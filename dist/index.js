"use strict";var Nd=Object.defineProperty;var Zo=n=>{throw TypeError(n)};var Rd=(n,e,t)=>e in n?Nd(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var w=(n,e,t)=>Rd(n,typeof e!="symbol"?e+"":e,t),vi=(n,e,t)=>e.has(n)||Zo("Cannot "+t);var k=(n,e,t)=>(vi(n,e,"read from private field"),t?t.call(n):e.get(n)),_e=(n,e,t)=>e.has(n)?Zo("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),ce=(n,e,t,s)=>(vi(n,e,"write to private field"),s?s.call(n,t):e.set(n,t),t),nt=(n,e,t)=>(vi(n,e,"access private method"),t);const vo=require("siyuan");function Pd(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Ld=Ac;function Ac(n,e,t){n instanceof RegExp&&(n=Xo(n,t)),e instanceof RegExp&&(e=Xo(e,t));var s=Cc(n,e,t);return s&&{start:s[0],end:s[1],pre:t.slice(0,s[0]),body:t.slice(s[0]+n.length,s[1]),post:t.slice(s[1]+e.length)}}function Xo(n,e){var t=e.match(n);return t?t[0]:null}Ac.range=Cc;function Cc(n,e,t){var s,r,a,i,l,c=t.indexOf(n),u=t.indexOf(e,c+1),d=c;if(c>=0&&u>0){if(n===e)return[c,u];for(s=[],a=t.length;d>=0&&!l;)d==c?(s.push(d),c=t.indexOf(n,d+1)):s.length==1?l=[s.pop(),u]:(r=s.pop(),r<a&&(a=r,i=u),u=t.indexOf(e,d+1)),d=c<u&&c>=0?c:u;s.length&&(l=[a,i])}return l}var Mc=Ld,qd=zd,Ic="\0SLASH"+Math.random()+"\0",Oc="\0OPEN"+Math.random()+"\0",po="\0CLOSE"+Math.random()+"\0",Nc="\0COMMA"+Math.random()+"\0",Rc="\0PERIOD"+Math.random()+"\0";function pi(n){return parseInt(n,10)==n?parseInt(n,10):n.charCodeAt(0)}function Fd(n){return n.split("\\\\").join(Ic).split("\\{").join(Oc).split("\\}").join(po).split("\\,").join(Nc).split("\\.").join(Rc)}function Ud(n){return n.split(Ic).join("\\").split(Oc).join("{").split(po).join("}").split(Nc).join(",").split(Rc).join(".")}function Pc(n){if(!n)return[""];var e=[],t=Mc("{","}",n);if(!t)return n.split(",");var s=t.pre,r=t.body,a=t.post,i=s.split(",");i[i.length-1]+="{"+r+"}";var l=Pc(a);return a.length&&(i[i.length-1]+=l.shift(),i.push.apply(i,l)),e.push.apply(e,i),e}function zd(n){return n?(n.substr(0,2)==="{}"&&(n="\\{\\}"+n.substr(2)),$r(Fd(n),!0).map(Ud)):[]}function Bd(n){return"{"+n+"}"}function Yd(n){return/^-?0\d/.test(n)}function $d(n,e){return n<=e}function jd(n,e){return n>=e}function $r(n,e){var t=[],s=Mc("{","}",n);if(!s)return[n];var r=s.pre,a=s.post.length?$r(s.post,!1):[""];if(/\$$/.test(s.pre))for(var i=0;i<a.length;i++){var l=r+"{"+s.body+"}"+a[i];t.push(l)}else{var c=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(s.body),u=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(s.body),d=c||u,f=s.body.indexOf(",")>=0;if(!d&&!f)return s.post.match(/,(?!,).*\}/)?(n=s.pre+"{"+s.body+po+s.post,$r(n)):[n];var v;if(d)v=s.body.split(/\.\./);else if(v=Pc(s.body),v.length===1&&(v=$r(v[0],!1).map(Bd),v.length===1))return a.map(function(Z){return s.pre+v[0]+Z});var y;if(d){var _=pi(v[0]),m=pi(v[1]),g=Math.max(v[0].length,v[1].length),b=v.length==3?Math.abs(pi(v[2])):1,x=$d,D=m<_;D&&(b*=-1,x=jd);var A=v.some(Yd);y=[];for(var I=_;x(I,m);I+=b){var N;if(u)N=String.fromCharCode(I),N==="\\"&&(N="");else if(N=String(I),A){var P=g-N.length;if(P>0){var H=new Array(P+1).join("0");I<0?N="-"+H+N.slice(1):N=H+N}}y.push(N)}}else{y=[];for(var j=0;j<v.length;j++)y.push.apply(y,$r(v[j],!1))}for(var j=0;j<y.length;j++)for(var i=0;i<a.length;i++){var l=r+y[j]+a[i];(!e||d||l)&&t.push(l)}}return t}const Wd=Pd(qd),Hd=1024*64,La=n=>{if(typeof n!="string")throw new TypeError("invalid pattern");if(n.length>Hd)throw new TypeError("pattern is too long")},Gd={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},Yr=n=>n.replace(/[[\]\\-]/g,"\\$&"),Kd=n=>n.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),Jo=n=>n.join(""),Vd=(n,e)=>{const t=e;if(n.charAt(t)!=="[")throw new Error("not in a brace expression");const s=[],r=[];let a=t+1,i=!1,l=!1,c=!1,u=!1,d=t,f="";e:for(;a<n.length;){const m=n.charAt(a);if((m==="!"||m==="^")&&a===t+1){u=!0,a++;continue}if(m==="]"&&i&&!c){d=a+1;break}if(i=!0,m==="\\"&&!c){c=!0,a++;continue}if(m==="["&&!c){for(const[g,[b,x,D]]of Object.entries(Gd))if(n.startsWith(g,a)){if(f)return["$.",!1,n.length-t,!0];a+=g.length,D?r.push(b):s.push(b),l=l||x;continue e}}if(c=!1,f){m>f?s.push(Yr(f)+"-"+Yr(m)):m===f&&s.push(Yr(m)),f="",a++;continue}if(n.startsWith("-]",a+1)){s.push(Yr(m+"-")),a+=2;continue}if(n.startsWith("-",a+1)){f=m,a+=2;continue}s.push(Yr(m)),a++}if(d<a)return["",!1,0,!1];if(!s.length&&!r.length)return["$.",!1,n.length-t,!0];if(r.length===0&&s.length===1&&/^\\?.$/.test(s[0])&&!u){const m=s[0].length===2?s[0].slice(-1):s[0];return[Kd(m),!1,d-t,!1]}const v="["+(u?"^":"")+Jo(s)+"]",y="["+(u?"":"^")+Jo(r)+"]";return[s.length&&r.length?"("+v+"|"+y+")":s.length?v:y,l,d-t,!0]},jr=(n,{windowsPathsNoEscape:e=!1}={})=>e?n.replace(/\[([^\/\\])\]/g,"$1"):n.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1"),Qd=new Set(["!","?","+","*","@"]),el=n=>Qd.has(n),Zd="(?!(?:^|/)\\.\\.?(?:$|/))",ba="(?!\\.)",Xd=new Set(["[","."]),Jd=new Set(["..","."]),eh=new Set("().*{}+?[]^$\\!"),th=n=>n.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),go="[^/]",tl=go+"*?",sl=go+"+?";var Tt,Et,Qs,rt,gt,yn,$n,bn,Fs,jn,aa,ar,Lc,Mn,Ca,Oi,qc;const Gt=class Gt{constructor(e,t,s={}){_e(this,ar);w(this,"type");_e(this,Tt);_e(this,Et);_e(this,Qs,!1);_e(this,rt,[]);_e(this,gt);_e(this,yn);_e(this,$n);_e(this,bn,!1);_e(this,Fs);_e(this,jn);_e(this,aa,!1);this.type=e,e&&ce(this,Et,!0),ce(this,gt,t),ce(this,Tt,k(this,gt)?k(k(this,gt),Tt):this),ce(this,Fs,k(this,Tt)===this?s:k(k(this,Tt),Fs)),ce(this,$n,k(this,Tt)===this?[]:k(k(this,Tt),$n)),e==="!"&&!k(k(this,Tt),bn)&&k(this,$n).push(this),ce(this,yn,k(this,gt)?k(k(this,gt),rt).length:0)}get hasMagic(){if(k(this,Et)!==void 0)return k(this,Et);for(const e of k(this,rt))if(typeof e!="string"&&(e.type||e.hasMagic))return ce(this,Et,!0);return k(this,Et)}toString(){return k(this,jn)!==void 0?k(this,jn):this.type?ce(this,jn,this.type+"("+k(this,rt).map(e=>String(e)).join("|")+")"):ce(this,jn,k(this,rt).map(e=>String(e)).join(""))}push(...e){for(const t of e)if(t!==""){if(typeof t!="string"&&!(t instanceof Gt&&k(t,gt)===this))throw new Error("invalid part: "+t);k(this,rt).push(t)}}toJSON(){var t;const e=this.type===null?k(this,rt).slice().map(s=>typeof s=="string"?s:s.toJSON()):[this.type,...k(this,rt).map(s=>s.toJSON())];return this.isStart()&&!this.type&&e.unshift([]),this.isEnd()&&(this===k(this,Tt)||k(k(this,Tt),bn)&&((t=k(this,gt))==null?void 0:t.type)==="!")&&e.push({}),e}isStart(){var t;if(k(this,Tt)===this)return!0;if(!((t=k(this,gt))!=null&&t.isStart()))return!1;if(k(this,yn)===0)return!0;const e=k(this,gt);for(let s=0;s<k(this,yn);s++){const r=k(e,rt)[s];if(!(r instanceof Gt&&r.type==="!"))return!1}return!0}isEnd(){var t,s,r;if(k(this,Tt)===this||((t=k(this,gt))==null?void 0:t.type)==="!")return!0;if(!((s=k(this,gt))!=null&&s.isEnd()))return!1;if(!this.type)return(r=k(this,gt))==null?void 0:r.isEnd();const e=k(this,gt)?k(k(this,gt),rt).length:0;return k(this,yn)===e-1}copyIn(e){typeof e=="string"?this.push(e):this.push(e.clone(this))}clone(e){const t=new Gt(this.type,e);for(const s of k(this,rt))t.copyIn(s);return t}static fromGlob(e,t={}){var r;const s=new Gt(null,void 0,t);return nt(r=Gt,Mn,Ca).call(r,e,s,0,t),s}toMMPattern(){if(this!==k(this,Tt))return k(this,Tt).toMMPattern();const e=this.toString(),[t,s,r,a]=this.toRegExpSource();if(!(r||k(this,Et)||k(this,Fs).nocase&&!k(this,Fs).nocaseMagicOnly&&e.toUpperCase()!==e.toLowerCase()))return s;const l=(k(this,Fs).nocase?"i":"")+(a?"u":"");return Object.assign(new RegExp(`^${t}$`,l),{_src:t,_glob:e})}get options(){return k(this,Fs)}toRegExpSource(e){var c;const t=e??!!k(this,Fs).dot;if(k(this,Tt)===this&&nt(this,ar,Lc).call(this),!this.type){const u=this.isStart()&&this.isEnd(),d=k(this,rt).map(_=>{var D;const[m,g,b,x]=typeof _=="string"?nt(D=Gt,Mn,qc).call(D,_,k(this,Et),u):_.toRegExpSource(e);return ce(this,Et,k(this,Et)||b),ce(this,Qs,k(this,Qs)||x),m}).join("");let f="";if(this.isStart()&&typeof k(this,rt)[0]=="string"&&!(k(this,rt).length===1&&Jd.has(k(this,rt)[0]))){const m=Xd,g=t&&m.has(d.charAt(0))||d.startsWith("\\.")&&m.has(d.charAt(2))||d.startsWith("\\.\\.")&&m.has(d.charAt(4)),b=!t&&!e&&m.has(d.charAt(0));f=g?Zd:b?ba:""}let v="";return this.isEnd()&&k(k(this,Tt),bn)&&((c=k(this,gt))==null?void 0:c.type)==="!"&&(v="(?:$|\\/)"),[f+d+v,jr(d),ce(this,Et,!!k(this,Et)),k(this,Qs)]}const s=this.type==="*"||this.type==="+",r=this.type==="!"?"(?:(?!(?:":"(?:";let a=nt(this,ar,Oi).call(this,t);if(this.isStart()&&this.isEnd()&&!a&&this.type!=="!"){const u=this.toString();return ce(this,rt,[u]),this.type=null,ce(this,Et,void 0),[u,jr(this.toString()),!1,!1]}let i=!s||e||t||!ba?"":nt(this,ar,Oi).call(this,!0);i===a&&(i=""),i&&(a=`(?:${a})(?:${i})*?`);let l="";if(this.type==="!"&&k(this,aa))l=(this.isStart()&&!t?ba:"")+sl;else{const u=this.type==="!"?"))"+(this.isStart()&&!t&&!e?ba:"")+tl+")":this.type==="@"?")":this.type==="?"?")?":this.type==="+"&&i?")":this.type==="*"&&i?")?":`)${this.type}`;l=r+a+u}return[l,jr(a),ce(this,Et,!!k(this,Et)),k(this,Qs)]}};Tt=new WeakMap,Et=new WeakMap,Qs=new WeakMap,rt=new WeakMap,gt=new WeakMap,yn=new WeakMap,$n=new WeakMap,bn=new WeakMap,Fs=new WeakMap,jn=new WeakMap,aa=new WeakMap,ar=new WeakSet,Lc=function(){if(this!==k(this,Tt))throw new Error("should only call on root");if(k(this,bn))return this;this.toString(),ce(this,bn,!0);let e;for(;e=k(this,$n).pop();){if(e.type!=="!")continue;let t=e,s=k(t,gt);for(;s;){for(let r=k(t,yn)+1;!s.type&&r<k(s,rt).length;r++)for(const a of k(e,rt)){if(typeof a=="string")throw new Error("string part in extglob AST??");a.copyIn(k(s,rt)[r])}t=s,s=k(t,gt)}}return this},Mn=new WeakSet,Ca=function(e,t,s,r){var y,_;let a=!1,i=!1,l=-1,c=!1;if(t.type===null){let m=s,g="";for(;m<e.length;){const b=e.charAt(m++);if(a||b==="\\"){a=!a,g+=b;continue}if(i){m===l+1?(b==="^"||b==="!")&&(c=!0):b==="]"&&!(m===l+2&&c)&&(i=!1),g+=b;continue}else if(b==="["){i=!0,l=m,c=!1,g+=b;continue}if(!r.noext&&el(b)&&e.charAt(m)==="("){t.push(g),g="";const x=new Gt(b,t);m=nt(y=Gt,Mn,Ca).call(y,e,x,m,r),t.push(x);continue}g+=b}return t.push(g),m}let u=s+1,d=new Gt(null,t);const f=[];let v="";for(;u<e.length;){const m=e.charAt(u++);if(a||m==="\\"){a=!a,v+=m;continue}if(i){u===l+1?(m==="^"||m==="!")&&(c=!0):m==="]"&&!(u===l+2&&c)&&(i=!1),v+=m;continue}else if(m==="["){i=!0,l=u,c=!1,v+=m;continue}if(el(m)&&e.charAt(u)==="("){d.push(v),v="";const g=new Gt(m,d);d.push(g),u=nt(_=Gt,Mn,Ca).call(_,e,g,u,r);continue}if(m==="|"){d.push(v),v="",f.push(d),d=new Gt(null,t);continue}if(m===")")return v===""&&k(t,rt).length===0&&ce(t,aa,!0),d.push(v),v="",t.push(...f,d),u;v+=m}return t.type=null,ce(t,Et,void 0),ce(t,rt,[e.substring(s-1)]),u},Oi=function(e){return k(this,rt).map(t=>{if(typeof t=="string")throw new Error("string type in extglob ast??");const[s,r,a,i]=t.toRegExpSource(e);return ce(this,Qs,k(this,Qs)||i),s}).filter(t=>!(this.isStart()&&this.isEnd())||!!t).join("|")},qc=function(e,t,s=!1){let r=!1,a="",i=!1;for(let l=0;l<e.length;l++){const c=e.charAt(l);if(r){r=!1,a+=(eh.has(c)?"\\":"")+c;continue}if(c==="\\"){l===e.length-1?a+="\\\\":r=!0;continue}if(c==="["){const[u,d,f,v]=Vd(e,l);if(f){a+=u,i=i||d,l+=f-1,t=t||v;continue}}if(c==="*"){s&&e==="*"?a+=sl:a+=tl,t=!0;continue}if(c==="?"){a+=go,t=!0;continue}a+=th(c)}return[a,jr(e),!!t,i]},_e(Gt,Mn);let qa=Gt;const sh=(n,{windowsPathsNoEscape:e=!1}={})=>e?n.replace(/[?*()[\]]/g,"[$&]"):n.replace(/[?*()[\]\\]/g,"\\$&"),Zt=(n,e,t={})=>(La(e),!t.nocomment&&e.charAt(0)==="#"?!1:new Er(e,t).match(n)),nh=/^\*+([^+@!?\*\[\(]*)$/,rh=n=>e=>!e.startsWith(".")&&e.endsWith(n),ah=n=>e=>e.endsWith(n),ih=n=>(n=n.toLowerCase(),e=>!e.startsWith(".")&&e.toLowerCase().endsWith(n)),oh=n=>(n=n.toLowerCase(),e=>e.toLowerCase().endsWith(n)),lh=/^\*+\.\*+$/,ch=n=>!n.startsWith(".")&&n.includes("."),uh=n=>n!=="."&&n!==".."&&n.includes("."),dh=/^\.\*+$/,hh=n=>n!=="."&&n!==".."&&n.startsWith("."),fh=/^\*+$/,vh=n=>n.length!==0&&!n.startsWith("."),ph=n=>n.length!==0&&n!=="."&&n!=="..",gh=/^\?+([^+@!?\*\[\(]*)?$/,mh=([n,e=""])=>{const t=Fc([n]);return e?(e=e.toLowerCase(),s=>t(s)&&s.toLowerCase().endsWith(e)):t},yh=([n,e=""])=>{const t=Uc([n]);return e?(e=e.toLowerCase(),s=>t(s)&&s.toLowerCase().endsWith(e)):t},bh=([n,e=""])=>{const t=Uc([n]);return e?s=>t(s)&&s.endsWith(e):t},wh=([n,e=""])=>{const t=Fc([n]);return e?s=>t(s)&&s.endsWith(e):t},Fc=([n])=>{const e=n.length;return t=>t.length===e&&!t.startsWith(".")},Uc=([n])=>{const e=n.length;return t=>t.length===e&&t!=="."&&t!==".."},zc=typeof process=="object"&&process?typeof process.env=="object"&&process.env&&process.env.__MINIMATCH_TESTING_PLATFORM__||process.platform:"posix",nl={win32:{sep:"\\"},posix:{sep:"/"}},_h=zc==="win32"?nl.win32.sep:nl.posix.sep;Zt.sep=_h;const ms=Symbol("globstar **");Zt.GLOBSTAR=ms;const kh="[^/]",Th=kh+"*?",Sh="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",xh="(?:(?!(?:\\/|^)\\.).)*?",Dh=(n,e={})=>t=>Zt(t,n,e);Zt.filter=Dh;const gs=(n,e={})=>Object.assign({},n,e),Eh=n=>{if(!n||typeof n!="object"||!Object.keys(n).length)return Zt;const e=Zt;return Object.assign((s,r,a={})=>e(s,r,gs(n,a)),{Minimatch:class extends e.Minimatch{constructor(r,a={}){super(r,gs(n,a))}static defaults(r){return e.defaults(gs(n,r)).Minimatch}},AST:class extends e.AST{constructor(r,a,i={}){super(r,a,gs(n,i))}static fromGlob(r,a={}){return e.AST.fromGlob(r,gs(n,a))}},unescape:(s,r={})=>e.unescape(s,gs(n,r)),escape:(s,r={})=>e.escape(s,gs(n,r)),filter:(s,r={})=>e.filter(s,gs(n,r)),defaults:s=>e.defaults(gs(n,s)),makeRe:(s,r={})=>e.makeRe(s,gs(n,r)),braceExpand:(s,r={})=>e.braceExpand(s,gs(n,r)),match:(s,r,a={})=>e.match(s,r,gs(n,a)),sep:e.sep,GLOBSTAR:ms})};Zt.defaults=Eh;const Bc=(n,e={})=>(La(n),e.nobrace||!/\{(?:(?!\{).)*\}/.test(n)?[n]:Wd(n));Zt.braceExpand=Bc;const Ah=(n,e={})=>new Er(n,e).makeRe();Zt.makeRe=Ah;const Ch=(n,e,t={})=>{const s=new Er(e,t);return n=n.filter(r=>s.match(r)),s.options.nonull&&!n.length&&n.push(e),n};Zt.match=Ch;const rl=/[?*]|[+@!]\(.*?\)|\[|\]/,Mh=n=>n.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");class Er{constructor(e,t={}){w(this,"options");w(this,"set");w(this,"pattern");w(this,"windowsPathsNoEscape");w(this,"nonegate");w(this,"negate");w(this,"comment");w(this,"empty");w(this,"preserveMultipleSlashes");w(this,"partial");w(this,"globSet");w(this,"globParts");w(this,"nocase");w(this,"isWindows");w(this,"platform");w(this,"windowsNoMagicRoot");w(this,"regexp");La(e),t=t||{},this.options=t,this.pattern=e,this.platform=t.platform||zc,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!t.windowsPathsNoEscape||t.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!t.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!t.nonegate,this.comment=!1,this.empty=!1,this.partial=!!t.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=t.windowsNoMagicRoot!==void 0?t.windowsNoMagicRoot:!!(this.isWindows&&this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(const e of this.set)for(const t of e)if(typeof t!="string")return!0;return!1}debug(...e){}make(){const e=this.pattern,t=this.options;if(!t.nocomment&&e.charAt(0)==="#"){this.comment=!0;return}if(!e){this.empty=!0;return}this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],t.debug&&(this.debug=(...a)=>console.error(...a)),this.debug(this.pattern,this.globSet);const s=this.globSet.map(a=>this.slashSplit(a));this.globParts=this.preprocess(s),this.debug(this.pattern,this.globParts);let r=this.globParts.map((a,i,l)=>{if(this.isWindows&&this.windowsNoMagicRoot){const c=a[0]===""&&a[1]===""&&(a[2]==="?"||!rl.test(a[2]))&&!rl.test(a[3]),u=/^[a-z]:/i.test(a[0]);if(c)return[...a.slice(0,4),...a.slice(4).map(d=>this.parse(d))];if(u)return[a[0],...a.slice(1).map(d=>this.parse(d))]}return a.map(c=>this.parse(c))});if(this.debug(this.pattern,r),this.set=r.filter(a=>a.indexOf(!1)===-1),this.isWindows)for(let a=0;a<this.set.length;a++){const i=this.set[a];i[0]===""&&i[1]===""&&this.globParts[a][2]==="?"&&typeof i[3]=="string"&&/^[a-z]:$/i.test(i[3])&&(i[2]="?")}this.debug(this.pattern,this.set)}preprocess(e){if(this.options.noglobstar)for(let s=0;s<e.length;s++)for(let r=0;r<e[s].length;r++)e[s][r]==="**"&&(e[s][r]="*");const{optimizationLevel:t=1}=this.options;return t>=2?(e=this.firstPhasePreProcess(e),e=this.secondPhasePreProcess(e)):t>=1?e=this.levelOneOptimize(e):e=this.adjascentGlobstarOptimize(e),e}adjascentGlobstarOptimize(e){return e.map(t=>{let s=-1;for(;(s=t.indexOf("**",s+1))!==-1;){let r=s;for(;t[r+1]==="**";)r++;r!==s&&t.splice(s,r-s)}return t})}levelOneOptimize(e){return e.map(t=>(t=t.reduce((s,r)=>{const a=s[s.length-1];return r==="**"&&a==="**"?s:r===".."&&a&&a!==".."&&a!=="."&&a!=="**"?(s.pop(),s):(s.push(r),s)},[]),t.length===0?[""]:t))}levelTwoFileOptimize(e){Array.isArray(e)||(e=this.slashSplit(e));let t=!1;do{if(t=!1,!this.preserveMultipleSlashes){for(let r=1;r<e.length-1;r++){const a=e[r];r===1&&a===""&&e[0]===""||(a==="."||a==="")&&(t=!0,e.splice(r,1),r--)}e[0]==="."&&e.length===2&&(e[1]==="."||e[1]==="")&&(t=!0,e.pop())}let s=0;for(;(s=e.indexOf("..",s+1))!==-1;){const r=e[s-1];r&&r!=="."&&r!==".."&&r!=="**"&&(t=!0,e.splice(s-1,2),s-=2)}}while(t);return e.length===0?[""]:e}firstPhasePreProcess(e){let t=!1;do{t=!1;for(let s of e){let r=-1;for(;(r=s.indexOf("**",r+1))!==-1;){let i=r;for(;s[i+1]==="**";)i++;i>r&&s.splice(r+1,i-r);let l=s[r+1];const c=s[r+2],u=s[r+3];if(l!==".."||!c||c==="."||c===".."||!u||u==="."||u==="..")continue;t=!0,s.splice(r,1);const d=s.slice(0);d[r]="**",e.push(d),r--}if(!this.preserveMultipleSlashes){for(let i=1;i<s.length-1;i++){const l=s[i];i===1&&l===""&&s[0]===""||(l==="."||l==="")&&(t=!0,s.splice(i,1),i--)}s[0]==="."&&s.length===2&&(s[1]==="."||s[1]==="")&&(t=!0,s.pop())}let a=0;for(;(a=s.indexOf("..",a+1))!==-1;){const i=s[a-1];if(i&&i!=="."&&i!==".."&&i!=="**"){t=!0;const c=a===1&&s[a+1]==="**"?["."]:[];s.splice(a-1,2,...c),s.length===0&&s.push(""),a-=2}}}}while(t);return e}secondPhasePreProcess(e){for(let t=0;t<e.length-1;t++)for(let s=t+1;s<e.length;s++){const r=this.partsMatch(e[t],e[s],!this.preserveMultipleSlashes);if(r){e[t]=[],e[s]=r;break}}return e.filter(t=>t.length)}partsMatch(e,t,s=!1){let r=0,a=0,i=[],l="";for(;r<e.length&&a<t.length;)if(e[r]===t[a])i.push(l==="b"?t[a]:e[r]),r++,a++;else if(s&&e[r]==="**"&&t[a]===e[r+1])i.push(e[r]),r++;else if(s&&t[a]==="**"&&e[r]===t[a+1])i.push(t[a]),a++;else if(e[r]==="*"&&t[a]&&(this.options.dot||!t[a].startsWith("."))&&t[a]!=="**"){if(l==="b")return!1;l="a",i.push(e[r]),r++,a++}else if(t[a]==="*"&&e[r]&&(this.options.dot||!e[r].startsWith("."))&&e[r]!=="**"){if(l==="a")return!1;l="b",i.push(t[a]),r++,a++}else return!1;return e.length===t.length&&i}parseNegate(){if(this.nonegate)return;const e=this.pattern;let t=!1,s=0;for(let r=0;r<e.length&&e.charAt(r)==="!";r++)t=!t,s++;s&&(this.pattern=e.slice(s)),this.negate=t}matchOne(e,t,s=!1){const r=this.options;if(this.isWindows){const m=typeof e[0]=="string"&&/^[a-z]:$/i.test(e[0]),g=!m&&e[0]===""&&e[1]===""&&e[2]==="?"&&/^[a-z]:$/i.test(e[3]),b=typeof t[0]=="string"&&/^[a-z]:$/i.test(t[0]),x=!b&&t[0]===""&&t[1]===""&&t[2]==="?"&&typeof t[3]=="string"&&/^[a-z]:$/i.test(t[3]),D=g?3:m?0:void 0,A=x?3:b?0:void 0;if(typeof D=="number"&&typeof A=="number"){const[I,N]=[e[D],t[A]];I.toLowerCase()===N.toLowerCase()&&(t[A]=I,A>D?t=t.slice(A):D>A&&(e=e.slice(D)))}}const{optimizationLevel:a=1}=this.options;a>=2&&(e=this.levelTwoFileOptimize(e)),this.debug("matchOne",this,{file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var i=0,l=0,c=e.length,u=t.length;i<c&&l<u;i++,l++){this.debug("matchOne loop");var d=t[l],f=e[i];if(this.debug(t,d,f),d===!1)return!1;if(d===ms){this.debug("GLOBSTAR",[t,d,f]);var v=i,y=l+1;if(y===u){for(this.debug("** at the end");i<c;i++)if(e[i]==="."||e[i]===".."||!r.dot&&e[i].charAt(0)===".")return!1;return!0}for(;v<c;){var _=e[v];if(this.debug(`
globstar while`,e,v,t,y,_),this.matchOne(e.slice(v),t.slice(y),s))return this.debug("globstar found match!",v,c,_),!0;if(_==="."||_===".."||!r.dot&&_.charAt(0)==="."){this.debug("dot detected!",e,v,t,y);break}this.debug("globstar swallow a segment, and continue"),v++}return!!(s&&(this.debug(`
>>> no match, partial?`,e,v,t,y),v===c))}let m;if(typeof d=="string"?(m=f===d,this.debug("string match",d,f,m)):(m=d.test(f),this.debug("pattern match",d,f,m)),!m)return!1}if(i===c&&l===u)return!0;if(i===c)return s;if(l===u)return i===c-1&&e[i]==="";throw new Error("wtf?")}braceExpand(){return Bc(this.pattern,this.options)}parse(e){La(e);const t=this.options;if(e==="**")return ms;if(e==="")return"";let s,r=null;(s=e.match(fh))?r=t.dot?ph:vh:(s=e.match(nh))?r=(t.nocase?t.dot?oh:ih:t.dot?ah:rh)(s[1]):(s=e.match(gh))?r=(t.nocase?t.dot?yh:mh:t.dot?bh:wh)(s):(s=e.match(lh))?r=t.dot?uh:ch:(s=e.match(dh))&&(r=hh);const a=qa.fromGlob(e,this.options).toMMPattern();return r&&typeof a=="object"&&Reflect.defineProperty(a,"test",{value:r}),a}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;const e=this.set;if(!e.length)return this.regexp=!1,this.regexp;const t=this.options,s=t.noglobstar?Th:t.dot?Sh:xh,r=new Set(t.nocase?["i"]:[]);let a=e.map(c=>{const u=c.map(d=>{if(d instanceof RegExp)for(const f of d.flags.split(""))r.add(f);return typeof d=="string"?Mh(d):d===ms?ms:d._src});return u.forEach((d,f)=>{const v=u[f+1],y=u[f-1];d!==ms||y===ms||(y===void 0?v!==void 0&&v!==ms?u[f+1]="(?:\\/|"+s+"\\/)?"+v:u[f]=s:v===void 0?u[f-1]=y+"(?:\\/|"+s+")?":v!==ms&&(u[f-1]=y+"(?:\\/|\\/"+s+"\\/)"+v,u[f+1]=ms))}),u.filter(d=>d!==ms).join("/")}).join("|");const[i,l]=e.length>1?["(?:",")"]:["",""];a="^"+i+a+l+"$",this.negate&&(a="^(?!"+a+").+$");try{this.regexp=new RegExp(a,[...r].join(""))}catch{this.regexp=!1}return this.regexp}slashSplit(e){return this.preserveMultipleSlashes?e.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(e)?["",...e.split(/\/+/)]:e.split(/\/+/)}match(e,t=this.partial){if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&t)return!0;const s=this.options;this.isWindows&&(e=e.split("\\").join("/"));const r=this.slashSplit(e);this.debug(this.pattern,"split",r);const a=this.set;this.debug(this.pattern,"set",a);let i=r[r.length-1];if(!i)for(let l=r.length-2;!i&&l>=0;l--)i=r[l];for(let l=0;l<a.length;l++){const c=a[l];let u=r;if(s.matchBase&&c.length===1&&(u=[i]),this.matchOne(u,c,t))return s.flipNegate?!0:!this.negate}return s.flipNegate?!1:this.negate}static defaults(e){return Zt.defaults(e).Minimatch}}Zt.AST=qa;Zt.Minimatch=Er;Zt.escape=sh;Zt.unescape=jr;function Ih(n){const e=[];if((!n.name||n.name.trim().length===0)&&e.push("name: Profile name cannot be empty"),(!n.regexTargets||n.regexTargets.length===0)&&e.push("regexTargets: Must include at least one target"),n.includeRegex)try{new RegExp(n.includeRegex)}catch(t){e.push(`includeRegex: ${t instanceof Error?t.message:String(t)}`)}if(n.excludeRegex)try{new RegExp(n.excludeRegex)}catch(t){e.push(`excludeRegex: ${t instanceof Error?t.message:String(t)}`)}return[...n.includeTags,...n.excludeTags].forEach(t=>{t.startsWith("#")||e.push(`Invalid tag "${t}" - must start with #`)}),{valid:e.length===0,errors:e}}const Oh={id:"default",name:"Default",description:"Include all tasks",includePaths:[],excludePaths:[],includeTags:[],excludeTags:[],includeRegex:void 0,excludeRegex:void 0,regexTargets:["taskText"],excludeStatusTypes:[]},Jr={enabled:!1,mode:"all",activeProfileId:"default",profiles:[Oh]};class Nh{constructor(e){w(this,"includePathMatchers",[]);w(this,"excludePathMatchers",[]);w(this,"includeTagsSet",new Set);w(this,"excludeTagsSet",new Set);w(this,"includeRegex");w(this,"excludeRegex");w(this,"regexTargets");if(this.includePathMatchers=e.includePaths.map(t=>new Er(this.normalizePath(t),{dot:!0,matchBase:!0})),this.excludePathMatchers=e.excludePaths.map(t=>new Er(this.normalizePath(t),{dot:!0,matchBase:!0})),this.includeTagsSet=new Set(e.includeTags.map(t=>this.normalizeTag(t))),this.excludeTagsSet=new Set(e.excludeTags.map(t=>this.normalizeTag(t))),e.includeRegex)try{this.includeRegex=new RegExp(e.includeRegex)}catch{}if(e.excludeRegex)try{this.excludeRegex=new RegExp(e.excludeRegex)}catch{}this.regexTargets=new Set(e.regexTargets)}matches(e){return this.explain(e).included}explain(e){const t=this.buildContext(e);if(this.excludePathMatchers.length>0&&t.path){for(const s of this.excludePathMatchers)if(s.match(t.path))return{included:!1,reason:"Excluded by path pattern",matchedRule:{type:"excludePath",pattern:s.pattern}}}if(this.includePathMatchers.length>0){if(!t.path)return{included:!1,reason:"includePaths set but task has no path metadata"};let s=!1;for(const r of this.includePathMatchers)if(r.match(t.path)){s=!0;break}if(!s)return{included:!1,reason:"Did not match any includePath pattern"}}if(this.excludeTagsSet.size>0&&t.tags.length>0){for(const s of t.tags)if(this.excludeTagsSet.has(s))return{included:!1,reason:"Excluded by tag",matchedRule:{type:"excludeTag",pattern:s}}}if(this.includeTagsSet.size>0){if(t.tags.length===0)return{included:!1,reason:"includeTags set but task has no tags"};let s=!1;for(const r of t.tags)if(this.includeTagsSet.has(r)){s=!0;break}if(!s)return{included:!1,reason:"Did not match any includeTag"}}if(this.excludeRegex){const s=this.extractRegexTargets(e,t);for(const[r,a]of s)if(this.excludeRegex.test(a))return{included:!1,reason:"Excluded by regex",matchedRule:{type:"excludeRegex",pattern:this.excludeRegex.source,target:r}}}if(this.includeRegex){const s=this.extractRegexTargets(e,t);let r=!1;for(const[,a]of s)if(this.includeRegex.test(a)){r=!0;break}if(!r)return{included:!1,reason:"Did not match includeRegex",matchedRule:{type:"includeRegex",pattern:this.includeRegex.source}}}return{included:!0,reason:"Passed all filters"}}buildContext(e){return{path:e.path?this.normalizePath(e.path):void 0,fileName:e.path?this.extractFileName(e.path):void 0,tags:(e.tags||[]).map(t=>this.normalizeTag(t)),taskText:e.name||""}}extractRegexTargets(e,t){const s=[];return this.regexTargets.has("taskText")&&s.push(["taskText",t.taskText]),this.regexTargets.has("path")&&t.path&&s.push(["path",t.path]),this.regexTargets.has("fileName")&&t.fileName&&s.push(["fileName",t.fileName]),s}normalizePath(e){return e.replace(/\\/g,"/").replace(/^\/+/,"")}normalizeTag(e){return e.startsWith("#")?e.toLowerCase():`#${e}`.toLowerCase()}extractFileName(e){return e.split("/").pop()||""}}const qn=class qn{constructor(){w(this,"config");w(this,"compiled",null);this.config=Jr}static getInstance(){return qn.instance||(qn.instance=new qn),qn.instance}initialize(e){this.updateConfig(e)}updateConfig(e){this.config=e,this.compile()}compile(){if(!this.config.enabled){this.compiled=null;return}const e=this.config.profiles.find(t=>t.id===this.config.activeProfileId)||this.config.profiles[0];if(!e){this.compiled=null;return}this.compiled=new Nh(e)}shouldTreatAsTask(e,t){if(!this.compiled)return!0;const s=this.extractTagsFromContent(e),r={name:e,path:t,tags:s};return this.compiled.matches(r)}shouldIncludeTask(e){return this.compiled?this.compiled.matches(e):!0}explainTask(e){return this.compiled?this.compiled.explain(e):{included:!0,reason:"Global filter disabled"}}extractTagsFromContent(e){return e.match(/#[\w\/-]+/g)||[]}getConfig(){return this.config}getActiveProfile(){return this.config.profiles.find(e=>e.id===this.config.activeProfileId)}setActiveProfile(e){this.config.profiles.some(t=>t.id===e)&&(this.config.activeProfileId=e,this.compile())}reset(){this.updateConfig(Jr)}};w(qn,"instance");let us=qn;const Ni=!1;var mo=Array.isArray,Rh=Array.prototype.indexOf,Xa=Array.from,Ph=Object.defineProperty,wr=Object.getOwnPropertyDescriptor,Yc=Object.getOwnPropertyDescriptors,Lh=Object.prototype,qh=Array.prototype,yo=Object.getPrototypeOf,al=Object.isExtensible;function Fh(n){for(var e=0;e<n.length;e++)n[e]()}function $c(){var n,e,t=new Promise((s,r)=>{n=s,e=r});return{promise:t,resolve:n,reject:e}}function jc(n,e){if(Array.isArray(n))return n;if(!(Symbol.iterator in n))return Array.from(n);const t=[];for(const s of n)if(t.push(s),t.length===e)break;return t}const qt=2,Fa=4,Ja=8,Wc=1<<24,an=16,on=32,ir=64,bo=128,Ds=512,$t=1024,Xt=2048,ln=4096,hs=8192,en=16384,wo=32768,Ar=65536,il=1<<17,Hc=1<<18,Pr=1<<19,Uh=1<<20,Xs=1<<25,sr=32768,Ri=1<<21,_o=1<<22,Dn=1<<23,tn=Symbol("$state"),zh=Symbol("legacy props"),Bh=Symbol(""),yr=new class extends Error{constructor(){super(...arguments);w(this,"name","StaleReactionError");w(this,"message","The reaction that called `getAbortSignal()` was re-run or destroyed")}};function ko(n){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Yh(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function $h(n){throw new Error("https://svelte.dev/e/effect_in_teardown")}function jh(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Wh(n){throw new Error("https://svelte.dev/e/effect_orphan")}function Hh(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Gh(n){throw new Error("https://svelte.dev/e/props_invalid_value")}function Kh(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Vh(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Qh(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function Zh(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const Xh=1,Jh=2,Gc=4,ef=8,tf=16,sf=1,nf=4,rf=8,af=16,of=1,lf=2,Rt=Symbol(),cf="http://www.w3.org/1999/xhtml";function uf(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function df(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function Kc(n){return n===this.v}function Vc(n,e){return n!=n?e==e:n!==e||n!==null&&typeof n=="object"||typeof n=="function"}function Qc(n){return!Vc(n,this.v)}let hf=!1,St=null;function Cr(n){St=n}function Zc(n){return Jc().get(n)}function ff(n,e){return Jc().set(n,e),e}function dt(n,e=!1,t){St={p:St,i:!1,c:null,e:null,s:n,x:null,l:null}}function ht(n){var e=St,t=e.e;if(t!==null){e.e=null;for(var s of t)yu(s)}return e.i=!0,St=e.p,{}}function Xc(){return!0}function Jc(n){return St===null&&ko(),St.c??(St.c=new Map(vf(St)||void 0))}function vf(n){let e=n.p;for(;e!==null;){const t=e.c;if(t!==null)return t;e=e.p}return null}let zn=[];function eu(){var n=zn;zn=[],Fh(n)}function Lr(n){if(zn.length===0&&!Vr){var e=zn;queueMicrotask(()=>{e===zn&&eu()})}zn.push(n)}function pf(){for(;zn.length>0;)eu()}function tu(n){var e=Ge;if(e===null)return Pe.f|=Dn,n;if(e.f&wo)Mr(n,e);else{if(!(e.f&bo))throw n;e.b.error(n)}}function Mr(n,e){for(;e!==null;){if(e.f&bo)try{e.b.error(n);return}catch(t){n=t}e=e.parent}throw n}const gf=-7169;function Mt(n,e){n.f=n.f&gf|e}function To(n){n.f&Ds||n.deps===null?Mt(n,$t):Mt(n,ln)}function su(n){if(n!==null)for(const e of n)!(e.f&qt)||!(e.f&sr)||(e.f^=sr,su(e.deps))}function nu(n,e,t){n.f&Xt?e.add(n):n.f&ln&&t.add(n),su(n.deps),Mt(n,$t)}const wa=new Set;let Re=null,Kr=null,Pt=null,Ts=[],ei=null,Pi=!1,Vr=!1;var _r,kr,Wn,Hn,ia,Tr,Sr,Es,Li,qi,ru,au;const Va=class Va{constructor(){_e(this,Es);w(this,"committed",!1);w(this,"current",new Map);w(this,"previous",new Map);_e(this,_r,new Set);_e(this,kr,new Set);_e(this,Wn,0);_e(this,Hn,0);_e(this,ia,null);_e(this,Tr,new Set);_e(this,Sr,new Set);w(this,"skipped_effects",new Set);w(this,"is_fork",!1)}is_deferred(){return this.is_fork||k(this,Hn)>0}process(e){var r;Ts=[],Kr=null,this.apply();var t=[],s=[];for(const a of e)nt(this,Es,Li).call(this,a,t,s);this.is_fork||nt(this,Es,ru).call(this),this.is_deferred()?(nt(this,Es,qi).call(this,s),nt(this,Es,qi).call(this,t)):(Kr=this,Re=null,ol(s),ol(t),Kr=null,(r=k(this,ia))==null||r.resolve()),Pt=null}capture(e,t){t!==Rt&&!this.previous.has(e)&&this.previous.set(e,t),e.f&Dn||(this.current.set(e,e.v),Pt==null||Pt.set(e,e.v))}activate(){Re=this,this.apply()}deactivate(){Re===this&&(Re=null,Pt=null)}flush(){if(this.activate(),Ts.length>0){if(iu(),Re!==null&&Re!==this)return}else k(this,Wn)===0&&this.process([]);this.deactivate()}discard(){for(const e of k(this,kr))e(this);k(this,kr).clear()}increment(e){ce(this,Wn,k(this,Wn)+1),e&&ce(this,Hn,k(this,Hn)+1)}decrement(e){ce(this,Wn,k(this,Wn)-1),e&&ce(this,Hn,k(this,Hn)-1),this.revive()}revive(){for(const e of k(this,Tr))k(this,Sr).delete(e),Mt(e,Xt),nn(e);for(const e of k(this,Sr))Mt(e,ln),nn(e);this.flush()}oncommit(e){k(this,_r).add(e)}ondiscard(e){k(this,kr).add(e)}settled(){return(k(this,ia)??ce(this,ia,$c())).promise}static ensure(){if(Re===null){const e=Re=new Va;wa.add(Re),Vr||Va.enqueue(()=>{Re===e&&e.flush()})}return Re}static enqueue(e){Lr(e)}apply(){}};_r=new WeakMap,kr=new WeakMap,Wn=new WeakMap,Hn=new WeakMap,ia=new WeakMap,Tr=new WeakMap,Sr=new WeakMap,Es=new WeakSet,Li=function(e,t,s){e.f^=$t;for(var r=e.first,a=null;r!==null;){var i=r.f,l=(i&(on|ir))!==0,c=l&&(i&$t)!==0,u=c||(i&hs)!==0||this.skipped_effects.has(r);if(!u&&r.fn!==null){l?r.f^=$t:a!==null&&i&(Fa|Ja|Wc)?a.b.defer_effect(r):i&Fa?t.push(r):da(r)&&(i&an&&k(this,Tr).add(r),ta(r));var d=r.first;if(d!==null){r=d;continue}}var f=r.parent;for(r=r.next;r===null&&f!==null;)f===a&&(a=null),r=f.next,f=f.parent}},qi=function(e){for(var t=0;t<e.length;t+=1)nu(e[t],k(this,Tr),k(this,Sr))},ru=function(){if(k(this,Hn)===0){for(const e of k(this,_r))e();k(this,_r).clear()}k(this,Wn)===0&&nt(this,Es,au).call(this)},au=function(){var r;if(wa.size>1){this.previous.clear();var e=Pt,t=!0;for(const a of wa){if(a===this){t=!1;continue}const i=[];for(const[c,u]of this.current){if(a.current.has(c))if(t&&u!==a.current.get(c))a.current.set(c,u);else continue;i.push(c)}if(i.length===0)continue;const l=[...a.current.keys()].filter(c=>!this.current.has(c));if(l.length>0){var s=Ts;Ts=[];const c=new Set,u=new Map;for(const d of i)ou(d,l,c,u);if(Ts.length>0){Re=a,a.apply();for(const d of Ts)nt(r=a,Es,Li).call(r,d,[],[]);a.deactivate()}Ts=s}}Re=null,Pt=e}this.committed=!0,wa.delete(this)};let Js=Va;function mf(n){var e=Vr;Vr=!0;try{for(var t;;){if(pf(),Ts.length===0&&(Re==null||Re.flush(),Ts.length===0))return ei=null,t;iu()}}finally{Vr=e}}function iu(){var n=Xn;Pi=!0;var e=null;try{var t=0;for(za(!0);Ts.length>0;){var s=Js.ensure();if(t++>1e3){var r,a;yf()}s.process(Ts),En.clear()}}finally{Pi=!1,za(n),ei=null}}function yf(){try{Hh()}catch(n){Mr(n,ei)}}let Ms=null;function ol(n){var e=n.length;if(e!==0){for(var t=0;t<e;){var s=n[t++];if(!(s.f&(en|hs))&&da(s)&&(Ms=new Set,ta(s),s.deps===null&&s.first===null&&s.nodes===null&&(s.teardown===null&&s.ac===null?ku(s):s.fn=null),(Ms==null?void 0:Ms.size)>0)){En.clear();for(const r of Ms){if(r.f&(en|hs))continue;const a=[r];let i=r.parent;for(;i!==null;)Ms.has(i)&&(Ms.delete(i),a.push(i)),i=i.parent;for(let l=a.length-1;l>=0;l--){const c=a[l];c.f&(en|hs)||ta(c)}}Ms.clear()}}Ms=null}}function ou(n,e,t,s){if(!t.has(n)&&(t.add(n),n.reactions!==null))for(const r of n.reactions){const a=r.f;a&qt?ou(r,e,t,s):a&(_o|an)&&!(a&Xt)&&lu(r,e,s)&&(Mt(r,Xt),nn(r))}}function lu(n,e,t){const s=t.get(n);if(s!==void 0)return s;if(n.deps!==null)for(const r of n.deps){if(e.includes(r))return!0;if(r.f&qt&&lu(r,e,t))return t.set(r,!0),!0}return t.set(n,!1),!1}function nn(n){for(var e=ei=n;e.parent!==null;){e=e.parent;var t=e.f;if(Pi&&e===Ge&&t&an&&!(t&Hc))return;if(t&(ir|on)){if(!(t&$t))return;e.f^=$t}}Ts.push(e)}function bf(n){let e=0,t=nr(0),s;return()=>{Do()&&(o(t),ua(()=>(e===0&&(s=On(()=>n(()=>Qr(t)))),e+=1,()=>{Lr(()=>{e-=1,e===0&&(s==null||s(),s=void 0,Qr(t))})})))}}var wf=Ar|Pr|bo;function _f(n,e,t){new kf(n,e,t)}var ws,fo,Us,Gn,zs,_s,ns,Bs,Zs,wn,Kn,_n,Vn,xr,Dr,kn,Qa,Ct,Tf,Sf,Fi,Ma,Ia,Ui;class kf{constructor(e,t,s){_e(this,Ct);w(this,"parent");w(this,"is_pending",!1);_e(this,ws);_e(this,fo,null);_e(this,Us);_e(this,Gn);_e(this,zs);_e(this,_s,null);_e(this,ns,null);_e(this,Bs,null);_e(this,Zs,null);_e(this,wn,null);_e(this,Kn,0);_e(this,_n,0);_e(this,Vn,!1);_e(this,xr,new Set);_e(this,Dr,new Set);_e(this,kn,null);_e(this,Qa,bf(()=>(ce(this,kn,nr(k(this,Kn))),()=>{ce(this,kn,null)})));ce(this,ws,e),ce(this,Us,t),ce(this,Gn,s),this.parent=Ge.b,this.is_pending=!!k(this,Us).pending,ce(this,zs,Co(()=>{Ge.b=this;{var r=nt(this,Ct,Fi).call(this);try{ce(this,_s,Ss(()=>s(r)))}catch(a){this.error(a)}k(this,_n)>0?nt(this,Ct,Ia).call(this):this.is_pending=!1}return()=>{var a;(a=k(this,wn))==null||a.remove()}},wf))}defer_effect(e){nu(e,k(this,xr),k(this,Dr))}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!k(this,Us).pending}update_pending_count(e){nt(this,Ct,Ui).call(this,e),ce(this,Kn,k(this,Kn)+e),k(this,kn)&&Ir(k(this,kn),k(this,Kn))}get_effect_pending(){return k(this,Qa).call(this),o(k(this,kn))}error(e){var t=k(this,Us).onerror;let s=k(this,Us).failed;if(k(this,Vn)||!t&&!s)throw e;k(this,_s)&&(is(k(this,_s)),ce(this,_s,null)),k(this,ns)&&(is(k(this,ns)),ce(this,ns,null)),k(this,Bs)&&(is(k(this,Bs)),ce(this,Bs,null));var r=!1,a=!1;const i=()=>{if(r){df();return}r=!0,a&&Zh(),Js.ensure(),ce(this,Kn,0),k(this,Bs)!==null&&Zn(k(this,Bs),()=>{ce(this,Bs,null)}),this.is_pending=this.has_pending_snippet(),ce(this,_s,nt(this,Ct,Ma).call(this,()=>(ce(this,Vn,!1),Ss(()=>k(this,Gn).call(this,k(this,ws)))))),k(this,_n)>0?nt(this,Ct,Ia).call(this):this.is_pending=!1};var l=Pe;try{as(null),a=!0,t==null||t(e,i),a=!1}catch(c){Mr(c,k(this,zs)&&k(this,zs).parent)}finally{as(l)}s&&Lr(()=>{ce(this,Bs,nt(this,Ct,Ma).call(this,()=>{Js.ensure(),ce(this,Vn,!0);try{return Ss(()=>{s(k(this,ws),()=>e,()=>i)})}catch(c){return Mr(c,k(this,zs).parent),null}finally{ce(this,Vn,!1)}}))})}}ws=new WeakMap,fo=new WeakMap,Us=new WeakMap,Gn=new WeakMap,zs=new WeakMap,_s=new WeakMap,ns=new WeakMap,Bs=new WeakMap,Zs=new WeakMap,wn=new WeakMap,Kn=new WeakMap,_n=new WeakMap,Vn=new WeakMap,xr=new WeakMap,Dr=new WeakMap,kn=new WeakMap,Qa=new WeakMap,Ct=new WeakSet,Tf=function(){try{ce(this,_s,Ss(()=>k(this,Gn).call(this,k(this,ws))))}catch(e){this.error(e)}},Sf=function(){const e=k(this,Us).pending;e&&(ce(this,ns,Ss(()=>e(k(this,ws)))),Js.enqueue(()=>{var t=nt(this,Ct,Fi).call(this);ce(this,_s,nt(this,Ct,Ma).call(this,()=>(Js.ensure(),Ss(()=>k(this,Gn).call(this,t))))),k(this,_n)>0?nt(this,Ct,Ia).call(this):(Zn(k(this,ns),()=>{ce(this,ns,null)}),this.is_pending=!1)}))},Fi=function(){var e=k(this,ws);return this.is_pending&&(ce(this,wn,sn()),k(this,ws).before(k(this,wn)),e=k(this,wn)),e},Ma=function(e){var t=Ge,s=Pe,r=St;js(k(this,zs)),as(k(this,zs)),Cr(k(this,zs).ctx);try{return e()}catch(a){return tu(a),null}finally{js(t),as(s),Cr(r)}},Ia=function(){const e=k(this,Us).pending;k(this,_s)!==null&&(ce(this,Zs,document.createDocumentFragment()),k(this,Zs).append(k(this,wn)),xu(k(this,_s),k(this,Zs))),k(this,ns)===null&&ce(this,ns,Ss(()=>e(k(this,ws))))},Ui=function(e){var t;if(!this.has_pending_snippet()){this.parent&&nt(t=this.parent,Ct,Ui).call(t,e);return}if(ce(this,_n,k(this,_n)+e),k(this,_n)===0){this.is_pending=!1;for(const s of k(this,xr))Mt(s,Xt),nn(s);for(const s of k(this,Dr))Mt(s,ln),nn(s);k(this,xr).clear(),k(this,Dr).clear(),k(this,ns)&&Zn(k(this,ns),()=>{ce(this,ns,null)}),k(this,Zs)&&(k(this,ws).before(k(this,Zs)),ce(this,Zs,null))}};function xf(n,e,t,s){const r=ti;if(t.length===0&&n.length===0){s(e.map(r));return}var a=Re,i=Ge,l=Df();function c(){Promise.all(t.map(u=>Ef(u))).then(u=>{l();try{s([...e.map(r),...u])}catch(d){i.f&en||Mr(d,i)}a==null||a.deactivate(),Ua()}).catch(u=>{Mr(u,i)})}n.length>0?Promise.all(n).then(()=>{l();try{return c()}finally{a==null||a.deactivate(),Ua()}}):c()}function Df(){var n=Ge,e=Pe,t=St,s=Re;return function(a=!0){js(n),as(e),Cr(t),a&&(s==null||s.activate())}}function Ua(){js(null),as(null),Cr(null)}function ti(n){var e=qt|Xt,t=Pe!==null&&Pe.f&qt?Pe:null;return Ge!==null&&(Ge.f|=Pr),{ctx:St,deps:null,effects:null,equals:Kc,f:e,fn:n,reactions:null,rv:0,v:Rt,wv:0,parent:t??Ge,ac:null}}function Ef(n,e,t){let s=Ge;s===null&&Yh();var r=s.b,a=void 0,i=nr(Rt),l=!Pe,c=new Map;return Ff(()=>{var y;var u=$c();a=u.promise;try{Promise.resolve(n()).then(u.resolve,u.reject).then(()=>{d===Re&&d.committed&&d.deactivate(),Ua()})}catch(_){u.reject(_),Ua()}var d=Re;if(l){var f=r.is_rendered();r.update_pending_count(1),d.increment(f),(y=c.get(d))==null||y.reject(yr),c.delete(d),c.set(d,u)}const v=(_,m=void 0)=>{if(d.activate(),m)m!==yr&&(i.f|=Dn,Ir(i,m));else{i.f&Dn&&(i.f^=Dn),Ir(i,_);for(const[g,b]of c){if(c.delete(g),g===d)break;b.reject(yr)}}l&&(r.update_pending_count(-1),d.decrement(f))};u.promise.then(v,_=>v(null,_||"unknown"))}),Eo(()=>{for(const u of c.values())u.reject(yr)}),new Promise(u=>{function d(f){function v(){f===a?u(i):d(a)}f.then(v,v)}d(a)})}function Q(n){const e=ti(n);return Du(e),e}function cu(n){const e=ti(n);return e.equals=Qc,e}function uu(n){var e=n.effects;if(e!==null){n.effects=null;for(var t=0;t<e.length;t+=1)is(e[t])}}function Af(n){for(var e=n.parent;e!==null;){if(!(e.f&qt))return e.f&en?null:e;e=e.parent}return null}function So(n){var e,t=Ge;js(Af(n));try{n.f&=~sr,uu(n),e=Mu(n)}finally{js(t)}return e}function du(n){var e=So(n);if(!n.equals(e)&&(n.wv=Au(),(!(Re!=null&&Re.is_fork)||n.deps===null)&&(n.v=e,n.deps===null))){Mt(n,$t);return}In||(Pt!==null?(Do()||Re!=null&&Re.is_fork)&&Pt.set(n,e):To(n))}let zi=new Set;const En=new Map;let hu=!1;function nr(n,e){var t={f:0,v:n,reactions:null,equals:Kc,rv:0,wv:0};return t}function K(n,e){const t=nr(n);return Du(t),t}function Cf(n,e=!1,t=!0){const s=nr(n);return e||(s.equals=Qc),s}function T(n,e,t=!1){Pe!==null&&(!Ns||Pe.f&il)&&Xc()&&Pe.f&(qt|an|_o|il)&&!(Qt!=null&&Qt.includes(n))&&Qh();let s=t?xe(e):e;return Ir(n,s)}function Ir(n,e){if(!n.equals(e)){var t=n.v;In?En.set(n,e):En.set(n,t),n.v=e;var s=Js.ensure();if(s.capture(n,t),n.f&qt){const r=n;n.f&Xt&&So(r),To(r)}n.wv=Au(),fu(n,Xt),Ge!==null&&Ge.f&$t&&!(Ge.f&(on|ir))&&(bs===null?zf([n]):bs.push(n)),!s.is_fork&&zi.size>0&&!hu&&Mf()}return e}function Mf(){hu=!1;var n=Xn;za(!0);const e=Array.from(zi);try{for(const t of e)t.f&$t&&Mt(t,ln),da(t)&&ta(t)}finally{za(n)}zi.clear()}function ll(n,e=1){var t=o(n),s=e===1?t++:t--;return T(n,t),s}function Qr(n){T(n,n.v+1)}function fu(n,e){var t=n.reactions;if(t!==null)for(var s=t.length,r=0;r<s;r++){var a=t[r],i=a.f,l=(i&Xt)===0;if(l&&Mt(a,e),i&qt){var c=a;Pt==null||Pt.delete(c),i&sr||(i&Ds&&(a.f|=sr),fu(c,ln))}else l&&(i&an&&Ms!==null&&Ms.add(a),nn(a))}}function xe(n){if(typeof n!="object"||n===null||tn in n)return n;const e=yo(n);if(e!==Lh&&e!==qh)return n;var t=new Map,s=mo(n),r=K(0),a=Jn,i=l=>{if(Jn===a)return l();var c=Pe,u=Jn;as(null),fl(a);var d=l();return as(c),fl(u),d};return s&&t.set("length",K(n.length)),new Proxy(n,{defineProperty(l,c,u){(!("value"in u)||u.configurable===!1||u.enumerable===!1||u.writable===!1)&&Kh();var d=t.get(c);return d===void 0?d=i(()=>{var f=K(u.value);return t.set(c,f),f}):T(d,u.value,!0),!0},deleteProperty(l,c){var u=t.get(c);if(u===void 0){if(c in l){const d=i(()=>K(Rt));t.set(c,d),Qr(r)}}else T(u,Rt),Qr(r);return!0},get(l,c,u){var y;if(c===tn)return n;var d=t.get(c),f=c in l;if(d===void 0&&(!f||(y=wr(l,c))!=null&&y.writable)&&(d=i(()=>{var _=xe(f?l[c]:Rt),m=K(_);return m}),t.set(c,d)),d!==void 0){var v=o(d);return v===Rt?void 0:v}return Reflect.get(l,c,u)},getOwnPropertyDescriptor(l,c){var u=Reflect.getOwnPropertyDescriptor(l,c);if(u&&"value"in u){var d=t.get(c);d&&(u.value=o(d))}else if(u===void 0){var f=t.get(c),v=f==null?void 0:f.v;if(f!==void 0&&v!==Rt)return{enumerable:!0,configurable:!0,value:v,writable:!0}}return u},has(l,c){var v;if(c===tn)return!0;var u=t.get(c),d=u!==void 0&&u.v!==Rt||Reflect.has(l,c);if(u!==void 0||Ge!==null&&(!d||(v=wr(l,c))!=null&&v.writable)){u===void 0&&(u=i(()=>{var y=d?xe(l[c]):Rt,_=K(y);return _}),t.set(c,u));var f=o(u);if(f===Rt)return!1}return d},set(l,c,u,d){var D;var f=t.get(c),v=c in l;if(s&&c==="length")for(var y=u;y<f.v;y+=1){var _=t.get(y+"");_!==void 0?T(_,Rt):y in l&&(_=i(()=>K(Rt)),t.set(y+"",_))}if(f===void 0)(!v||(D=wr(l,c))!=null&&D.writable)&&(f=i(()=>K(void 0)),T(f,xe(u)),t.set(c,f));else{v=f.v!==Rt;var m=i(()=>xe(u));T(f,m)}var g=Reflect.getOwnPropertyDescriptor(l,c);if(g!=null&&g.set&&g.set.call(d,u),!v){if(s&&typeof c=="string"){var b=t.get("length"),x=Number(c);Number.isInteger(x)&&x>=b.v&&T(b,x+1)}Qr(r)}return!0},ownKeys(l){o(r);var c=Reflect.ownKeys(l).filter(f=>{var v=t.get(f);return v===void 0||v.v!==Rt});for(var[u,d]of t)d.v!==Rt&&!(u in l)&&c.push(u);return c},setPrototypeOf(){Vh()}})}function cl(n){try{if(n!==null&&typeof n=="object"&&tn in n)return n[tn]}catch{}return n}function If(n,e){return Object.is(cl(n),cl(e))}var ul,vu,pu,gu;function Of(){if(ul===void 0){ul=window,vu=/Firefox/.test(navigator.userAgent);var n=Element.prototype,e=Node.prototype,t=Text.prototype;pu=wr(e,"firstChild").get,gu=wr(e,"nextSibling").get,al(n)&&(n.__click=void 0,n.__className=void 0,n.__attributes=null,n.__style=void 0,n.__e=void 0),al(t)&&(t.__t=void 0)}}function sn(n=""){return document.createTextNode(n)}function Tn(n){return pu.call(n)}function ca(n){return gu.call(n)}function h(n,e){return Tn(n)}function Qe(n,e=!1){{var t=Tn(n);return t instanceof Comment&&t.data===""?ca(t):t}}function p(n,e=1,t=!1){let s=n;for(;e--;)s=ca(s);return s}function Nf(n){n.textContent=""}function mu(){return!1}let dl=!1;function Rf(){dl||(dl=!0,document.addEventListener("reset",n=>{Promise.resolve().then(()=>{var e;if(!n.defaultPrevented)for(const t of n.target.elements)(e=t.__on_r)==null||e.call(t)})},{capture:!0}))}function si(n){var e=Pe,t=Ge;as(null),js(null);try{return n()}finally{as(e),js(t)}}function xo(n,e,t,s=t){n.addEventListener(e,()=>si(t));const r=n.__on_r;r?n.__on_r=()=>{r(),s(!0)}:n.__on_r=()=>s(!0),Rf()}function Pf(n){Ge===null&&(Pe===null&&Wh(),jh()),In&&$h()}function Lf(n,e){var t=e.last;t===null?e.last=e.first=n:(t.next=n,n.prev=t,e.last=n)}function cn(n,e,t){var s=Ge;s!==null&&s.f&hs&&(n|=hs);var r={ctx:St,deps:null,nodes:null,f:n|Xt|Ds,first:null,fn:e,last:null,next:null,parent:s,b:s&&s.b,prev:null,teardown:null,wv:0,ac:null};if(t)try{ta(r),r.f|=wo}catch(l){throw is(r),l}else e!==null&&nn(r);var a=r;if(t&&a.deps===null&&a.teardown===null&&a.nodes===null&&a.first===a.last&&!(a.f&Pr)&&(a=a.first,n&an&&n&Ar&&a!==null&&(a.f|=Ar)),a!==null&&(a.parent=s,s!==null&&Lf(a,s),Pe!==null&&Pe.f&qt&&!(n&ir))){var i=Pe;(i.effects??(i.effects=[])).push(a)}return r}function Do(){return Pe!==null&&!Ns}function Eo(n){const e=cn(Ja,null,!1);return Mt(e,$t),e.teardown=n,e}function xt(n){Pf();var e=Ge.f,t=!Pe&&(e&on)!==0&&(e&wo)===0;if(t){var s=St;(s.e??(s.e=[])).push(n)}else return yu(n)}function yu(n){return cn(Fa|Uh,n,!1)}function qf(n){Js.ensure();const e=cn(ir|Pr,n,!0);return(t={})=>new Promise(s=>{t.outro?Zn(e,()=>{is(e),s(void 0)}):(is(e),s(void 0))})}function Ao(n){return cn(Fa,n,!1)}function Ff(n){return cn(_o|Pr,n,!0)}function ua(n,e=0){return cn(Ja|e,n,!0)}function $(n,e=[],t=[],s=[]){xf(s,e,t,r=>{cn(Ja,()=>n(...r.map(o)),!0)})}function Co(n,e=0){var t=cn(an|e,n,!0);return t}function Ss(n){return cn(on|Pr,n,!0)}function bu(n){var e=n.teardown;if(e!==null){const t=In,s=Pe;hl(!0),as(null);try{e.call(null)}finally{hl(t),as(s)}}}function wu(n,e=!1){var t=n.first;for(n.first=n.last=null;t!==null;){const r=t.ac;r!==null&&si(()=>{r.abort(yr)});var s=t.next;t.f&ir?t.parent=null:is(t,e),t=s}}function Uf(n){for(var e=n.first;e!==null;){var t=e.next;e.f&on||is(e),e=t}}function is(n,e=!0){var t=!1;(e||n.f&Hc)&&n.nodes!==null&&n.nodes.end!==null&&(_u(n.nodes.start,n.nodes.end),t=!0),wu(n,e&&!t),Ba(n,0),Mt(n,en);var s=n.nodes&&n.nodes.t;if(s!==null)for(const a of s)a.stop();bu(n);var r=n.parent;r!==null&&r.first!==null&&ku(n),n.next=n.prev=n.teardown=n.ctx=n.deps=n.fn=n.nodes=n.ac=null}function _u(n,e){for(;n!==null;){var t=n===e?null:ca(n);n.remove(),n=t}}function ku(n){var e=n.parent,t=n.prev,s=n.next;t!==null&&(t.next=s),s!==null&&(s.prev=t),e!==null&&(e.first===n&&(e.first=s),e.last===n&&(e.last=t))}function Zn(n,e,t=!0){var s=[];Tu(n,s,!0);var r=()=>{t&&is(n),e&&e()},a=s.length;if(a>0){var i=()=>--a||r();for(var l of s)l.out(i)}else r()}function Tu(n,e,t){if(!(n.f&hs)){n.f^=hs;var s=n.nodes&&n.nodes.t;if(s!==null)for(const l of s)(l.is_global||t)&&e.push(l);for(var r=n.first;r!==null;){var a=r.next,i=(r.f&Ar)!==0||(r.f&on)!==0&&(n.f&an)!==0;Tu(r,e,i?t:!1),r=a}}}function Mo(n){Su(n,!0)}function Su(n,e){if(n.f&hs){n.f^=hs,n.f&$t||(Mt(n,Xt),nn(n));for(var t=n.first;t!==null;){var s=t.next,r=(t.f&Ar)!==0||(t.f&on)!==0;Su(t,r?e:!1),t=s}var a=n.nodes&&n.nodes.t;if(a!==null)for(const i of a)(i.is_global||e)&&i.in()}}function xu(n,e){if(n.nodes)for(var t=n.nodes.start,s=n.nodes.end;t!==null;){var r=t===s?null:ca(t);e.append(t),t=r}}let Xn=!1;function za(n){Xn=n}let In=!1;function hl(n){In=n}let Pe=null,Ns=!1;function as(n){Pe=n}let Ge=null;function js(n){Ge=n}let Qt=null;function Du(n){Pe!==null&&(Qt===null?Qt=[n]:Qt.push(n))}let Kt=null,ls=0,bs=null;function zf(n){bs=n}let Eu=1,ea=0,Jn=ea;function fl(n){Jn=n}function Au(){return++Eu}function da(n){var e=n.f;if(e&Xt)return!0;if(e&qt&&(n.f&=~sr),e&ln){for(var t=n.deps,s=t.length,r=0;r<s;r++){var a=t[r];if(da(a)&&du(a),a.wv>n.wv)return!0}e&Ds&&Pt===null&&Mt(n,$t)}return!1}function Cu(n,e,t=!0){var s=n.reactions;if(s!==null&&!(Qt!=null&&Qt.includes(n)))for(var r=0;r<s.length;r++){var a=s[r];a.f&qt?Cu(a,e,!1):e===a&&(t?Mt(a,Xt):a.f&$t&&Mt(a,ln),nn(a))}}function Mu(n){var _;var e=Kt,t=ls,s=bs,r=Pe,a=Qt,i=St,l=Ns,c=Jn,u=n.f;Kt=null,ls=0,bs=null,Pe=u&(on|ir)?null:n,Qt=null,Cr(n.ctx),Ns=!1,Jn=++ea,n.ac!==null&&(si(()=>{n.ac.abort(yr)}),n.ac=null);try{n.f|=Ri;var d=n.fn,f=d(),v=n.deps;if(Kt!==null){var y;if(Ba(n,ls),v!==null&&ls>0)for(v.length=ls+Kt.length,y=0;y<Kt.length;y++)v[ls+y]=Kt[y];else n.deps=v=Kt;if(Do()&&n.f&Ds)for(y=ls;y<v.length;y++)((_=v[y]).reactions??(_.reactions=[])).push(n)}else v!==null&&ls<v.length&&(Ba(n,ls),v.length=ls);if(Xc()&&bs!==null&&!Ns&&v!==null&&!(n.f&(qt|ln|Xt)))for(y=0;y<bs.length;y++)Cu(bs[y],n);return r!==null&&r!==n&&(ea++,bs!==null&&(s===null?s=bs:s.push(...bs))),n.f&Dn&&(n.f^=Dn),f}catch(m){return tu(m)}finally{n.f^=Ri,Kt=e,ls=t,bs=s,Pe=r,Qt=a,Cr(i),Ns=l,Jn=c}}function Bf(n,e){let t=e.reactions;if(t!==null){var s=Rh.call(t,n);if(s!==-1){var r=t.length-1;r===0?t=e.reactions=null:(t[s]=t[r],t.pop())}}if(t===null&&e.f&qt&&(Kt===null||!Kt.includes(e))){var a=e;a.f&Ds&&(a.f^=Ds,a.f&=~sr),To(a),uu(a),Ba(a,0)}}function Ba(n,e){var t=n.deps;if(t!==null)for(var s=e;s<t.length;s++)Bf(n,t[s])}function ta(n){var e=n.f;if(!(e&en)){Mt(n,$t);var t=Ge,s=Xn;Ge=n,Xn=!0;try{e&(an|Wc)?Uf(n):wu(n),bu(n);var r=Mu(n);n.teardown=typeof r=="function"?r:null,n.wv=Eu;var a;Ni&&hf&&n.f&Xt&&n.deps}finally{Xn=s,Ge=t}}}async function Iu(){await Promise.resolve(),mf()}function o(n){var e=n.f,t=(e&qt)!==0;if(Pe!==null&&!Ns){var s=Ge!==null&&(Ge.f&en)!==0;if(!s&&!(Qt!=null&&Qt.includes(n))){var r=Pe.deps;if(Pe.f&Ri)n.rv<ea&&(n.rv=ea,Kt===null&&r!==null&&r[ls]===n?ls++:Kt===null?Kt=[n]:Kt.includes(n)||Kt.push(n));else{(Pe.deps??(Pe.deps=[])).push(n);var a=n.reactions;a===null?n.reactions=[Pe]:a.includes(Pe)||a.push(Pe)}}}if(In&&En.has(n))return En.get(n);if(t){var i=n;if(In){var l=i.v;return(!(i.f&$t)&&i.reactions!==null||Nu(i))&&(l=So(i)),En.set(i,l),l}var c=(i.f&Ds)===0&&!Ns&&Pe!==null&&(Xn||(Pe.f&Ds)!==0),u=i.deps===null;da(i)&&(c&&(i.f|=Ds),du(i)),c&&!u&&Ou(i)}if(Pt!=null&&Pt.has(n))return Pt.get(n);if(n.f&Dn)throw n.v;return n.v}function Ou(n){if(n.deps!==null){n.f|=Ds;for(const e of n.deps)(e.reactions??(e.reactions=[])).push(n),e.f&qt&&!(e.f&Ds)&&Ou(e)}}function Nu(n){if(n.v===Rt)return!0;if(n.deps===null)return!1;for(const e of n.deps)if(En.has(e)||e.f&qt&&Nu(e))return!0;return!1}function On(n){var e=Ns;try{return Ns=!0,n()}finally{Ns=e}}function Yf(n){if(!(typeof n!="object"||!n||n instanceof EventTarget)){if(tn in n)Bi(n);else if(!Array.isArray(n))for(let e in n){const t=n[e];typeof t=="object"&&t&&tn in t&&Bi(t)}}}function Bi(n,e=new Set){if(typeof n=="object"&&n!==null&&!(n instanceof EventTarget)&&!e.has(n)){e.add(n),n instanceof Date&&n.getTime();for(let s in n)try{Bi(n[s],e)}catch{}const t=yo(n);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const s=Yc(t);for(let r in s){const a=s[r].get;if(a)try{a.call(n)}catch{}}}}}const $f=["touchstart","touchmove"];function jf(n){return $f.includes(n)}const Ru=new Set,Yi=new Set;function Wf(n,e,t,s={}){function r(a){if(s.capture||Wr.call(e,a),!a.cancelBubble)return si(()=>t==null?void 0:t.call(this,a))}return n.startsWith("pointer")||n.startsWith("touch")||n==="wheel"?Lr(()=>{e.addEventListener(n,r,s)}):e.addEventListener(n,r,s),r}function Lt(n,e,t,s,r){var a={capture:s,passive:r},i=Wf(n,e,t,a);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&Eo(()=>{e.removeEventListener(n,i,a)})}function bt(n){for(var e=0;e<n.length;e++)Ru.add(n[e]);for(var t of Yi)t(n)}let vl=null;function Wr(n){var g;var e=this,t=e.ownerDocument,s=n.type,r=((g=n.composedPath)==null?void 0:g.call(n))||[],a=r[0]||n.target;vl=n;var i=0,l=vl===n&&n.__root;if(l){var c=r.indexOf(l);if(c!==-1&&(e===document||e===window)){n.__root=e;return}var u=r.indexOf(e);if(u===-1)return;c<=u&&(i=c)}if(a=r[i]||n.target,a!==e){Ph(n,"currentTarget",{configurable:!0,get(){return a||t}});var d=Pe,f=Ge;as(null),js(null);try{for(var v,y=[];a!==null;){var _=a.assignedSlot||a.parentNode||a.host||null;try{var m=a["__"+s];m!=null&&(!a.disabled||n.target===a)&&m.call(a,n)}catch(b){v?y.push(b):v=b}if(n.cancelBubble||_===e||_===null)break;a=_}if(v){for(let b of y)queueMicrotask(()=>{throw b});throw v}}finally{n.__root=e,delete n.currentTarget,as(d),js(f)}}}function Pu(n){var e=document.createElement("template");return e.innerHTML=n.replaceAll("<!>","<!---->"),e.content}function sa(n,e){var t=Ge;t.nodes===null&&(t.nodes={start:n,end:e,a:null,t:null})}function C(n,e){var t=(e&of)!==0,s=(e&lf)!==0,r,a=!n.startsWith("<!>");return()=>{r===void 0&&(r=Pu(a?n:"<!>"+n),t||(r=Tn(r)));var i=s||vu?document.importNode(r,!0):r.cloneNode(!0);if(t){var l=Tn(i),c=i.lastChild;sa(l,c)}else sa(i,i);return i}}function gi(n=""){{var e=sn(n+"");return sa(e,e),e}}function ut(){var n=document.createDocumentFragment(),e=document.createComment(""),t=sn();return n.append(e,t),sa(e,t),n}function S(n,e){n!==null&&n.before(e)}function R(n,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(n.__t??(n.__t=n.nodeValue))&&(n.__t=t,n.nodeValue=t+"")}function _a(n,e){return Hf(n,e)}const dr=new Map;function Hf(n,{target:e,anchor:t,props:s={},events:r,context:a,intro:i=!0}){Of();var l=new Set,c=f=>{for(var v=0;v<f.length;v++){var y=f[v];if(!l.has(y)){l.add(y);var _=jf(y);e.addEventListener(y,Wr,{passive:_});var m=dr.get(y);m===void 0?(document.addEventListener(y,Wr,{passive:_}),dr.set(y,1)):dr.set(y,m+1)}}};c(Xa(Ru)),Yi.add(c);var u=void 0,d=qf(()=>{var f=t??e.appendChild(sn());return _f(f,{pending:()=>{}},v=>{if(a){dt({});var y=St;y.c=a}r&&(s.$$events=r),u=n(v,s)||{},a&&ht()}),()=>{var _;for(var v of l){e.removeEventListener(v,Wr);var y=dr.get(v);--y===0?(document.removeEventListener(v,Wr),dr.delete(v)):dr.set(v,y)}Yi.delete(c),f!==t&&((_=f.parentNode)==null||_.removeChild(f))}});return $i.set(u,d),u}let $i=new WeakMap;function ka(n,e){const t=$i.get(n);return t?($i.delete(n),t(e)):Promise.resolve()}var Is,Ys,cs,Qn,oa,la,Za;class Gf{constructor(e,t=!0){w(this,"anchor");_e(this,Is,new Map);_e(this,Ys,new Map);_e(this,cs,new Map);_e(this,Qn,new Set);_e(this,oa,!0);_e(this,la,()=>{var e=Re;if(k(this,Is).has(e)){var t=k(this,Is).get(e),s=k(this,Ys).get(t);if(s)Mo(s),k(this,Qn).delete(t);else{var r=k(this,cs).get(t);r&&(k(this,Ys).set(t,r.effect),k(this,cs).delete(t),r.fragment.lastChild.remove(),this.anchor.before(r.fragment),s=r.effect)}for(const[a,i]of k(this,Is)){if(k(this,Is).delete(a),a===e)break;const l=k(this,cs).get(i);l&&(is(l.effect),k(this,cs).delete(i))}for(const[a,i]of k(this,Ys)){if(a===t||k(this,Qn).has(a))continue;const l=()=>{if(Array.from(k(this,Is).values()).includes(a)){var u=document.createDocumentFragment();xu(i,u),u.append(sn()),k(this,cs).set(a,{effect:i,fragment:u})}else is(i);k(this,Qn).delete(a),k(this,Ys).delete(a)};k(this,oa)||!s?(k(this,Qn).add(a),Zn(i,l,!1)):l()}}});_e(this,Za,e=>{k(this,Is).delete(e);const t=Array.from(k(this,Is).values());for(const[s,r]of k(this,cs))t.includes(s)||(is(r.effect),k(this,cs).delete(s))});this.anchor=e,ce(this,oa,t)}ensure(e,t){var s=Re,r=mu();if(t&&!k(this,Ys).has(e)&&!k(this,cs).has(e))if(r){var a=document.createDocumentFragment(),i=sn();a.append(i),k(this,cs).set(e,{effect:Ss(()=>t(i)),fragment:a})}else k(this,Ys).set(e,Ss(()=>t(this.anchor)));if(k(this,Is).set(s,e),r){for(const[l,c]of k(this,Ys))l===e?s.skipped_effects.delete(c):s.skipped_effects.add(c);for(const[l,c]of k(this,cs))l===e?s.skipped_effects.delete(c.effect):s.skipped_effects.add(c.effect);s.oncommit(k(this,la)),s.ondiscard(k(this,Za))}else k(this,la).call(this)}}Is=new WeakMap,Ys=new WeakMap,cs=new WeakMap,Qn=new WeakMap,oa=new WeakMap,la=new WeakMap,Za=new WeakMap;function W(n,e,t=!1){var s=new Gf(n),r=t?Ar:0;function a(i,l){s.ensure(i,l)}Co(()=>{var i=!1;e((l,c=!0)=>{i=!0,a(c,l)}),i||a(!1,null)},r)}function pt(n,e){return e}function Kf(n,e,t){for(var s=[],r=e.length,a,i=e.length,l=0;l<r;l++){let f=e[l];Zn(f,()=>{if(a){if(a.pending.delete(f),a.done.add(f),a.pending.size===0){var v=n.outrogroups;ji(Xa(a.done)),v.delete(a),v.size===0&&(n.outrogroups=null)}}else i-=1},!1)}if(i===0){var c=s.length===0&&t!==null;if(c){var u=t,d=u.parentNode;Nf(d),d.append(u),n.items.clear()}ji(e,!c)}else a={pending:new Set(e),done:new Set},(n.outrogroups??(n.outrogroups=new Set)).add(a)}function ji(n,e=!0){for(var t=0;t<n.length;t++)is(n[t],e)}var pl;function je(n,e,t,s,r,a=null){var i=n,l=new Map,c=(e&Gc)!==0;if(c){var u=n;i=u.appendChild(sn())}var d=null,f=cu(()=>{var b=t();return mo(b)?b:b==null?[]:Xa(b)}),v,y=!0;function _(){g.fallback=d,Vf(g,v,i,e,s),d!==null&&(v.length===0?d.f&Xs?(d.f^=Xs,Hr(d,null,i)):Mo(d):Zn(d,()=>{d=null}))}var m=Co(()=>{v=o(f);for(var b=v.length,x=new Set,D=Re,A=mu(),I=0;I<b;I+=1){var N=v[I],P=s(N,I),H=y?null:l.get(P);H?(H.v&&Ir(H.v,N),H.i&&Ir(H.i,I),A&&D.skipped_effects.delete(H.e)):(H=Qf(l,y?i:pl??(pl=sn()),N,P,I,r,e,t),y||(H.e.f|=Xs),l.set(P,H)),x.add(P)}if(b===0&&a&&!d&&(y?d=Ss(()=>a(i)):(d=Ss(()=>a(pl??(pl=sn()))),d.f|=Xs)),!y)if(A){for(const[j,Z]of l)x.has(j)||D.skipped_effects.add(Z.e);D.oncommit(_),D.ondiscard(()=>{})}else _();o(f)}),g={effect:m,items:l,outrogroups:null,fallback:d};y=!1}function Vf(n,e,t,s,r){var Z,ae,re,de,V,U,O,M,B;var a=(s&ef)!==0,i=e.length,l=n.items,c=n.effect.first,u,d=null,f,v=[],y=[],_,m,g,b;if(a)for(b=0;b<i;b+=1)_=e[b],m=r(_,b),g=l.get(m).e,g.f&Xs||((ae=(Z=g.nodes)==null?void 0:Z.a)==null||ae.measure(),(f??(f=new Set)).add(g));for(b=0;b<i;b+=1){if(_=e[b],m=r(_,b),g=l.get(m).e,n.outrogroups!==null)for(const se of n.outrogroups)se.pending.delete(g),se.done.delete(g);if(g.f&Xs)if(g.f^=Xs,g===c)Hr(g,null,t);else{var x=d?d.next:c;g===n.effect.last&&(n.effect.last=g.prev),g.prev&&(g.prev.next=g.next),g.next&&(g.next.prev=g.prev),vn(n,d,g),vn(n,g,x),Hr(g,x,t),d=g,v=[],y=[],c=d.next;continue}if(g.f&hs&&(Mo(g),a&&((de=(re=g.nodes)==null?void 0:re.a)==null||de.unfix(),(f??(f=new Set)).delete(g))),g!==c){if(u!==void 0&&u.has(g)){if(v.length<y.length){var D=y[0],A;d=D.prev;var I=v[0],N=v[v.length-1];for(A=0;A<v.length;A+=1)Hr(v[A],D,t);for(A=0;A<y.length;A+=1)u.delete(y[A]);vn(n,I.prev,N.next),vn(n,d,I),vn(n,N,D),c=D,d=N,b-=1,v=[],y=[]}else u.delete(g),Hr(g,c,t),vn(n,g.prev,g.next),vn(n,g,d===null?n.effect.first:d.next),vn(n,d,g),d=g;continue}for(v=[],y=[];c!==null&&c!==g;)(u??(u=new Set)).add(c),y.push(c),c=c.next;if(c===null)continue}g.f&Xs||v.push(g),d=g,c=g.next}if(n.outrogroups!==null){for(const se of n.outrogroups)se.pending.size===0&&(ji(Xa(se.done)),(V=n.outrogroups)==null||V.delete(se));n.outrogroups.size===0&&(n.outrogroups=null)}if(c!==null||u!==void 0){var P=[];if(u!==void 0)for(g of u)g.f&hs||P.push(g);for(;c!==null;)!(c.f&hs)&&c!==n.fallback&&P.push(c),c=c.next;var H=P.length;if(H>0){var j=s&Gc&&i===0?t:null;if(a){for(b=0;b<H;b+=1)(O=(U=P[b].nodes)==null?void 0:U.a)==null||O.measure();for(b=0;b<H;b+=1)(B=(M=P[b].nodes)==null?void 0:M.a)==null||B.fix()}Kf(n,P,j)}}a&&Lr(()=>{var se,ee;if(f!==void 0)for(g of f)(ee=(se=g.nodes)==null?void 0:se.a)==null||ee.apply()})}function Qf(n,e,t,s,r,a,i,l){var c=i&Xh?i&tf?nr(t):Cf(t,!1,!1):null,u=i&Jh?nr(r):null;return{v:c,i:u,e:Ss(()=>(a(e,c??t,u??r,l),()=>{n.delete(s)}))}}function Hr(n,e,t){if(n.nodes)for(var s=n.nodes.start,r=n.nodes.end,a=e&&!(e.f&Xs)?e.nodes.start:t;s!==null;){var i=ca(s);if(a.before(s),s===r)return;s=i}}function vn(n,e,t){e===null?n.effect.first=t:e.next=t,t===null?n.effect.last=e:t.prev=e}function Zf(n,e,t=!1,s=!1,r=!1){var a=n,i="";$(()=>{var l=Ge;if(i!==(i=e()??"")&&(l.nodes!==null&&(_u(l.nodes.start,l.nodes.end),l.nodes=null),i!=="")){var c=i+"";t?c=`<svg>${c}</svg>`:s&&(c=`<math>${c}</math>`);var u=Pu(c);if((t||s)&&(u=Tn(u)),sa(Tn(u),u.lastChild),t||s)for(;Tn(u);)a.before(Tn(u));else a.before(u)}})}function Xf(n,e,t){Ao(()=>{var s=On(()=>e(n,t==null?void 0:t())||{});if(t&&(s!=null&&s.update)){var r=!1,a={};ua(()=>{var i=t();Yf(i),r&&Vc(a,i)&&(a=i,s.update(i))}),r=!0}if(s!=null&&s.destroy)return()=>s.destroy()})}function Lu(n){var e,t,s="";if(typeof n=="string"||typeof n=="number")s+=n;else if(typeof n=="object")if(Array.isArray(n)){var r=n.length;for(e=0;e<r;e++)n[e]&&(t=Lu(n[e]))&&(s&&(s+=" "),s+=t)}else for(t in n)n[t]&&(s&&(s+=" "),s+=t);return s}function Jf(){for(var n,e,t=0,s="",r=arguments.length;t<r;t++)(n=arguments[t])&&(e=Lu(n))&&(s&&(s+=" "),s+=e);return s}function ev(n){return typeof n=="object"?Jf(n):n??""}const gl=[...` 	
\r\f\v\uFEFF`];function tv(n,e,t){var s=n==null?"":""+n;if(e&&(s=s?s+" "+e:e),t){for(var r in t)if(t[r])s=s?s+" "+r:r;else if(s.length)for(var a=r.length,i=0;(i=s.indexOf(r,i))>=0;){var l=i+a;(i===0||gl.includes(s[i-1]))&&(l===s.length||gl.includes(s[l]))?s=(i===0?"":s.substring(0,i))+s.substring(l+1):i=l}}return s===""?null:s}function sv(n,e){return n==null?null:String(n)}function Xe(n,e,t,s,r,a){var i=n.__className;if(i!==t||i===void 0){var l=tv(t,s,a);l==null?n.removeAttribute("class"):n.className=l,n.__className=t}else if(a&&r!==a)for(var c in a){var u=!!a[c];(r==null||u!==!!r[c])&&n.classList.toggle(c,u)}return a}function Rs(n,e,t,s){var r=n.__style;if(r!==e){var a=sv(e);a==null?n.removeAttribute("style"):n.style.cssText=a,n.__style=e}return s}function qu(n,e,t=!1){if(n.multiple){if(e==null)return;if(!mo(e))return uf();for(var s of n.options)s.selected=e.includes(Zr(s));return}for(s of n.options){var r=Zr(s);if(If(r,e)){s.selected=!0;return}}(!t||e!==void 0)&&(n.selectedIndex=-1)}function nv(n){var e=new MutationObserver(()=>{qu(n,n.__value)});e.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Eo(()=>{e.disconnect()})}function Fu(n,e,t=e){var s=new WeakSet,r=!0;xo(n,"change",a=>{var i=a?"[selected]":":checked",l;if(n.multiple)l=[].map.call(n.querySelectorAll(i),Zr);else{var c=n.querySelector(i)??n.querySelector("option:not([disabled])");l=c&&Zr(c)}t(l),Re!==null&&s.add(Re)}),Ao(()=>{var a=e();if(n===document.activeElement){var i=Kr??Re;if(s.has(i))return}if(qu(n,a,r),r&&a===void 0){var l=n.querySelector(":checked");l!==null&&(a=Zr(l),t(a))}n.__value=a,r=!1}),nv(n)}function Zr(n){return"__value"in n?n.__value:n.value}const rv=Symbol("is custom element"),av=Symbol("is html");function Io(n,e){var t=Oo(n);t.value===(t.value=e??void 0)||n.value===e&&(e!==0||n.nodeName!=="PROGRESS")||(n.value=e??"")}function An(n,e){var t=Oo(n);t.checked!==(t.checked=e??void 0)&&(n.checked=e)}function Ne(n,e,t,s){var r=Oo(n);r[e]!==(r[e]=t)&&(e==="loading"&&(n[Bh]=t),t==null?n.removeAttribute(e):typeof t!="string"&&iv(n).includes(e)?n[e]=t:n.setAttribute(e,t))}function Oo(n){return n.__attributes??(n.__attributes={[rv]:n.nodeName.includes("-"),[av]:n.namespaceURI===cf})}var ml=new Map;function iv(n){var e=n.getAttribute("is")||n.nodeName,t=ml.get(e);if(t)return t;ml.set(e,t=[]);for(var s,r=n,a=Element.prototype;a!==r;){s=Yc(r);for(var i in s)s[i].set&&t.push(i);r=yo(r)}return t}function it(n,e,t=e){var s=new WeakSet;xo(n,"input",async r=>{var a=r?n.defaultValue:n.value;if(a=mi(n)?yi(a):a,t(a),Re!==null&&s.add(Re),await Iu(),a!==(a=e())){var i=n.selectionStart,l=n.selectionEnd,c=n.value.length;if(n.value=a??"",l!==null){var u=n.value.length;i===l&&l===c&&u>c?(n.selectionStart=u,n.selectionEnd=u):(n.selectionStart=i,n.selectionEnd=Math.min(l,u))}}}),On(e)==null&&n.value&&(t(mi(n)?yi(n.value):n.value),Re!==null&&s.add(Re)),ua(()=>{var r=e();if(n===document.activeElement){var a=Kr??Re;if(s.has(a))return}mi(n)&&r===yi(n.value)||n.type==="date"&&!r&&!n.value||r!==n.value&&(n.value=r??"")})}function Wi(n,e,t=e){xo(n,"change",s=>{var r=s?n.defaultChecked:n.checked;t(r)}),On(e)==null&&t(n.checked),ua(()=>{var s=e();n.checked=!!s})}function mi(n){var e=n.type;return e==="number"||e==="range"}function yi(n){return n===""?null:+n}function yl(n,e){return n===e||(n==null?void 0:n[tn])===e}function Ps(n={},e,t,s){return Ao(()=>{var r,a;return ua(()=>{r=a,a=(s==null?void 0:s())||[],On(()=>{n!==t(...a)&&(e(n,...a),r&&yl(t(...r),n)&&e(null,...r))})}),()=>{Lr(()=>{a&&yl(t(...a),n)&&e(null,...a)})}}),n}let Ta=!1;function ov(n){var e=Ta;try{return Ta=!1,[n(),Ta]}finally{Ta=e}}function rn(n,e,t,s){var x;var r=(t&rf)!==0,a=(t&af)!==0,i=s,l=!0,c=()=>(l&&(l=!1,i=a?On(s):s),i),u;if(r){var d=tn in n||zh in n;u=((x=wr(n,e))==null?void 0:x.set)??(d&&e in n?D=>n[e]=D:void 0)}var f,v=!1;r?[f,v]=ov(()=>n[e]):f=n[e],f===void 0&&s!==void 0&&(f=c(),u&&(Gh(),u(f)));var y;if(y=()=>{var D=n[e];return D===void 0?c():(l=!0,D)},!(t&nf))return y;if(u){var _=n.$$legacy;return function(D,A){return arguments.length>0?((!A||_||v)&&u(A?y():D),D):y()}}var m=!1,g=(t&sf?ti:cu)(()=>(m=!1,y()));r&&o(g);var b=Ge;return function(D,A){if(arguments.length>0){const I=A?o(g):r?xe(D):D;return T(g,I),m=!0,i!==void 0&&(i=I),D}return In&&m||b.f&en?g.v:o(g)}}function ha(n){St===null&&ko(),xt(()=>{const e=On(n);if(typeof e=="function")return e})}function lv(n){St===null&&ko(),ha(()=>()=>On(n))}const cv="5";var Ec;typeof window<"u"&&((Ec=window.__svelte??(window.__svelte={})).v??(Ec.v=new Set)).add(cv);function uv(){return{type:"daily",interval:1,time:"09:00"}}function Uu(n){return!n||!n.type||!n.interval||n.interval<1?!1:n.type==="weekly"?Array.isArray(n.weekdays)&&n.weekdays.length>0&&n.weekdays.every(e=>e>=0&&e<=6):n.type==="monthly"?n.dayOfMonth>=1&&n.dayOfMonth<=31:n.type==="yearly"?n.month>=0&&n.month<=11&&n.dayOfMonth>=1&&n.dayOfMonth<=31:!0}const Bn="recurring-tasks-active",Oa="recurring-tasks-archive",bl="recurring-tasks",wl="recurring-tasks.json.bak",_l="n8n-event-settings",kl="n8n-event-queue",dv="notification-state",hv="recurring-tasks-dock",Tl="scheduler-emitted-occurrences",gn=5,Hi={n8n:{webhookUrl:"",sharedSecret:"",enabled:!1}},No=60*1e3,fv=30*1e3,bi=2e3,Sl="shehab-note-recurring-plugin",xl="1.0.0",vv=60*60*1e3,pv=3,Dl=10,wi=1e3,Na=100,El=[{label:"15 minutes",minutes:15},{label:"30 minutes",minutes:30},{label:"1 hour",minutes:60},{label:"2 hours",minutes:120},{label:"4 hours",minutes:240}],gv=[{label:"+1 day",minutes:60*24},{label:"+3 days",minutes:60*24*3},{label:"+1 week",minutes:60*24*7}],mv={lowest:"#94a3b8",low:"#64748b",normal:"#3b82f6",medium:"#f59e0b",high:"#f97316",highest:"#ef4444"},yv=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],Al="last-run-timestamp",Cl="custom-recurring-task-id",Ml="custom-recurring-task-due",Il="custom-recurring-task-enabled",Sa=3,Ol=[1e3,5e3,3e4],bv=1e4,Ro={dueSoonScoreMax:100,dueSoonScoreMin:0,dueDateWeight:10,overdueBaseScore:110,overduePenaltyWeight:15,noDueDateScore:0,priorityMultipliers:{lowest:.8,low:1,normal:1.1,medium:1.2,high:1.5,highest:2},maxUrgency:200,minUrgency:0},zu=24*60*60*1e3,wv=(n,e,t)=>Math.min(t,Math.max(e,n)),Nl=n=>new Date(n.getFullYear(),n.getMonth(),n.getDate()),_v=(n,e)=>{const t=Nl(n),s=Nl(e);return Math.round((s.getTime()-t.getTime())/zu)},kv=(n,e)=>e.priorityMultipliers[n]??1;function Po(n,e={}){return Tv(n,e).score}function Tv(n,e={}){const t=e.now??new Date,s=e.settings??Ro;if(!Lo(n))return{score:0,breakdown:{priorityContribution:0,dueDateContribution:0,overdueContribution:0}};const r=Or(n.priority)??"normal",a=kv(r,s);if(!n.dueAt){const _=s.noDueDateScore,m=_*a;return{score:_i(m,s),breakdown:{priorityContribution:m-_,dueDateContribution:_,overdueContribution:0}}}const i=new Date(n.dueAt);if(Number.isNaN(i.getTime())){const _=s.noDueDateScore,m=_*a;return{score:_i(m,s),breakdown:{priorityContribution:m-_,dueDateContribution:_,overdueContribution:0}}}const l=i.getTime()<t.getTime(),c=_v(t,i),u=l?Math.max(1,Math.ceil((t.getTime()-i.getTime())/zu)):0,d=l?0:wv(s.dueSoonScoreMax-c*s.dueDateWeight,s.dueSoonScoreMin,s.dueSoonScoreMax),f=l?s.overdueBaseScore+u*s.overduePenaltyWeight:0,v=d+f,y=v*a;return{score:_i(y,s),breakdown:{priorityContribution:y-v,dueDateContribution:d,overdueContribution:f}}}function _i(n,e){const t=e.maxUrgency!==void 0?Math.min(e.maxUrgency,n):n;return Math.round(Math.max(e.minUrgency,t))}function Bu(n,e,t){const s=new Date().toISOString(),r=t||new Date;return{id:Yu(),name:n,lastCompletedAt:void 0,dueAt:r.toISOString(),frequency:e,enabled:!0,priority:"normal",timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,completionCount:0,missCount:0,currentStreak:0,bestStreak:0,recentCompletions:[],snoozeCount:0,maxSnoozes:3,version:gn,createdAt:s,updatedAt:s}}const Sv=["lowest","low","normal","medium","high","highest"];function Or(n){if(!n)return;const e=n.toLowerCase();if(e==="urgent")return"highest";if(e==="none")return"normal";if(Sv.includes(e))return e}function Yu(){return`task_${Date.now()}_${Math.random().toString(36).slice(2,11)}`}function $u(n,e={}){const t=new Date().toISOString();return{...{...n,id:Yu(),createdAt:t,updatedAt:t,lastCompletedAt:void 0,completionCount:0,missCount:0,currentStreak:0,bestStreak:0,recentCompletions:[],snoozeCount:0},...e}}function xv(n){var s;const e=new Date,t=e.toISOString();if(n.completionCount=(n.completionCount||0)+1,n.currentStreak=(n.currentStreak||0)+1,n.bestStreak=Math.max(n.bestStreak||0,n.currentStreak),n.recentCompletions||(n.recentCompletions=[]),n.recentCompletions.push(t),n.recentCompletions.length>Dl&&(n.recentCompletions=n.recentCompletions.slice(-Dl)),(s=n.smartRecurrence)!=null&&s.enabled){n.completionHistory||(n.completionHistory=[]);const r=new Date(n.dueAt),a=Math.round((e.getTime()-r.getTime())/(1e3*60)),i={scheduledFor:n.dueAt,completedAt:t,delayMinutes:a,dayOfWeek:e.getDay(),context:{tags:n.tags||[],relatedBlocks:n.linkedBlockId?[n.linkedBlockId]:[]}};n.completionHistory.push(i),n.completionHistory.length>100&&(n.completionHistory=n.completionHistory.slice(-100))}n.snoozeCount=0,n.lastCompletedAt=t,n.updatedAt=t}function ju(n){n.missCount=(n.missCount||0)+1,n.currentStreak=0,n.updatedAt=new Date().toISOString()}function Wu(n){const e=n.completionCount||0,t=n.missCount||0,s=e+t;if(s===0)return 100;let a=e/s*70;const i=n.currentStreak||0,l=Math.min(30,i*3);return a+=l,Math.round(Math.min(100,a))}function Dv(n,e){const t=new Set([...n.blockedBy??[],...n.dependsOn??[]]);return t.size===0?!1:e.filter(r=>t.has(r.id)).some(r=>Lo(r))}function Ev(n,e){return e.some(t=>t.id===n.id||!new Set([...t.blockedBy??[],...t.dependsOn??[]]).has(n.id)?!1:Lo(t))}function Lo(n){return n.status?n.status==="todo":n.enabled}function Yn(n){const{message:e,type:t="info",duration:s=3e3,actionLabel:r,onAction:a,showCountdown:i=!1}=n,l=document.createElement("div");l.className=`recurring-tasks-toast recurring-tasks-toast--${t}`;const c=document.createElement("span");c.textContent=e,l.appendChild(c);let u=null;if(r&&a){const f=document.createElement("button");f.type="button";let v=Math.max(1,Math.ceil(s/1e3));f.textContent=i?`${r} (${v}s)`:r,f.className="recurring-tasks-toast__action",f.addEventListener("click",()=>{a(),u!==null&&window.clearInterval(u),l.parentElement&&l.parentElement.removeChild(l)}),l.appendChild(f),i&&s>0&&(u=window.setInterval(()=>{v=Math.max(0,v-1),f.textContent=`${r} (${v}s)`,v<=0&&u!==null&&(window.clearInterval(u),u=null)},1e3))}Object.assign(l.style,{position:"fixed",top:"20px",right:"20px",padding:"12px 20px",borderRadius:"6px",backgroundColor:Av(t),color:"white",fontSize:"14px",fontWeight:"500",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",zIndex:"10000",maxWidth:"420px",display:"flex",alignItems:"center",gap:"12px",animation:"slideInRight 0.3s ease-out"}),document.body.appendChild(l);const d=()=>{u!==null&&window.clearInterval(u),l.style.animation="slideOutRight 0.3s ease-out",setTimeout(()=>{l.parentElement&&l.parentElement.removeChild(l)},300)};s>0&&setTimeout(()=>{d()},s)}function Av(n){switch(n){case"success":return"#4caf50";case"error":return"#f44336";case"warning":return"#ff9800";case"info":default:return"#2196f3"}}const G={success:(n,e)=>Yn({message:n,type:"success",duration:e}),error:(n,e)=>Yn({message:n,type:"error",duration:e}),warning:(n,e)=>Yn({message:n,type:"warning",duration:e}),info:(n,e)=>Yn({message:n,type:"info",duration:e})};if(typeof document<"u"){const n=document.createElement("style");n.textContent=`
    @keyframes slideInRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    @keyframes slideOutRight {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(100%);
        opacity: 0;
      }
    }

    .recurring-tasks-toast__action {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      padding: 6px 10px;
      border-radius: 4px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s ease;
      white-space: nowrap;
    }

    .recurring-tasks-toast__action:hover {
      background: rgba(255, 255, 255, 0.3);
    }
  `,document.head.appendChild(n)}class Cv{constructor(){w(this,"handlers",new Map)}on(e,t){return this.handlers.has(e)||this.handlers.set(e,new Set),this.handlers.get(e).add(t),()=>{var s;return(s=this.handlers.get(e))==null?void 0:s.delete(t)}}emit(e,t){var s;(s=this.handlers.get(e))==null||s.forEach(r=>r(t))}clear(){this.handlers.clear()}}const Ye=new Cv;function xa(n,e){const t=n.findIndex(r=>r.id===e.id);if(t===-1)return[...n,e];const s=[...n];return s[t]=e,s}function Rl(n,e){const t=n.filter(s=>s.id!==e);return t.length===n.length?n:t}function ki(n,e,t){let s=!1;const r=n.map(a=>a.id!==e?a:(s=!0,t(a)));return s?r:n}function Mv(n,e=new Date){const t=new Date(e);return t.setHours(23,59,59,999),n.filter(s=>s.enabled?new Date(s.dueAt)<=t:!1)}const qo=Symbol("urgency-settings"),Iv=(()=>{try{if(typeof process<"u"&&process.env)return process.env.DEBUG==="true"}catch{}return!1})();function ni(n,e,t){const s={timestamp:new Date().toISOString()},r=`[${n.toUpperCase()}] [${s.timestamp}]`;n==="error"?console.error(r,e,t||""):n==="warn"?console.warn(r,e,t||""):n==="debug"&&Iv?console.debug(r,e,t||""):n==="info"&&console.log(r,e,t||"")}function Hu(n,e){ni("debug",n,e)}function ue(n,e){ni("info",n,e)}function ot(n,e){ni("warn",n,e)}function Te(n,e){ni("error",n,e)}async function Ov(n){return new Promise(e=>{try{vo.fetchPost("/api/block/getBlockInfo",{id:n},t=>{var r,a,i;const s=((r=t==null?void 0:t.data)==null?void 0:r.content)??((a=t==null?void 0:t.data)==null?void 0:a.markdown)??((i=t==null?void 0:t.data)==null?void 0:i.name)??null;e(s?s.trim():null)})}catch(t){ot("Failed to fetch block preview",t),e(null)}})}async function Nv(n){return new Promise(e=>{try{vo.fetchPost("/api/block/getBlockHTML",{id:n},t=>{var r;const s=((r=t==null?void 0:t.data)==null?void 0:r.html)??null;e(s?s.trim():null)})}catch(t){ot("Failed to fetch block embed",t),e(null)}})}function Gi(n){const[e,t]=n.split(":").map(Number);return{hours:e,minutes:t}}function Rv(n){const e=n.getHours().toString().padStart(2,"0"),t=n.getMinutes().toString().padStart(2,"0");return`${e}:${t}`}function Pv(n){return n.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}function Ki(n){return n.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function Fo(n){const e=new Date;return n.getDate()===e.getDate()&&n.getMonth()===e.getMonth()&&n.getFullYear()===e.getFullYear()}function Lv(n){return n<new Date}function qv(n){return Lv(n)&&!Fo(n)}function Cn(n,e){const t=new Date(n);return t.setDate(t.getDate()+e),t}function Pl(n,e){return Cn(n,e*7)}function Ti(n,e,t){const s=new Date(n);return s.setHours(e,t,0,0),s}function Ll(n,e,t){const s=new Date(n);s.setHours(e,t,0,0);const r=s.getHours()!==e||s.getMinutes()!==t;return{date:s,shifted:r}}function Vi(n){const e=new Date(n);return e.setHours(0,0,0,0),e}function Fv(n){const e=new Date(n);return e.setHours(23,59,59,999),e}function Uv(n,e){const s=Math.abs(e.getTime()-n.getTime());return Math.floor(s/864e5)}function zv(n,e){const t=[];for(let s=0;s<e;s++)t.push(Cn(n,s));return t}var Bv=C('<span class="task-card__streak svelte-yjw1ud"> </span>'),Yv=C('<button class="task-card__edit-btn svelte-yjw1ud" title="Edit"></button>'),$v=C('<span class="task-card__relative svelte-yjw1ud"> </span>'),jv=C('<div class="task-card__last-completed svelte-yjw1ud"><span class="task-card__label svelte-yjw1ud">Last completed:</span> <span class="task-card__value svelte-yjw1ud"> </span></div>'),Wv=C('<div class="task-card__block-preview-html svelte-yjw1ud"><!></div>'),Hv=C('<div class="task-card__block-preview svelte-yjw1ud" role="tooltip"><!></div>'),Gv=C('<div class="task-card__linked-block svelte-yjw1ud"><button class="task-card__block-link svelte-yjw1ud"> </button> <!></div>'),Kv=C('<button class="task-card__snooze-chip"> </button>'),Vv=C('<button class="task-card__snooze-option" role="menuitem"> </button>'),Qv=C('<div class="task-card__snooze-menu" role="menu" tabindex="0" aria-label="Snooze options"></div>'),Zv=C('<div role="article" tabindex="0"><div class="task-card__header svelte-yjw1ud"><div class="task-card__title-row svelte-yjw1ud"><div class="task-card__priority-indicator svelte-yjw1ud"></div> <h3 class="task-card__name svelte-yjw1ud"> </h3> <!></div> <!></div> <div class="task-card__details svelte-yjw1ud"><div class="task-card__due svelte-yjw1ud"><span class="task-card__label svelte-yjw1ud">Due:</span> <span class="task-card__value svelte-yjw1ud"> </span> <!></div> <div class="task-card__urgency svelte-yjw1ud"><span class="task-card__label svelte-yjw1ud">Urgency:</span> <span class="task-card__value svelte-yjw1ud"> </span></div> <!> <!></div> <div><div class="task-card__health-bar"></div></div> <div class="task-card__actions svelte-yjw1ud"><div class="task-card__snooze-container svelte-yjw1ud"><button class="task-card__action task-card__action--snooze" aria-label="Snooze task" aria-haspopup="menu"> Snooze</button> <div class="task-card__snooze-quick"><!> <button class="task-card__snooze-chip task-card__snooze-chip--tomorrow" aria-label="Snooze until tomorrow">Tomorrow</button></div> <!></div> <button class="task-card__action task-card__action--delay" aria-label="Delay task to tomorrow"> Tomorrow</button> <button class="task-card__action task-card__action--skip" aria-label="Skip this occurrence"> Skip</button> <button class="task-card__action task-card__action--done" aria-label="Mark task as done"> Done</button></div></div>');function qr(n,e){dt(e,!0);const t=Q(()=>new Date(e.task.dueAt)),s=Q(()=>qv(o(t))),r=Q(()=>Fo(o(t))),a=Q(()=>o(s)?Uv(new Date(e.task.dueAt),new Date):0),i=Q(()=>o(s)?"task-card--overdue":o(r)?"task-card--today":""),l=Q(()=>()=>o(s)?`rgba(244, 67, 54, ${Math.min(.45,.12+o(a)*.05)})`:""),c=Q(()=>()=>o(s)?`rgba(244, 67, 54, ${Math.min(.8,.3+o(a)*.08)})`:""),u=Q(()=>()=>{const ne=Or(e.task.priority)||"normal";return mv[ne]}),d=Q(()=>()=>e.timezoneHandler?e.timezoneHandler.getRelativeTime(o(t)):""),f=Q(()=>(e.task.currentStreak||0)>0),v=Q(()=>()=>""),y=Q(()=>Wu(e.task)),_=Q(()=>o(y)>=80?"health--good":o(y)>=50?"health--fair":"health--poor"),m=Zc(qo),g=Q(()=>Po(e.task,{settings:m}));let b=K(!1),x=K(-1),D=[],A=K(!1),I=K(null),N=K(null),P=K(!1);const H=Q(()=>()=>e.task.linkedBlockId?e.task.linkedBlockId.length>10?`${e.task.linkedBlockId.slice(0,10)}`:e.task.linkedBlockId:""),j=Q(()=>()=>{if(!o(I))return"";const ne=o(I).replace(/\s+/g," ").trim();return ne.length>220?`${ne.slice(0,220)}`:ne}),Z=Q(()=>()=>El.filter(ne=>[15,60,120].includes(ne.minutes))),ae=Q(()=>()=>`snooze-menu-${e.task.id}`);xt(()=>{T(I,e.task.linkedBlockContent??null,!0),T(N,null),T(P,!1)});function re(){e.onDone(e.task)}function de(){e.onDelay(e.task)}function V(){e.onEdit&&e.onEdit(e.task)}function U(){e.onSkip(e.task)}async function O(){T(b,!o(b)),o(b)&&(await Iu(),T(x,-1),D=[])}function M(ne){const be=new CustomEvent("task-snooze",{detail:{taskId:e.task.id,minutes:ne}});window.dispatchEvent(be),T(b,!1),T(x,-1)}function B(ne){var qe,Oe,le,we;const be=o(Z);ne.key==="ArrowDown"?(ne.preventDefault(),T(x,Math.min(o(x)+1,be.length-1),!0),(qe=D[o(x)])==null||qe.focus()):ne.key==="ArrowUp"?(ne.preventDefault(),T(x,Math.max(o(x)-1,0),!0),(Oe=D[o(x)])==null||Oe.focus()):ne.key==="Escape"?(T(b,!1),T(x,-1)):ne.key==="Home"?(ne.preventDefault(),T(x,0),(le=D[0])==null||le.focus()):ne.key==="End"&&(ne.preventDefault(),T(x,be.length-1),(we=D[o(x)])==null||we.focus())}function se(ne){if(ne.key==="Escape"&&o(b)){T(b,!1);return}(ne.key==="Enter"||ne.key===" ")&&(ne.preventDefault(),O())}async function ee(){if(T(A,!0),!e.task.linkedBlockId||o(P)||o(N))return;T(P,!0);const[ne,be]=await Promise.all([Nv(e.task.linkedBlockId),Ov(e.task.linkedBlockId)]);T(N,ne,!0),T(I,be,!0),T(P,!1)}function me(){T(A,!1)}const he=Q(()=>()=>`Task:  ${e.task.name.replace(/[<>"&]/g,be=>({"<":"&lt;",">":"&gt;",'"':"&quot;","&":"&amp;"})[be]||be)}`);var fe=Zv();fe.__keydown=ne=>{ne.key==="Escape"&&o(b)&&T(b,!1)};var De=h(fe),Se=h(De),Fe=h(Se),ve=p(Fe,2),z=h(ve),E=p(ve,2);{var F=ne=>{var be=Bv(),qe=h(be);$(Oe=>{Ne(be,"title",`${e.task.currentStreak??""} day streak`),R(qe,`${Oe??""} ${e.task.currentStreak??""}`)},[()=>o(v)()]),S(ne,be)};W(E,ne=>{o(f)&&ne(F)})}var X=p(Se,2);{var ie=ne=>{var be=Yv();be.__click=V,S(ne,be)};W(X,ne=>{e.onEdit&&ne(ie)})}var L=p(De,2),q=h(L),te=p(h(q),2),pe=h(te),ke=p(te,2);{var ye=ne=>{var be=$v(),qe=h(be);$(Oe=>R(qe,Oe),[()=>o(d)()]),S(ne,be)};W(ke,ne=>{e.timezoneHandler&&ne(ye)})}var Ee=p(q,2),Ae=p(h(Ee),2),Ke=h(Ae),tt=p(Ee,2);{var Ze=ne=>{var be=jv(),qe=p(h(be),2),Oe=h(qe);$(le=>R(Oe,le),[()=>Ki(new Date(e.task.lastCompletedAt))]),S(ne,be)};W(tt,ne=>{e.task.lastCompletedAt&&ne(Ze)})}var lt=p(tt,2);{var ft=ne=>{var be=Gv(),qe=h(be),Oe=h(qe),le=p(qe,2);{var we=Ie=>{var vt=Hv(),Ut=h(vt);{var _t=kt=>{var Ot=gi("Loading preview");S(kt,Ot)},jt=kt=>{var Ot=ut(),As=Qe(Ot);{var zt=Wt=>{var Y=Wv(),ge=h(Y);Zf(ge,()=>o(N)),S(Wt,Y)},ts=Wt=>{var Y=ut(),ge=Qe(Y);{var et=Ht=>{var dn=gi();$(()=>R(dn,o(j))),S(Ht,dn)},ss=Ht=>{var dn=gi("No preview available.");S(Ht,dn)};W(ge,Ht=>{o(I)?Ht(et):Ht(ss,!1)},!0)}S(Wt,Y)};W(As,Wt=>{o(N)?Wt(zt):Wt(ts,!1)},!0)}S(kt,Ot)};W(Ut,kt=>{o(P)?kt(_t):kt(jt,!1)})}S(Ie,vt)};W(le,Ie=>{o(A)&&Ie(we)})}$(()=>{Ne(qe,"title",`Linked block: ${e.task.linkedBlockId}`),R(Oe,` Block ${o(H)??""}`)}),Lt("mouseenter",qe,ee),Lt("mouseleave",qe,me),Lt("focus",qe,ee),Lt("blur",qe,me),S(ne,be)};W(lt,ne=>{e.task.linkedBlockId&&ne(ft)})}var Me=p(L,2),Le=h(Me),Ce=p(Me,2),Ue=h(Ce),We=h(Ue);We.__click=O,We.__keydown=se;var ze=p(We,2),ct=h(ze);je(ct,17,()=>o(Z),pt,(ne,be)=>{var qe=Kv();qe.__click=()=>M(o(be).minutes);var Oe=h(qe);$(()=>{Ne(qe,"aria-label",`Snooze for ${o(be).label}`),R(Oe,o(be).label)}),S(ne,qe)});var It=p(ct,2);It.__click=de;var Jt=p(ze,2);{var vs=ne=>{var be=Qv();be.__keydown=B,je(be,21,()=>El,pt,(qe,Oe,le)=>{var we=Vv();we.__click=()=>M(o(Oe).minutes),Ne(we,"tabindex",le===0?0:-1);var Ie=h(we);Ps(we,(vt,Ut)=>D[Ut]=vt,vt=>D==null?void 0:D[vt],()=>[le]),$(()=>R(Ie,o(Oe).label)),S(qe,we)}),$(()=>Ne(be,"id",o(ae))),S(ne,be)};W(Jt,ne=>{o(b)&&ne(vs)})}var Ft=p(Ue,2);Ft.__click=de;var es=p(Ft,2);es.__click=U;var ps=p(es,2);ps.__click=re,$((ne,be)=>{Xe(fe,1,`task-card ${o(i)??""}`,"svelte-yjw1ud"),Rs(fe,`--overdue-tint: ${o(l)??""}; --overdue-border: ${o(c)??""};`),Ne(fe,"aria-label",ne),Ne(fe,"data-task-id",e.task.id),Rs(Fe,`background-color: ${o(u)??""}`),Ne(Fe,"title",`Priority:  ${(e.task.priority||"normal")??""}`),R(z,e.task.name),R(pe,be),Ne(Ee,"title",`Urgency score: ${o(g)??""}`),R(Ke,o(g)),Xe(Me,1,`task-card__health ${o(_)??""}`,"svelte-yjw1ud"),Ne(Me,"title",`Task health:  ${o(y)??""}%`),Rs(Le,`width: ${o(y)??""}%`),Ne(We,"aria-expanded",o(b)),Ne(We,"aria-controls",o(ae))},[()=>o(he)(),()=>Ki(o(t))]),S(n,fe),ht()}bt(["keydown","click"]);var Xv=C(`<div class="today-tab__empty svelte-u7986x"><p class="svelte-u7986x"> No tasks due today or overdue!</p> <p class="today-tab__empty-subtitle svelte-u7986x">You're all caught up.</p></div>`),Jv=C('<div class="today-tab__card-wrapper svelte-u7986x" role="listitem"><!></div>'),ep=C('<div class="today-tab svelte-u7986x"><div class="today-tab__header svelte-u7986x"><h2 class="today-tab__title svelte-u7986x">Today & Overdue Tasks</h2> <p class="today-tab__subtitle svelte-u7986x"> </p></div> <div class="today-tab__content svelte-u7986x" role="list" aria-label="Today and overdue tasks"><!></div></div>');function tp(n,e){dt(e,!0);const t=Q(()=>[...e.tasks].sort((m,g)=>new Date(m.dueAt).getTime()-new Date(g.dueAt).getTime()));let s=K(0),r=xe([]);xt(()=>{o(s)>=o(t).length&&T(s,Math.max(0,o(t).length-1),!0)});function a(m){var b;if(o(t).length===0)return;const g=Math.max(0,Math.min(m,o(t).length-1));T(s,g,!0),(b=r[g])==null||b.focus()}function i(m,g){m.key==="ArrowDown"?(m.preventDefault(),a(g+1)):m.key==="ArrowUp"?(m.preventDefault(),a(g-1)):m.key==="Home"?(m.preventDefault(),a(0)):m.key==="End"&&(m.preventDefault(),a(o(t).length-1))}var l=ep(),c=h(l),u=p(h(c),2),d=h(u),f=p(c,2),v=h(f);{var y=m=>{var g=Xv();S(m,g)},_=m=>{var g=ut(),b=Qe(g);je(b,19,()=>o(t),x=>x.id,(x,D,A)=>{var I=Jv();I.__keydown=P=>i(P,o(A));var N=h(I);qr(N,{get task(){return o(D)},get onDone(){return e.onDone},get onDelay(){return e.onDelay},get onSkip(){return e.onSkip},get onEdit(){return e.onEdit},get timezoneHandler(){return e.timezoneHandler}}),Ps(I,(P,H)=>r[H]=P,P=>r==null?void 0:r[P],()=>[o(A)]),$(()=>Ne(I,"tabindex",o(A)===o(s)?0:-1)),Lt("focus",I,()=>T(s,o(A),!0)),S(x,I)}),S(m,g)};W(v,m=>{o(t).length===0?m(y):m(_,!1)})}$(()=>R(d,`${e.tasks.length??""} task${e.tasks.length!==1?"s":""} requiring attention`)),S(n,l),ht()}bt(["keydown"]);var sp=C('<div class="all-tasks-tab__empty svelte-i091qn"><p class="svelte-i091qn">No recurring tasks yet.</p> <p class="all-tasks-tab__empty-subtitle svelte-i091qn">Create your first task to get started!</p></div>'),np=C('<div class="all-tasks-tab__empty svelte-i091qn"><p class="svelte-i091qn"> </p> <p class="all-tasks-tab__empty-subtitle svelte-i091qn">Try a different search term.</p></div>'),rp=C('<tr><td class="all-tasks-tab__select-col svelte-i091qn"><input type="checkbox"/></td><td class="task-name svelte-i091qn"> </td><td class="svelte-i091qn"> </td><td class="svelte-i091qn"> </td><td class="svelte-i091qn"><label class="toggle-switch svelte-i091qn"><input type="checkbox" class="svelte-i091qn"/> <span class="toggle-slider svelte-i091qn"></span></label></td><td class="svelte-i091qn"><div class="task-actions svelte-i091qn"><button class="task-action-btn task-action-btn--edit svelte-i091qn" title="Edit"></button> <button class="task-action-btn task-action-btn--duplicate svelte-i091qn" title="Duplicate"></button> <button class="task-action-btn task-action-btn--delete svelte-i091qn" title="Delete"></button></div></td></tr>'),ap=C('<table class="all-tasks-tab__table svelte-i091qn"><thead class="svelte-i091qn"><tr class="svelte-i091qn"><th class="all-tasks-tab__select-col svelte-i091qn"><input class="all-tasks-tab__select-all svelte-i091qn" type="checkbox" aria-label="Select all visible tasks"/></th><th class="svelte-i091qn">Task Name</th><th class="svelte-i091qn">Next Due</th><th class="svelte-i091qn">Frequency</th><th class="svelte-i091qn">Status</th><th class="svelte-i091qn">Actions</th></tr></thead><tbody></tbody></table>'),ip=C('<div class="all-tasks-tab__table-wrapper svelte-i091qn"><!></div>'),op=C('<div class="delete-confirm-overlay svelte-i091qn"><div class="delete-confirm-dialog svelte-i091qn"><h3 class="svelte-i091qn">Delete Task?</h3> <p class="svelte-i091qn"> </p> <div class="delete-confirm-actions svelte-i091qn"><button class="btn-cancel svelte-i091qn">Cancel</button> <button class="btn-delete svelte-i091qn">Delete</button></div></div></div>'),lp=C('<div class="delete-confirm-overlay svelte-i091qn"><div class="delete-confirm-dialog svelte-i091qn"><h3 class="svelte-i091qn">Delete Selected Tasks?</h3> <p class="svelte-i091qn"> </p> <div class="delete-confirm-actions svelte-i091qn"><button class="btn-cancel svelte-i091qn">Cancel</button> <button class="btn-delete svelte-i091qn">Delete</button></div></div></div>'),cp=C('<div class="all-tasks-tab svelte-i091qn"><div class="all-tasks-tab__header svelte-i091qn"><h2 class="all-tasks-tab__title svelte-i091qn">All Recurring Tasks</h2> <div class="all-tasks-tab__actions svelte-i091qn"><div class="all-tasks-tab__search svelte-i091qn"><span class="all-tasks-tab__search-icon svelte-i091qn"></span> <input class="all-tasks-tab__search-input svelte-i091qn" type="search" placeholder="Search tasks (name, tags, block content)" aria-label="Search tasks" title="Searches task names, descriptions, tags, and linked block content."/></div> <button class="all-tasks-tab__create-btn svelte-i091qn">+ Create New Task</button></div></div> <div class="all-tasks-tab__content svelte-i091qn"><div class="all-tasks-tab__bulk svelte-i091qn"><div class="all-tasks-tab__bulk-info"> </div> <div class="all-tasks-tab__bulk-actions svelte-i091qn"><button class="all-tasks-tab__bulk-btn svelte-i091qn">Enable</button> <button class="all-tasks-tab__bulk-btn svelte-i091qn">Disable</button> <button class="all-tasks-tab__bulk-btn all-tasks-tab__bulk-btn--danger svelte-i091qn">Delete</button></div></div> <!></div></div> <!> <!>',1);function up(n,e){dt(e,!0);let t=K(null),s=K(!1),r=K(""),a=K(""),i=K(xe(new Set)),l=K(0),c=xe([]),u=K(null);const d=Q(()=>[...e.tasks].sort((L,q)=>new Date(L.dueAt).getTime()-new Date(q.dueAt).getTime())),f=Q(()=>()=>{const L=o(a).trim().toLowerCase();return L?o(d).filter(q=>{var pe;return[q.name,q.description,q.category,q.linkedBlockContent,(pe=q.tags)==null?void 0:pe.join(" ")].filter(Boolean).join(" ").toLowerCase().includes(L)}):o(d)}),v=Q(()=>o(f).map(L=>L.id)),y=Q(()=>o(i).size>0),_=Q(()=>o(f).length>0&&o(f).every(L=>o(i).has(L.id))),m=Q(()=>o(f).some(L=>o(i).has(L.id))&&!o(_));xt(()=>{const L=new Set([...o(i)].filter(q=>e.tasks.some(te=>te.id===q)));L.size!==o(i).size&&T(i,L,!0)}),xt(()=>{o(u)&&(o(u).indeterminate=o(m))}),xt(()=>{o(l)>=o(f).length&&T(l,Math.max(0,o(f).length-1),!0)}),xt(()=>{const L=window.setTimeout(()=>{T(a,o(r),!0)},300);return()=>{window.clearTimeout(L)}});function g(L){T(t,L,!0)}function b(){o(t)&&(e.onDelete(o(t)),T(t,null))}function x(){T(t,null)}function D(L){const q=new Set(o(i));q.has(L)?q.delete(L):q.add(L),T(i,q,!0)}function A(){const L=new Set(o(i));o(_)?o(v).forEach(q=>L.delete(q)):o(v).forEach(q=>L.add(q)),T(i,L,!0)}function I(L){var te;if(o(f).length===0)return;const q=Math.max(0,Math.min(L,o(f).length-1));T(l,q,!0),(te=c[q])==null||te.focus()}function N(L,q){L.key==="ArrowDown"?(L.preventDefault(),I(q+1)):L.key==="ArrowUp"?(L.preventDefault(),I(q-1)):L.key==="Home"?(L.preventDefault(),I(0)):L.key==="End"&&(L.preventDefault(),I(o(f).length-1))}function P(){if(o(i).size===0){T(s,!1);return}e.onBulkDelete([...o(i)]),T(i,new Set,!0),T(s,!1)}function H(){T(s,!1)}function j(L){const{type:q,interval:te}=L.frequency,pe=q==="daily"?"day":q==="weekly"?"week":q==="monthly"?"month":"year",ke=te===1?`Every ${pe}`:`Every ${te} ${pe}s`;if(q==="weekly")return`${ke} on ${L.frequency.weekdays.map(ye=>yv[ye]??ye).join(", ")}`;if(q==="monthly")return`${ke} on day ${L.frequency.dayOfMonth}`;if(q==="yearly"){const ye=Z[L.frequency.month]??`Month ${L.frequency.month+1}`;return`${ke} on ${ye} ${L.frequency.dayOfMonth}`}return ke}const Z=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var ae=cp(),re=Qe(ae),de=h(re),V=p(h(de),2),U=h(V),O=p(h(U),2),M=p(U,2);M.__click=function(...L){var q;(q=e.onCreate)==null||q.apply(this,L)};var B=p(de,2),se=h(B),ee=h(se),me=h(ee),he=p(ee,2),fe=h(he);fe.__click=()=>e.onBulkEnable([...o(i)]);var De=p(fe,2);De.__click=()=>e.onBulkDisable([...o(i)]);var Se=p(De,2);Se.__click=()=>T(s,!0);var Fe=p(se,2);{var ve=L=>{var q=sp();S(L,q)},z=L=>{var q=ip(),te=h(q);{var pe=ye=>{var Ee=np(),Ae=h(Ee),Ke=h(Ae);$(tt=>R(Ke,`No tasks match "${tt??""}".`),[()=>o(a).trim()]),S(ye,Ee)},ke=ye=>{var Ee=ap(),Ae=h(Ee),Ke=h(Ae),tt=h(Ke),Ze=h(tt);Ze.__click=A,Ps(Ze,ft=>T(u,ft),()=>o(u));var lt=p(Ae);je(lt,23,()=>o(f),ft=>ft.id,(ft,Me,Le)=>{var Ce=rp();Ce.__keydown=Ie=>N(Ie,o(Le));var Ue=h(Ce),We=h(Ue);We.__click=()=>D(o(Me).id);var ze=p(Ue),ct=h(ze),It=p(ze),Jt=h(It),vs=p(It),Ft=h(vs),es=p(vs),ps=h(es),ne=h(ps);ne.__change=()=>e.onToggleEnabled(o(Me));var be=p(es),qe=h(be),Oe=h(qe);Oe.__click=()=>e.onEdit(o(Me));var le=p(Oe,2);le.__click=()=>e.onDuplicate(o(Me));var we=p(le,2);we.__click=()=>g(o(Me)),Ps(Ce,(Ie,vt)=>c[vt]=Ie,Ie=>c==null?void 0:c[Ie],()=>[o(Le)]),$((Ie,vt,Ut,_t)=>{Xe(Ce,1,ev(o(Me).enabled?"":"disabled"),"svelte-i091qn"),Ne(Ce,"tabindex",o(Le)===o(l)?0:-1),Ne(Ce,"aria-selected",Ie),Ne(We,"aria-label",`Select ${o(Me).name}`),An(We,vt),R(ct,o(Me).name),R(Jt,Ut),R(Ft,_t),An(ne,o(Me).enabled)},[()=>o(i).has(o(Me).id),()=>o(i).has(o(Me).id),()=>Ki(new Date(o(Me).dueAt)),()=>j(o(Me))]),Lt("focus",Ce,()=>T(l,o(Le),!0)),S(ft,Ce)}),$(()=>{An(Ze,o(_)),Ze.disabled=o(f).length===0}),S(ye,Ee)};W(te,ye=>{o(f).length===0?ye(pe):ye(ke,!1)})}S(L,q)};W(Fe,L=>{o(d).length===0?L(ve):L(z,!1)})}var E=p(re,2);{var F=L=>{var q=op(),te=h(q),pe=p(h(te),2),ke=h(pe),ye=p(pe,2),Ee=h(ye);Ee.__click=x;var Ae=p(Ee,2);Ae.__click=b,$(()=>R(ke,`Are you sure you want to delete "${o(t).name??""}"? This action cannot be undone.`)),S(L,q)};W(E,L=>{o(t)&&L(F)})}var X=p(E,2);{var ie=L=>{var q=lp(),te=h(q),pe=p(h(te),2),ke=h(pe),ye=p(pe,2),Ee=h(ye);Ee.__click=H;var Ae=p(Ee,2);Ae.__click=P,$(()=>R(ke,`Are you sure you want to delete ${o(i).size??""} task${o(i).size===1?"":"s"}? This action cannot be undone.`)),S(L,q)};W(X,L=>{o(s)&&L(ie)})}$(()=>{O.disabled=o(d).length===0,R(me,`${o(i).size??""} selected`),fe.disabled=!o(y),De.disabled=!o(y),Se.disabled=!o(y)}),it(O,()=>o(r),L=>T(r,L)),S(n,ae),ht()}bt(["click","keydown","change"]);var dp=C('<div class="timeline-tab__empty svelte-11jqy0n"><p> </p></div>'),hp=C('<span class="timeline-task__meta-item svelte-11jqy0n"> </span>'),fp=C('<span class="timeline-task__meta-item svelte-11jqy0n"> </span>'),vp=C('<span class="timeline-task__meta-item svelte-11jqy0n"> </span>'),pp=C('<div class="timeline-task svelte-11jqy0n"><div class="timeline-task__time svelte-11jqy0n"> </div> <div class="timeline-task__content svelte-11jqy0n"><div class="timeline-task__name svelte-11jqy0n"> </div> <div class="timeline-task__meta svelte-11jqy0n"><!> <!> <!></div></div></div>'),gp=C('<div class="timeline-day svelte-11jqy0n"><div class="timeline-day__date svelte-11jqy0n"><div class="timeline-day__date-label svelte-11jqy0n"> </div> <div class="timeline-day__weekday svelte-11jqy0n"> </div></div> <div class="timeline-day__tasks svelte-11jqy0n"></div></div>'),mp=C('<div class="timeline-tab__timeline svelte-11jqy0n"></div>'),yp=C('<div class="timeline-tab svelte-11jqy0n"><div class="timeline-tab__header svelte-11jqy0n"><h2 class="timeline-tab__title svelte-11jqy0n">Scheduled Timeline</h2> <p class="timeline-tab__subtitle svelte-11jqy0n"> </p></div> <div class="timeline-tab__content svelte-11jqy0n"><!></div></div>');function bp(n,e){dt(e,!0);let t=rn(e,"days",3,30);function s(b){const{frequency:x}=b;if(x.type==="weekly"){const D=[...x.weekdays].sort((A,I)=>A-I).join(",");return`weekly:${x.interval}:${x.time??""}:${D}`}return x.type==="monthly"?`monthly:${x.interval}:${x.time??""}:${x.dayOfMonth}`:x.type==="yearly"?`yearly:${x.interval}:${x.time??""}:${x.month}:${x.dayOfMonth}`:`daily:${x.interval}:${x.time??""}`}function r(b,x){const D=b.map(A=>`${A.id}:${A.enabled}:${A.dueAt}:${s(A)}`).join("|");return`${x}:${D}`}function a(b,x){const D=Vi(new Date),A=Fv(Cn(D,x-1)),I=24*60*60*1e3,P=zv(D,x).map(H=>({date:H,tasks:[]}));for(const H of b.filter(j=>j.enabled)){const j=new Date(H.dueAt),Z=e.recurrenceEngine.getOccurrencesInRange(D,A,H.frequency,j);for(const ae of Z){const re=Vi(ae),de=Math.floor((re.getTime()-D.getTime())/I);de>=0&&de<x&&P[de].tasks.push({task:H,occurrence:ae})}}for(const H of P)H.tasks.sort((j,Z)=>j.occurrence.getTime()-Z.occurrence.getTime());return P}const i=(()=>{let b="",x=[];return{get(D,A){const I=r(D,A);return I===b||(b=I,x=a(D,A)),x}}})(),l=Q(()=>i.get(e.tasks,t())),c=Q(()=>o(l).some(b=>b.tasks.length>0));var u=yp(),d=h(u),f=p(h(d),2),v=h(f),y=p(d,2),_=h(y);{var m=b=>{var x=dp(),D=h(x),A=h(D);$(()=>R(A,`No tasks scheduled in the next ${t()??""} days.`)),S(b,x)},g=b=>{var x=mp();je(x,21,()=>o(l),D=>D.date.toISOString(),(D,A)=>{var I=ut(),N=Qe(I);{var P=H=>{var j=gp(),Z=h(j),ae=h(Z),re=h(ae),de=p(ae,2),V=h(de),U=p(Z,2);je(U,21,()=>o(A).tasks,({task:O,occurrence:M})=>O.id+M.toISOString(),(O,M)=>{let B=()=>o(M).task,se=()=>o(M).occurrence;var ee=pp(),me=h(ee),he=h(me),fe=p(me,2),De=h(fe),Se=h(De),Fe=p(De,2),ve=h(Fe);{var z=L=>{var q=hp(),te=h(q);$(()=>R(te,` ${B().linkedBlockId??""}`)),S(L,q)};W(ve,L=>{B().linkedBlockId&&L(z)})}var E=p(ve,2);{var F=L=>{var q=fp(),te=h(q);$(()=>R(te,` ${B().priority??""}`)),S(L,q)};W(E,L=>{B().priority&&L(F)})}var X=p(E,2);{var ie=L=>{var q=vp(),te=h(q);$(pe=>R(te,` ${pe??""}`),[()=>B().tags.join(", ")]),S(L,q)};W(X,L=>{var q;(q=B().tags)!=null&&q.length&&L(ie)})}$(L=>{R(he,L),R(Se,B().name)},[()=>Rv(se())]),S(O,ee)}),$((O,M)=>{R(re,O),R(V,M)},[()=>Pv(o(A).date),()=>o(A).date.toLocaleDateString(void 0,{weekday:"short"})]),S(H,j)};W(N,H=>{o(A).tasks.length>0&&H(P)})}S(D,I)}),S(b,x)};W(_,b=>{o(c)?b(g,!1):b(m)})}$(()=>R(v,`Next ${t()??""} days`)),S(n,u),ht()}var wp=C('<span class="leaderboard-item__badge svelte-1ptoc1q"> Best</span>'),_p=C('<div class="leaderboard-item svelte-1ptoc1q"><div class="leaderboard-item__rank svelte-1ptoc1q"></div> <div class="leaderboard-item__name svelte-1ptoc1q"> </div> <div class="leaderboard-item__value svelte-1ptoc1q"> <!></div></div>'),kp=C('<div class="analytics-section svelte-1ptoc1q"><h3 class="analytics-section__title svelte-1ptoc1q"> Current Streaks</h3> <div class="leaderboard svelte-1ptoc1q"></div></div>'),Tp=C('<div class="health-item svelte-1ptoc1q"><div class="health-item__name svelte-1ptoc1q"> </div> <div class="health-item__bar-container svelte-1ptoc1q"><div class="health-item__bar svelte-1ptoc1q"></div> <div class="health-item__score svelte-1ptoc1q"> </div></div></div>'),Sp=C('<h4 class="subsection-title svelte-1ptoc1q"> Best Performing</h4> <div class="health-list svelte-1ptoc1q"></div>',1),xp=C('<div class="health-item svelte-1ptoc1q"><div class="health-item__name svelte-1ptoc1q"> </div> <div class="health-item__bar-container svelte-1ptoc1q"><div class="health-item__bar svelte-1ptoc1q"></div> <div class="health-item__score svelte-1ptoc1q"> </div></div></div>'),Dp=C('<h4 class="subsection-title svelte-1ptoc1q"> Needs Attention</h4> <div class="health-list svelte-1ptoc1q"></div>',1),Ep=C('<div class="activity-item svelte-1ptoc1q"><div class="activity-item__icon svelte-1ptoc1q"></div> <div class="activity-item__details svelte-1ptoc1q"><div class="activity-item__name svelte-1ptoc1q"> </div> <div class="activity-item__time svelte-1ptoc1q"> </div></div></div>'),Ap=C('<div class="analytics-section svelte-1ptoc1q"><h3 class="analytics-section__title svelte-1ptoc1q">Recent Activity</h3> <div class="activity-list svelte-1ptoc1q"></div></div>'),Cp=C('<div class="analytics-tab svelte-1ptoc1q"><div class="analytics-tab__header svelte-1ptoc1q"><h2 class="analytics-tab__title svelte-1ptoc1q">Task Analytics</h2> <p class="analytics-tab__subtitle svelte-1ptoc1q">Performance insights and statistics</p></div> <div class="analytics-tab__content svelte-1ptoc1q"><div class="analytics-section svelte-1ptoc1q"><h3 class="analytics-section__title svelte-1ptoc1q">Overall Performance</h3> <div class="stats-grid svelte-1ptoc1q"><div class="stat-card svelte-1ptoc1q"><div class="stat-card__value svelte-1ptoc1q"> </div> <div class="stat-card__label svelte-1ptoc1q">Total Completions</div></div> <div class="stat-card svelte-1ptoc1q"><div class="stat-card__value svelte-1ptoc1q"> </div> <div class="stat-card__label svelte-1ptoc1q">Total Misses</div></div> <div class="stat-card stat-card--highlight svelte-1ptoc1q"><div class="stat-card__value svelte-1ptoc1q"> </div> <div class="stat-card__label svelte-1ptoc1q">Completion Rate</div></div></div></div> <!> <div class="analytics-section svelte-1ptoc1q"><h3 class="analytics-section__title svelte-1ptoc1q">Task Health Scores</h3> <!> <!></div> <!></div></div>');function Mp(n,e){dt(e,!0);const t=Q(()=>()=>{let O=0,M=0;for(const ee of e.tasks)O+=ee.completionCount||0,M+=ee.missCount||0;const B=O+M,se=B>0?O/B*100:100;return{totalCompletions:O,totalMisses:M,completionRate:Math.round(se)}}),s=Q(()=>()=>[...e.tasks].filter(O=>(O.currentStreak||0)>0).sort((O,M)=>(M.currentStreak||0)-(O.currentStreak||0)).slice(0,10)),r=Q(()=>()=>[...e.tasks].map(O=>({task:O,health:Wu(O)})).sort((O,M)=>O.health-M.health)),a=Q(()=>()=>o(r)().slice(-5).reverse()),i=Q(()=>()=>o(r)().slice(0,5)),l=Q(()=>()=>{const O=[];for(const M of e.tasks)if(M.recentCompletions&&M.recentCompletions.length>0)for(const B of M.recentCompletions)O.push({task:M,completedAt:B});return O.sort((M,B)=>new Date(B.completedAt).getTime()-new Date(M.completedAt).getTime()).slice(0,10)});function c(O){return new Date(O).toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function u(O){return O>=80?"#10b981":O>=60?"#3b82f6":O>=40?"#f59e0b":"#ef4444"}var d=Cp(),f=p(h(d),2),v=h(f),y=p(h(v),2),_=h(y),m=h(_),g=h(m),b=p(_,2),x=h(b),D=h(x),A=p(b,2),I=h(A),N=h(I),P=p(v,2);{var H=O=>{var M=kp(),B=p(h(M),2);je(B,21,()=>o(s)(),pt,(se,ee,me)=>{var he=_p(),fe=h(he);fe.textContent=`#${me+1}`;var De=p(fe,2),Se=h(De),Fe=p(De,2),ve=h(Fe),z=p(ve);{var E=F=>{var X=wp();S(F,X)};W(z,F=>{o(ee).bestStreak&&o(ee).currentStreak===o(ee).bestStreak&&F(E)})}$(()=>{R(Se,o(ee).name),R(ve,`${o(ee).currentStreak??""} day${o(ee).currentStreak!==1?"s":""} `)}),S(se,he)}),S(O,M)};W(P,O=>{o(s)().length>0&&O(H)})}var j=p(P,2),Z=p(h(j),2);{var ae=O=>{var M=Sp(),B=p(Qe(M),2);je(B,21,()=>o(a)(),pt,(se,ee)=>{let me=()=>o(ee).task,he=()=>o(ee).health;var fe=Tp(),De=h(fe),Se=h(De),Fe=p(De,2),ve=h(Fe),z=p(ve,2),E=h(z);$(F=>{R(Se,me().name),Rs(ve,`width: ${he()??""}%; background-color: ${F??""}`),R(E,`${he()??""}/100`)},[()=>u(he())]),S(se,fe)}),S(O,M)};W(Z,O=>{o(a)().length>0&&O(ae)})}var re=p(Z,2);{var de=O=>{var M=Dp(),B=p(Qe(M),2);je(B,21,()=>o(i)(),pt,(se,ee)=>{let me=()=>o(ee).task,he=()=>o(ee).health;var fe=xp(),De=h(fe),Se=h(De),Fe=p(De,2),ve=h(Fe),z=p(ve,2),E=h(z);$(F=>{R(Se,me().name),Rs(ve,`width: ${he()??""}%; background-color: ${F??""}`),R(E,`${he()??""}/100`)},[()=>u(he())]),S(se,fe)}),S(O,M)};W(re,O=>{o(i)().length>0&&o(i)()[0].health<80&&O(de)})}var V=p(j,2);{var U=O=>{var M=Ap(),B=p(h(M),2);je(B,21,()=>o(l)(),pt,(se,ee)=>{let me=()=>o(ee).task,he=()=>o(ee).completedAt;var fe=Ep(),De=p(h(fe),2),Se=h(De),Fe=h(Se),ve=p(Se,2),z=h(ve);$(E=>{R(Fe,me().name),R(z,E)},[()=>c(he())]),S(se,fe)}),S(O,M)};W(V,O=>{o(l)().length>0&&O(U)})}$((O,M,B)=>{R(g,O),R(D,M),R(N,`${B??""}%`)},[()=>o(t)().totalCompletions,()=>o(t)().totalMisses,()=>o(t)().completionRate]),S(n,d),ht()}var Ip=C('<div class="inbox-tab__empty svelte-1jnb97y"><p class="svelte-1jnb97y"> No tasks in inbox</p> <p class="inbox-tab__empty-subtitle svelte-1jnb97y">Create your first task or schedule your existing tasks!</p></div>'),Op=C('<div class="inbox-tab__card-wrapper svelte-1jnb97y" role="listitem"><!></div>'),Np=C('<div class="inbox-tab svelte-1jnb97y"><div class="inbox-tab__header svelte-1jnb97y"><h2 class="inbox-tab__title svelte-1jnb97y">Inbox</h2> <p class="inbox-tab__subtitle svelte-1jnb97y"> </p></div> <div class="inbox-tab__content svelte-1jnb97y" role="list" aria-label="Inbox tasks"><!></div></div>');function Rp(n,e){dt(e,!0);const t=Q(()=>e.tasks.filter(m=>m.status!=="done"&&m.status!=="cancelled"&&!m.dueAt&&!m.scheduledAt&&!m.startAt).sort((m,g)=>new Date(g.createdAt).getTime()-new Date(m.createdAt).getTime()));let s=K(0),r=xe([]);xt(()=>{o(s)>=o(t).length&&T(s,Math.max(0,o(t).length-1),!0)});function a(m){var b;if(o(t).length===0)return;const g=Math.max(0,Math.min(m,o(t).length-1));T(s,g,!0),(b=r[g])==null||b.focus()}function i(m,g){m.key==="ArrowDown"?(m.preventDefault(),a(g+1)):m.key==="ArrowUp"?(m.preventDefault(),a(g-1)):m.key==="Enter"&&e.onEdit?(m.preventDefault(),e.onEdit(o(t)[g])):m.key===" "&&e.onDone&&(m.preventDefault(),e.onDone(o(t)[g]))}var l=Np(),c=h(l),u=p(h(c),2),d=h(u),f=p(c,2),v=h(f);{var y=m=>{var g=Ip();S(m,g)},_=m=>{var g=ut(),b=Qe(g);je(b,19,()=>o(t),x=>x.id,(x,D,A)=>{var I=Op();I.__keydown=P=>i(P,o(A));var N=h(I);qr(N,{get task(){return o(D)},get onEdit(){return e.onEdit},get onDone(){return e.onDone},get onDelete(){return e.onDelete}}),Ps(I,(P,H)=>r[H]=P,P=>r==null?void 0:r[P],()=>[o(A)]),$(()=>Ne(I,"tabindex",o(A)===o(s)?0:-1)),Lt("focus",I,()=>T(s,o(A),!0)),S(x,I)}),S(m,g)};W(v,m=>{o(t).length===0?m(y):m(_,!1)})}$(()=>R(d,`${o(t).length??""} task${o(t).length!==1?"s":""} without dates`)),S(n,l),ht()}bt(["keydown"]);var Pp=C('<div class="upcoming-tab__empty svelte-102jr7u"><p class="svelte-102jr7u"> </p> <p class="upcoming-tab__empty-subtitle svelte-102jr7u">You have a clear schedule ahead!</p></div>'),Lp=C('<div class="upcoming-tab__card-wrapper svelte-102jr7u" role="listitem"><!></div>'),qp=C('<div class="upcoming-tab__date-group svelte-102jr7u"><h3 class="upcoming-tab__date-header svelte-102jr7u"> </h3> <!></div>'),Fp=C('<div class="upcoming-tab svelte-102jr7u"><div class="upcoming-tab__header svelte-102jr7u"><h2 class="upcoming-tab__title svelte-102jr7u">Upcoming</h2> <p class="upcoming-tab__subtitle svelte-102jr7u"> </p></div> <div class="upcoming-tab__content svelte-102jr7u" role="list" aria-label="Upcoming tasks"><!></div></div>');function Up(n,e){dt(e,!0);let t=rn(e,"daysAhead",3,7);const s=new Date;s.setHours(0,0,0,0);const r=new Date(s);r.setDate(r.getDate()+t());const a=Q(()=>e.tasks.filter(D=>{if(D.status==="done"||D.status==="cancelled"||!D.dueAt)return!1;const A=new Date(D.dueAt);return A.setHours(0,0,0,0),A>s&&A<=r}).sort((D,A)=>new Date(D.dueAt).getTime()-new Date(A.dueAt).getTime())),i=Q(()=>()=>{const D=new Map;return o(a).forEach(A=>{const I=new Date(A.dueAt);I.setHours(0,0,0,0);const N=I.toISOString().split("T")[0];D.has(N)||D.set(N,[]),D.get(N).push(A)}),D});function l(D){const A=new Date(D),I=Math.floor((A.getTime()-s.getTime())/(1e3*60*60*24)),N=A.toLocaleDateString("en-US",{weekday:"long"}),P=A.toLocaleDateString("en-US",{month:"short",day:"numeric"});return I===1?`Tomorrow - ${N}, ${P}`:`${N}, ${P} (in ${I} days)`}let c=K(0),u=xe([]);xt(()=>{o(c)>=o(a).length&&T(c,Math.max(0,o(a).length-1),!0)});function d(D,A){D.key==="ArrowDown"?(D.preventDefault(),T(c,Math.min(o(c)+1,o(a).length-1),!0)):D.key==="ArrowUp"?(D.preventDefault(),T(c,Math.max(o(c)-1,0),!0)):D.key==="Enter"&&e.onEdit?(D.preventDefault(),e.onEdit(o(a)[A])):D.key===" "&&e.onDone&&(D.preventDefault(),e.onDone(o(a)[A]))}var f=Fp(),v=h(f),y=p(h(v),2),_=h(y),m=p(v,2),g=h(m);{var b=D=>{var A=Pp(),I=h(A),N=h(I);$(()=>R(N,` No tasks scheduled for the next ${t()??""} days`)),S(D,A)},x=D=>{var A=ut(),I=Qe(A);je(I,17,()=>[...o(i).entries()],pt,(N,P)=>{var H=Q(()=>jc(o(P),2));let j=()=>o(H)[0],Z=()=>o(H)[1];var ae=qp(),re=h(ae),de=h(re),V=p(re,2);je(V,19,Z,U=>U.id,(U,O)=>{const M=Q(()=>o(a).indexOf(o(O)));var B=Lp();B.__keydown=ee=>d(ee,o(M));var se=h(B);qr(se,{get task(){return o(O)},get onEdit(){return e.onEdit},get onDone(){return e.onDone},get onDelete(){return e.onDelete}}),Ps(B,(ee,me)=>u[me]=ee,ee=>u==null?void 0:u[ee],()=>[o(M)]),$(()=>Ne(B,"tabindex",o(M)===o(c)?0:-1)),Lt("focus",B,()=>T(c,o(M),!0)),S(U,B)}),$(U=>R(de,U),[()=>l(j())]),S(N,ae)}),S(D,A)};W(g,D=>{o(a).length===0?D(b):D(x,!1)})}$(()=>R(_,`${o(a).length??""} task${o(a).length!==1?"s":""} in the next ${t()??""} days`)),S(n,f),ht()}bt(["keydown"]);var zp=C('<div class="done-tab__empty svelte-z9ywjc"><p class="svelte-z9ywjc"> No completed tasks yet</p> <p class="done-tab__empty-subtitle svelte-z9ywjc">Complete some tasks to see them here!</p></div>'),Bp=C('<button class="done-tab__uncomplete-btn svelte-z9ywjc" title="Mark as not done">Undo</button>'),Yp=C('<div class="done-tab__card-wrapper svelte-z9ywjc" role="listitem"><div class="done-tab__task-header svelte-z9ywjc"><span class="done-tab__done-date svelte-z9ywjc"> </span> <!></div> <!></div>'),$p=C('<div class="done-tab__pagination svelte-z9ywjc"><button class="done-tab__page-btn svelte-z9ywjc"> Previous</button> <span class="done-tab__page-info svelte-z9ywjc"> </span> <button class="done-tab__page-btn svelte-z9ywjc">Next </button></div>'),jp=C("<!> <!>",1),Wp=C('<div class="done-tab svelte-z9ywjc"><div class="done-tab__header svelte-z9ywjc"><h2 class="done-tab__title svelte-z9ywjc">Done</h2> <p class="done-tab__subtitle svelte-z9ywjc"> </p></div> <div class="done-tab__content svelte-z9ywjc" role="list" aria-label="Completed tasks"><!></div></div>');function Hp(n,e){dt(e,!0);let t=rn(e,"daysBack",3,30),s=K(0);const r=50,a=new Date;a.setDate(a.getDate()-t()),a.setHours(0,0,0,0);const i=Q(()=>e.tasks.filter(P=>P.status!=="done"||!P.doneAt?!1:new Date(P.doneAt)>=a).sort((P,H)=>new Date(H.doneAt).getTime()-new Date(P.doneAt).getTime())),l=Q(()=>Math.ceil(o(i).length/r)),c=Q(()=>o(i).slice(o(s)*r,(o(s)+1)*r));xt(()=>{o(s)>=o(l)&&o(l)>0&&T(s,o(l)-1)});function u(){o(s)<o(l)-1&&ll(s)}function d(){o(s)>0&&ll(s,-1)}function f(P){const H=new Date(P),j=new Date,Z=j.getTime()-H.getTime(),ae=Math.floor(Z/(1e3*60*60*24));return ae===0?"Today":ae===1?"Yesterday":ae<7?`${ae} days ago`:H.toLocaleDateString("en-US",{month:"short",day:"numeric",year:H.getFullYear()!==j.getFullYear()?"numeric":void 0})}let v=K(0),y=xe([]);xt(()=>{o(v)>=o(c).length&&T(v,Math.max(0,o(c).length-1),!0)});function _(P,H){P.key==="ArrowDown"?(P.preventDefault(),T(v,Math.min(o(v)+1,o(c).length-1),!0)):P.key==="ArrowUp"?(P.preventDefault(),T(v,Math.max(o(v)-1,0),!0)):P.key==="Enter"&&e.onEdit&&(P.preventDefault(),e.onEdit(o(c)[H]))}var m=Wp(),g=h(m),b=p(h(g),2),x=h(b),D=p(g,2),A=h(D);{var I=P=>{var H=zp();S(P,H)},N=P=>{var H=jp(),j=Qe(H);je(j,19,()=>o(c),re=>re.id,(re,de,V)=>{var U=Yp();U.__keydown=he=>_(he,o(V));var O=h(U),M=h(O),B=h(M),se=p(M,2);{var ee=he=>{var fe=Bp();fe.__click=()=>e.onUncomplete(o(de)),S(he,fe)};W(se,he=>{e.onUncomplete&&he(ee)})}var me=p(O,2);qr(me,{get task(){return o(de)},get onEdit(){return e.onEdit},get onDelete(){return e.onDelete}}),Ps(U,(he,fe)=>y[fe]=he,he=>y==null?void 0:y[he],()=>[o(V)]),$(he=>{Ne(U,"tabindex",o(V)===o(v)?0:-1),R(B,`Completed ${he??""}`)},[()=>f(o(de).doneAt)]),Lt("focus",U,()=>T(v,o(V),!0)),S(re,U)});var Z=p(j,2);{var ae=re=>{var de=$p(),V=h(de);V.__click=d;var U=p(V,2),O=h(U),M=p(U,2);M.__click=u,$(()=>{V.disabled=o(s)===0,R(O,`Page ${o(s)+1} of ${o(l)??""}`),M.disabled=o(s)>=o(l)-1}),S(re,de)};W(Z,re=>{o(l)>1&&re(ae)})}S(P,H)};W(A,P=>{o(i).length===0?P(I):P(N,!1)})}$(()=>R(x,`${o(i).length??""} completed task${o(i).length!==1?"s":""} in the last ${t()??""} days`)),S(n,m),ht()}bt(["keydown","click"]);var Gp=C('<div class="projects-tab__empty svelte-8ybpha"><p class="svelte-8ybpha"> No active projects</p> <p class="projects-tab__empty-subtitle svelte-8ybpha">Create tasks to see them organized by project!</p></div>'),Kp=C('<div class="projects-tab__card-wrapper svelte-8ybpha" role="listitem"><!></div>'),Vp=C('<div class="projects-tab__project-tasks svelte-8ybpha" role="list"></div>'),Qp=C('<div class="projects-tab__project svelte-8ybpha"><button class="projects-tab__project-header svelte-8ybpha"><span class="projects-tab__expand-icon svelte-8ybpha"> </span> <span class="projects-tab__project-name svelte-8ybpha"> </span> <span class="projects-tab__project-count svelte-8ybpha"> </span></button> <!></div>'),Zp=C('<div class="projects-tab svelte-8ybpha"><div class="projects-tab__header svelte-8ybpha"><div class="projects-tab__header-main svelte-8ybpha"><h2 class="projects-tab__title svelte-8ybpha">Projects</h2> <p class="projects-tab__subtitle svelte-8ybpha"> </p></div> <div class="projects-tab__actions svelte-8ybpha"><button class="projects-tab__action-btn svelte-8ybpha">Expand All</button> <button class="projects-tab__action-btn svelte-8ybpha">Collapse All</button></div></div> <div class="projects-tab__content svelte-8ybpha" role="region" aria-label="Project task lists"><!></div></div>');function Xp(n,e){dt(e,!0);const t=Q(()=>()=>{const j=new Map;return e.tasks.filter(ae=>ae.status!=="done"&&ae.status!=="cancelled").forEach(ae=>{const re=ae.linkedBlockPath||"Uncategorized";j.has(re)||j.set(re,[]),j.get(re).push(ae)}),j.forEach(ae=>{ae.sort((re,de)=>!re.dueAt&&!de.dueAt?0:re.dueAt?de.dueAt?new Date(re.dueAt).getTime()-new Date(de.dueAt).getTime():-1:1)}),new Map([...j.entries()].sort(([ae],[re])=>ae.localeCompare(re)))}),s=Q(()=>[...o(t).values()].reduce((j,Z)=>j+Z.length,0));let r=K(xe(new Set([...o(t).keys()])));function a(j){const Z=new Set(o(r));Z.has(j)?Z.delete(j):Z.add(j),T(r,Z,!0)}function i(){T(r,new Set([...o(t).keys()]),!0)}function l(){T(r,new Set,!0)}let c=K(0),u=xe([]);const d=Q(()=>()=>{const j=[];return o(t).forEach((Z,ae)=>{o(r).has(ae)&&j.push(...Z)}),j});xt(()=>{o(c)>=o(d).length&&T(c,Math.max(0,o(d).length-1),!0)});function f(j,Z){j.key==="ArrowDown"?(j.preventDefault(),T(c,Math.min(o(c)+1,o(d).length-1),!0)):j.key==="ArrowUp"?(j.preventDefault(),T(c,Math.max(o(c)-1,0),!0)):j.key==="Enter"&&e.onEdit?(j.preventDefault(),e.onEdit(o(d)[Z])):j.key===" "&&e.onDone&&(j.preventDefault(),e.onDone(o(d)[Z]))}function v(j){const Z=j.split("/");return Z[Z.length-1]||j}var y=Zp(),_=h(y),m=h(_),g=p(h(m),2),b=h(g),x=p(m,2),D=h(x);D.__click=i;var A=p(D,2);A.__click=l;var I=p(_,2),N=h(I);{var P=j=>{var Z=Gp();S(j,Z)},H=j=>{var Z=ut(),ae=Qe(Z);je(ae,17,()=>[...o(t).entries()],pt,(re,de)=>{var V=Q(()=>jc(o(de),2));let U=()=>o(V)[0],O=()=>o(V)[1];var M=Qp(),B=h(M);B.__click=()=>a(U());var se=h(B),ee=h(se),me=p(se,2),he=h(me),fe=p(me,2),De=h(fe),Se=p(B,2);{var Fe=ve=>{var z=Vp();je(z,23,O,E=>E.id,(E,F)=>{const X=Q(()=>o(d).indexOf(o(F)));var ie=Kp();ie.__keydown=q=>f(q,o(X));var L=h(ie);qr(L,{get task(){return o(F)},get onEdit(){return e.onEdit},get onDone(){return e.onDone},get onDelete(){return e.onDelete}}),Ps(ie,(q,te)=>u[te]=q,q=>u==null?void 0:u[q],()=>[o(X)]),$(()=>Ne(ie,"tabindex",o(X)===o(c)?0:-1)),Lt("focus",ie,()=>T(c,o(X),!0)),S(E,ie)}),$(E=>Ne(z,"aria-label",E),[()=>`Tasks for ${v(U())}`]),S(ve,z)};W(Se,ve=>{o(r).has(U())&&ve(Fe)})}$((ve,z)=>{R(ee,ve),Ne(me,"title",U()),R(he,z),R(De,O().length)},[()=>o(r).has(U())?"":"",()=>v(U())]),S(re,M)}),S(j,Z)};W(N,j=>{o(t).size===0?j(P):j(H,!1)})}$(()=>R(b,`${o(s)??""} task${o(s)!==1?"s":""} in ${o(t).size??""} project${o(t).size!==1?"s":""}`)),S(n,y),ht()}bt(["click","keydown"]);class Cs extends Error{constructor(e,t,s,r){super(e),this.line=t,this.column=s,this.suggestion=r,this.name="QuerySyntaxError"}}class hr extends Error{constructor(e,t){super(e),this.cause=t,this.name="QueryExecutionError"}}var yt=(n=>(n.TODO="TODO",n.IN_PROGRESS="IN_PROGRESS",n.DONE="DONE",n.CANCELLED="CANCELLED",n.NON_TASK="NON_TASK",n.EMPTY="EMPTY",n))(yt||{});const qs=class qs{constructor(e){w(this,"symbol");w(this,"name");w(this,"nextStatusSymbol");w(this,"type");this.symbol=e.symbol,this.name=e.name,this.nextStatusSymbol=e.nextStatusSymbol,this.type=e.type}static getTypeForUnknownSymbol(e){switch(e){case"x":case"X":return"DONE";case"/":return"IN_PROGRESS";case"-":return"CANCELLED";case" ":default:return"TODO"}}isCompleted(){return this.type==="DONE"||this.type==="CANCELLED"}};w(qs,"TODO",new qs({symbol:" ",name:"Todo",nextStatusSymbol:"x",type:"TODO"})),w(qs,"DONE",new qs({symbol:"x",name:"Done",nextStatusSymbol:" ",type:"DONE"})),w(qs,"IN_PROGRESS",new qs({symbol:"/",name:"In Progress",nextStatusSymbol:"x",type:"IN_PROGRESS"})),w(qs,"CANCELLED",new qs({symbol:"-",name:"Cancelled",nextStatusSymbol:" ",type:"CANCELLED"}));let Vs=qs;var He;(function(n){n[n.AM=0]="AM",n[n.PM=1]="PM"})(He||(He={}));var at;(function(n){n[n.SUNDAY=0]="SUNDAY",n[n.MONDAY=1]="MONDAY",n[n.TUESDAY=2]="TUESDAY",n[n.WEDNESDAY=3]="WEDNESDAY",n[n.THURSDAY=4]="THURSDAY",n[n.FRIDAY=5]="FRIDAY",n[n.SATURDAY=6]="SATURDAY"})(at||(at={}));var ys;(function(n){n[n.JANUARY=1]="JANUARY",n[n.FEBRUARY=2]="FEBRUARY",n[n.MARCH=3]="MARCH",n[n.APRIL=4]="APRIL",n[n.MAY=5]="MAY",n[n.JUNE=6]="JUNE",n[n.JULY=7]="JULY",n[n.AUGUST=8]="AUGUST",n[n.SEPTEMBER=9]="SEPTEMBER",n[n.OCTOBER=10]="OCTOBER",n[n.NOVEMBER=11]="NOVEMBER",n[n.DECEMBER=12]="DECEMBER"})(ys||(ys={}));function or(n,e){n.assign("day",e.getDate()),n.assign("month",e.getMonth()+1),n.assign("year",e.getFullYear())}function Gu(n,e){n.assign("hour",e.getHours()),n.assign("minute",e.getMinutes()),n.assign("second",e.getSeconds()),n.assign("millisecond",e.getMilliseconds()),n.assign("meridiem",e.getHours()<12?He.AM:He.PM)}function pr(n,e){n.imply("day",e.getDate()),n.imply("month",e.getMonth()+1),n.imply("year",e.getFullYear())}function Uo(n,e){n.imply("hour",e.getHours()),n.imply("minute",e.getMinutes()),n.imply("second",e.getSeconds()),n.imply("millisecond",e.getMilliseconds()),n.imply("meridiem",e.getHours()<12?He.AM:He.PM)}const Jp={ACDT:630,ACST:570,ADT:-180,AEDT:660,AEST:600,AFT:270,AKDT:-480,AKST:-540,ALMT:360,AMST:-180,AMT:-240,ANAST:720,ANAT:720,AQTT:300,ART:-180,AST:-240,AWDT:540,AWST:480,AZOST:0,AZOT:-60,AZST:300,AZT:240,BNT:480,BOT:-240,BRST:-120,BRT:-180,BST:60,BTT:360,CAST:480,CAT:120,CCT:390,CDT:-300,CEST:120,CET:{timezoneOffsetDuringDst:2*60,timezoneOffsetNonDst:60,dstStart:n=>ql(n,ys.MARCH,at.SUNDAY,2),dstEnd:n=>ql(n,ys.OCTOBER,at.SUNDAY,3)},CHADT:825,CHAST:765,CKT:-600,CLST:-180,CLT:-240,COT:-300,CST:-360,CT:{timezoneOffsetDuringDst:-5*60,timezoneOffsetNonDst:-6*60,dstStart:n=>pn(n,ys.MARCH,at.SUNDAY,2,2),dstEnd:n=>pn(n,ys.NOVEMBER,at.SUNDAY,1,2)},CVT:-60,CXT:420,ChST:600,DAVT:420,EASST:-300,EAST:-360,EAT:180,ECT:-300,EDT:-240,EEST:180,EET:120,EGST:0,EGT:-60,EST:-300,ET:{timezoneOffsetDuringDst:-4*60,timezoneOffsetNonDst:-5*60,dstStart:n=>pn(n,ys.MARCH,at.SUNDAY,2,2),dstEnd:n=>pn(n,ys.NOVEMBER,at.SUNDAY,1,2)},FJST:780,FJT:720,FKST:-180,FKT:-240,FNT:-120,GALT:-360,GAMT:-540,GET:240,GFT:-180,GILT:720,GMT:0,GST:240,GYT:-240,HAA:-180,HAC:-300,HADT:-540,HAE:-240,HAP:-420,HAR:-360,HAST:-600,HAT:-90,HAY:-480,HKT:480,HLV:-210,HNA:-240,HNC:-360,HNE:-300,HNP:-480,HNR:-420,HNT:-150,HNY:-540,HOVT:420,ICT:420,IDT:180,IOT:360,IRDT:270,IRKST:540,IRKT:540,IRST:210,IST:330,JST:540,KGT:360,KRAST:480,KRAT:480,KST:540,KUYT:240,LHDT:660,LHST:630,LINT:840,MAGST:720,MAGT:720,MART:-510,MAWT:300,MDT:-360,MESZ:120,MEZ:60,MHT:720,MMT:390,MSD:240,MSK:180,MST:-420,MT:{timezoneOffsetDuringDst:-6*60,timezoneOffsetNonDst:-7*60,dstStart:n=>pn(n,ys.MARCH,at.SUNDAY,2,2),dstEnd:n=>pn(n,ys.NOVEMBER,at.SUNDAY,1,2)},MUT:240,MVT:300,MYT:480,NCT:660,NDT:-90,NFT:690,NOVST:420,NOVT:360,NPT:345,NST:-150,NUT:-660,NZDT:780,NZST:720,OMSST:420,OMST:420,PDT:-420,PET:-300,PETST:720,PETT:720,PGT:600,PHOT:780,PHT:480,PKT:300,PMDT:-120,PMST:-180,PONT:660,PST:-480,PT:{timezoneOffsetDuringDst:-7*60,timezoneOffsetNonDst:-8*60,dstStart:n=>pn(n,ys.MARCH,at.SUNDAY,2,2),dstEnd:n=>pn(n,ys.NOVEMBER,at.SUNDAY,1,2)},PWT:540,PYST:-180,PYT:-240,RET:240,SAMT:240,SAST:120,SBT:660,SCT:240,SGT:480,SRT:-180,SST:-660,TAHT:-600,TFT:300,TJT:300,TKT:780,TLT:540,TMT:300,TVT:720,ULAT:480,UTC:0,UYST:-120,UYT:-180,UZT:300,VET:-210,VLAST:660,VLAT:660,VUT:660,WAST:120,WAT:60,WEST:60,WESZ:60,WET:0,WEZ:0,WFT:720,WGST:-120,WGT:-180,WIB:420,WIT:540,WITA:480,WST:780,WT:0,YAKST:600,YAKT:600,YAPT:600,YEKST:360,YEKT:360};function pn(n,e,t,s,r=0){let a=0,i=0;for(;i<s;)a++,new Date(n,e-1,a).getDay()===t&&i++;return new Date(n,e-1,a,r)}function ql(n,e,t,s=0){const r=t===0?7:t,a=new Date(n,e-1+1,1,12),i=a.getDay()===0?7:a.getDay();let l;return i===r?l=7:i<r?l=7+i-r:l=i-r,a.setDate(a.getDate()-l),new Date(n,e-1,a.getDate(),s)}function Ku(n,e,t={}){if(n==null)return null;if(typeof n=="number")return n;const s=t[n]??Jp[n];return s==null?null:typeof s=="number"?s:e==null?null:e>s.dstStart(e.getFullYear())&&!(e>s.dstEnd(e.getFullYear()))?s.timezoneOffsetDuringDst:s.timezoneOffsetNonDst}const eg={day:0,second:0,millisecond:0};function rs(n,e){let t=new Date(n);if(e.y&&(e.year=e.y,delete e.y),e.mo&&(e.month=e.mo,delete e.mo),e.M&&(e.month=e.M,delete e.M),e.w&&(e.week=e.w,delete e.w),e.d&&(e.day=e.d,delete e.d),e.h&&(e.hour=e.h,delete e.h),e.m&&(e.minute=e.m,delete e.m),e.s&&(e.second=e.s,delete e.s),e.ms&&(e.millisecond=e.ms,delete e.ms),"year"in e){const s=Math.floor(e.year);t.setFullYear(t.getFullYear()+s);const r=e.year-s;r>0&&(e.month=(e==null?void 0:e.month)??0,e.month+=r*12)}if("quarter"in e){const s=Math.floor(e.quarter);t.setMonth(t.getMonth()+s*3)}if("month"in e){const s=Math.floor(e.month);t.setMonth(t.getMonth()+s);const r=e.month-s;r>0&&(e.week=(e==null?void 0:e.week)??0,e.week+=r*4)}if("week"in e){const s=Math.floor(e.week);t.setDate(t.getDate()+s*7);const r=e.week-s;r>0&&(e.day=(e==null?void 0:e.day)??0,e.day+=Math.round(r*7))}if("day"in e){const s=Math.floor(e.day);t.setDate(t.getDate()+s);const r=e.day-s;r>0&&(e.hour=(e==null?void 0:e.hour)??0,e.hour+=Math.round(r*24))}if("hour"in e){const s=Math.floor(e.hour);t.setHours(t.getHours()+s);const r=e.hour-s;r>0&&(e.minute=(e==null?void 0:e.minute)??0,e.minute+=Math.round(r*60))}if("minute"in e){const s=Math.floor(e.minute);t.setMinutes(t.getMinutes()+s);const r=e.minute-s;r>0&&(e.second=(e==null?void 0:e.second)??0,e.second+=Math.round(r*60))}if("second"in e){const s=Math.floor(e.second);t.setSeconds(t.getSeconds()+s);const r=e.second-s;r>0&&(e.millisecond=(e==null?void 0:e.millisecond)??0,e.millisecond+=Math.round(r*1e3))}if("millisecond"in e){const s=Math.floor(e.millisecond);t.setMilliseconds(t.getMilliseconds()+s)}return t}function ri(n){const e={};for(const t in n)e[t]=-n[t];return e}class er{constructor(e,t){w(this,"instant");w(this,"timezoneOffset");this.instant=e??new Date,this.timezoneOffset=t??null}static fromDate(e){return new er(e)}static fromInput(e,t){if(e instanceof Date)return er.fromDate(e);const s=(e==null?void 0:e.instant)??new Date,r=Ku(e==null?void 0:e.timezone,s,t);return new er(s,r)}getDateWithAdjustedTimezone(){const e=new Date(this.instant);return this.timezoneOffset!==null&&e.setMinutes(e.getMinutes()-this.getSystemTimezoneAdjustmentMinute(this.instant)),e}getSystemTimezoneAdjustmentMinute(e,t){(!e||e.getTime()<0)&&(e=new Date);const s=-e.getTimezoneOffset(),r=t??this.timezoneOffset??s;return s-r}getTimezoneOffset(){return this.timezoneOffset??-this.instant.getTimezoneOffset()}}class st{constructor(e,t){w(this,"knownValues");w(this,"impliedValues");w(this,"reference");w(this,"_tags",new Set);if(this.reference=e,this.knownValues={},this.impliedValues={},t)for(const r in t)this.knownValues[r]=t[r];const s=e.getDateWithAdjustedTimezone();this.imply("day",s.getDate()),this.imply("month",s.getMonth()+1),this.imply("year",s.getFullYear()),this.imply("hour",12),this.imply("minute",0),this.imply("second",0),this.imply("millisecond",0)}static createRelativeFromReference(e,t=eg){let s=rs(e.getDateWithAdjustedTimezone(),t);const r=new st(e);return r.addTag("result/relativeDate"),"hour"in t||"minute"in t||"second"in t||"millisecond"in t?(r.addTag("result/relativeDateAndTime"),Gu(r,s),or(r,s),r.assign("timezoneOffset",e.getTimezoneOffset())):(Uo(r,s),r.imply("timezoneOffset",e.getTimezoneOffset()),"day"in t?(r.assign("day",s.getDate()),r.assign("month",s.getMonth()+1),r.assign("year",s.getFullYear()),r.assign("weekday",s.getDay())):"week"in t?(r.assign("day",s.getDate()),r.assign("month",s.getMonth()+1),r.assign("year",s.getFullYear()),r.imply("weekday",s.getDay())):(r.imply("day",s.getDate()),"month"in t?(r.assign("month",s.getMonth()+1),r.assign("year",s.getFullYear())):(r.imply("month",s.getMonth()+1),"year"in t?r.assign("year",s.getFullYear()):r.imply("year",s.getFullYear())))),r}get(e){return e in this.knownValues?this.knownValues[e]:e in this.impliedValues?this.impliedValues[e]:null}isCertain(e){return e in this.knownValues}getCertainComponents(){return Object.keys(this.knownValues)}imply(e,t){return e in this.knownValues?this:(this.impliedValues[e]=t,this)}assign(e,t){return this.knownValues[e]=t,delete this.impliedValues[e],this}addDurationAsImplied(e){const t=this.dateWithoutTimezoneAdjustment(),s=rs(t,e);return("day"in e||"week"in e||"month"in e||"year"in e)&&(this.delete(["day","weekday","month","year"]),this.imply("day",s.getDate()),this.imply("weekday",s.getDay()),this.imply("month",s.getMonth()+1),this.imply("year",s.getFullYear())),("second"in e||"minute"in e||"hour"in e)&&(this.delete(["second","minute","hour"]),this.imply("second",s.getSeconds()),this.imply("minute",s.getMinutes()),this.imply("hour",s.getHours())),this}delete(e){typeof e=="string"&&(e=[e]);for(const t of e)delete this.knownValues[t],delete this.impliedValues[t]}clone(){const e=new st(this.reference);e.knownValues={},e.impliedValues={};for(const t in this.knownValues)e.knownValues[t]=this.knownValues[t];for(const t in this.impliedValues)e.impliedValues[t]=this.impliedValues[t];return e}isOnlyDate(){return!this.isCertain("hour")&&!this.isCertain("minute")&&!this.isCertain("second")}isOnlyTime(){return!this.isCertain("weekday")&&!this.isCertain("day")&&!this.isCertain("month")&&!this.isCertain("year")}isOnlyWeekdayComponent(){return this.isCertain("weekday")&&!this.isCertain("day")&&!this.isCertain("month")}isDateWithUnknownYear(){return this.isCertain("month")&&!this.isCertain("year")}isValidDate(){const e=this.dateWithoutTimezoneAdjustment();return!(e.getFullYear()!==this.get("year")||e.getMonth()!==this.get("month")-1||e.getDate()!==this.get("day")||this.get("hour")!=null&&e.getHours()!=this.get("hour")||this.get("minute")!=null&&e.getMinutes()!=this.get("minute"))}toString(){return`[ParsingComponents {
            tags: ${JSON.stringify(Array.from(this._tags).sort())}, 
            knownValues: ${JSON.stringify(this.knownValues)}, 
            impliedValues: ${JSON.stringify(this.impliedValues)}}, 
            reference: ${JSON.stringify(this.reference)}]`}date(){const e=this.dateWithoutTimezoneAdjustment(),t=this.reference.getSystemTimezoneAdjustmentMinute(e,this.get("timezoneOffset"));return new Date(e.getTime()+t*6e4)}addTag(e){return this._tags.add(e),this}addTags(e){for(const t of e)this._tags.add(t);return this}tags(){return new Set(this._tags)}dateWithoutTimezoneAdjustment(){const e=new Date(this.get("year"),this.get("month")-1,this.get("day"),this.get("hour"),this.get("minute"),this.get("second"),this.get("millisecond"));return e.setFullYear(this.get("year")),e}}class Fr{constructor(e,t,s,r,a){w(this,"refDate");w(this,"index");w(this,"text");w(this,"reference");w(this,"start");w(this,"end");this.reference=e,this.refDate=e.instant,this.index=t,this.text=s,this.start=r||new st(e),this.end=a}clone(){const e=new Fr(this.reference,this.index,this.text);return e.start=this.start?this.start.clone():null,e.end=this.end?this.end.clone():null,e}date(){return this.start.date()}addTag(e){return this.start.addTag(e),this.end&&this.end.addTag(e),this}addTags(e){return this.start.addTags(e),this.end&&this.end.addTags(e),this}tags(){const e=new Set(this.start.tags());if(this.end)for(const t of this.end.tags())e.add(t);return e}toString(){const e=Array.from(this.tags()).sort();return`[ParsingResult {index: ${this.index}, text: '${this.text}', tags: ${JSON.stringify(e)} ...}]`}}function Vu(n,e,t="\\s{0,5},?\\s{0,5}"){const s=e.replace(/\((?!\?)/g,"(?:");return`${n}${s}(?:${t}${s}){0,10}`}function tg(n){let e;return n instanceof Array?e=[...n]:n instanceof Map?e=Array.from(n.keys()):e=Object.keys(n),e}function Hs(n){return`(?:${tg(n).sort((t,s)=>s.length-t.length).join("|").replace(/\./g,"\\.")})`}function Qu(n){return n<100&&(n>50?n=n+1900:n=n+2e3),n}function ai(n,e,t){let s=new Date(n);s.setMonth(t-1),s.setDate(e);const r=rs(s,{year:1}),a=rs(s,{year:-1});return Math.abs(r.getTime()-n.getTime())<Math.abs(s.getTime()-n.getTime())?s=r:Math.abs(a.getTime()-n.getTime())<Math.abs(s.getTime()-n.getTime())&&(s=a),s.getFullYear()}const Qi={sunday:0,sun:0,"sun.":0,monday:1,mon:1,"mon.":1,tuesday:2,tue:2,"tue.":2,wednesday:3,wed:3,"wed.":3,thursday:4,thurs:4,"thurs.":4,thur:4,"thur.":4,thu:4,"thu.":4,friday:5,fri:5,"fri.":5,saturday:6,sat:6,"sat.":6},Zu={january:1,february:2,march:3,april:4,may:5,june:6,july:7,august:8,september:9,october:10,november:11,december:12},Nn={...Zu,jan:1,"jan.":1,feb:2,"feb.":2,mar:3,"mar.":3,apr:4,"apr.":4,jun:6,"jun.":6,jul:7,"jul.":7,aug:8,"aug.":8,sep:9,"sep.":9,sept:9,"sept.":9,oct:10,"oct.":10,nov:11,"nov.":11,dec:12,"dec.":12},Zi={one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9,ten:10,eleven:11,twelve:12},Xi={first:1,second:2,third:3,fourth:4,fifth:5,sixth:6,seventh:7,eighth:8,ninth:9,tenth:10,eleventh:11,twelfth:12,thirteenth:13,fourteenth:14,fifteenth:15,sixteenth:16,seventeenth:17,eighteenth:18,nineteenth:19,twentieth:20,"twenty first":21,"twenty-first":21,"twenty second":22,"twenty-second":22,"twenty third":23,"twenty-third":23,"twenty fourth":24,"twenty-fourth":24,"twenty fifth":25,"twenty-fifth":25,"twenty sixth":26,"twenty-sixth":26,"twenty seventh":27,"twenty-seventh":27,"twenty eighth":28,"twenty-eighth":28,"twenty ninth":29,"twenty-ninth":29,thirtieth:30,"thirty first":31,"thirty-first":31},Xu={second:"second",seconds:"second",minute:"minute",minutes:"minute",hour:"hour",hours:"hour",day:"day",days:"day",week:"week",weeks:"week",month:"month",months:"month",quarter:"quarter",quarters:"quarter",year:"year",years:"year"},ii={s:"second",sec:"second",second:"second",seconds:"second",m:"minute",min:"minute",mins:"minute",minute:"minute",minutes:"minute",h:"hour",hr:"hour",hrs:"hour",hour:"hour",hours:"hour",d:"day",day:"day",days:"day",w:"week",week:"week",weeks:"week",mo:"month",mon:"month",mos:"month",month:"month",months:"month",qtr:"quarter",quarter:"quarter",quarters:"quarter",y:"year",yr:"year",year:"year",years:"year",...Xu},Ju=`(?:${Hs(Zi)}|[0-9]+|[0-9]+\\.[0-9]+|half(?:\\s{0,2}an?)?|an?\\b(?:\\s{0,2}few)?|few|several|the|a?\\s{0,2}couple\\s{0,2}(?:of)?)`;function sg(n){const e=n.toLowerCase();return Zi[e]!==void 0?Zi[e]:e==="a"||e==="an"||e=="the"?1:e.match(/few/)?3:e.match(/half/)?.5:e.match(/couple/)?2:e.match(/several/)?7:parseFloat(e)}const Ya=`(?:${Hs(Xi)}|[0-9]{1,2}(?:st|nd|rd|th)?)`;function $a(n){let e=n.toLowerCase();return Xi[e]!==void 0?Xi[e]:(e=e.replace(/(?:st|nd|rd|th)$/i,""),parseInt(e))}const oi="(?:[1-9][0-9]{0,3}\\s{0,2}(?:BE|AD|BC|BCE|CE)|[1-2][0-9]{3}|[5-9][0-9]|2[0-5])";function li(n){if(/BE/i.test(n))return n=n.replace(/BE/i,""),parseInt(n)-543;if(/BCE?/i.test(n))return n=n.replace(/BCE?/i,""),-parseInt(n);if(/(AD|CE)/i.test(n))return n=n.replace(/(AD|CE)/i,""),parseInt(n);const e=parseInt(n);return Qu(e)}const ed=`(${Ju})\\s{0,3}(${Hs(ii)})`,Fl=new RegExp(ed,"i"),ng=`(${Ju})\\s{0,3}(${Hs(Xu)})`,td="\\s{0,5},?(?:\\s*and)?\\s{0,5}",fa=Vu("(?:(?:about|around)\\s{0,3})?",ed,td),ci=Vu("(?:(?:about|around)\\s{0,3})?",ng,td);function Ur(n){const e={};let t=n,s=Fl.exec(t);for(;s;)rg(e,s),t=t.substring(s[0].length).trim(),s=Fl.exec(t);return Object.keys(e).length==0?null:e}function rg(n,e){if(e[0].match(/^[a-zA-Z]+$/))return;const t=sg(e[1]),s=ii[e[2].toLowerCase()];n[s]=t}class os{constructor(){w(this,"cachedInnerPattern",null);w(this,"cachedPattern",null)}innerPatternHasChange(e,t){return this.innerPattern(e)!==t}patternLeftBoundary(){return"(\\W|^)"}pattern(e){return this.cachedInnerPattern&&!this.innerPatternHasChange(e,this.cachedInnerPattern)?this.cachedPattern:(this.cachedInnerPattern=this.innerPattern(e),this.cachedPattern=new RegExp(`${this.patternLeftBoundary()}${this.cachedInnerPattern.source}`,this.cachedInnerPattern.flags),this.cachedPattern)}extract(e,t){const s=t[1]??"";t.index=t.index+s.length,t[0]=t[0].substring(s.length);for(let r=2;r<t.length;r++)t[r-1]=t[r];return this.innerExtract(e,t)}}const ag=new RegExp(`(?:(?:within|in|for)\\s*)?(?:(?:about|around|roughly|approximately|just)\\s*(?:~\\s*)?)?(${fa})(?=\\W|$)`,"i"),ig=new RegExp(`(?:within|in|for)\\s*(?:(?:about|around|roughly|approximately|just)\\s*(?:~\\s*)?)?(${fa})(?=\\W|$)`,"i"),og=new RegExp(`(?:within|in|for)\\s*(?:(?:about|around|roughly|approximately|just)\\s*(?:~\\s*)?)?(${ci})(?=\\W|$)`,"i");class lg extends os{constructor(t){super();w(this,"strictMode");this.strictMode=t}innerPattern(t){return this.strictMode?og:t.option.forwardDate?ag:ig}innerExtract(t,s){if(s[0].match(/^for\s*the\s*\w+/))return null;const r=Ur(s[1]);return r?st.createRelativeFromReference(t.reference,r):null}}const cg=new RegExp(`(?:on\\s{0,3})?(${Ya})(?:\\s{0,3}(?:to|\\-|\\|until|through|till)?\\s{0,3}(${Ya}))?(?:-|/|\\s{0,3}(?:of)?\\s{0,3})(${Hs(Nn)})(?:(?:-|/|,?\\s{0,3})(${oi}(?!\\w)))?(?=\\W|$)`,"i"),Ul=1,zl=2,ug=3,Bl=4;class dg extends os{innerPattern(){return cg}innerExtract(e,t){const s=e.createParsingResult(t.index,t[0]),r=Nn[t[ug].toLowerCase()],a=$a(t[Ul]);if(a>31)return t.index=t.index+t[Ul].length,null;if(s.start.assign("month",r),s.start.assign("day",a),t[Bl]){const i=li(t[Bl]);s.start.assign("year",i)}else{const i=ai(e.refDate,a,r);s.start.imply("year",i)}if(t[zl]){const i=$a(t[zl]);s.end=s.start.clone(),s.end.assign("day",i)}return s}}const hg=new RegExp(`(${Hs(Nn)})(?:-|/|\\s*,?\\s*)(${Ya})(?!\\s*(?:am|pm))\\s*(?:(?:to|\\-)\\s*(${Ya})\\s*)?(?:(?:-|/|\\s*,\\s*|\\s+)(${oi}))?(?=\\W|$)(?!\\:\\d)`,"i"),fg=1,Yl=2,Si=3,xi=4;class vg extends os{constructor(t){super();w(this,"shouldSkipYearLikeDate");this.shouldSkipYearLikeDate=t}innerPattern(){return hg}innerExtract(t,s){const r=Nn[s[fg].toLowerCase()],a=$a(s[Yl]);if(a>31||this.shouldSkipYearLikeDate&&!s[Si]&&!s[xi]&&s[Yl].match(/^2[0-5]$/))return null;const i=t.createParsingComponents({day:a,month:r}).addTag("parser/ENMonthNameMiddleEndianParser");if(s[xi]){const u=li(s[xi]);i.assign("year",u)}else{const u=ai(t.refDate,a,r);i.imply("year",u)}if(!s[Si])return i;const l=$a(s[Si]),c=t.createParsingResult(s.index,s[0]);return c.start=i,c.end=i.clone(),c.end.assign("day",l),c}}const pg=new RegExp(`((?:in)\\s*)?(${Hs(Nn)})\\s*(?:(?:,|-|of)?\\s*(${oi})?)?(?=[^\\s\\w]|\\s+[^0-9]|\\s+$|$)`,"i"),gg=1,mg=2,$l=3;class yg extends os{innerPattern(){return pg}innerExtract(e,t){const s=t[mg].toLowerCase();if(t[0].length<=3&&!Zu[s])return null;const r=e.createParsingResult(t.index+(t[gg]||"").length,t.index+t[0].length);r.start.imply("day",1),r.start.addTag("parser/ENMonthNameParser");const a=Nn[s];if(r.start.assign("month",a),t[$l]){const i=li(t[$l]);r.start.assign("year",i)}else{const i=ai(e.refDate,1,a);r.start.imply("year",i)}return r}}const bg=new RegExp(`([0-9]{4})[-\\.\\/\\s](?:(${Hs(Nn)})|([0-9]{1,2}))[-\\.\\/\\s]([0-9]{1,2})(?=\\W|$)`,"i"),wg=1,_g=2,jl=3,kg=4;class Tg extends os{constructor(t){super();w(this,"strictMonthDateOrder");this.strictMonthDateOrder=t}innerPattern(){return bg}innerExtract(t,s){const r=parseInt(s[wg]);let a=parseInt(s[kg]),i=s[jl]?parseInt(s[jl]):Nn[s[_g].toLowerCase()];if(i<1||i>12){if(this.strictMonthDateOrder)return null;a>=1&&a<=12&&([i,a]=[a,i])}return a<1||a>31?null:{day:a,month:i,year:r}}}const Sg=new RegExp("([0-9]|0[1-9]|1[012])/([0-9]{4})","i"),xg=1,Dg=2;class Eg extends os{innerPattern(){return Sg}innerExtract(e,t){const s=parseInt(t[Dg]),r=parseInt(t[xg]);return e.createParsingComponents().imply("day",1).assign("month",r).assign("year",s)}}function Ag(n,e,t,s){return new RegExp(`${n}${e}(\\d{1,4})(?:(?:\\.|:|)(\\d{1,2})(?:(?::|)(\\d{2})(?:\\.(\\d{1,6}))?)?)?(?:\\s*(a\\.m\\.|p\\.m\\.|am?|pm?))?${t}`,s)}function Cg(n,e){return new RegExp(`^(${n})(\\d{1,4})(?:(?:\\.|\\:|\\)(\\d{1,2})(?:(?:\\.|\\:|\\)(\\d{1,2})(?:\\.(\\d{1,6}))?)?)?(?:\\s*(a\\.m\\.|p\\.m\\.|am?|pm?))?${e}`,"i")}const Di=2,Pn=3,Da=4,Ea=5,fr=6;class Mg{constructor(e=!1){w(this,"strictMode");w(this,"cachedPrimaryPrefix",null);w(this,"cachedPrimarySuffix",null);w(this,"cachedPrimaryTimePattern",null);w(this,"cachedFollowingPhase",null);w(this,"cachedFollowingSuffix",null);w(this,"cachedFollowingTimePatten",null);this.strictMode=e}patternFlags(){return"i"}primaryPatternLeftBoundary(){return"(^|\\s|T|\\b)"}primarySuffix(){return"(?!/)(?=\\W|$)"}followingSuffix(){return"(?!/)(?=\\W|$)"}pattern(e){return this.getPrimaryTimePatternThroughCache()}extract(e,t){const s=this.extractPrimaryTimeComponents(e,t);if(!s)return t[0].match(/^\d{4}/)?(t.index+=4,null):(t.index+=t[0].length,null);const r=t.index+t[1].length,a=t[0].substring(t[1].length),i=e.createParsingResult(r,a,s);t.index+=t[0].length;const l=e.text.substring(t.index),u=this.getFollowingTimePatternThroughCache().exec(l);return a.match(/^\d{3,4}/)&&u&&(u[0].match(/^\s*([+-])\s*\d{2,4}$/)||u[0].match(/^\s*([+-])\s*\d{2}\W\d{2}/))?null:!u||u[0].match(/^\s*([+-])\s*\d{3,4}$/)?this.checkAndReturnWithoutFollowingPattern(i):(i.end=this.extractFollowingTimeComponents(e,u,i),i.end&&(i.text+=u[0]),this.checkAndReturnWithFollowingPattern(i))}extractPrimaryTimeComponents(e,t,s=!1){const r=e.createParsingComponents();let a=0,i=null,l=parseInt(t[Di]);if(l>100){if(t[Di].length==4&&t[Pn]==null&&!t[fr]||this.strictMode||t[Pn]!=null)return null;a=l%100,l=Math.floor(l/100)}if(l>24)return null;if(t[Pn]!=null){if(t[Pn].length==1&&!t[fr])return null;a=parseInt(t[Pn])}if(a>=60)return null;if(l>12&&(i=He.PM),t[fr]!=null){if(l>12)return null;const c=t[fr][0].toLowerCase();c=="a"&&(i=He.AM,l==12&&(l=0)),c=="p"&&(i=He.PM,l!=12&&(l+=12))}if(r.assign("hour",l),r.assign("minute",a),i!==null?r.assign("meridiem",i):l<12?r.imply("meridiem",He.AM):r.imply("meridiem",He.PM),t[Ea]!=null){const c=parseInt(t[Ea].substring(0,3));if(c>=1e3)return null;r.assign("millisecond",c)}if(t[Da]!=null){const c=parseInt(t[Da]);if(c>=60)return null;r.assign("second",c)}return r}extractFollowingTimeComponents(e,t,s){const r=e.createParsingComponents();if(t[Ea]!=null){const c=parseInt(t[Ea].substring(0,3));if(c>=1e3)return null;r.assign("millisecond",c)}if(t[Da]!=null){const c=parseInt(t[Da]);if(c>=60)return null;r.assign("second",c)}let a=parseInt(t[Di]),i=0,l=-1;if(t[Pn]!=null?i=parseInt(t[Pn]):a>100&&(i=a%100,a=Math.floor(a/100)),i>=60||a>24)return null;if(a>=12&&(l=He.PM),t[fr]!=null){if(a>12)return null;const c=t[fr][0].toLowerCase();c=="a"&&(l=He.AM,a==12&&(a=0,r.isCertain("day")||r.imply("day",r.get("day")+1))),c=="p"&&(l=He.PM,a!=12&&(a+=12)),s.start.isCertain("meridiem")||(l==He.AM?(s.start.imply("meridiem",He.AM),s.start.get("hour")==12&&s.start.assign("hour",0)):(s.start.imply("meridiem",He.PM),s.start.get("hour")!=12&&s.start.assign("hour",s.start.get("hour")+12)))}return r.assign("hour",a),r.assign("minute",i),l>=0?r.assign("meridiem",l):s.start.isCertain("meridiem")&&s.start.get("hour")>12?s.start.get("hour")-12>a?r.imply("meridiem",He.AM):a<=12&&(r.assign("hour",a+12),r.assign("meridiem",He.PM)):a>12?r.imply("meridiem",He.PM):a<=12&&r.imply("meridiem",He.AM),r.date().getTime()<s.start.date().getTime()&&r.imply("day",r.get("day")+1),r}checkAndReturnWithoutFollowingPattern(e){if(e.text.match(/^\d$/)||e.text.match(/^\d\d\d+$/)||e.text.match(/\d[apAP]$/))return null;const t=e.text.match(/[^\d:.](\d[\d.]+)$/);if(t){const s=t[1];if(this.strictMode||s.includes(".")&&!s.match(/\d(\.\d{2})+$/)||parseInt(s)>24)return null}return e}checkAndReturnWithFollowingPattern(e){if(e.text.match(/^\d+-\d+$/))return null;const t=e.text.match(/[^\d:.](\d[\d.]+)\s*-\s*(\d[\d.]+)$/);if(t){if(this.strictMode)return null;const s=t[1],r=t[2];if(r.includes(".")&&!r.match(/\d(\.\d{2})+$/))return null;const a=parseInt(r),i=parseInt(s);if(a>24||i>24)return null}return e}getPrimaryTimePatternThroughCache(){const e=this.primaryPrefix(),t=this.primarySuffix();return this.cachedPrimaryPrefix===e&&this.cachedPrimarySuffix===t?this.cachedPrimaryTimePattern:(this.cachedPrimaryTimePattern=Ag(this.primaryPatternLeftBoundary(),e,t,this.patternFlags()),this.cachedPrimaryPrefix=e,this.cachedPrimarySuffix=t,this.cachedPrimaryTimePattern)}getFollowingTimePatternThroughCache(){const e=this.followingPhase(),t=this.followingSuffix();return this.cachedFollowingPhase===e&&this.cachedFollowingSuffix===t?this.cachedFollowingTimePatten:(this.cachedFollowingTimePatten=Cg(e,t),this.cachedFollowingPhase=e,this.cachedFollowingSuffix=t,this.cachedFollowingTimePatten)}}class Ig extends Mg{constructor(e){super(e)}followingPhase(){return"\\s*(?:\\-|\\|\\~|\\|to|until|through|till|\\?)\\s*"}primaryPrefix(){return"(?:(?:at|from)\\s*)??"}primarySuffix(){return"(?:\\s*(?:o\\W*clock|at\\s*night|in\\s*the\\s*(?:morning|afternoon)))?(?!/)(?=\\W|$)"}extractPrimaryTimeComponents(e,t){const s=super.extractPrimaryTimeComponents(e,t);if(!s)return s;if(t[0].endsWith("night")){const r=s.get("hour");r>=6&&r<12?(s.assign("hour",s.get("hour")+12),s.assign("meridiem",He.PM)):r<6&&s.assign("meridiem",He.AM)}if(t[0].endsWith("afternoon")){s.assign("meridiem",He.PM);const r=s.get("hour");r>=0&&r<=6&&s.assign("hour",s.get("hour")+12)}return t[0].endsWith("morning")&&(s.assign("meridiem",He.AM),s.get("hour")<12&&s.assign("hour",s.get("hour"))),s.addTag("parser/ENTimeExpressionParser")}extractFollowingTimeComponents(e,t,s){const r=super.extractFollowingTimeComponents(e,t,s);return r&&r.addTag("parser/ENTimeExpressionParser"),r}}const Og=new RegExp(`(${fa})\\s{0,5}(?:ago|before|earlier)(?=\\W|$)`,"i"),Ng=new RegExp(`(${ci})\\s{0,5}(?:ago|before|earlier)(?=\\W|$)`,"i");class Rg extends os{constructor(t){super();w(this,"strictMode");this.strictMode=t}innerPattern(){return this.strictMode?Ng:Og}innerExtract(t,s){const r=Ur(s[1]);return r?st.createRelativeFromReference(t.reference,ri(r)):null}}const Pg=new RegExp(`(${fa})\\s{0,5}(?:later|after|from now|henceforth|forward|out)(?=(?:\\W|$))`,"i"),Lg=new RegExp(`(${ci})\\s{0,5}(later|after|from now)(?=\\W|$)`,"i"),qg=1;class Fg extends os{constructor(t){super();w(this,"strictMode");this.strictMode=t}innerPattern(){return this.strictMode?Lg:Pg}innerExtract(t,s){const r=Ur(s[qg]);return r?st.createRelativeFromReference(t.reference,r):null}}let sd=class{refine(e,t){return t.filter(s=>this.isValid(e,s))}};class va{refine(e,t){if(t.length<2)return t;const s=[];let r=t[0],a=null;for(let i=1;i<t.length;i++){a=t[i];const l=e.text.substring(r.index+r.text.length,a.index);if(!this.shouldMergeResults(l,r,a,e))s.push(r),r=a;else{const c=r,u=a,d=this.mergeResults(l,c,u,e);e.debug(()=>{console.log(`${this.constructor.name} merged ${c} and ${u} into ${d}`)}),r=d}}return r!=null&&s.push(r),s}}class Ug extends va{shouldMergeResults(e,t,s){return!t.end&&!s.end&&e.match(this.patternBetween())!=null}mergeResults(e,t,s){if(!t.start.isOnlyWeekdayComponent()&&!s.start.isOnlyWeekdayComponent()&&(s.start.getCertainComponents().forEach(a=>{t.start.isCertain(a)||t.start.imply(a,s.start.get(a))}),t.start.getCertainComponents().forEach(a=>{s.start.isCertain(a)||s.start.imply(a,t.start.get(a))})),t.start.date()>s.start.date()){let a=t.start.date(),i=s.start.date();s.start.isOnlyWeekdayComponent()&&rs(i,{day:7})>a?(i=rs(i,{day:7}),s.start.imply("day",i.getDate()),s.start.imply("month",i.getMonth()+1),s.start.imply("year",i.getFullYear())):t.start.isOnlyWeekdayComponent()&&rs(a,{day:-7})<i?(a=rs(a,{day:-7}),t.start.imply("day",a.getDate()),t.start.imply("month",a.getMonth()+1),t.start.imply("year",a.getFullYear())):s.start.isDateWithUnknownYear()&&rs(i,{year:1})>a?(i=rs(i,{year:1}),s.start.imply("year",i.getFullYear())):t.start.isDateWithUnknownYear()&&rs(a,{year:-1})<i?(a=rs(a,{year:-1}),t.start.imply("year",a.getFullYear())):[s,t]=[t,s]}const r=t.clone();return r.start=t.start,r.end=s.start,r.index=Math.min(t.index,s.index),t.index<s.index?r.text=t.text+e+s.text:r.text=s.text+e+t.text,r}}class zg extends Ug{patternBetween(){return/^\s*(to|-||until|through|till)\s*$/i}}function Wl(n,e){const t=n.clone(),s=n.start,r=e.start;if(t.start=Hl(s,r),n.end!=null||e.end!=null){const a=n.end==null?n.start:n.end,i=e.end==null?e.start:e.end,l=Hl(a,i);if(n.end==null&&l.date().getTime()<t.start.date().getTime()){const c=new Date(l.date().getTime());c.setDate(c.getDate()+1),l.isCertain("day")?or(l,c):pr(l,c)}t.end=l}return t}function Hl(n,e){const t=n.clone();return e.isCertain("hour")?(t.assign("hour",e.get("hour")),t.assign("minute",e.get("minute")),e.isCertain("second")?(t.assign("second",e.get("second")),e.isCertain("millisecond")?t.assign("millisecond",e.get("millisecond")):t.imply("millisecond",e.get("millisecond"))):(t.imply("second",e.get("second")),t.imply("millisecond",e.get("millisecond")))):(t.imply("hour",e.get("hour")),t.imply("minute",e.get("minute")),t.imply("second",e.get("second")),t.imply("millisecond",e.get("millisecond"))),e.isCertain("timezoneOffset")&&t.assign("timezoneOffset",e.get("timezoneOffset")),e.isCertain("meridiem")?t.assign("meridiem",e.get("meridiem")):e.get("meridiem")!=null&&t.get("meridiem")==null&&t.imply("meridiem",e.get("meridiem")),t.get("meridiem")==He.PM&&t.get("hour")<12&&(e.isCertain("hour")?t.assign("hour",t.get("hour")+12):t.imply("hour",t.get("hour")+12)),t.addTags(n.tags()),t.addTags(e.tags()),t}class Bg extends va{shouldMergeResults(e,t,s){return(t.start.isOnlyDate()&&s.start.isOnlyTime()||s.start.isOnlyDate()&&t.start.isOnlyTime())&&e.match(this.patternBetween())!=null}mergeResults(e,t,s){const r=t.start.isOnlyDate()?Wl(t,s):Wl(s,t);return r.index=t.index,r.text=t.text+e+s.text,r}}class Gl extends Bg{patternBetween(){return new RegExp("^\\s*(T|at|after|before|on|of|,|-|\\.||:)?\\s*$")}}const Yg=new RegExp("^\\s*,?\\s*\\(?([A-Z]{2,4})\\)?(?=\\W|$)","i");class $g{constructor(e){w(this,"timezoneOverrides");this.timezoneOverrides=e}refine(e,t){const s=e.option.timezones??{};return t.forEach(r=>{const a=e.text.substring(r.index+r.text.length),i=Yg.exec(a);if(!i)return;const l=i[1].toUpperCase(),c=r.start.date()??r.refDate??new Date,u={...this.timezoneOverrides,...s},d=Ku(l,c,u);if(d==null)return;e.debug(()=>{console.log(`Extracting timezone: '${l}' into: ${d} for: ${r.start}`)});const f=r.start.get("timezoneOffset");f!==null&&d!=f&&(r.start.isCertain("timezoneOffset")||l!=i[1])||r.start.isOnlyDate()&&l!=i[1]||(r.text+=i[0],r.start.isCertain("timezoneOffset")||r.start.assign("timezoneOffset",d),r.end!=null&&!r.end.isCertain("timezoneOffset")&&r.end.assign("timezoneOffset",d))}),t}}const jg=new RegExp("^\\s*(?:\\(?(?:GMT|UTC)\\s?)?([+-])(\\d{1,2})(?::?(\\d{2}))?\\)?","i"),Wg=1,Hg=2,Gg=3;class Kg{refine(e,t){return t.forEach(function(s){if(s.start.isCertain("timezoneOffset"))return;const r=e.text.substring(s.index+s.text.length),a=jg.exec(r);if(!a)return;e.debug(()=>{console.log(`Extracting timezone: '${a[0]}' into : ${s}`)});const i=parseInt(a[Hg]),l=parseInt(a[Gg]||"0");let c=i*60+l;c>14*60||(a[Wg]==="-"&&(c=-c),s.end!=null&&s.end.assign("timezoneOffset",c),s.start.assign("timezoneOffset",c),s.text+=a[0])}),t}}class Ji{refine(e,t){if(t.length<2)return t;const s=[];let r=t[0];for(let a=1;a<t.length;a++){const i=t[a];if(i.index>=r.index+r.text.length){s.push(r),r=i;continue}let l=null,c=null;i.text.length>r.text.length?(l=i,c=r):(l=r,c=i),e.debug(()=>{console.log(`${this.constructor.name} remove ${c} by ${l}`)}),r=l}return r!=null&&s.push(r),s}}class Vg{refine(e,t){return e.option.forwardDate&&t.forEach(s=>{let r=e.reference.getDateWithAdjustedTimezone();if(s.start.isOnlyTime()&&e.reference.instant>s.start.date()){const a=e.reference.getDateWithAdjustedTimezone(),i=new Date(a);i.setDate(i.getDate()+1),pr(s.start,i),e.debug(()=>{console.log(`${this.constructor.name} adjusted ${s} time from the ref date (${a}) to the following day (${i})`)}),s.end&&s.end.isOnlyTime()&&(pr(s.end,i),s.start.date()>s.end.date()&&(i.setDate(i.getDate()+1),pr(s.end,i)))}if(s.start.isOnlyWeekdayComponent()&&r>s.start.date()){let a=s.start.get("weekday")-r.getDay();if(a<=0&&(a+=7),r=rs(r,{day:a}),pr(s.start,r),e.debug(()=>{console.log(`${this.constructor.name} adjusted ${s} weekday (${s.start})`)}),s.end&&s.end.isOnlyWeekdayComponent()){let i=s.end.get("weekday")-r.getDay();i<=0&&(i+=7),r=rs(r,{day:i}),pr(s.end,r),e.debug(()=>{console.log(`${this.constructor.name} adjusted ${s} weekday (${s.end})`)})}}if(s.start.isDateWithUnknownYear()&&r>s.start.date())for(let a=0;a<3&&r>s.start.date();a++)s.start.imply("year",s.start.get("year")+1),e.debug(()=>{console.log(`${this.constructor.name} adjusted ${s} year (${s.start})`)}),s.end&&!s.end.isCertain("year")&&(s.end.imply("year",s.end.get("year")+1),e.debug(()=>{console.log(`${this.constructor.name} adjusted ${s} month (${s.start})`)}))}),t}}class Qg extends sd{constructor(t){super();w(this,"strictMode");this.strictMode=t}isValid(t,s){return s.text.replace(" ","").match(/^\d*(\.\d*)?$/)?(t.debug(()=>{console.log(`Removing unlikely result '${s.text}'`)}),!1):s.start.isValidDate()?s.end&&!s.end.isValidDate()?(t.debug(()=>{console.log(`Removing invalid result: ${s} (${s.end})`)}),!1):this.strictMode?this.isStrictModeValid(t,s):!0:(t.debug(()=>{console.log(`Removing invalid result: ${s} (${s.start})`)}),!1)}isStrictModeValid(t,s){return s.start.isOnlyWeekdayComponent()?(t.debug(()=>{console.log(`(Strict) Removing weekday only component: ${s} (${s.end})`)}),!1):!0}}const Zg=new RegExp("([0-9]{4})\\-([0-9]{1,2})\\-([0-9]{1,2})(?:T([0-9]{1,2}):([0-9]{1,2})(?::([0-9]{1,2})(?:\\.(\\d{1,4}))?)?(Z|([+-]\\d{2}):?(\\d{2})?)?)?(?=\\W|$)","i"),Xg=1,Jg=2,em=3,Kl=4,tm=5,Vl=6,Ql=7,sm=8,Zl=9,Xl=10;class nm extends os{innerPattern(){return Zg}innerExtract(e,t){const s=e.createParsingComponents({year:parseInt(t[Xg]),month:parseInt(t[Jg]),day:parseInt(t[em])});if(t[Kl]!=null&&(s.assign("hour",parseInt(t[Kl])),s.assign("minute",parseInt(t[tm])),t[Vl]!=null&&s.assign("second",parseInt(t[Vl])),t[Ql]!=null&&s.assign("millisecond",parseInt(t[Ql])),t[sm]!=null)){let r=0;if(t[Zl]){const a=parseInt(t[Zl]);let i=0;t[Xl]!=null&&(i=parseInt(t[Xl])),r=a*60,r<0?r-=i:r+=i}s.assign("timezoneOffset",r)}return s.addTag("parser/ISOFormatParser")}}class rm extends va{mergeResults(e,t,s){const r=s.clone();return r.index=t.index,r.text=t.text+e+r.text,r.start.assign("weekday",t.start.get("weekday")),r.end&&r.end.assign("weekday",t.start.get("weekday")),r}shouldMergeResults(e,t,s){return t.start.isOnlyWeekdayComponent()&&!t.start.isCertain("hour")&&s.start.isCertain("day")&&e.match(/^,?\s*$/)!=null}}function am(n,e=!1){return n.parsers.unshift(new nm),n.refiners.unshift(new rm),n.refiners.unshift(new Kg),n.refiners.unshift(new Ji),n.refiners.push(new $g),n.refiners.push(new Ji),n.refiners.push(new Vg),n.refiners.push(new Qg(e)),n}function im(n){const e=n.getDateWithAdjustedTimezone(),t=new st(n,{});return or(t,e),Gu(t,e),t.assign("timezoneOffset",n.getTimezoneOffset()),t.addTag("casualReference/now"),t}function om(n){const e=n.getDateWithAdjustedTimezone(),t=new st(n,{});return or(t,e),Uo(t,e),t.delete("meridiem"),t.addTag("casualReference/today"),t}function lm(n){return um(n).addTag("casualReference/yesterday")}function cm(n){return zo(n,1).addTag("casualReference/tomorrow")}function um(n,e){return zo(n,-1)}function zo(n,e){const t=n.getDateWithAdjustedTimezone(),s=new st(n,{}),r=new Date(t.getTime());return r.setDate(r.getDate()+e),or(s,r),Uo(s,r),s.delete("meridiem"),s}function dm(n,e=22){const t=n.getDateWithAdjustedTimezone(),s=new st(n,{});return or(s,t),s.imply("hour",e),s.imply("meridiem",He.PM),s.addTag("casualReference/tonight"),s}function hm(n,e=20){const t=new st(n,{});return t.imply("meridiem",He.PM),t.imply("hour",e),t.addTag("casualReference/evening"),t}function fm(n){const e=new st(n,{});return n.getDateWithAdjustedTimezone().getHours()>2&&e.addDurationAsImplied({day:1}),e.assign("hour",0),e.imply("minute",0),e.imply("second",0),e.imply("millisecond",0),e.addTag("casualReference/midnight"),e}function vm(n,e=6){const t=new st(n,{});return t.imply("meridiem",He.AM),t.imply("hour",e),t.imply("minute",0),t.imply("second",0),t.imply("millisecond",0),t.addTag("casualReference/morning"),t}function pm(n,e=15){const t=new st(n,{});return t.imply("meridiem",He.PM),t.imply("hour",e),t.imply("minute",0),t.imply("second",0),t.imply("millisecond",0),t.addTag("casualReference/afternoon"),t}function gm(n){const e=new st(n,{});return e.imply("meridiem",He.AM),e.assign("hour",12),e.imply("minute",0),e.imply("second",0),e.imply("millisecond",0),e.addTag("casualReference/noon"),e}const mm=/(now|today|tonight|tomorrow|overmorrow|tmr|tmrw|yesterday|last\s*night)(?=\W|$)/i;class ym extends os{innerPattern(e){return mm}innerExtract(e,t){let s=e.refDate;const r=t[0].toLowerCase();let a=e.createParsingComponents();switch(r){case"now":a=im(e.reference);break;case"today":a=om(e.reference);break;case"yesterday":a=lm(e.reference);break;case"tomorrow":case"tmr":case"tmrw":a=cm(e.reference);break;case"tonight":a=dm(e.reference);break;case"overmorrow":a=zo(e.reference,2);break;default:if(r.match(/last\s*night/)){if(s.getHours()>6){const i=new Date(s.getTime());i.setDate(i.getDate()-1),s=i}or(a,s),a.imply("hour",0)}break}return a.addTag("parser/ENCasualDateParser"),a}}const bm=/(?:this)?\s{0,3}(morning|afternoon|evening|night|midnight|midday|noon)(?=\W|$)/i;class wm extends os{innerPattern(){return bm}innerExtract(e,t){let s=null;switch(t[1].toLowerCase()){case"afternoon":s=pm(e.reference);break;case"evening":case"night":s=hm(e.reference);break;case"midnight":s=fm(e.reference);break;case"morning":s=vm(e.reference);break;case"noon":case"midday":s=gm(e.reference);break}return s&&s.addTag("parser/ENCasualTimeParser"),s}}function _m(n,e,t){const s=n.getDateWithAdjustedTimezone(),r=km(s,e,t);let a=new st(n);return a=a.addDurationAsImplied({day:r}),a.assign("weekday",e),a}function km(n,e,t){const s=n.getDay();switch(t){case"this":return Ra(n,e);case"last":return nd(n,e);case"next":return s==at.SUNDAY?e==at.SUNDAY?7:e:s==at.SATURDAY?e==at.SATURDAY?7:e==at.SUNDAY?8:1+e:e<s&&e!=at.SUNDAY?Ra(n,e):Ra(n,e)+7}return Tm(n,e)}function Tm(n,e){const t=nd(n,e),s=Ra(n,e);return s<-t?s:t}function Ra(n,e){const t=n.getDay();let s=e-t;return s<0&&(s+=7),s}function nd(n,e){const t=n.getDay();let s=e-t;return s>=0&&(s-=7),s}const Sm=new RegExp(`(?:(?:\\,|\\(|\\)\\s*)?(?:on\\s*?)?(?:(this|last|past|next)\\s*)?(${Hs(Qi)}|weekend|weekday)(?:\\s*(?:\\,|\\)|\\))?(?:\\s*(this|last|past|next)\\s*week)?(?=\\W|$)`,"i"),xm=1,Dm=2,Em=3;class Am extends os{innerPattern(){return Sm}innerExtract(e,t){const s=t[xm],r=t[Em];let a=s||r;a=a||"",a=a.toLowerCase();let i=null;a=="last"||a=="past"?i="last":a=="next"?i="next":a=="this"&&(i="this");const l=t[Dm].toLowerCase();let c;if(Qi[l]!==void 0)c=Qi[l];else if(l=="weekend")c=i=="last"?at.SUNDAY:at.SATURDAY;else if(l=="weekday"){const u=e.reference.getDateWithAdjustedTimezone().getDay();u==at.SUNDAY||u==at.SATURDAY?c=i=="last"?at.FRIDAY:at.MONDAY:(c=u-1,c=i=="last"?c-1:c+1,c=c%5+1)}else return null;return _m(e.reference,c,i)}}const Cm=new RegExp(`(this|last|past|next|after\\s*this)\\s*(${Hs(ii)})(?=\\s*)(?=\\W|$)`,"i"),Mm=1,Im=2;class Om extends os{innerPattern(){return Cm}innerExtract(e,t){const s=t[Mm].toLowerCase(),r=t[Im].toLowerCase(),a=ii[r];if(s=="next"||s.startsWith("after")){const c={};return c[a]=1,st.createRelativeFromReference(e.reference,c)}if(s=="last"||s=="past"){const c={};return c[a]=-1,st.createRelativeFromReference(e.reference,c)}const i=e.createParsingComponents();let l=new Date(e.reference.instant.getTime());return r.match(/week/i)?(l.setDate(l.getDate()-l.getDay()),i.imply("day",l.getDate()),i.imply("month",l.getMonth()+1),i.imply("year",l.getFullYear())):r.match(/month/i)?(l.setDate(1),i.imply("day",l.getDate()),i.assign("year",l.getFullYear()),i.assign("month",l.getMonth()+1)):r.match(/year/i)&&(l.setDate(1),l.setMonth(0),i.imply("day",l.getDate()),i.imply("month",l.getMonth()+1),i.assign("year",l.getFullYear())),i}}const Nm=new RegExp("([^\\d]|^)([0-3]{0,1}[0-9]{1})[\\/\\.\\-]([0-3]{0,1}[0-9]{1})(?:[\\/\\.\\-]([0-9]{4}|[0-9]{2}))?(\\W|$)","i"),Rm=1,Pm=5,Jl=2,ec=3,Ei=4;class Lm{constructor(e){w(this,"groupNumberMonth");w(this,"groupNumberDay");this.groupNumberMonth=e?ec:Jl,this.groupNumberDay=e?Jl:ec}pattern(){return Nm}extract(e,t){const s=t.index+t[Rm].length,r=t.index+t[0].length-t[Pm].length;if(s>0&&e.text.substring(0,s).match("\\d/?$")||r<e.text.length&&e.text.substring(r).match("^/?\\d"))return;const a=e.text.substring(s,r);if(a.match(/^\d\.\d$/)||a.match(/^\d\.\d{1,2}\.\d{1,2}\s*$/)||!t[Ei]&&a.indexOf("/")<0)return;const i=e.createParsingResult(s,a);let l=parseInt(t[this.groupNumberMonth]),c=parseInt(t[this.groupNumberDay]);if((l<1||l>12)&&l>12)if(c>=1&&c<=12&&l<=31)[c,l]=[l,c];else return null;if(c<1||c>31)return null;if(i.start.assign("day",c),i.start.assign("month",l),t[Ei]){const u=parseInt(t[Ei]),d=Qu(u);i.start.assign("year",d)}else{const u=ai(e.refDate,c,l);i.start.imply("year",u)}return i.addTag("parser/SlashDateFormatParser")}}const qm=new RegExp(`(this|last|past|next|after|\\+|-)\\s*(${fa})(?=\\W|$)`,"i"),Fm=new RegExp(`(this|last|past|next|after|\\+|-)\\s*(${ci})(?=\\W|$)`,"i");class Um extends os{constructor(t=!0){super();w(this,"allowAbbreviations");this.allowAbbreviations=t}innerPattern(){return this.allowAbbreviations?qm:Fm}innerExtract(t,s){const r=s[1].toLowerCase();let a=Ur(s[2]);if(!a)return null;switch(r){case"last":case"past":case"-":a=ri(a);break}return st.createRelativeFromReference(t.reference,a)}}function zm(n){return n.text.match(/^[+-]/i)!=null}function tc(n){return n.text.match(/^-/i)!=null}class Bm extends va{shouldMergeResults(e,t,s){return e.match(/^\s*$/i)?zm(s)||tc(s):!1}mergeResults(e,t,s,r){let a=Ur(s.text);tc(s)&&(a=ri(a));const i=st.createRelativeFromReference(er.fromDate(t.start.date()),a);return new Fr(t.reference,t.index,`${t.text}${e}${s.text}`,i)}}function sc(n){return n.text.match(/\s+(before|from)$/i)!=null}function Ym(n){return n.text.match(/\s+(after|since)$/i)!=null}class $m extends va{patternBetween(){return/^\s*$/i}shouldMergeResults(e,t,s){return!e.match(this.patternBetween())||!sc(t)&&!Ym(t)?!1:!!s.start.get("day")&&!!s.start.get("month")&&!!s.start.get("year")}mergeResults(e,t,s){let r=Ur(t.text);sc(t)&&(r=ri(r));const a=st.createRelativeFromReference(er.fromDate(s.start.date()),r);return new Fr(s.reference,t.index,`${t.text}${e}${s.text}`,a)}}const jm=new RegExp(`^\\s*(${oi})`,"i"),Wm=1;class Hm{refine(e,t){return t.forEach(function(s){if(!s.start.isDateWithUnknownYear())return;const r=e.text.substring(s.index+s.text.length),a=jm.exec(r);if(!a||a[0].trim().length<=3)return;e.debug(()=>{console.log(`Extracting year: '${a[0]}' into : ${s}`)});const i=li(a[Wm]);s.end!=null&&s.end.assign("year",i),s.start.assign("year",i),s.text+=a[0]}),t}}class Gm extends sd{constructor(){super()}isValid(e,t){const s=t.text.trim();return s===e.text.trim()?!0:s.toLowerCase()==="may"&&!e.text.substring(0,t.index).trim().match(/\b(in)$/i)?(e.debug(()=>{console.log(`Removing unlikely result: ${t}`)}),!1):s.toLowerCase().endsWith("the second")?(e.text.substring(t.index+t.text.length).trim().length>0&&e.debug(()=>{console.log(`Removing unlikely result: ${t}`)}),!1):!0}}class rd{createCasualConfiguration(e=!1){const t=this.createConfiguration(!1,e);return t.parsers.push(new ym),t.parsers.push(new wm),t.parsers.push(new yg),t.parsers.push(new Om),t.parsers.push(new Um),t.refiners.push(new Gm),t}createConfiguration(e=!0,t=!1){const s=am({parsers:[new Lm(t),new lg(e),new dg,new vg(t),new Am,new Eg,new Ig(e),new Rg(e),new Fg(e)],refiners:[new Gl]},e);return s.parsers.unshift(new Tg(e)),s.refiners.unshift(new $m),s.refiners.unshift(new Bm),s.refiners.unshift(new Ji),s.refiners.push(new Gl),s.refiners.push(new Hm),s.refiners.push(new zg),s}}class Nr{constructor(e){w(this,"parsers");w(this,"refiners");w(this,"defaultConfig",new rd);e=e||this.defaultConfig.createCasualConfiguration(),this.parsers=[...e.parsers],this.refiners=[...e.refiners]}clone(){return new Nr({parsers:[...this.parsers],refiners:[...this.refiners]})}parseDate(e,t,s){const r=this.parse(e,t,s);return r.length>0?r[0].start.date():null}parse(e,t,s){const r=new Km(e,t,s);let a=[];return this.parsers.forEach(i=>{const l=Nr.executeParser(r,i);a=a.concat(l)}),a.sort((i,l)=>i.index-l.index),this.refiners.forEach(function(i){a=i.refine(r,a)}),a}static executeParser(e,t){const s=[],r=t.pattern(e),a=e.text;let i=e.text,l=r.exec(i);for(;l;){const c=l.index+a.length-i.length;l.index=c;const u=t.extract(e,l);if(!u){i=a.substring(l.index+1),l=r.exec(i);continue}let d=null;u instanceof Fr?d=u:u instanceof st?(d=e.createParsingResult(l.index,l[0]),d.start=u):d=e.createParsingResult(l.index,l[0],u);const f=d.index,v=d.text;e.debug(()=>console.log(`${t.constructor.name} extracted (at index=${f}) '${v}'`)),s.push(d),i=a.substring(f+v.length),l=r.exec(i)}return s}}class Km{constructor(e,t,s){w(this,"text");w(this,"option");w(this,"reference");w(this,"refDate");this.text=e,this.option=s??{},this.reference=er.fromInput(t,this.option.timezones),this.refDate=this.reference.instant}createParsingComponents(e){return e instanceof st?e:new st(this.reference,e)}createParsingResult(e,t,s,r){const a=typeof t=="string"?t:this.text.substring(e,t),i=s?this.createParsingComponents(s):null,l=r?this.createParsingComponents(r):null;return new Fr(this.reference,e,a,i,l)}debug(e){this.option.debug&&(this.option.debug instanceof Function?this.option.debug(e):this.option.debug.debug(e))}}const Bo=new rd,Vm=new Nr(Bo.createCasualConfiguration(!1));new Nr(Bo.createConfiguration(!0,!1));new Nr(Bo.createCasualConfiguration(!0));const Qm=Vm;function Aa(n,e,t){return Qm.parseDate(n,e,t)}class ks{static parse(e,t=new Date){const s=e.trim(),r=e;if(!s)return{date:null,isValid:!1,error:"Empty date string",original:r};if(s.match(/^(\d{4})-(\d{2})-(\d{2})$/)){const _=new Date(s);if(!isNaN(_.getTime()))return{date:_,isValid:!0,original:r}}try{const _=Aa(s,t);if(_){const m=new Date(_);return m.setHours(0,0,0,0),{date:m,isValid:!0,original:r}}}catch{}const i=new Date(t);i.setHours(0,0,0,0);const l=s.toLowerCase();if(l==="today")return{date:i,isValid:!0,original:r};if(l==="tomorrow"){const _=new Date(i);return _.setDate(_.getDate()+1),{date:_,isValid:!0,original:r}}if(l==="yesterday"){const _=new Date(i);return _.setDate(_.getDate()-1),{date:_,isValid:!0,original:r}}const c=l.match(/^in\s+(\d+)\s+(day|days|week|weeks|month|months)$/);if(c){const _=parseInt(c[1]),m=c[2],g=new Date(i);return m.startsWith("day")?g.setDate(g.getDate()+_):m.startsWith("week")?g.setDate(g.getDate()+_*7):m.startsWith("month")&&g.setMonth(g.getMonth()+_),{date:g,isValid:!0,original:r}}const u=l.match(/^(\d+)\s+(day|days|week|weeks|month|months)\s+ago$/);if(u){const _=parseInt(u[1]),m=u[2],g=new Date(i);return m.startsWith("day")?g.setDate(g.getDate()-_):m.startsWith("week")?g.setDate(g.getDate()-_*7):m.startsWith("month")&&g.setMonth(g.getMonth()-_),{date:g,isValid:!0,original:r}}const d=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],f=l.match(/^(next|last)\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday)$/);if(f){const _=f[1],m=d.indexOf(f[2]),g=i.getDay();let b=m-g;_==="next"?b<=0&&(b+=7):b>=0&&(b-=7);const x=new Date(i);return x.setDate(x.getDate()+b),{date:x,isValid:!0,original:r}}const v=l.match(/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)$/);if(v){const _=d.indexOf(v[1]),m=i.getDay();let g=_-m;g<0&&(g+=7);const b=new Date(i);return b.setDate(b.getDate()+g),{date:b,isValid:!0,original:r}}const y=l.match(/^(this|next|last)\s+(week|month)$/);if(y){const _=y[1],m=y[2],g=new Date(i);if(m==="week"){const b=g.getDay(),x=b===0?-6:1-b;g.setDate(g.getDate()+x),_==="next"?g.setDate(g.getDate()+7):_==="last"&&g.setDate(g.getDate()-7)}else m==="month"&&(g.setDate(1),_==="next"?g.setMonth(g.getMonth()+1):_==="last"&&g.setMonth(g.getMonth()-1));return{date:g,isValid:!0,original:r}}return{date:null,isValid:!1,error:`Could not parse date: ${e}`,original:r}}static toISODateString(e){return e.toISOString().split("T")[0]}static parseNaturalLanguageDate(e,t=new Date){const s=e.trim();if(!s)return null;const r=ks.handleShortcuts(s,t);if(r)return r;try{const i=Aa(s,t,{forwardDate:!0});if(i)return i}catch{}return ks.parse(s,t).date}static parseToISO(e,t=new Date){const s=ks.parseNaturalLanguageDate(e,t);return s?s.toISOString():null}static isDateExpression(e){const t=e.trim().toLowerCase();if(!t)return!1;if(["today","tomorrow","yesterday","monday","tuesday","wednesday","thursday","friday","saturday","sunday","next","last","this","week","month","year","day","days","ago","eod","eow","eom","in ","at "].some(r=>t.includes(r)))return!0;try{return Aa(t,new Date)!==null}catch{return!1}}static getDateSuggestions(e,t=new Date){const s=[],r=e.trim().toLowerCase(),a=new Date(t);a.setHours(0,0,0,0);const i=[{text:"Today",offset:0,icon:""},{text:"Tomorrow",offset:1,icon:""},{text:"In 2 days",offset:2,icon:""},{text:"In 3 days",offset:3,icon:""},{text:"In 1 week",offset:7,icon:""},{text:"In 2 weeks",offset:14,icon:""}];for(const u of i)if(!r||u.text.toLowerCase().includes(r)){const d=Cn(a,u.offset);s.push({text:u.text,value:d.toISOString(),description:ks.formatDateForDisplay(d,!1),category:"relative",icon:u.icon})}const l=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];for(let u=0;u<l.length;u++){const d=l[u];if(!r||d.toLowerCase().includes(r)||`next ${d}`.toLowerCase().includes(r)){const f=a.getDay();let y=(u===6?0:u+1)-f;y<=0&&(y+=7);const _=Cn(a,y);s.push({text:d,value:_.toISOString(),description:ks.formatDateForDisplay(_,!1),category:"named",icon:""})}}const c=[{text:"EOD (end of day)",keyword:"eod",icon:""},{text:"EOW (end of week)",keyword:"eow",icon:""},{text:"EOM (end of month)",keyword:"eom",icon:""}];for(const u of c)if(!r||u.text.toLowerCase().includes(r)||u.keyword.includes(r)){const d=ks.handleShortcuts(u.keyword,t);d&&s.push({text:u.text,value:d.toISOString(),description:ks.formatDateForDisplay(d,!0),category:"shortcut",icon:u.icon})}if(!r||"next month".includes(r)){const u=new Date(a);u.setMonth(u.getMonth()+1),s.push({text:"Next month",value:u.toISOString(),description:ks.formatDateForDisplay(u,!1),category:"relative",icon:""})}return s.slice(0,8)}static formatDateForDisplay(e,t=!1){const s={weekday:"short",year:"numeric",month:"short",day:"numeric"};return t&&(s.hour="2-digit",s.minute="2-digit"),e.toLocaleString(void 0,s)}static parseTime(e){const t=e.trim().toLowerCase(),s=t.match(/^(\d{1,2}):(\d{2})$/);if(s){const a=parseInt(s[1]),i=parseInt(s[2]);if(a>=0&&a<24&&i>=0&&i<60)return{hours:a,minutes:i}}const r=t.match(/^(\d{1,2})(?::(\d{2}))?\s*(am|pm)$/);if(r){let a=parseInt(r[1]);const i=r[2]?parseInt(r[2]):0,l=r[3];if(l==="pm"&&a!==12?a+=12:l==="am"&&a===12&&(a=0),a>=0&&a<24&&i>=0&&i<60)return{hours:a,minutes:i}}try{const a=Aa(t,new Date);if(a)return{hours:a.getHours(),minutes:a.getMinutes()}}catch{}return null}static handleShortcuts(e,t){const s=e.trim().toLowerCase(),r=new Date(t);switch(r.setHours(0,0,0,0),s){case"eod":return Ti(r,17,0);case"eow":{const a=r.getDay();let i;a===0?i=5:a<=5?i=5-a:i=6;const l=Cn(r,i);return Ti(l,17,0)}case"eom":{const a=new Date(r.getFullYear(),r.getMonth()+1,0);return Ti(a,17,0)}default:return null}}}class tr{constructor(){w(this,"input","");w(this,"position",0);w(this,"line",1);w(this,"column",1);w(this,"referenceDate",new Date)}parse(e,t=new Date){let s=e.trim();const r={},a=s.split(`
`),i=[];for(const u of a){const d=u.trim();if(d==="@ignoreGlobalFilter"){r.overrideGlobalFilter=!0;continue}const f=d.match(/^@profile\s+(.+)$/);if(f){r.useProfile=f[1].trim();continue}i.push(u)}this.input=i.join(`
`).trim(),this.position=0,this.line=1,this.column=1,this.referenceDate=t;const l={filters:[]},c=this.input.split(`
`).map(u=>u.trim()).filter(u=>u.length>0);for(let u=0;u<c.length;u++){this.line=u+1,this.column=1;const d=c[u];if(d.startsWith("sort by "))l.sort=this.parseSortInstruction(d);else if(d.startsWith("group by "))l.group=this.parseGroupInstruction(d);else if(d.startsWith("limit ")||d.startsWith("limit to "))l.limit=this.parseLimitInstruction(d);else if(/^explain$/i.test(d))l.explain=!0;else{const f=this.parseFilterInstruction(d);f&&l.filters.push(f)}}return{...l,...r}}validate(e){try{return this.parse(e),{valid:!0}}catch(t){return t instanceof Cs?{valid:!1,error:t.message}:{valid:!1,error:String(t)}}}normalizeOperatorAliases(e){return e=e.replace(/^-(\w+)/,"not $1"),e=e.replace(/(\s+(?:and|AND|or|OR))\s+-(\w+)/gi,"$1 not $2"),e=e.replace(/^!(\w+)/,"not $1"),e=e.replace(/(\s+(?:and|AND|or|OR))\s+!(\w+)/gi,"$1 not $2"),e=e.replace(/\s+except\s+/gi," AND NOT "),e=e.replace(/\s*&&\s*/g," AND "),e=e.replace(/\s*\|\|\s*/g," OR "),e}parseFilterInstruction(e){if(e=this.normalizeOperatorAliases(e),e==="done")return{type:"done",operator:"is",value:!0};if(e==="not done")return{type:"done",operator:"is",value:!1};if(this.hasBooleanOperators(e)||e.includes("("))return this.parseBooleanExpression(e);if(e.match(/^(due|scheduled|start|created|done|cancelled)\s+between\s+/i)){const r=this.parseDateFilter(e);if(r)return r}if(e.startsWith("status.type is ")){const r=e.substring(15).trim();return{type:"status",operator:"type-is",value:this.parseStatusType(r)}}if(e.startsWith("status.name includes ")){const r=e.substring(21).trim();return{type:"status",operator:"name-includes",value:this.unquote(r)}}if(e.startsWith("status.symbol is ")){const r=e.substring(17).trim();return{type:"status",operator:"symbol-is",value:this.unquote(r)}}const s=this.parseDateFilter(e);if(s)return s;if(e.startsWith("priority is "))return{type:"priority",operator:"is",value:e.substring(12).trim()};if(e.startsWith("priority above "))return{type:"priority",operator:"above",value:e.substring(15).trim()};if(e.startsWith("priority below "))return{type:"priority",operator:"below",value:e.substring(15).trim()};if(e.startsWith("urgency is ")){const r=e.substring(11).trim();return{type:"urgency",operator:"is",value:this.parseNumericValue(r,"urgency")}}if(e.startsWith("urgency above ")){const r=e.substring(14).trim();return{type:"urgency",operator:"above",value:this.parseNumericValue(r,"urgency")}}if(e.startsWith("urgency below ")){const r=e.substring(14).trim();return{type:"urgency",operator:"below",value:this.parseNumericValue(r,"urgency")}}if(e.startsWith("tag includes ")){const r=e.substring(13).trim();return{type:"tag",operator:"includes",value:this.unquote(r)}}if(e.startsWith("tag does not include ")){const r=e.substring(21).trim();return{type:"tag",operator:"includes",value:this.unquote(r),negate:!0}}if(e.startsWith("tags include ")){const r=e.substring(13).trim();return{type:"tag",operator:"includes",value:this.unquote(r)}}if(e==="has tags")return{type:"tag",operator:"has",value:!0};if(e==="no tags")return{type:"tag",operator:"has",value:!1};if(e.startsWith("path includes ")){const r=e.substring(14).trim();return{type:"path",operator:"includes",value:this.unquote(r)}}if(e.startsWith("path does not include ")){const r=e.substring(22).trim();return{type:"path",operator:"includes",value:this.unquote(r),negate:!0}}if(e==="is blocked")return{type:"dependency",operator:"is-blocked",value:!0};if(e==="is not blocked")return{type:"dependency",operator:"is-blocked",value:!1};if(e==="is blocking")return{type:"dependency",operator:"is-blocking",value:!0};if(e==="is recurring")return{type:"recurrence",operator:"is",value:!0};if(e==="is not recurring")return{type:"recurrence",operator:"is",value:!1};if(e.startsWith("description includes ")){const r=e.substring(21).trim();return{type:"description",operator:"includes",value:this.unquote(r)}}if(e.startsWith("description does not include ")){const r=e.substring(29).trim();return{type:"description",operator:"does not include",value:this.unquote(r)}}if(e.startsWith("description regex ")){const r=e.substring(18).trim();return{type:"description",operator:"regex",value:this.unquote(r)}}if(e.startsWith("heading includes ")){const r=e.substring(17).trim();return{type:"heading",operator:"includes",value:this.unquote(r)}}if(e.startsWith("heading does not include ")){const r=e.substring(25).trim();return{type:"heading",operator:"does not include",value:this.unquote(r)}}throw new Cs(`Unknown filter instruction: "${e}"`,this.line,this.column,"Check the query syntax documentation for valid filter instructions")}parseDateFilter(e){const t=["due","scheduled","start","created","done","cancelled"];for(const s of t){if(e===`has ${s} date`)return{type:"date",operator:"has",value:{field:s}};if(e===`no ${s} date`)return{type:"date",operator:"has",value:{field:s},negate:!0};const r=e.match(new RegExp(`^${s}\\s+between\\s+(.+?)\\s+and\\s+(.+)$`,"i"));if(r){const i=r[1].trim(),l=r[2].trim(),c=ks.parse(i,this.referenceDate),u=ks.parse(l,this.referenceDate);if(!c.isValid||!c.date)throw new Cs(`Invalid start date: "${i}"`,this.line,this.column,'Use formats like: today, tomorrow, YYYY-MM-DD, "in 3 days", "next Monday"');if(!u.isValid||!u.date)throw new Cs(`Invalid end date: "${l}"`,this.line,this.column,'Use formats like: today, tomorrow, YYYY-MM-DD, "in 3 days", "next Monday"');return{type:"date",operator:"between",value:{field:s,date:c.date,endDate:u.date}}}const a=["before","after","on","on or before","on or after"];for(const i of a){const l=`${s} ${i} `;if(e.startsWith(l)){const c=e.substring(l.length).trim(),u=ks.parse(c,this.referenceDate);if(!u.isValid||!u.date)throw new Cs(`Invalid date value: "${c}"`,this.line,this.column,'Use formats like: today, tomorrow, YYYY-MM-DD, "in 3 days", "next Monday"');return{type:"date",operator:i,value:{field:s,date:u.date}}}}}return null}parseSortInstruction(e){const t=e.match(/^sort by ([a-z.]+)(\s+reverse)?$/i);if(!t)throw new Cs(`Invalid sort instruction: "${e}"`,this.line,this.column,'Use format: "sort by FIELD" or "sort by FIELD reverse"');return{field:t[1],reverse:!!t[2]}}parseGroupInstruction(e){const t=e.match(/^group by ([a-z.]+)$/i);if(!t)throw new Cs(`Invalid group instruction: "${e}"`,this.line,this.column,'Use format: "group by FIELD"');return{field:t[1]}}parseLimitInstruction(e){let t=e.match(/^limit (\d+)$/);if(t||(t=e.match(/^limit to (\d+) tasks?$/),t))return parseInt(t[1],10);throw new Cs(`Invalid limit instruction: "${e}"`,this.line,this.column,'Use format: "limit 10" or "limit to 10 tasks"')}parseStatusType(e){switch(e.toUpperCase().replace(/\s+/g,"_")){case"TODO":return yt.TODO;case"IN_PROGRESS":return yt.IN_PROGRESS;case"DONE":return yt.DONE;case"CANCELLED":return yt.CANCELLED;case"NON_TASK":return yt.NON_TASK;default:throw new Cs(`Invalid status type: "${e}"`,this.line,this.column,"Valid types: TODO, IN_PROGRESS, DONE, CANCELLED, NON_TASK")}}parseNumericValue(e,t){const s=Number(e);if(Number.isNaN(s))throw new Cs(`Invalid ${t} value: "${e}"`,this.line,this.column,`Use a numeric ${t} value (e.g., "${t} above 75")`);return s}unquote(e){return e.startsWith('"')&&e.endsWith('"')||e.startsWith("'")&&e.endsWith("'")?e.slice(1,-1):e}hasBooleanOperators(e){if(/^(not|NOT)\s+/i.test(e))return!0;const t=/\s+between\s+.+?\s+and\s+/i;if(t.test(e)){const s=e.replace(t," ");return/\s+(and|AND|or|OR)\s+/i.test(s)}return/\s+(and|AND|or|OR)\s+/i.test(e)}parseBooleanExpression(e){return this.parseOrExpression(e)}parseOrExpression(e){const t=this.splitByOperator(e,/\s+(or|OR)\s+/i);if(t.length===1)return this.parseAndExpression(t[0]);let s=this.parseAndExpression(t[0]);for(let r=1;r<t.length;r++)s={type:"boolean",operator:"OR",value:null,left:s,right:this.parseAndExpression(t[r])};return s}parseAndExpression(e){const t=this.splitByOperator(e,/\s+(and|AND)\s+/i,!0);if(t.length===1)return this.parseNotExpression(t[0]);let s=this.parseNotExpression(t[0]);for(let r=1;r<t.length;r++)s={type:"boolean",operator:"AND",value:null,left:s,right:this.parseNotExpression(t[r])};return s}parseNotExpression(e){const t=e.trim();if(t.toLowerCase()==="not done")return{type:"done",operator:"is",value:!1};if(/^(not|NOT)\s+/i.test(t)){const s=t.replace(/^(not|NOT)\s+/i,"").trim();return{type:"boolean",operator:"NOT",value:null,inner:this.parsePrimaryExpression(s)}}return this.parsePrimaryExpression(t)}parsePrimaryExpression(e){const t=e.trim();if(t.startsWith("(")&&t.endsWith(")")){let s=0;for(let r=0;r<t.length&&(t[r]==="("&&s++,t[r]===")"&&s--,!(s===0&&r<t.length-1));r++);if(s===0){const r=t.slice(1,-1).trim();return this.parseBooleanExpression(r)}}return this.parseAtomicFilter(t)}splitByOperator(e,t,s=!1){const r=[];let a="",i=0,l=0;for(;l<e.length;){const c=e[l];if(c==="(")i++,a+=c,l++;else if(c===")")i--,a+=c,l++;else if(i===0){const d=e.slice(l).match(t);if(d&&d.index===0){if(s&&/\s+(and|AND)\s+/i.test(d[0])&&a.toLowerCase().match(/\s+between\s+[^)]*$/)){a+=d[0],l+=d[0].length;continue}a.trim()&&r.push(a.trim()),a="",l+=d[0].length}else a+=c,l++}else a+=c,l++}return a.trim()&&r.push(a.trim()),r.length>0?r:[e]}parseAtomicFilter(e){const t=this.normalizeOperatorAliases(e.trim());if(t==="done")return{type:"done",operator:"is",value:!0};if(t==="not done")return{type:"done",operator:"is",value:!1};if(t.match(/^(due|scheduled|start|created|done|cancelled)\s+between\s+/i)){const a=this.parseDateFilter(t);if(a)return a}if(t.startsWith("status.type is ")){const a=t.substring(15).trim();return{type:"status",operator:"type-is",value:this.parseStatusType(a)}}if(t.startsWith("status.name includes ")){const a=t.substring(21).trim();return{type:"status",operator:"name-includes",value:this.unquote(a)}}if(t.startsWith("status.symbol is ")){const a=t.substring(17).trim();return{type:"status",operator:"symbol-is",value:this.unquote(a)}}const r=this.parseDateFilter(t);if(r)return r;if(t.startsWith("priority is "))return{type:"priority",operator:"is",value:t.substring(12).trim()};if(t.startsWith("priority above "))return{type:"priority",operator:"above",value:t.substring(15).trim()};if(t.startsWith("priority below "))return{type:"priority",operator:"below",value:t.substring(15).trim()};if(t.startsWith("urgency is ")){const a=t.substring(11).trim();return{type:"urgency",operator:"is",value:this.parseNumericValue(a,"urgency")}}if(t.startsWith("urgency above ")){const a=t.substring(14).trim();return{type:"urgency",operator:"above",value:this.parseNumericValue(a,"urgency")}}if(t.startsWith("urgency below ")){const a=t.substring(14).trim();return{type:"urgency",operator:"below",value:this.parseNumericValue(a,"urgency")}}if(t.startsWith("tag includes ")){const a=t.substring(13).trim();return{type:"tag",operator:"includes",value:this.unquote(a)}}if(t.startsWith("tag does not include ")){const a=t.substring(21).trim();return{type:"tag",operator:"includes",value:this.unquote(a),negate:!0}}if(t.startsWith("tags include ")){const a=t.substring(13).trim();return{type:"tag",operator:"includes",value:this.unquote(a)}}if(t==="has tags")return{type:"tag",operator:"has",value:!0};if(t==="no tags")return{type:"tag",operator:"has",value:!1};if(t.startsWith("path includes ")){const a=t.substring(14).trim();return{type:"path",operator:"includes",value:this.unquote(a)}}if(t.startsWith("path does not include ")){const a=t.substring(22).trim();return{type:"path",operator:"includes",value:this.unquote(a),negate:!0}}if(t==="is blocked")return{type:"dependency",operator:"is-blocked",value:!0};if(t==="is not blocked")return{type:"dependency",operator:"is-blocked",value:!1};if(t==="is blocking")return{type:"dependency",operator:"is-blocking",value:!0};if(t==="is recurring")return{type:"recurrence",operator:"is",value:!0};if(t==="is not recurring")return{type:"recurrence",operator:"is",value:!1};if(t.startsWith("description includes ")){const a=t.substring(21).trim();return{type:"description",operator:"includes",value:this.unquote(a)}}if(t.startsWith("description does not include ")){const a=t.substring(29).trim();return{type:"description",operator:"does not include",value:this.unquote(a)}}if(t.startsWith("description regex ")){const a=t.substring(18).trim();return{type:"description",operator:"regex",value:this.unquote(a)}}if(t.startsWith("heading includes ")){const a=t.substring(17).trim();return{type:"heading",operator:"includes",value:this.unquote(a)}}if(t.startsWith("heading does not include ")){const a=t.substring(25).trim();return{type:"heading",operator:"does not include",value:this.unquote(a)}}throw new Cs(`Unknown filter instruction: "${t}"`,this.line,this.column,"Check the query syntax documentation for valid filter instructions")}}class wt{}const Fn=class Fn{constructor(){w(this,"statuses",new Map);this.addDefaultStatuses()}static getInstance(){return Fn.instance||(Fn.instance=new Fn),Fn.instance}addDefaultStatuses(){this.add(Vs.TODO),this.add(Vs.IN_PROGRESS),this.add(Vs.DONE),this.add(Vs.CANCELLED)}add(e){this.statuses.set(e.symbol,e)}register(e){this.add(e)}unregister(e){this.statuses.delete(e)}get(e){const t=this.statuses.get(e);return t||new Vs({symbol:e,name:"Unknown",nextStatusSymbol:"x",type:Vs.getTypeForUnknownSymbol(e)})}getNextStatus(e){return this.get(e.nextStatusSymbol)}getAllStatuses(){return Array.from(this.statuses.values())}getAll(){return this.getAllStatuses()}reset(){this.statuses.clear(),this.addDefaultStatuses()}};w(Fn,"instance",null);let Ws=Fn;class Zm extends wt{constructor(e,t=!1){super(),this.statusType=e,this.negate=t}matches(e){const t=Ws.getInstance(),s=e.statusSymbol||" ",a=t.get(s).type===this.statusType;return this.negate?!a:a}}class Xm extends wt{constructor(e,t=!1){super(),this.name=e,this.negate=t}matches(e){const t=Ws.getInstance(),s=e.statusSymbol||" ",a=t.get(s).name.toLowerCase().includes(this.name.toLowerCase());return this.negate?!a:a}}class Jm extends wt{constructor(e,t=!1){super(),this.symbol=e,this.negate=t}matches(e){const s=(e.statusSymbol||" ")===this.symbol;return this.negate?!s:s}}class ey extends wt{matches(e){const t=Ws.getInstance(),s=e.statusSymbol||" ";return t.get(s).type===yt.DONE}}class ty extends wt{matches(e){const t=Ws.getInstance(),s=e.statusSymbol||" ";return t.get(s).type!==yt.DONE}}class nc extends wt{constructor(e,t,s,r){super(),this.field=e,this.comparator=t,this.targetDate=s,this.endDate=r}matches(e){const t=this.getTaskDate(e);if(!t)return!1;const s=new Date(this.targetDate);s.setHours(0,0,0,0);const r=new Date(t);switch(r.setHours(0,0,0,0),this.comparator){case"before":return r<s;case"after":return r>s;case"on":return r.getTime()===s.getTime();case"on or before":return r<=s;case"on or after":return r>=s;case"between":if(!this.endDate)return!1;const a=new Date(this.endDate);return a.setHours(0,0,0,0),r>=s&&r<=a;default:return!1}}getTaskDate(e){let t;switch(this.field){case"due":t=e.dueAt;break;case"scheduled":t=e.scheduledAt;break;case"start":t=e.startAt;break;case"created":t=e.createdAt;break;case"done":t=e.doneAt;break;case"cancelled":t=e.cancelledAt;break}return t?new Date(t):null}}class sy extends wt{constructor(e,t=!1){super(),this.field=e,this.negate=t}matches(e){let t=!1;switch(this.field){case"due":t=!!e.dueAt;break;case"scheduled":t=!!e.scheduledAt;break;case"start":t=!!e.startAt;break;case"created":t=!!e.createdAt;break;case"done":t=!!e.doneAt;break;case"cancelled":t=!!e.cancelledAt;break}return this.negate?!t:t}}const rc={lowest:0,low:1,normal:2,medium:3,high:4,highest:5};function ny(n){return Or(n)??"normal"}function ry(n){return n==="urgent"?"highest":n==="none"?"normal":n}class ay extends wt{constructor(e,t){super(),this.operator=e,this.level=t}matches(e){const t=ny(e.priority),s=rc[t],r=rc[ry(this.level)];switch(this.operator){case"is":return s===r;case"above":return s>r;case"below":return s<r;default:return!1}}}class iy extends wt{constructor(e,t=!1){super(),this.tag=e,this.negate=t}matches(e){const t=e.tags||[],s=this.tag.toLowerCase(),r=t.some(a=>a.toLowerCase().includes(s));return this.negate?!r:r}}class oy extends wt{constructor(e=!1){super(),this.negate=e}matches(e){const t=e.tags&&e.tags.length>0;return this.negate?!t:!!t}}class ly extends wt{constructor(e,t=!1){super(),this.pattern=e,this.negate=t}matches(e){const s=(e.path||"").toLowerCase().includes(this.pattern.toLowerCase());return this.negate?!s:s}}class cy extends wt{constructor(e,t=!1){super(),this.dependencyGraph=e,this.negate=t}matches(e){if(!this.dependencyGraph){const s=e.blockedBy&&e.blockedBy.length>0;return this.negate?!s:!!s}const t=this.dependencyGraph.isBlocked(e.id);return this.negate?!t:t}}class uy extends wt{constructor(e,t=!1){super(),this.dependencyGraph=e,this.negate=t}matches(e){if(!this.dependencyGraph)return!!this.negate;const t=this.dependencyGraph.isBlocking(e.id);return this.negate?!t:t}}class dy extends wt{constructor(e=!1){super(),this.negate=e}matches(e){const t=e.frequency&&e.frequency.type!=="once";return this.negate?!t:!!t}}class hy extends wt{constructor(e,t){super(),this.left=e,this.right=t}matches(e){return this.left.matches(e)&&this.right.matches(e)}}class fy extends wt{constructor(e,t){super(),this.left=e,this.right=t}matches(e){return this.left.matches(e)||this.right.matches(e)}}class vy extends wt{constructor(e){super(),this.inner=e}matches(e){return!this.inner.matches(e)}}class py extends wt{constructor(e,t,s=!1){super(),this.operator=e,this.pattern=t,this.caseSensitive=s}matches(e){const t=e.name||"",s=e.description||"",r=`${t} ${s}`.trim();switch(this.operator){case"includes":{const a=this.caseSensitive?this.pattern:this.pattern.toLowerCase();return(this.caseSensitive?r:r.toLowerCase()).includes(a)}case"does not include":{const a=this.caseSensitive?this.pattern:this.pattern.toLowerCase();return!(this.caseSensitive?r:r.toLowerCase()).includes(a)}case"regex":try{const a=this.caseSensitive?"":"i";return new RegExp(this.pattern,a).test(r)}catch{return!1}}}}class gy extends wt{constructor(e,t){super(),this.operator=e,this.pattern=t}matches(e){const s=(e.heading||"").toLowerCase().includes(this.pattern.toLowerCase());return this.operator==="includes"?s:!s}}class my extends wt{constructor(e,t,s,r){super(),this.comparator=e,this.threshold=t,this.referenceDate=s,this.settings=r}matches(e){const t=Po(e,{now:this.referenceDate,settings:this.settings});switch(this.comparator){case"above":return t>this.threshold;case"below":return t<this.threshold;case"is":return t===this.threshold;default:return!1}}}class Rn{group(e){const t=new Map;for(const s of e){const r=this.getGroupKey(s);this.addToGroup(t,r,s)}return t}addToGroup(e,t,s){e.has(t)||e.set(t,[]),e.get(t).push(s)}}class yy extends Rn{getGroupKey(e){if(!e.dueAt)return"No due date";const t=new Date;t.setHours(0,0,0,0);const s=new Date(e.dueAt);s.setHours(0,0,0,0);const r=s.getTime()-t.getTime(),a=Math.ceil(r/(1e3*60*60*24));return a<0?"Overdue":a===0?"Today":a===1?"Tomorrow":a<=7?"This Week":"Later"}}class by extends Rn{getGroupKey(e){if(!e.scheduledAt)return"No scheduled date";const t=new Date;t.setHours(0,0,0,0);const s=new Date(e.scheduledAt);s.setHours(0,0,0,0);const r=s.getTime()-t.getTime(),a=Math.ceil(r/(1e3*60*60*24));return a<0?"Past":a===0?"Today":a===1?"Tomorrow":a<=7?"This Week":"Later"}}class wy extends Rn{getGroupKey(e){const t=Ws.getInstance(),s=e.statusSymbol||" ";return t.get(s).type}}class _y extends Rn{getGroupKey(e){const t=Ws.getInstance(),s=e.statusSymbol||" ";return t.get(s).name}}class ky extends Rn{getGroupKey(e){const t=e.priority||"normal";return t.charAt(0).toUpperCase()+t.slice(1)}}class Ty extends Rn{getGroupKey(e){return e.path||""||"No path"}}class Sy extends Rn{getGroupKey(e){const t=e.path||"";if(!t)return"No folder";const s=t.lastIndexOf("/");return s===-1?"Root":t.substring(0,s)||"Root"}}class xy extends Rn{group(e){const t=new Map;for(const s of e){const r=s.tags||[];if(r.length===0)this.addToGroup(t,"No tags",s);else for(const a of r)this.addToGroup(t,a,s)}return t}getGroupKey(e){const t=e.tags||[];return t.length>0?t[0]:"No tags"}}function Dy(n){const e=[];if(n.filters.length>0){e.push("**Filters:**");for(const t of n.filters)e.push(`- ${gr(t)}`)}else e.push("**Filters:** None (showing all tasks)");if(n.sort){const t=n.sort.reverse?"descending":"ascending";e.push(`
**Sort:** By ${n.sort.field} (${t})`)}return n.group&&e.push(`
**Group:** By ${n.group.field}`),n.limit!==void 0&&n.limit>0&&e.push(`
**Limit:** First ${n.limit} tasks`),e.join(`
`)}function gr(n){const e=n.negate?"NOT ":"";switch(n.type){case"status":return`${e}Status ${n.operator} "${n.value}"`;case"date":return`${e}${n.value.field} ${n.value.comparator} ${n.value.date}`;case"priority":return`${e}Priority ${n.operator} ${n.value}`;case"urgency":return`${e}Urgency ${n.operator} ${n.value}`;case"tag":return n.operator==="includes"?`${e}Tag includes "${n.value}"`:n.operator==="has"?`${e}Has tags`:`${e}Tag ${n.operator} "${n.value}"`;case"path":return`${e}Path ${n.operator} "${n.value}"`;case"dependency":return n.value==="blocked"?`${e}Is blocked by another task`:n.value==="blocking"?`${e}Is blocking another task`:`${e}Dependency ${n.operator} ${n.value}`;case"recurrence":return`${e}Recurrence ${n.operator} ${n.value}`;case"boolean":return n.operator==="AND"||n.operator==="and"?`(${gr(n.left)} AND ${gr(n.right)})`:n.operator==="OR"||n.operator==="or"?`(${gr(n.left)} OR ${gr(n.right)})`:n.operator==="NOT"||n.operator==="not"?`(NOT ${gr(n.inner)})`:"Unknown boolean filter";case"done":return n.value?`${e}done`:`${e}not done`;case"description":return`${e}Description ${n.operator} "${n.value}"`;default:return`${e}Unknown filter`}}class ad{constructor(e,t={}){w(this,"dependencyGraph",null);w(this,"globalFilterAST",null);w(this,"urgencySettings");this.taskIndex=e,this.urgencySettings=t.urgencySettings??Ro}setDependencyGraph(e){this.dependencyGraph=e}setGlobalFilter(e){if(!e){this.globalFilterAST=null;return}try{const t=new tr;this.globalFilterAST=t.parse(e)}catch(t){console.error("Failed to parse global filter:",t),this.globalFilterAST=null}}execute(e){const t=performance.now(),s=new Date;try{const r=e.explain?this.generateExplanation(e):void 0;let a=this.taskIndex.getAllTasks();const i=a.length;this.globalFilterAST&&this.globalFilterAST.filters.length>0&&(a=this.applyFilters(a,this.globalFilterAST.filters,s)),e.filters.length>0&&(a=this.applyFilters(a,e.filters,s)),e.sort&&(a=this.applySort(a,e.sort,s)),e.limit!==void 0&&e.limit>0&&(a=a.slice(0,e.limit));let l;e.group&&(l=this.applyGrouping(a,e.group));const u=performance.now()-t;return{tasks:a,groups:l,totalCount:i,executionTimeMs:u,explanation:r}}catch(r){throw new hr(`Failed to execute query: ${r instanceof Error?r.message:String(r)}`,r instanceof Error?r:void 0)}}executeString(e){const s=new tr().parse(e);return this.execute(s)}validateQuery(e){try{return{valid:!0,parsedFilters:new tr().parse(e).filters.map(r=>`${r.type}:${r.operator}`)}}catch(t){return{valid:!1,error:t instanceof Error?t.message:String(t)}}}applyFilters(e,t,s){let r=e;for(const a of t){const i=this.createFilter(a,s);r=r.filter(l=>i.matches(l))}return r}createFilter(e,t){switch(e.type){case"done":return e.value?new ey:new ty;case"status":if(e.operator==="type-is")return new Zm(e.value,e.negate);if(e.operator==="name-includes")return new Xm(e.value,e.negate);if(e.operator==="symbol-is")return new Jm(e.value,e.negate);throw new hr(`Unknown status operator: ${e.operator}`);case"date":return e.operator==="has"?new sy(e.value.field,e.negate):e.operator==="between"?new nc(e.value.field,e.operator,e.value.date,e.value.endDate):new nc(e.value.field,e.operator,e.value.date);case"priority":return new ay(e.operator,e.value);case"urgency":return new my(e.operator,e.value,t,this.urgencySettings);case"tag":return e.operator==="has"?new oy(!e.value):new iy(e.value,e.negate);case"path":return new ly(e.value,e.negate);case"dependency":if(e.operator==="is-blocked")return new cy(this.dependencyGraph,!e.value);if(e.operator==="is-blocking")return new uy(this.dependencyGraph,!e.value);throw new hr(`Unknown dependency operator: ${e.operator}`);case"recurrence":return new dy(!e.value);case"description":return new py(e.operator,e.value,e.negate);case"heading":return new gy(e.operator,e.value);case"boolean":if(e.operator==="AND"&&e.left&&e.right)return new hy(this.createFilter(e.left,t),this.createFilter(e.right,t));if(e.operator==="OR"&&e.left&&e.right)return new fy(this.createFilter(e.left,t),this.createFilter(e.right,t));if(e.operator==="NOT"&&e.inner)return new vy(this.createFilter(e.inner,t));throw new hr(`Invalid boolean operator: ${e.operator}`);default:throw new hr(`Unknown filter type: ${e.type}`)}}applySort(e,t,s){const r=[...e];return r.sort((a,i)=>{let l=0;switch(t.field){case"due":l=this.compareDates(a.dueAt,i.dueAt);break;case"scheduled":l=this.compareDates(a.scheduledAt,i.scheduledAt);break;case"start":l=this.compareDates(a.startAt,i.startAt);break;case"created":l=this.compareDates(a.createdAt,i.createdAt);break;case"done":l=this.compareDates(a.doneAt,i.doneAt);break;case"priority":l=this.comparePriorities(a.priority,i.priority);break;case"urgency":l=this.getUrgencyScore(i,s)-this.getUrgencyScore(a,s);break;case"status.type":l=this.compareStatusTypes(a,i);break;case"description":l=(a.description||"").localeCompare(i.description||"");break;case"heading":l=(a.heading||"").localeCompare(i.heading||"");break;case"path":l=(a.path||"").localeCompare(i.path||"");break;default:l=a.name.localeCompare(i.name)}return t.reverse?-l:l}),r}compareDates(e,t){return!e&&!t?0:e?t?new Date(e).getTime()-new Date(t).getTime():-1:1}comparePriorities(e,t){const s={lowest:0,low:1,normal:2,medium:3,high:4,highest:5},r=s[Or(e)||"normal"]||2,a=s[Or(t)||"normal"]||2;return r-a}compareStatusTypes(e,t){const s=r=>{const a=r.statusSymbol||" ";return a===" "?0:a==="/"?1:a==="x"?2:a==="-"?3:0};return s(e)-s(t)}getUrgencyScore(e,t){return Po(e,{now:t,settings:this.urgencySettings})}applyGrouping(e,t){return this.createGrouper(t.field).group(e)}createGrouper(e){switch(e){case"due":return new yy;case"scheduled":return new by;case"status.type":return new wy;case"status.name":return new _y;case"priority":return new ky;case"path":return new Ty;case"folder":return new Sy;case"tags":return new xy;default:throw new hr(`Unknown grouping field: ${e}`)}}generateExplanation(e){return Dy(e)}}class id{constructor(e){w(this,"parser");this.parser=e??new tr}compose(e,t){const{query:s,ignoreGlobal:r}=this.stripIgnoreDirective(e),a=this.parser.parse(s);return!r&&t&&t.filters.length>0?{ast:{...a,filters:[...t.filters,...a.filters]},ignoredGlobal:!1}:{ast:a,ignoredGlobal:r}}stripIgnoreDirective(e){const t=e.split(`
`),s=[];let r=!1;for(const a of t){if(/^ignore global query$/i.test(a.trim())){r=!0;continue}s.push(a)}return{query:s.join(`
`),ignoreGlobal:r}}}const od={enabled:!1,query:""},Un=class Un{constructor(e=od){w(this,"config");w(this,"ast",null);w(this,"error",null);this.config=e,this.parse()}static getInstance(){return Un.instance||(Un.instance=new Un),Un.instance}initialize(e){this.config=e,this.parse()}updateConfig(e){this.config=e,this.parse()}getConfig(){return this.config}isEnabled(){return this.config.enabled&&this.config.query.trim().length>0}getAST(){return this.ast}getError(){return this.error}parse(){if(!this.isEnabled()){this.ast=null,this.error=null;return}try{const e=new tr;this.ast=e.parse(this.config.query),this.error=null}catch(e){this.ast=null,this.error=e instanceof Error?e.message:String(e)}}};w(Un,"instance",null);let na=Un;var Ey=C('<button class="search-tab__btn svelte-1yjlv38"> </button>'),Ay=C('<div class="search-tab__error svelte-1yjlv38"> </div>'),Cy=C('<div class="search-tab__stats svelte-1yjlv38"> </div>'),My=C('<li><button class="search-tab__history-item svelte-1yjlv38"> </button></li>'),Iy=C('<div class="search-tab__history svelte-1yjlv38"><div class="search-tab__history-header svelte-1yjlv38"><h3 class="svelte-1yjlv38">Recent Queries</h3> <button class="search-tab__btn--small svelte-1yjlv38">Clear</button></div> <ul class="search-tab__history-list svelte-1yjlv38"></ul></div>'),Oy=C('<button class="search-tab__example-btn svelte-1yjlv38"><code class="svelte-1yjlv38"> </code></button>'),Ny=C('<div class="search-tab__empty svelte-1yjlv38"><p class="svelte-1yjlv38"> No tasks match your query</p> <p class="search-tab__empty-subtitle svelte-1yjlv38">Try adjusting your search criteria</p></div>'),Ry=C('<div class="search-tab__card-wrapper svelte-1yjlv38" role="listitem"><!></div>'),Py=C(`<div class="search-tab svelte-1yjlv38"><div class="search-tab__header svelte-1yjlv38"><h2 class="search-tab__title svelte-1yjlv38">Search</h2> <p class="search-tab__subtitle svelte-1yjlv38">Use query language to filter and search tasks</p></div> <div class="search-tab__query-section svelte-1yjlv38"><div class="search-tab__input-wrapper svelte-1yjlv38"><textarea class="search-tab__input svelte-1yjlv38" placeholder="Enter query (e.g., 'not done AND priority high')..." rows="2"></textarea> <div class="search-tab__input-actions svelte-1yjlv38"><button class="search-tab__btn search-tab__btn--primary svelte-1yjlv38"> </button> <!></div></div> <!> <!></div> <!> <div class="search-tab__examples svelte-1yjlv38"><h3 class="search-tab__examples-title svelte-1yjlv38">Example Queries</h3> <div class="search-tab__examples-grid svelte-1yjlv38"></div></div> <div class="search-tab__results svelte-1yjlv38" role="list" aria-label="Search results"><!></div></div>`);function Ly(n,e){dt(e,!0);let t=K(""),s=K(xe([])),r=K(""),a=K(0),i=K(xe([])),l=K(!1),c=K(!1);const u=["not done","priority is high","due before tomorrow","not done AND priority above medium","is blocked","description includes meeting","tag includes #work","is recurring","priority is high OR priority is medium","NOT is blocked","not done AND priority is high AND description includes priority","sort by priority","sort by urgency","urgency above 80","group by priority"],d={getAllTasks:()=>e.tasks},f=Zc(qo),v=new ad(d,{urgencySettings:f}),y=new id(new tr);function _(){if(!o(t).trim()){T(s,[],!0),T(r,"");return}T(c,!0),T(r,"");try{const z=na.getInstance();if(z.isEnabled()&&z.getError())throw new Error(`Global query error: ${z.getError()}`);const E=y.compose(o(t),z.getAST()).ast,F=v.execute(E);if(T(s,F.tasks,!0),T(a,F.executionTimeMs,!0),!o(i).includes(o(t))){T(i,[o(t),...o(i)].slice(0,10),!0);try{localStorage.setItem("query-history",JSON.stringify(o(i)))}catch{}}}catch(z){T(r,z instanceof Error?z.message:String(z),!0),T(s,[],!0),G.error(`Query error: ${o(r)}`)}finally{T(c,!1)}}function m(){try{const z=localStorage.getItem("query-history");z&&T(i,JSON.parse(z),!0)}catch{}}function g(z){T(t,z,!0),_()}function b(z){T(t,z,!0),T(l,!1),_()}function x(){T(i,[],!0);try{localStorage.removeItem("query-history")}catch{}T(l,!1)}function D(z){z.key==="Enter"&&!z.shiftKey&&(z.preventDefault(),_())}xt(()=>{m()});let A=K(0),I=xe([]);xt(()=>{o(A)>=o(s).length&&T(A,Math.max(0,o(s).length-1),!0)});function N(z,E){z.key==="ArrowDown"?(z.preventDefault(),T(A,Math.min(o(A)+1,o(s).length-1),!0)):z.key==="ArrowUp"?(z.preventDefault(),T(A,Math.max(o(A)-1,0),!0)):z.key==="Enter"&&e.onEdit?(z.preventDefault(),e.onEdit(o(s)[E])):z.key===" "&&e.onDone&&(z.preventDefault(),e.onDone(o(s)[E]))}var P=Py(),H=p(h(P),2),j=h(H),Z=h(j);Z.__keydown=D;var ae=p(Z,2),re=h(ae);re.__click=_;var de=h(re),V=p(re,2);{var U=z=>{var E=Ey();E.__click=()=>T(l,!o(l));var F=h(E);$(()=>R(F,`History (${o(i).length??""})`)),S(z,E)};W(V,z=>{o(i).length>0&&z(U)})}var O=p(j,2);{var M=z=>{var E=Ay(),F=h(E);$(()=>R(F,` ${o(r)??""}`)),S(z,E)};W(O,z=>{o(r)&&z(M)})}var B=p(O,2);{var se=z=>{var E=Cy(),F=h(E);$(X=>R(F,`Found ${o(s).length??""} task${o(s).length!==1?"s":""} in ${X??""}ms`),[()=>o(a).toFixed(2)]),S(z,E)};W(B,z=>{o(a)>0&&!o(r)&&z(se)})}var ee=p(H,2);{var me=z=>{var E=Iy(),F=h(E),X=p(h(F),2);X.__click=x;var ie=p(F,2);je(ie,21,()=>o(i),pt,(L,q)=>{var te=My(),pe=h(te);pe.__click=()=>b(o(q));var ke=h(pe);$(()=>R(ke,o(q))),S(L,te)}),S(z,E)};W(ee,z=>{o(l)&&o(i).length>0&&z(me)})}var he=p(ee,2),fe=p(h(he),2);je(fe,21,()=>u,pt,(z,E)=>{var F=Oy();F.__click=()=>g(o(E));var X=h(F),ie=h(X);$(()=>R(ie,o(E))),S(z,F)});var De=p(he,2),Se=h(De);{var Fe=z=>{var E=Ny();S(z,E)},ve=z=>{var E=ut(),F=Qe(E);{var X=ie=>{var L=ut(),q=Qe(L);je(q,19,()=>o(s),te=>te.id,(te,pe,ke)=>{var ye=Ry();ye.__keydown=Ae=>N(Ae,o(ke));var Ee=h(ye);qr(Ee,{get task(){return o(pe)},get onEdit(){return e.onEdit},get onDone(){return e.onDone},get onDelete(){return e.onDelete}}),Ps(ye,(Ae,Ke)=>I[Ke]=Ae,Ae=>I==null?void 0:I[Ae],()=>[o(ke)]),$(()=>Ne(ye,"tabindex",o(ke)===o(A)?0:-1)),Lt("focus",ye,()=>T(A,o(ke),!0)),S(te,ye)}),S(ie,L)};W(F,ie=>{o(s).length>0&&ie(X)},!0)}S(z,E)};W(Se,z=>{o(s).length===0&&o(t).trim()&&!o(r)?z(Fe):z(ve,!1)})}$(()=>{re.disabled=o(c),R(de,o(c)?"Searching...":"Search")}),it(Z,()=>o(t),z=>T(t,z)),S(n,P),ht()}bt(["keydown","click"]);class qy{analyzeCompletionPatterns(e){if(!e.completionHistory||e.completionHistory.length===0)return this.getDefaultInsight();const t=e.completionHistory,s=new ac,r=this.calculateAverageDelay(t),a=s.calculateOptimalTime(t),i=s.findWeekdayPatterns(t),l=Array.from(i.keys()).filter(y=>{const _=i.get(y);return _&&_.confidence>.5}),c=this.calculateConsistencyScore(t),u=(e.completionCount||0)+(e.missCount||0),d=u>0?(e.missCount||0)/u*100:0,f=this.generateSuggestion(r,a,l,c),v=this.calculateConfidence(t.length,c,a.confidence);return{averageCompletionDelay:r,preferredTimeOfDay:a.hour,preferredDayOfWeek:l,completionConsistency:c,missedTaskFrequency:d,suggestedAdjustment:f,confidence:v}}suggestScheduleOptimization(e){const t=this.analyzeCompletionPatterns(e);if(t.confidence<.5||!e.completionHistory||e.completionHistory.length<10)return null;const s=e.frequency,r={...s};let a="",i="";if(Math.abs(t.averageCompletionDelay)>60&&(a=`You typically complete this task around ${t.preferredTimeOfDay}:00, `,a+=t.averageCompletionDelay>0?`${Math.round(t.averageCompletionDelay/60)} hours later than scheduled.`:`${Math.round(Math.abs(t.averageCompletionDelay)/60)} hours earlier than scheduled.`,i="Better alignment with your natural completion patterns"),s.type==="weekly"&&t.preferredDayOfWeek.length>0){const l=s.weekdays||[],c=t.preferredDayOfWeek;JSON.stringify(l.sort())!==JSON.stringify(c.sort())&&(r.weekdays=c,a+=` Consider scheduling for ${this.formatWeekdays(c)} based on completion patterns.`,i="Higher completion rate on preferred days")}return a?{currentSchedule:{frequency:s,time:this.extractTimeFromDueAt(e.dueAt)},suggestedSchedule:{frequency:r,time:t.preferredTimeOfDay!==void 0?`${t.preferredTimeOfDay.toString().padStart(2,"0")}:00`:void 0},reason:a,confidence:t.confidence,expectedImprovement:i}:null}autoAdjustSchedule(e,t=.7){var a;if(!((a=e.smartRecurrence)!=null&&a.autoAdjust))return!1;const s=this.suggestScheduleOptimization(e);if(!s||s.confidence<t)return!1;if(e.frequency=s.suggestedSchedule.frequency,s.suggestedSchedule.time){const i=new Date(e.dueAt),[l,c]=s.suggestedSchedule.time.split(":").map(Number);i.setHours(l,c||0,0,0),e.dueAt=i.toISOString()}e.learningMetrics||(e.learningMetrics={averageDelayMinutes:0,optimalHour:0,consistencyScore:0,lastLearningUpdate:new Date().toISOString()});const r=this.analyzeCompletionPatterns(e);return e.learningMetrics.averageDelayMinutes=r.averageCompletionDelay,e.learningMetrics.optimalHour=r.preferredTimeOfDay,e.learningMetrics.consistencyScore=r.completionConsistency,e.learningMetrics.lastLearningUpdate=new Date().toISOString(),!0}detectAnomalies(e){const t=[];if(!e.completionHistory||e.completionHistory.length<5)return t;const r=new ac().detectSkipPatterns(e);r.isAnomalous&&t.push({type:"consistently_skipped",severity:"high",description:r.reason,affectedPeriod:{start:e.createdAt,end:new Date().toISOString()},suggestion:"Consider adjusting the recurrence frequency or disabling this task"});const a=this.detectCompletionDrift(e.completionHistory);return a.isDrifting&&t.push({type:"completion_drift",severity:a.severity,description:`Completion times are drifting ${a.direction} by an average of ${a.averageDriftMinutes} minutes`,affectedPeriod:{start:e.completionHistory[0].completedAt,end:e.completionHistory[e.completionHistory.length-1].completedAt},suggestion:"Consider adjusting the scheduled time to match your natural completion pattern"}),t}getDefaultInsight(){return{averageCompletionDelay:0,preferredTimeOfDay:9,preferredDayOfWeek:[],completionConsistency:0,missedTaskFrequency:0,suggestedAdjustment:"Not enough data to generate insights (need at least 10 completions)",confidence:0}}calculateAverageDelay(e){if(e.length===0)return 0;const t=e.reduce((s,r)=>s+r.delayMinutes,0);return Math.round(t/e.length)}calculateConsistencyScore(e){if(e.length<2)return 0;const t=this.calculateAverageDelay(e),s=e.reduce((i,l)=>{const c=l.delayMinutes-t;return i+c*c},0)/e.length,r=Math.sqrt(s),a=Math.max(0,1-r/240);return Math.round(a*100)/100}generateSuggestion(e,t,s,r){if(r<.3)return"Completion patterns are inconsistent. Try to complete tasks at similar times.";const a=[];if(Math.abs(e)>60){const i=Math.round(Math.abs(e)/60);e>0?a.push(`Consider scheduling ${i} hour(s) later (around ${t.hour}:00)`):a.push(`Consider scheduling ${i} hour(s) earlier (around ${t.hour}:00)`)}return s.length>0&&t.confidence>.6&&a.push(`Best completion rate on ${this.formatWeekdays(s)}`),a.length>0?a.join(". "):"Maintaining good completion consistency!"}calculateConfidence(e,t,s){const a=Math.min(1,e/30)*.4+t*.3+s*.3;return Math.round(a*100)/100}extractTimeFromDueAt(e){const t=new Date(e);return`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`}formatWeekdays(e){const t=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];return e.map(s=>t[s]).join(", ")}detectCompletionDrift(e){if(e.length<10)return{isDrifting:!1,direction:"later",averageDriftMinutes:0,severity:"low"};const s=e.slice(-10).map(f=>f.delayMinutes);let r=0,a=0,i=0,l=0;const c=s.length;for(let f=0;f<c;f++)r+=f,a+=s[f],i+=f*s[f],l+=f*f;const u=(c*i-r*a)/(c*l-r*r),d=Math.abs(u);if(d>5){const f=d>30?"high":d>15?"medium":"low";return{isDrifting:!0,direction:u>0?"later":"earlier",averageDriftMinutes:Math.round(d),severity:f}}return{isDrifting:!1,direction:"later",averageDriftMinutes:0,severity:"low"}}}class ac{calculateOptimalTime(e){if(e.length===0)return{hour:9,confidence:0,sampleSize:0};const t=new Map;for(const i of e){const l=new Date(i.completedAt).getHours();t.set(l,(t.get(l)||0)+1)}let s=9,r=0;for(const[i,l]of t.entries())l>r&&(r=l,s=i);const a=r/e.length;return{hour:s,confidence:Math.round(a*100)/100,sampleSize:e.length}}findWeekdayPatterns(e){const t=new Map,s=new Map;for(const r of e){const a=r.dayOfWeek;s.has(a)||s.set(a,[]),s.get(a).push(r)}for(const[r,a]of s.entries()){const i=this.calculateOptimalTime(a);a.length>=2&&t.set(r,i)}return t}detectSkipPatterns(e){const t=(e.completionCount||0)+(e.missCount||0),s=t>0?(e.missCount||0)/t:0;return s>.5&&t>=10?{isAnomalous:!0,reason:`Task is skipped ${Math.round(s*100)}% of the time (${e.missCount} out of ${t})`}:(e.missCount||0)>=5&&e.currentStreak===0?{isAnomalous:!0,reason:"Task has been skipped multiple times recently"}:{isAnomalous:!1,reason:""}}}var Fy=C('<div class="empty-state svelte-14xzl1l"><svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="svelte-14xzl1l"><path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg> <h3 class="svelte-14xzl1l">No Smart Tasks Yet</h3> <p>Enable smart recurrence on your tasks and complete them at least 5 times to see insights.</p></div>'),Uy=C('<div class="suggestion-box svelte-14xzl1l"><div class="suggestion-icon svelte-14xzl1l"></div> <p class="svelte-14xzl1l"> </p></div>'),zy=C('<div class="schedule-suggestion svelte-14xzl1l"><h4 class="svelte-14xzl1l">Suggested Schedule Adjustment</h4> <div class="schedule-comparison svelte-14xzl1l"><div class="schedule-column svelte-14xzl1l"><span class="schedule-label svelte-14xzl1l">Current</span> <span class="schedule-value svelte-14xzl1l"> </span></div> <div class="schedule-arrow svelte-14xzl1l"></div> <div class="schedule-column svelte-14xzl1l"><span class="schedule-label svelte-14xzl1l">Suggested</span> <span class="schedule-value svelte-14xzl1l"> </span></div></div> <p class="suggestion-reason svelte-14xzl1l"> </p> <p class="suggestion-improvement svelte-14xzl1l"> </p> <button class="apply-btn svelte-14xzl1l">Apply Suggestion</button></div>'),By=C('<div class="anomaly-card svelte-14xzl1l"><div class="anomaly-header svelte-14xzl1l"><span class="anomaly-type svelte-14xzl1l"> </span> <span class="anomaly-severity svelte-14xzl1l"> </span></div> <p class="anomaly-description svelte-14xzl1l"> </p> <p class="anomaly-suggestion svelte-14xzl1l"> </p></div>'),Yy=C('<div class="anomalies-section svelte-14xzl1l"><h4 class="svelte-14xzl1l"> Detected Issues</h4> <!></div>'),$y=C('<span class="history-label svelte-14xzl1l"> </span>'),jy=C('<div class="history-summary svelte-14xzl1l"><span class="history-label svelte-14xzl1l"> </span> <!></div>'),Wy=C('<div class="insight-card svelte-14xzl1l"><div class="insight-header svelte-14xzl1l"><h3 class="svelte-14xzl1l"> </h3> <div class="confidence-badge svelte-14xzl1l"> </div></div> <div class="insight-stats svelte-14xzl1l"><div class="stat-item svelte-14xzl1l"><span class="stat-label svelte-14xzl1l">Consistency</span> <span class="stat-value svelte-14xzl1l"> </span></div> <div class="stat-item svelte-14xzl1l"><span class="stat-label svelte-14xzl1l">Avg Delay</span> <span class="stat-value svelte-14xzl1l"> </span></div> <div class="stat-item svelte-14xzl1l"><span class="stat-label svelte-14xzl1l">Preferred Time</span> <span class="stat-value svelte-14xzl1l"> </span></div> <div class="stat-item svelte-14xzl1l"><span class="stat-label svelte-14xzl1l">Completion Rate</span> <span class="stat-value svelte-14xzl1l"> </span></div></div> <!> <!> <!> <!></div>'),Hy=C('<div class="insights-list svelte-14xzl1l"></div>'),Gy=C('<div class="insights-tab svelte-14xzl1l"><div class="insights-header svelte-14xzl1l"><h2 class="svelte-14xzl1l">Smart Insights</h2> <p class="svelte-14xzl1l">Learn from your task completion patterns to optimize your schedule</p></div> <!></div>');function Ky(n,e){dt(e,!0);const t=new qy,s=Q(()=>e.tasks.filter(g=>{var b;return((b=g.smartRecurrence)==null?void 0:b.enabled)&&g.completionHistory&&g.completionHistory.length>=5})),r=Q(()=>o(s).map(g=>({task:g,insight:t.analyzeCompletionPatterns(g),suggestion:t.suggestScheduleOptimization(g),anomalies:t.detectAnomalies(g)}))),a=Q(()=>o(r).sort((g,b)=>b.insight.confidence-g.insight.confidence));function i(g,b){var x;(x=e.onApplySuggestion)==null||x.call(e,g,b)}function l(g){if(Math.abs(g)<60)return`${Math.abs(g)} minutes`;const b=Math.abs(Math.round(g/60));return`${b} hour${b!==1?"s":""}`}function c(g){const b=g>=12?"PM":"AM";return`${g>12?g-12:g===0?12:g}:00 ${b}`}function u(g){return g>=.8?"Excellent":g>=.6?"Good":g>=.4?"Fair":"Inconsistent"}function d(g){return g>=.8?"#4caf50":g>=.6?"#2196f3":g>=.4?"#ff9800":"#f44336"}function f(g){switch(g){case"low":return"#ff9800";case"medium":return"#ff5722";case"high":return"#f44336"}}var v=Gy(),y=p(h(v),2);{var _=g=>{var b=Fy();S(g,b)},m=g=>{var b=Hy();je(b,21,()=>o(a),pt,(x,D)=>{let A=()=>o(D).task,I=()=>o(D).insight,N=()=>o(D).suggestion,P=()=>o(D).anomalies;var H=Wy(),j=h(H),Z=h(j),ae=h(Z),re=p(Z,2),de=h(re),V=p(j,2),U=h(V),O=p(h(U),2),M=h(O),B=p(U,2),se=p(h(B),2),ee=h(se),me=p(B,2),he=p(h(me),2),fe=h(he),De=p(me,2),Se=p(h(De),2),Fe=h(Se),ve=p(V,2);{var z=te=>{var pe=Uy(),ke=p(h(pe),2),ye=h(ke);$(()=>R(ye,I().suggestedAdjustment)),S(te,pe)};W(ve,te=>{I().suggestedAdjustment&&te(z)})}var E=p(ve,2);{var F=te=>{var pe=zy(),ke=p(h(pe),2),ye=h(ke),Ee=p(h(ye),2),Ae=h(Ee),Ke=p(ye,4),tt=p(h(Ke),2),Ze=h(tt),lt=p(ke,2),ft=h(lt),Me=p(lt,2),Le=h(Me),Ce=p(Me,2);Ce.__click=()=>i(A(),N()),$(()=>{R(Ae,N().currentSchedule.time||"Not set"),R(Ze,N().suggestedSchedule.time||"Not set"),R(ft,N().reason),R(Le,`Expected: ${N().expectedImprovement??""}`)}),S(te,pe)};W(E,te=>{N()&&te(F)})}var X=p(E,2);{var ie=te=>{var pe=Yy(),ke=p(h(pe),2);je(ke,17,P,pt,(ye,Ee)=>{var Ae=By(),Ke=h(Ae),tt=h(Ke),Ze=h(tt),lt=p(tt,2),ft=h(lt),Me=p(Ke,2),Le=h(Me),Ce=p(Me,2),Ue=h(Ce);$((We,ze,ct)=>{Rs(Ae,`border-left-color: ${We??""}`),R(Ze,ze),Rs(lt,`background-color: ${ct??""}`),R(ft,o(Ee).severity),R(Le,o(Ee).description),R(Ue,` ${o(Ee).suggestion??""}`)},[()=>f(o(Ee).severity),()=>o(Ee).type.replace(/_/g," "),()=>f(o(Ee).severity)]),S(ye,Ae)}),S(te,pe)};W(X,te=>{P().length>0&&te(ie)})}var L=p(X,2);{var q=te=>{var pe=jy(),ke=h(pe),ye=h(ke),Ee=p(ke,2);{var Ae=Ke=>{var tt=$y(),Ze=h(tt);$(lt=>R(Ze,`Last updated: ${lt??""}`),[()=>new Date(A().learningMetrics.lastLearningUpdate).toLocaleDateString()]),S(Ke,tt)};W(Ee,Ke=>{A().learningMetrics&&Ke(Ae)})}$(()=>R(ye,` ${A().completionHistory.length??""} completions tracked`)),S(te,pe)};W(L,te=>{A().completionHistory&&A().completionHistory.length>0&&te(q)})}$((te,pe,ke,ye,Ee,Ae,Ke)=>{R(ae,A().name),Rs(re,`background-color: ${te??""}`),R(de,`${pe??""}% confidence`),Rs(O,`color: ${ke??""}`),R(M,ye),R(ee,`${I().averageCompletionDelay>0?"+":""}${Ee??""}`),R(fe,Ae),R(Fe,`${Ke??""}%`)},[()=>d(I().confidence),()=>Math.round(I().confidence*100),()=>d(I().completionConsistency),()=>u(I().completionConsistency),()=>l(I().averageCompletionDelay),()=>c(I().preferredTimeOfDay),()=>Math.round(100-I().missedTaskFrequency)]),S(x,H)}),S(g,b)};W(y,g=>{o(s).length===0?g(_):g(m,!1)})}S(n,v),ht()}bt(["click"]);var eo=["MO","TU","WE","TH","FR","SA","SU"],Vt=function(){function n(e,t){if(t===0)throw new Error("Can't create weekday with n == 0");this.weekday=e,this.n=t}return n.fromStr=function(e){return new n(eo.indexOf(e))},n.prototype.nth=function(e){return this.n===e?this:new n(this.weekday,e)},n.prototype.equals=function(e){return this.weekday===e.weekday&&this.n===e.n},n.prototype.toString=function(){var e=eo[this.weekday];return this.n&&(e=(this.n>0?"+":"")+String(this.n)+e),e},n.prototype.getJsWeekday=function(){return this.weekday===6?0:this.weekday+1},n}(),mt=function(n){return n!=null},Ls=function(n){return typeof n=="number"},ic=function(n){return typeof n=="string"&&eo.includes(n)},ds=Array.isArray,Gs=function(n,e){e===void 0&&(e=n),arguments.length===1&&(e=n,n=0);for(var t=[],s=n;s<e;s++)t.push(s);return t},Be=function(n,e){var t=0,s=[];if(ds(n))for(;t<e;t++)s[t]=[].concat(n);else for(;t<e;t++)s[t]=n;return s},Vy=function(n){return ds(n)?n:[n]};function vr(n,e,t){t===void 0&&(t=" ");var s=String(n);return e=e>>0,s.length>e?String(s):(e=e-s.length,e>t.length&&(t+=Be(t,e/t.length)),t.slice(0,e)+String(s))}var Qy=function(n,e,t){var s=n.split(e);return t?s.slice(0,t).concat([s.slice(t).join(e)]):s},xs=function(n,e){var t=n%e;return t*e<0?t+e:t},Ai=function(n,e){return{div:Math.floor(n/e),mod:xs(n,e)}},$s=function(n){return!mt(n)||n.length===0},At=function(n){return!$s(n)},Je=function(n,e){return At(n)&&n.indexOf(e)!==-1},rr=function(n,e,t,s,r,a){return s===void 0&&(s=0),r===void 0&&(r=0),a===void 0&&(a=0),new Date(Date.UTC(n,e-1,t,s,r,a))},Zy=[31,28,31,30,31,30,31,31,30,31,30,31],ld=1e3*60*60*24,cd=9999,ud=rr(1970,1,1),Xy=[6,0,1,2,3,4,5],Xr=function(n){return n%4===0&&n%100!==0||n%400===0},dd=function(n){return n instanceof Date},Gr=function(n){return dd(n)&&!isNaN(n.getTime())},Jy=function(n,e){var t=n.getTime(),s=e.getTime(),r=t-s;return Math.round(r/ld)},to=function(n){return Jy(n,ud)},hd=function(n){return new Date(ud.getTime()+n*ld)},eb=function(n){var e=n.getUTCMonth();return e===1&&Xr(n.getUTCFullYear())?29:Zy[e]},Rr=function(n){return Xy[n.getUTCDay()]},oc=function(n,e){var t=rr(n,e+1,1);return[Rr(t),eb(t)]},fd=function(n,e){return e=e||n,new Date(Date.UTC(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()))},so=function(n){var e=new Date(n.getTime());return e},lc=function(n){for(var e=[],t=0;t<n.length;t++)e.push(so(n[t]));return e},ra=function(n){n.sort(function(e,t){return e.getTime()-t.getTime()})},Yo=function(n,e){e===void 0&&(e=!0);var t=new Date(n);return[vr(t.getUTCFullYear().toString(),4,"0"),vr(t.getUTCMonth()+1,2,"0"),vr(t.getUTCDate(),2,"0"),"T",vr(t.getUTCHours(),2,"0"),vr(t.getUTCMinutes(),2,"0"),vr(t.getUTCSeconds(),2,"0"),e?"Z":""].join("")},$o=function(n){var e=/^(\d{4})(\d{2})(\d{2})(T(\d{2})(\d{2})(\d{2})Z?)?$/,t=e.exec(n);if(!t)throw new Error("Invalid UNTIL value: ".concat(n));return new Date(Date.UTC(parseInt(t[1],10),parseInt(t[2],10)-1,parseInt(t[3],10),parseInt(t[5],10)||0,parseInt(t[6],10)||0,parseInt(t[7],10)||0))},cc=function(n,e){var t=n.toLocaleString("sv-SE",{timeZone:e});return t.replace(" ","T")+"Z"},tb=function(n,e){var t=Intl.DateTimeFormat().resolvedOptions().timeZone,s=new Date(cc(n,t)),r=new Date(cc(n,e??"UTC")),a=r.getTime()-s.getTime();return new Date(n.getTime()-a)},br=function(){function n(e,t){this.minDate=null,this.maxDate=null,this._result=[],this.total=0,this.method=e,this.args=t,e==="between"?(this.maxDate=t.inc?t.before:new Date(t.before.getTime()-1),this.minDate=t.inc?t.after:new Date(t.after.getTime()+1)):e==="before"?this.maxDate=t.inc?t.dt:new Date(t.dt.getTime()-1):e==="after"&&(this.minDate=t.inc?t.dt:new Date(t.dt.getTime()+1))}return n.prototype.accept=function(e){++this.total;var t=this.minDate&&e<this.minDate,s=this.maxDate&&e>this.maxDate;if(this.method==="between"){if(t)return!0;if(s)return!1}else if(this.method==="before"){if(s)return!1}else if(this.method==="after")return t?!0:(this.add(e),!1);return this.add(e)},n.prototype.add=function(e){return this._result.push(e),!0},n.prototype.getValue=function(){var e=this._result;switch(this.method){case"all":case"between":return e;case"before":case"after":default:return e.length?e[e.length-1]:null}},n.prototype.clone=function(){return new n(this.method,this.args)},n}(),no=function(n,e){return no=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,s){t.__proto__=s}||function(t,s){for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(t[r]=s[r])},no(n,e)};function jo(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");no(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var fs=function(){return fs=Object.assign||function(e){for(var t,s=1,r=arguments.length;s<r;s++){t=arguments[s];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},fs.apply(this,arguments)};function J(n,e,t){if(t||arguments.length===2)for(var s=0,r=e.length,a;s<r;s++)(a||!(s in e))&&(a||(a=Array.prototype.slice.call(e,0,s)),a[s]=e[s]);return n.concat(a||Array.prototype.slice.call(e))}var uc=function(n){jo(e,n);function e(t,s,r){var a=n.call(this,t,s)||this;return a.iterator=r,a}return e.prototype.add=function(t){return this.iterator(t,this._result.length)?(this._result.push(t),!0):!1},e}(br),ja={dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],tokens:{SKIP:/^[ \r\n\t]+|^\.$/,number:/^[1-9][0-9]*/,numberAsText:/^(one|two|three)/i,every:/^every/i,"day(s)":/^days?/i,"weekday(s)":/^weekdays?/i,"week(s)":/^weeks?/i,"hour(s)":/^hours?/i,"minute(s)":/^minutes?/i,"month(s)":/^months?/i,"year(s)":/^years?/i,on:/^(on|in)/i,at:/^(at)/i,the:/^the/i,first:/^first/i,second:/^second/i,third:/^third/i,nth:/^([1-9][0-9]*)(\.|th|nd|rd|st)/i,last:/^last/i,for:/^for/i,"time(s)":/^times?/i,until:/^(un)?til/i,monday:/^mo(n(day)?)?/i,tuesday:/^tu(e(s(day)?)?)?/i,wednesday:/^we(d(n(esday)?)?)?/i,thursday:/^th(u(r(sday)?)?)?/i,friday:/^fr(i(day)?)?/i,saturday:/^sa(t(urday)?)?/i,sunday:/^su(n(day)?)?/i,january:/^jan(uary)?/i,february:/^feb(ruary)?/i,march:/^mar(ch)?/i,april:/^apr(il)?/i,may:/^may/i,june:/^june?/i,july:/^july?/i,august:/^aug(ust)?/i,september:/^sep(t(ember)?)?/i,october:/^oct(ober)?/i,november:/^nov(ember)?/i,december:/^dec(ember)?/i,comma:/^(,\s*|(and|or)\s*)+/i}},dc=function(n,e){return n.indexOf(e)!==-1},sb=function(n){return n.toString()},nb=function(n,e,t){return"".concat(e," ").concat(t,", ").concat(n)},un=function(){function n(e,t,s,r){if(t===void 0&&(t=sb),s===void 0&&(s=ja),r===void 0&&(r=nb),this.text=[],this.language=s||ja,this.gettext=t,this.dateFormatter=r,this.rrule=e,this.options=e.options,this.origOptions=e.origOptions,this.origOptions.bymonthday){var a=[].concat(this.options.bymonthday),i=[].concat(this.options.bynmonthday);a.sort(function(d,f){return d-f}),i.sort(function(d,f){return f-d}),this.bymonthday=a.concat(i),this.bymonthday.length||(this.bymonthday=null)}if(mt(this.origOptions.byweekday)){var l=ds(this.origOptions.byweekday)?this.origOptions.byweekday:[this.origOptions.byweekday],c=String(l);this.byweekday={allWeeks:l.filter(function(d){return!d.n}),someWeeks:l.filter(function(d){return!!d.n}),isWeekdays:c.indexOf("MO")!==-1&&c.indexOf("TU")!==-1&&c.indexOf("WE")!==-1&&c.indexOf("TH")!==-1&&c.indexOf("FR")!==-1&&c.indexOf("SA")===-1&&c.indexOf("SU")===-1,isEveryDay:c.indexOf("MO")!==-1&&c.indexOf("TU")!==-1&&c.indexOf("WE")!==-1&&c.indexOf("TH")!==-1&&c.indexOf("FR")!==-1&&c.indexOf("SA")!==-1&&c.indexOf("SU")!==-1};var u=function(d,f){return d.weekday-f.weekday};this.byweekday.allWeeks.sort(u),this.byweekday.someWeeks.sort(u),this.byweekday.allWeeks.length||(this.byweekday.allWeeks=null),this.byweekday.someWeeks.length||(this.byweekday.someWeeks=null)}else this.byweekday=null}return n.isFullyConvertible=function(e){var t=!0;if(!(e.options.freq in n.IMPLEMENTED)||e.origOptions.until&&e.origOptions.count)return!1;for(var s in e.origOptions){if(dc(["dtstart","tzid","wkst","freq"],s))return!0;if(!dc(n.IMPLEMENTED[e.options.freq],s))return!1}return t},n.prototype.isFullyConvertible=function(){return n.isFullyConvertible(this.rrule)},n.prototype.toString=function(){var e=this.gettext;if(!(this.options.freq in n.IMPLEMENTED))return e("RRule error: Unable to fully convert this rrule to text");if(this.text=[e("every")],this[oe.FREQUENCIES[this.options.freq]](),this.options.until){this.add(e("until"));var t=this.options.until;this.add(this.dateFormatter(t.getUTCFullYear(),this.language.monthNames[t.getUTCMonth()],t.getUTCDate()))}else this.options.count&&this.add(e("for")).add(this.options.count.toString()).add(this.plural(this.options.count)?e("times"):e("time"));return this.isFullyConvertible()||this.add(e("(~ approximate)")),this.text.join("")},n.prototype.HOURLY=function(){var e=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?e("hours"):e("hour"))},n.prototype.MINUTELY=function(){var e=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?e("minutes"):e("minute"))},n.prototype.DAILY=function(){var e=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()),this.byweekday&&this.byweekday.isWeekdays?this.add(this.plural(this.options.interval)?e("weekdays"):e("weekday")):this.add(this.plural(this.options.interval)?e("days"):e("day")),this.origOptions.bymonth&&(this.add(e("in")),this._bymonth()),this.bymonthday?this._bymonthday():this.byweekday?this._byweekday():this.origOptions.byhour&&this._byhour()},n.prototype.WEEKLY=function(){var e=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()).add(this.plural(this.options.interval)?e("weeks"):e("week")),this.byweekday&&this.byweekday.isWeekdays?this.options.interval===1?this.add(this.plural(this.options.interval)?e("weekdays"):e("weekday")):this.add(e("on")).add(e("weekdays")):this.byweekday&&this.byweekday.isEveryDay?this.add(this.plural(this.options.interval)?e("days"):e("day")):(this.options.interval===1&&this.add(e("week")),this.origOptions.bymonth&&(this.add(e("in")),this._bymonth()),this.bymonthday?this._bymonthday():this.byweekday&&this._byweekday(),this.origOptions.byhour&&this._byhour())},n.prototype.MONTHLY=function(){var e=this.gettext;this.origOptions.bymonth?(this.options.interval!==1&&(this.add(this.options.interval.toString()).add(e("months")),this.plural(this.options.interval)&&this.add(e("in"))),this._bymonth()):(this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?e("months"):e("month"))),this.bymonthday?this._bymonthday():this.byweekday&&this.byweekday.isWeekdays?this.add(e("on")).add(e("weekdays")):this.byweekday&&this._byweekday()},n.prototype.YEARLY=function(){var e=this.gettext;this.origOptions.bymonth?(this.options.interval!==1&&(this.add(this.options.interval.toString()),this.add(e("years"))),this._bymonth()):(this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?e("years"):e("year"))),this.bymonthday?this._bymonthday():this.byweekday&&this._byweekday(),this.options.byyearday&&this.add(e("on the")).add(this.list(this.options.byyearday,this.nth,e("and"))).add(e("day")),this.options.byweekno&&this.add(e("in")).add(this.plural(this.options.byweekno.length)?e("weeks"):e("week")).add(this.list(this.options.byweekno,void 0,e("and")))},n.prototype._bymonthday=function(){var e=this.gettext;this.byweekday&&this.byweekday.allWeeks?this.add(e("on")).add(this.list(this.byweekday.allWeeks,this.weekdaytext,e("or"))).add(e("the")).add(this.list(this.bymonthday,this.nth,e("or"))):this.add(e("on the")).add(this.list(this.bymonthday,this.nth,e("and")))},n.prototype._byweekday=function(){var e=this.gettext;this.byweekday.allWeeks&&!this.byweekday.isWeekdays&&this.add(e("on")).add(this.list(this.byweekday.allWeeks,this.weekdaytext)),this.byweekday.someWeeks&&(this.byweekday.allWeeks&&this.add(e("and")),this.add(e("on the")).add(this.list(this.byweekday.someWeeks,this.weekdaytext,e("and"))))},n.prototype._byhour=function(){var e=this.gettext;this.add(e("at")).add(this.list(this.origOptions.byhour,void 0,e("and")))},n.prototype._bymonth=function(){this.add(this.list(this.options.bymonth,this.monthtext,this.gettext("and")))},n.prototype.nth=function(e){e=parseInt(e.toString(),10);var t,s=this.gettext;if(e===-1)return s("last");var r=Math.abs(e);switch(r){case 1:case 21:case 31:t=r+s("st");break;case 2:case 22:t=r+s("nd");break;case 3:case 23:t=r+s("rd");break;default:t=r+s("th")}return e<0?t+" "+s("last"):t},n.prototype.monthtext=function(e){return this.language.monthNames[e-1]},n.prototype.weekdaytext=function(e){var t=Ls(e)?(e+1)%7:e.getJsWeekday();return(e.n?this.nth(e.n)+" ":"")+this.language.dayNames[t]},n.prototype.plural=function(e){return e%100!==1},n.prototype.add=function(e){return this.text.push(" "),this.text.push(e),this},n.prototype.list=function(e,t,s,r){var a=this;r===void 0&&(r=","),ds(e)||(e=[e]);var i=function(c,u,d){for(var f="",v=0;v<c.length;v++)v!==0&&(v===c.length-1?f+=" "+d+" ":f+=u+" "),f+=c[v];return f};t=t||function(c){return c.toString()};var l=function(c){return t&&t.call(a,c)};return s?i(e.map(l),r,s):e.map(l).join(r+" ")},n}(),rb=function(){function n(e){this.done=!0,this.rules=e}return n.prototype.start=function(e){return this.text=e,this.done=!1,this.nextSymbol()},n.prototype.isDone=function(){return this.done&&this.symbol===null},n.prototype.nextSymbol=function(){var e,t;this.symbol=null,this.value=null;do{if(this.done)return!1;var s=void 0;e=null;for(var r in this.rules){s=this.rules[r];var a=s.exec(this.text);a&&(e===null||a[0].length>e[0].length)&&(e=a,t=r)}if(e!=null&&(this.text=this.text.substr(e[0].length),this.text===""&&(this.done=!0)),e==null){this.done=!0,this.symbol=null,this.value=null;return}}while(t==="SKIP");return this.symbol=t,this.value=e,!0},n.prototype.accept=function(e){if(this.symbol===e){if(this.value){var t=this.value;return this.nextSymbol(),t}return this.nextSymbol(),!0}return!1},n.prototype.acceptNumber=function(){return this.accept("number")},n.prototype.expect=function(e){if(this.accept(e))return!0;throw new Error("expected "+e+" but found "+this.symbol)},n}();function vd(n,e){e===void 0&&(e=ja);var t={},s=new rb(e.tokens);if(!s.start(n))return null;return r(),t;function r(){s.expect("every");var v=s.acceptNumber();if(v&&(t.interval=parseInt(v[0],10)),s.isDone())throw new Error("Unexpected end");switch(s.symbol){case"day(s)":t.freq=oe.DAILY,s.nextSymbol()&&(i(),f());break;case"weekday(s)":t.freq=oe.WEEKLY,t.byweekday=[oe.MO,oe.TU,oe.WE,oe.TH,oe.FR],s.nextSymbol(),i(),f();break;case"week(s)":t.freq=oe.WEEKLY,s.nextSymbol()&&(a(),i(),f());break;case"hour(s)":t.freq=oe.HOURLY,s.nextSymbol()&&(a(),f());break;case"minute(s)":t.freq=oe.MINUTELY,s.nextSymbol()&&(a(),f());break;case"month(s)":t.freq=oe.MONTHLY,s.nextSymbol()&&(a(),f());break;case"year(s)":t.freq=oe.YEARLY,s.nextSymbol()&&(a(),f());break;case"monday":case"tuesday":case"wednesday":case"thursday":case"friday":case"saturday":case"sunday":t.freq=oe.WEEKLY;var y=s.symbol.substr(0,2).toUpperCase();if(t.byweekday=[oe[y]],!s.nextSymbol())return;for(;s.accept("comma");){if(s.isDone())throw new Error("Unexpected end");var _=c();if(!_)throw new Error("Unexpected symbol "+s.symbol+", expected weekday");t.byweekday.push(oe[_]),s.nextSymbol()}i(),d(),f();break;case"january":case"february":case"march":case"april":case"may":case"june":case"july":case"august":case"september":case"october":case"november":case"december":if(t.freq=oe.YEARLY,t.bymonth=[l()],!s.nextSymbol())return;for(;s.accept("comma");){if(s.isDone())throw new Error("Unexpected end");var m=l();if(!m)throw new Error("Unexpected symbol "+s.symbol+", expected month");t.bymonth.push(m),s.nextSymbol()}a(),f();break;default:throw new Error("Unknown symbol")}}function a(){var v=s.accept("on"),y=s.accept("the");if(v||y)do{var _=u(),m=c(),g=l();if(_)m?(s.nextSymbol(),t.byweekday||(t.byweekday=[]),t.byweekday.push(oe[m].nth(_))):(t.bymonthday||(t.bymonthday=[]),t.bymonthday.push(_),s.accept("day(s)"));else if(m)s.nextSymbol(),t.byweekday||(t.byweekday=[]),t.byweekday.push(oe[m]);else if(s.symbol==="weekday(s)")s.nextSymbol(),t.byweekday||(t.byweekday=[oe.MO,oe.TU,oe.WE,oe.TH,oe.FR]);else if(s.symbol==="week(s)"){s.nextSymbol();var b=s.acceptNumber();if(!b)throw new Error("Unexpected symbol "+s.symbol+", expected week number");for(t.byweekno=[parseInt(b[0],10)];s.accept("comma");){if(b=s.acceptNumber(),!b)throw new Error("Unexpected symbol "+s.symbol+"; expected monthday");t.byweekno.push(parseInt(b[0],10))}}else if(g)s.nextSymbol(),t.bymonth||(t.bymonth=[]),t.bymonth.push(g);else return}while(s.accept("comma")||s.accept("the")||s.accept("on"))}function i(){var v=s.accept("at");if(v)do{var y=s.acceptNumber();if(!y)throw new Error("Unexpected symbol "+s.symbol+", expected hour");for(t.byhour=[parseInt(y[0],10)];s.accept("comma");){if(y=s.acceptNumber(),!y)throw new Error("Unexpected symbol "+s.symbol+"; expected hour");t.byhour.push(parseInt(y[0],10))}}while(s.accept("comma")||s.accept("at"))}function l(){switch(s.symbol){case"january":return 1;case"february":return 2;case"march":return 3;case"april":return 4;case"may":return 5;case"june":return 6;case"july":return 7;case"august":return 8;case"september":return 9;case"october":return 10;case"november":return 11;case"december":return 12;default:return!1}}function c(){switch(s.symbol){case"monday":case"tuesday":case"wednesday":case"thursday":case"friday":case"saturday":case"sunday":return s.symbol.substr(0,2).toUpperCase();default:return!1}}function u(){switch(s.symbol){case"last":return s.nextSymbol(),-1;case"first":return s.nextSymbol(),1;case"second":return s.nextSymbol(),s.accept("last")?-2:2;case"third":return s.nextSymbol(),s.accept("last")?-3:3;case"nth":var v=parseInt(s.value[1],10);if(v<-366||v>366)throw new Error("Nth out of range: "+v);return s.nextSymbol(),s.accept("last")?-v:v;default:return!1}}function d(){s.accept("on"),s.accept("the");var v=u();if(v)for(t.bymonthday=[v],s.nextSymbol();s.accept("comma");){if(v=u(),!v)throw new Error("Unexpected symbol "+s.symbol+"; expected monthday");t.bymonthday.push(v),s.nextSymbol()}}function f(){if(s.symbol==="until"){var v=Date.parse(s.text);if(!v)throw new Error("Cannot parse until date:"+s.text);t.until=new Date(v)}else s.accept("for")&&(t.count=parseInt(s.value[0],10),s.expect("number"))}}var $e;(function(n){n[n.YEARLY=0]="YEARLY",n[n.MONTHLY=1]="MONTHLY",n[n.WEEKLY=2]="WEEKLY",n[n.DAILY=3]="DAILY",n[n.HOURLY=4]="HOURLY",n[n.MINUTELY=5]="MINUTELY",n[n.SECONDLY=6]="SECONDLY"})($e||($e={}));function Wo(n){return n<$e.HOURLY}var ab=function(n,e){return e===void 0&&(e=ja),new oe(vd(n,e)||void 0)},zr=["count","until","interval","byweekday","bymonthday","bymonth"];un.IMPLEMENTED=[];un.IMPLEMENTED[$e.HOURLY]=zr;un.IMPLEMENTED[$e.MINUTELY]=zr;un.IMPLEMENTED[$e.DAILY]=["byhour"].concat(zr);un.IMPLEMENTED[$e.WEEKLY]=zr;un.IMPLEMENTED[$e.MONTHLY]=zr;un.IMPLEMENTED[$e.YEARLY]=["byweekno","byyearday"].concat(zr);var ib=function(n,e,t,s){return new un(n,e,t,s).toString()},ob=un.isFullyConvertible,Wa=function(){function n(e,t,s,r){this.hour=e,this.minute=t,this.second=s,this.millisecond=r||0}return n.prototype.getHours=function(){return this.hour},n.prototype.getMinutes=function(){return this.minute},n.prototype.getSeconds=function(){return this.second},n.prototype.getMilliseconds=function(){return this.millisecond},n.prototype.getTime=function(){return(this.hour*60*60+this.minute*60+this.second)*1e3+this.millisecond},n}(),lb=function(n){jo(e,n);function e(t,s,r,a,i,l,c){var u=n.call(this,a,i,l,c)||this;return u.year=t,u.month=s,u.day=r,u}return e.fromDate=function(t){return new this(t.getUTCFullYear(),t.getUTCMonth()+1,t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.valueOf()%1e3)},e.prototype.getWeekday=function(){return Rr(new Date(this.getTime()))},e.prototype.getTime=function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond)).getTime()},e.prototype.getDay=function(){return this.day},e.prototype.getMonth=function(){return this.month},e.prototype.getYear=function(){return this.year},e.prototype.addYears=function(t){this.year+=t},e.prototype.addMonths=function(t){if(this.month+=t,this.month>12){var s=Math.floor(this.month/12),r=xs(this.month,12);this.month=r,this.year+=s,this.month===0&&(this.month=12,--this.year)}},e.prototype.addWeekly=function(t,s){s>this.getWeekday()?this.day+=-(this.getWeekday()+1+(6-s))+t*7:this.day+=-(this.getWeekday()-s)+t*7,this.fixDay()},e.prototype.addDaily=function(t){this.day+=t,this.fixDay()},e.prototype.addHours=function(t,s,r){for(s&&(this.hour+=Math.floor((23-this.hour)/t)*t);;){this.hour+=t;var a=Ai(this.hour,24),i=a.div,l=a.mod;if(i&&(this.hour=l,this.addDaily(i)),$s(r)||Je(r,this.hour))break}},e.prototype.addMinutes=function(t,s,r,a){for(s&&(this.minute+=Math.floor((1439-(this.hour*60+this.minute))/t)*t);;){this.minute+=t;var i=Ai(this.minute,60),l=i.div,c=i.mod;if(l&&(this.minute=c,this.addHours(l,!1,r)),($s(r)||Je(r,this.hour))&&($s(a)||Je(a,this.minute)))break}},e.prototype.addSeconds=function(t,s,r,a,i){for(s&&(this.second+=Math.floor((86399-(this.hour*3600+this.minute*60+this.second))/t)*t);;){this.second+=t;var l=Ai(this.second,60),c=l.div,u=l.mod;if(c&&(this.second=u,this.addMinutes(c,!1,r,a)),($s(r)||Je(r,this.hour))&&($s(a)||Je(a,this.minute))&&($s(i)||Je(i,this.second)))break}},e.prototype.fixDay=function(){if(!(this.day<=28)){var t=oc(this.year,this.month-1)[1];if(!(this.day<=t))for(;this.day>t;){if(this.day-=t,++this.month,this.month===13&&(this.month=1,++this.year,this.year>cd))return;t=oc(this.year,this.month-1)[1]}}},e.prototype.add=function(t,s){var r=t.freq,a=t.interval,i=t.wkst,l=t.byhour,c=t.byminute,u=t.bysecond;switch(r){case $e.YEARLY:return this.addYears(a);case $e.MONTHLY:return this.addMonths(a);case $e.WEEKLY:return this.addWeekly(a,i);case $e.DAILY:return this.addDaily(a);case $e.HOURLY:return this.addHours(a,s,l);case $e.MINUTELY:return this.addMinutes(a,s,l,c);case $e.SECONDLY:return this.addSeconds(a,s,l,c,u)}},e}(Wa);function pd(n){for(var e=[],t=Object.keys(n),s=0,r=t;s<r.length;s++){var a=r[s];Je(Fb,a)||e.push(a),dd(n[a])&&!Gr(n[a])&&e.push(a)}if(e.length)throw new Error("Invalid options: "+e.join(", "));return fs({},n)}function cb(n){var e=fs(fs({},Ho),pd(n));if(mt(e.byeaster)&&(e.freq=oe.YEARLY),!(mt(e.freq)&&oe.FREQUENCIES[e.freq]))throw new Error("Invalid frequency: ".concat(e.freq," ").concat(n.freq));if(e.dtstart||(e.dtstart=new Date(new Date().setMilliseconds(0))),mt(e.wkst)?Ls(e.wkst)||(e.wkst=e.wkst.weekday):e.wkst=oe.MO.weekday,mt(e.bysetpos)){Ls(e.bysetpos)&&(e.bysetpos=[e.bysetpos]);for(var t=0;t<e.bysetpos.length;t++){var s=e.bysetpos[t];if(s===0||!(s>=-366&&s<=366))throw new Error("bysetpos must be between 1 and 366, or between -366 and -1")}}if(!(e.byweekno||At(e.byweekno)||At(e.byyearday)||e.bymonthday||At(e.bymonthday)||mt(e.byweekday)||mt(e.byeaster)))switch(e.freq){case oe.YEARLY:e.bymonth||(e.bymonth=e.dtstart.getUTCMonth()+1),e.bymonthday=e.dtstart.getUTCDate();break;case oe.MONTHLY:e.bymonthday=e.dtstart.getUTCDate();break;case oe.WEEKLY:e.byweekday=[Rr(e.dtstart)];break}if(mt(e.bymonth)&&!ds(e.bymonth)&&(e.bymonth=[e.bymonth]),mt(e.byyearday)&&!ds(e.byyearday)&&Ls(e.byyearday)&&(e.byyearday=[e.byyearday]),!mt(e.bymonthday))e.bymonthday=[],e.bynmonthday=[];else if(ds(e.bymonthday)){for(var r=[],a=[],t=0;t<e.bymonthday.length;t++){var s=e.bymonthday[t];s>0?r.push(s):s<0&&a.push(s)}e.bymonthday=r,e.bynmonthday=a}else e.bymonthday<0?(e.bynmonthday=[e.bymonthday],e.bymonthday=[]):(e.bynmonthday=[],e.bymonthday=[e.bymonthday]);if(mt(e.byweekno)&&!ds(e.byweekno)&&(e.byweekno=[e.byweekno]),!mt(e.byweekday))e.bynweekday=null;else if(Ls(e.byweekday))e.byweekday=[e.byweekday],e.bynweekday=null;else if(ic(e.byweekday))e.byweekday=[Vt.fromStr(e.byweekday).weekday],e.bynweekday=null;else if(e.byweekday instanceof Vt)!e.byweekday.n||e.freq>oe.MONTHLY?(e.byweekday=[e.byweekday.weekday],e.bynweekday=null):(e.bynweekday=[[e.byweekday.weekday,e.byweekday.n]],e.byweekday=null);else{for(var i=[],l=[],t=0;t<e.byweekday.length;t++){var c=e.byweekday[t];if(Ls(c)){i.push(c);continue}else if(ic(c)){i.push(Vt.fromStr(c).weekday);continue}!c.n||e.freq>oe.MONTHLY?i.push(c.weekday):l.push([c.weekday,c.n])}e.byweekday=At(i)?i:null,e.bynweekday=At(l)?l:null}return mt(e.byhour)?Ls(e.byhour)&&(e.byhour=[e.byhour]):e.byhour=e.freq<oe.HOURLY?[e.dtstart.getUTCHours()]:null,mt(e.byminute)?Ls(e.byminute)&&(e.byminute=[e.byminute]):e.byminute=e.freq<oe.MINUTELY?[e.dtstart.getUTCMinutes()]:null,mt(e.bysecond)?Ls(e.bysecond)&&(e.bysecond=[e.bysecond]):e.bysecond=e.freq<oe.SECONDLY?[e.dtstart.getUTCSeconds()]:null,{parsedOptions:e}}function ub(n){var e=n.dtstart.getTime()%1e3;if(!Wo(n.freq))return[];var t=[];return n.byhour.forEach(function(s){n.byminute.forEach(function(r){n.bysecond.forEach(function(a){t.push(new Wa(s,r,a,e))})})}),t}function ro(n){var e=n.split(`
`).map(db).filter(function(t){return t!==null});return fs(fs({},e[0]),e[1])}function Ha(n){var e={},t=/DTSTART(?:;TZID=([^:=]+?))?(?::|=)([^;\s]+)/i.exec(n);if(!t)return e;var s=t[1],r=t[2];return s&&(e.tzid=s),e.dtstart=$o(r),e}function db(n){if(n=n.replace(/^\s+|\s+$/,""),!n.length)return null;var e=/^([A-Z]+?)[:;]/.exec(n.toUpperCase());if(!e)return hc(n);var t=e[1];switch(t.toUpperCase()){case"RRULE":case"EXRULE":return hc(n);case"DTSTART":return Ha(n);default:throw new Error("Unsupported RFC prop ".concat(t," in ").concat(n))}}function hc(n){var e=n.replace(/^RRULE:/i,""),t=Ha(e),s=n.replace(/^(?:RRULE|EXRULE):/i,"").split(";");return s.forEach(function(r){var a=r.split("="),i=a[0],l=a[1];switch(i.toUpperCase()){case"FREQ":t.freq=$e[l.toUpperCase()];break;case"WKST":t.wkst=Os[l.toUpperCase()];break;case"COUNT":case"INTERVAL":case"BYSETPOS":case"BYMONTH":case"BYMONTHDAY":case"BYYEARDAY":case"BYWEEKNO":case"BYHOUR":case"BYMINUTE":case"BYSECOND":var c=hb(l),u=i.toLowerCase();t[u]=c;break;case"BYWEEKDAY":case"BYDAY":t.byweekday=fb(l);break;case"DTSTART":case"TZID":var d=Ha(n);t.tzid=d.tzid,t.dtstart=d.dtstart;break;case"UNTIL":t.until=$o(l);break;case"BYEASTER":t.byeaster=Number(l);break;default:throw new Error("Unknown RRULE property '"+i+"'")}}),t}function hb(n){if(n.indexOf(",")!==-1){var e=n.split(",");return e.map(fc)}return fc(n)}function fc(n){return/^[+-]?\d+$/.test(n)?Number(n):n}function fb(n){var e=n.split(",");return e.map(function(t){if(t.length===2)return Os[t];var s=t.match(/^([+-]?\d{1,2})([A-Z]{2})$/);if(!s||s.length<3)throw new SyntaxError("Invalid weekday string: ".concat(t));var r=Number(s[1]),a=s[2],i=Os[a].weekday;return new Vt(i,r)})}var Ga=function(){function n(e,t){if(isNaN(e.getTime()))throw new RangeError("Invalid date passed to DateWithZone");this.date=e,this.tzid=t}return Object.defineProperty(n.prototype,"isUTC",{get:function(){return!this.tzid||this.tzid.toUpperCase()==="UTC"},enumerable:!1,configurable:!0}),n.prototype.toString=function(){var e=Yo(this.date.getTime(),this.isUTC);return this.isUTC?":".concat(e):";TZID=".concat(this.tzid,":").concat(e)},n.prototype.getTime=function(){return this.date.getTime()},n.prototype.rezonedDate=function(){return this.isUTC?this.date:tb(this.date,this.tzid)},n}();function ao(n){for(var e=[],t="",s=Object.keys(n),r=Object.keys(Ho),a=0;a<s.length;a++)if(s[a]!=="tzid"&&Je(r,s[a])){var i=s[a].toUpperCase(),l=n[s[a]],c="";if(!(!mt(l)||ds(l)&&!l.length)){switch(i){case"FREQ":c=oe.FREQUENCIES[n.freq];break;case"WKST":Ls(l)?c=new Vt(l).toString():c=l.toString();break;case"BYWEEKDAY":i="BYDAY",c=Vy(l).map(function(y){return y instanceof Vt?y:ds(y)?new Vt(y[0],y[1]):new Vt(y)}).toString();break;case"DTSTART":t=vb(l,n.tzid);break;case"UNTIL":c=Yo(l,!n.tzid);break;default:if(ds(l)){for(var u=[],d=0;d<l.length;d++)u[d]=String(l[d]);c=u.toString()}else c=String(l)}c&&e.push([i,c])}}var f=e.map(function(y){var _=y[0],m=y[1];return"".concat(_,"=").concat(m.toString())}).join(";"),v="";return f!==""&&(v="RRULE:".concat(f)),[t,v].filter(function(y){return!!y}).join(`
`)}function vb(n,e){return n?"DTSTART"+new Ga(new Date(n),e).toString():""}function pb(n,e){return Array.isArray(n)?!Array.isArray(e)||n.length!==e.length?!1:n.every(function(t,s){return t.getTime()===e[s].getTime()}):n instanceof Date?e instanceof Date&&n.getTime()===e.getTime():n===e}var gb=function(){function n(){this.all=!1,this.before=[],this.after=[],this.between=[]}return n.prototype._cacheAdd=function(e,t,s){t&&(t=t instanceof Date?so(t):lc(t)),e==="all"?this.all=t:(s._value=t,this[e].push(s))},n.prototype._cacheGet=function(e,t){var s=!1,r=t?Object.keys(t):[],a=function(d){for(var f=0;f<r.length;f++){var v=r[f];if(!pb(t[v],d[v]))return!0}return!1},i=this[e];if(e==="all")s=this.all;else if(ds(i))for(var l=0;l<i.length;l++){var c=i[l];if(!(r.length&&a(c))){s=c._value;break}}if(!s&&this.all){for(var u=new br(e,t),l=0;l<this.all.length&&u.accept(this.all[l]);l++);s=u.getValue(),this._cacheAdd(e,s,t)}return ds(s)?lc(s):s instanceof Date?so(s):s},n}(),mb=J(J(J(J(J(J(J(J(J(J(J(J(J([],Be(1,31),!0),Be(2,28),!0),Be(3,31),!0),Be(4,30),!0),Be(5,31),!0),Be(6,30),!0),Be(7,31),!0),Be(8,31),!0),Be(9,30),!0),Be(10,31),!0),Be(11,30),!0),Be(12,31),!0),Be(1,7),!0),yb=J(J(J(J(J(J(J(J(J(J(J(J(J([],Be(1,31),!0),Be(2,29),!0),Be(3,31),!0),Be(4,30),!0),Be(5,31),!0),Be(6,30),!0),Be(7,31),!0),Be(8,31),!0),Be(9,30),!0),Be(10,31),!0),Be(11,30),!0),Be(12,31),!0),Be(1,7),!0),bb=Gs(1,29),wb=Gs(1,30),Sn=Gs(1,31),Bt=Gs(1,32),_b=J(J(J(J(J(J(J(J(J(J(J(J(J([],Bt,!0),wb,!0),Bt,!0),Sn,!0),Bt,!0),Sn,!0),Bt,!0),Bt,!0),Sn,!0),Bt,!0),Sn,!0),Bt,!0),Bt.slice(0,7),!0),kb=J(J(J(J(J(J(J(J(J(J(J(J(J([],Bt,!0),bb,!0),Bt,!0),Sn,!0),Bt,!0),Sn,!0),Bt,!0),Bt,!0),Sn,!0),Bt,!0),Sn,!0),Bt,!0),Bt.slice(0,7),!0),Tb=Gs(-28,0),Sb=Gs(-29,0),xn=Gs(-30,0),Yt=Gs(-31,0),xb=J(J(J(J(J(J(J(J(J(J(J(J(J([],Yt,!0),Sb,!0),Yt,!0),xn,!0),Yt,!0),xn,!0),Yt,!0),Yt,!0),xn,!0),Yt,!0),xn,!0),Yt,!0),Yt.slice(0,7),!0),Db=J(J(J(J(J(J(J(J(J(J(J(J(J([],Yt,!0),Tb,!0),Yt,!0),xn,!0),Yt,!0),xn,!0),Yt,!0),Yt,!0),xn,!0),Yt,!0),xn,!0),Yt,!0),Yt.slice(0,7),!0),Eb=[0,31,60,91,121,152,182,213,244,274,305,335,366],Ab=[0,31,59,90,120,151,181,212,243,273,304,334,365],vc=function(){for(var n=[],e=0;e<55;e++)n=n.concat(Gs(7));return n}();function Cb(n,e){var t=rr(n,1,1),s=Xr(n)?366:365,r=Xr(n+1)?366:365,a=to(t),i=Rr(t),l=fs(fs({yearlen:s,nextyearlen:r,yearordinal:a,yearweekday:i},Mb(n)),{wnomask:null});if($s(e.byweekno))return l;l.wnomask=Be(0,s+7);var c,u,d=c=xs(7-i+e.wkst,7);d>=4?(d=0,u=l.yearlen+xs(i-e.wkst,7)):u=s-d;for(var f=Math.floor(u/7),v=xs(u,7),y=Math.floor(f+v/4),_=0;_<e.byweekno.length;_++){var m=e.byweekno[_];if(m<0&&(m+=y+1),m>0&&m<=y){var g=void 0;m>1?(g=d+(m-1)*7,d!==c&&(g-=7-c)):g=d;for(var b=0;b<7&&(l.wnomask[g]=1,g++,l.wdaymask[g]!==e.wkst);b++);}}if(Je(e.byweekno,1)){var g=d+y*7;if(d!==c&&(g-=7-c),g<s)for(var _=0;_<7&&(l.wnomask[g]=1,g+=1,l.wdaymask[g]!==e.wkst);_++);}if(d){var x=void 0;if(Je(e.byweekno,-1))x=-1;else{var D=Rr(rr(n-1,1,1)),A=xs(7-D.valueOf()+e.wkst,7),I=Xr(n-1)?366:365,N=void 0;A>=4?(A=0,N=I+xs(D-e.wkst,7)):N=s-d,x=Math.floor(52+xs(N,7)/4)}if(Je(e.byweekno,x))for(var g=0;g<d;g++)l.wnomask[g]=1}return l}function Mb(n){var e=Xr(n)?366:365,t=rr(n,1,1),s=Rr(t);return e===365?{mmask:mb,mdaymask:kb,nmdaymask:Db,wdaymask:vc.slice(s),mrange:Ab}:{mmask:yb,mdaymask:_b,nmdaymask:xb,wdaymask:vc.slice(s),mrange:Eb}}function Ib(n,e,t,s,r,a){var i={lastyear:n,lastmonth:e,nwdaymask:[]},l=[];if(a.freq===oe.YEARLY)if($s(a.bymonth))l=[[0,t]];else for(var c=0;c<a.bymonth.length;c++)e=a.bymonth[c],l.push(s.slice(e-1,e+1));else a.freq===oe.MONTHLY&&(l=[s.slice(e-1,e+1)]);if($s(l))return i;i.nwdaymask=Be(0,t);for(var c=0;c<l.length;c++)for(var u=l[c],d=u[0],f=u[1]-1,v=0;v<a.bynweekday.length;v++){var y=void 0,_=a.bynweekday[v],m=_[0],g=_[1];g<0?(y=f+(g+1)*7,y-=xs(r[y]-m,7)):(y=d+(g-1)*7,y+=xs(7-r[y]+m,7)),d<=y&&y<=f&&(i.nwdaymask[y]=1)}return i}function Ob(n,e){e===void 0&&(e=0);var t=n%19,s=Math.floor(n/100),r=n%100,a=Math.floor(s/4),i=s%4,l=Math.floor((s+8)/25),c=Math.floor((s-l+1)/3),u=Math.floor(19*t+s-a-c+15)%30,d=Math.floor(r/4),f=r%4,v=Math.floor(32+2*i+2*d-u-f)%7,y=Math.floor((t+11*u+22*v)/451),_=Math.floor((u+v-7*y+114)/31),m=(u+v-7*y+114)%31+1,g=Date.UTC(n,_-1,m+e),b=Date.UTC(n,0,1);return[Math.ceil((g-b)/(1e3*60*60*24))]}var Nb=function(){function n(e){this.options=e}return n.prototype.rebuild=function(e,t){var s=this.options;if(e!==this.lastyear&&(this.yearinfo=Cb(e,s)),At(s.bynweekday)&&(t!==this.lastmonth||e!==this.lastyear)){var r=this.yearinfo,a=r.yearlen,i=r.mrange,l=r.wdaymask;this.monthinfo=Ib(e,t,a,i,l,s)}mt(s.byeaster)&&(this.eastermask=Ob(e,s.byeaster))},Object.defineProperty(n.prototype,"lastyear",{get:function(){return this.monthinfo?this.monthinfo.lastyear:null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"lastmonth",{get:function(){return this.monthinfo?this.monthinfo.lastmonth:null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"yearlen",{get:function(){return this.yearinfo.yearlen},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"yearordinal",{get:function(){return this.yearinfo.yearordinal},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"mrange",{get:function(){return this.yearinfo.mrange},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"wdaymask",{get:function(){return this.yearinfo.wdaymask},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"mmask",{get:function(){return this.yearinfo.mmask},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"wnomask",{get:function(){return this.yearinfo.wnomask},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"nwdaymask",{get:function(){return this.monthinfo?this.monthinfo.nwdaymask:[]},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"nextyearlen",{get:function(){return this.yearinfo.nextyearlen},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"mdaymask",{get:function(){return this.yearinfo.mdaymask},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"nmdaymask",{get:function(){return this.yearinfo.nmdaymask},enumerable:!1,configurable:!0}),n.prototype.ydayset=function(){return[Gs(this.yearlen),0,this.yearlen]},n.prototype.mdayset=function(e,t){for(var s=this.mrange[t-1],r=this.mrange[t],a=Be(null,this.yearlen),i=s;i<r;i++)a[i]=i;return[a,s,r]},n.prototype.wdayset=function(e,t,s){for(var r=Be(null,this.yearlen+7),a=to(rr(e,t,s))-this.yearordinal,i=a,l=0;l<7&&(r[a]=a,++a,this.wdaymask[a]!==this.options.wkst);l++);return[r,i,a]},n.prototype.ddayset=function(e,t,s){var r=Be(null,this.yearlen),a=to(rr(e,t,s))-this.yearordinal;return r[a]=a,[r,a,a+1]},n.prototype.htimeset=function(e,t,s,r){var a=this,i=[];return this.options.byminute.forEach(function(l){i=i.concat(a.mtimeset(e,l,s,r))}),ra(i),i},n.prototype.mtimeset=function(e,t,s,r){var a=this.options.bysecond.map(function(i){return new Wa(e,t,i,r)});return ra(a),a},n.prototype.stimeset=function(e,t,s,r){return[new Wa(e,t,s,r)]},n.prototype.getdayset=function(e){switch(e){case $e.YEARLY:return this.ydayset.bind(this);case $e.MONTHLY:return this.mdayset.bind(this);case $e.WEEKLY:return this.wdayset.bind(this);case $e.DAILY:return this.ddayset.bind(this);default:return this.ddayset.bind(this)}},n.prototype.gettimeset=function(e){switch(e){case $e.HOURLY:return this.htimeset.bind(this);case $e.MINUTELY:return this.mtimeset.bind(this);case $e.SECONDLY:return this.stimeset.bind(this)}},n}();function Rb(n,e,t,s,r,a){for(var i=[],l=0;l<n.length;l++){var c=void 0,u=void 0,d=n[l];d<0?(c=Math.floor(d/e.length),u=xs(d,e.length)):(c=Math.floor((d-1)/e.length),u=xs(d-1,e.length));for(var f=[],v=t;v<s;v++){var y=a[v];mt(y)&&f.push(y)}var _=void 0;c<0?_=f.slice(c)[0]:_=f[c];var m=e[u],g=hd(r.yearordinal+_),b=fd(g,m);Je(i,b)||i.push(b)}return ra(i),i}function gd(n,e){var t=e.dtstart,s=e.freq,r=e.interval,a=e.until,i=e.bysetpos,l=e.count;if(l===0||r===0)return Ks(n);var c=lb.fromDate(t),u=new Nb(e);u.rebuild(c.year,c.month);for(var d=qb(u,c,e);;){var f=u.getdayset(s)(c.year,c.month,c.day),v=f[0],y=f[1],_=f[2],m=Lb(v,y,_,u,e);if(At(i))for(var g=Rb(i,d,y,_,u,v),b=0;b<g.length;b++){var x=g[b];if(a&&x>a)return Ks(n);if(x>=t){var D=pc(x,e);if(!n.accept(D)||l&&(--l,!l))return Ks(n)}}else for(var b=y;b<_;b++){var A=v[b];if(mt(A))for(var I=hd(u.yearordinal+A),N=0;N<d.length;N++){var P=d[N],x=fd(I,P);if(a&&x>a)return Ks(n);if(x>=t){var D=pc(x,e);if(!n.accept(D)||l&&(--l,!l))return Ks(n)}}}if(e.interval===0||(c.add(e,m),c.year>cd))return Ks(n);Wo(s)||(d=u.gettimeset(s)(c.hour,c.minute,c.second,0)),u.rebuild(c.year,c.month)}}function Pb(n,e,t){var s=t.bymonth,r=t.byweekno,a=t.byweekday,i=t.byeaster,l=t.bymonthday,c=t.bynmonthday,u=t.byyearday;return At(s)&&!Je(s,n.mmask[e])||At(r)&&!n.wnomask[e]||At(a)&&!Je(a,n.wdaymask[e])||At(n.nwdaymask)&&!n.nwdaymask[e]||i!==null&&!Je(n.eastermask,e)||(At(l)||At(c))&&!Je(l,n.mdaymask[e])&&!Je(c,n.nmdaymask[e])||At(u)&&(e<n.yearlen&&!Je(u,e+1)&&!Je(u,-n.yearlen+e)||e>=n.yearlen&&!Je(u,e+1-n.yearlen)&&!Je(u,-n.nextyearlen+e-n.yearlen))}function pc(n,e){return new Ga(n,e.tzid).rezonedDate()}function Ks(n){return n.getValue()}function Lb(n,e,t,s,r){for(var a=!1,i=e;i<t;i++){var l=n[i];a=Pb(s,l,r),a&&(n[l]=null)}return a}function qb(n,e,t){var s=t.freq,r=t.byhour,a=t.byminute,i=t.bysecond;return Wo(s)?ub(t):s>=oe.HOURLY&&At(r)&&!Je(r,e.hour)||s>=oe.MINUTELY&&At(a)&&!Je(a,e.minute)||s>=oe.SECONDLY&&At(i)&&!Je(i,e.second)?[]:n.gettimeset(s)(e.hour,e.minute,e.second,e.millisecond)}var Os={MO:new Vt(0),TU:new Vt(1),WE:new Vt(2),TH:new Vt(3),FR:new Vt(4),SA:new Vt(5),SU:new Vt(6)},Ho={freq:$e.YEARLY,dtstart:null,interval:1,wkst:Os.MO,count:null,until:null,tzid:null,bysetpos:null,bymonth:null,bymonthday:null,bynmonthday:null,byyearday:null,byweekno:null,byweekday:null,bynweekday:null,byhour:null,byminute:null,bysecond:null,byeaster:null},Fb=Object.keys(Ho),oe=function(){function n(e,t){e===void 0&&(e={}),t===void 0&&(t=!1),this._cache=t?null:new gb,this.origOptions=pd(e);var s=cb(e).parsedOptions;this.options=s}return n.parseText=function(e,t){return vd(e,t)},n.fromText=function(e,t){return ab(e,t)},n.fromString=function(e){return new n(n.parseString(e)||void 0)},n.prototype._iter=function(e){return gd(e,this.options)},n.prototype._cacheGet=function(e,t){return this._cache?this._cache._cacheGet(e,t):!1},n.prototype._cacheAdd=function(e,t,s){if(this._cache)return this._cache._cacheAdd(e,t,s)},n.prototype.all=function(e){if(e)return this._iter(new uc("all",{},e));var t=this._cacheGet("all");return t===!1&&(t=this._iter(new br("all",{})),this._cacheAdd("all",t)),t},n.prototype.between=function(e,t,s,r){if(s===void 0&&(s=!1),!Gr(e)||!Gr(t))throw new Error("Invalid date passed in to RRule.between");var a={before:t,after:e,inc:s};if(r)return this._iter(new uc("between",a,r));var i=this._cacheGet("between",a);return i===!1&&(i=this._iter(new br("between",a)),this._cacheAdd("between",i,a)),i},n.prototype.before=function(e,t){if(t===void 0&&(t=!1),!Gr(e))throw new Error("Invalid date passed in to RRule.before");var s={dt:e,inc:t},r=this._cacheGet("before",s);return r===!1&&(r=this._iter(new br("before",s)),this._cacheAdd("before",r,s)),r},n.prototype.after=function(e,t){if(t===void 0&&(t=!1),!Gr(e))throw new Error("Invalid date passed in to RRule.after");var s={dt:e,inc:t},r=this._cacheGet("after",s);return r===!1&&(r=this._iter(new br("after",s)),this._cacheAdd("after",r,s)),r},n.prototype.count=function(){return this.all().length},n.prototype.toString=function(){return ao(this.origOptions)},n.prototype.toText=function(e,t,s){return ib(this,e,t,s)},n.prototype.isFullyConvertibleToText=function(){return ob(this)},n.prototype.clone=function(){return new n(this.origOptions)},n.FREQUENCIES=["YEARLY","MONTHLY","WEEKLY","DAILY","HOURLY","MINUTELY","SECONDLY"],n.YEARLY=$e.YEARLY,n.MONTHLY=$e.MONTHLY,n.WEEKLY=$e.WEEKLY,n.DAILY=$e.DAILY,n.HOURLY=$e.HOURLY,n.MINUTELY=$e.MINUTELY,n.SECONDLY=$e.SECONDLY,n.MO=Os.MO,n.TU=Os.TU,n.WE=Os.WE,n.TH=Os.TH,n.FR=Os.FR,n.SA=Os.SA,n.SU=Os.SU,n.parseString=ro,n.optionsToString=ao,n}();function Ub(n,e,t,s,r,a){var i={},l=n.accept;function c(v,y){t.forEach(function(_){_.between(v,y,!0).forEach(function(m){i[Number(m)]=!0})})}r.forEach(function(v){var y=new Ga(v,a).rezonedDate();i[Number(y)]=!0}),n.accept=function(v){var y=Number(v);return isNaN(y)?l.call(this,v):!i[y]&&(c(new Date(y-1),new Date(y+1)),!i[y])?(i[y]=!0,l.call(this,v)):!0},n.method==="between"&&(c(n.args.after,n.args.before),n.accept=function(v){var y=Number(v);return i[y]?!0:(i[y]=!0,l.call(this,v))});for(var u=0;u<s.length;u++){var d=new Ga(s[u],a).rezonedDate();if(!n.accept(new Date(d.getTime())))break}e.forEach(function(v){gd(n,v.options)});var f=n._result;switch(ra(f),n.method){case"all":case"between":return f;case"before":return f.length&&f[f.length-1]||null;case"after":default:return f.length&&f[0]||null}}var gc={dtstart:null,cache:!1,unfold:!1,forceset:!1,compatible:!1,tzid:null};function zb(n,e){var t=[],s=[],r=[],a=[],i=Ha(n),l=i.dtstart,c=i.tzid,u=Wb(n,e.unfold);return u.forEach(function(d){var f;if(d){var v=jb(d),y=v.name,_=v.parms,m=v.value;switch(y.toUpperCase()){case"RRULE":if(_.length)throw new Error("unsupported RRULE parm: ".concat(_.join(",")));t.push(ro(d));break;case"RDATE":var g=(f=/RDATE(?:;TZID=([^:=]+))?/i.exec(d))!==null&&f!==void 0?f:[],b=g[1];b&&!c&&(c=b),s=s.concat(mc(m,_));break;case"EXRULE":if(_.length)throw new Error("unsupported EXRULE parm: ".concat(_.join(",")));r.push(ro(m));break;case"EXDATE":a=a.concat(mc(m,_));break;case"DTSTART":break;default:throw new Error("unsupported property: "+y)}}}),{dtstart:l,tzid:c,rrulevals:t,rdatevals:s,exrulevals:r,exdatevals:a}}function Bb(n,e){var t=zb(n,e),s=t.rrulevals,r=t.rdatevals,a=t.exrulevals,i=t.exdatevals,l=t.dtstart,c=t.tzid,u=e.cache===!1;if(e.compatible&&(e.forceset=!0,e.unfold=!0),e.forceset||s.length>1||r.length||a.length||i.length){var d=new Gb(u);return d.dtstart(l),d.tzid(c||void 0),s.forEach(function(v){d.rrule(new oe(Ci(v,l,c),u))}),r.forEach(function(v){d.rdate(v)}),a.forEach(function(v){d.exrule(new oe(Ci(v,l,c),u))}),i.forEach(function(v){d.exdate(v)}),e.compatible&&e.dtstart&&d.rdate(l),d}var f=s[0]||{};return new oe(Ci(f,f.dtstart||e.dtstart||l,f.tzid||e.tzid||c),u)}function io(n,e){return e===void 0&&(e={}),Bb(n,Yb(e))}function Ci(n,e,t){return fs(fs({},n),{dtstart:e,tzid:t})}function Yb(n){var e=[],t=Object.keys(n),s=Object.keys(gc);if(t.forEach(function(r){Je(s,r)||e.push(r)}),e.length)throw new Error("Invalid options: "+e.join(", "));return fs(fs({},gc),n)}function $b(n){if(n.indexOf(":")===-1)return{name:"RRULE",value:n};var e=Qy(n,":",1),t=e[0],s=e[1];return{name:t,value:s}}function jb(n){var e=$b(n),t=e.name,s=e.value,r=t.split(";");if(!r)throw new Error("empty property name");return{name:r[0].toUpperCase(),parms:r.slice(1),value:s}}function Wb(n,e){if(e===void 0&&(e=!1),n=n&&n.trim(),!n)throw new Error("Invalid empty string");if(!e)return n.split(/\s/);for(var t=n.split(`
`),s=0;s<t.length;){var r=t[s]=t[s].replace(/\s+$/g,"");r?s>0&&r[0]===" "?(t[s-1]+=r.slice(1),t.splice(s,1)):s+=1:t.splice(s,1)}return t}function Hb(n){n.forEach(function(e){if(!/(VALUE=DATE(-TIME)?)|(TZID=)/.test(e))throw new Error("unsupported RDATE/EXDATE parm: "+e)})}function mc(n,e){return Hb(e),n.split(",").map(function(t){return $o(t)})}function yc(n){var e=this;return function(t){if(t!==void 0&&(e["_".concat(n)]=t),e["_".concat(n)]!==void 0)return e["_".concat(n)];for(var s=0;s<e._rrule.length;s++){var r=e._rrule[s].origOptions[n];if(r)return r}}}var Gb=function(n){jo(e,n);function e(t){t===void 0&&(t=!1);var s=n.call(this,{},t)||this;return s.dtstart=yc.apply(s,["dtstart"]),s.tzid=yc.apply(s,["tzid"]),s._rrule=[],s._rdate=[],s._exrule=[],s._exdate=[],s}return e.prototype._iter=function(t){return Ub(t,this._rrule,this._exrule,this._rdate,this._exdate,this.tzid())},e.prototype.rrule=function(t){bc(t,this._rrule)},e.prototype.exrule=function(t){bc(t,this._exrule)},e.prototype.rdate=function(t){wc(t,this._rdate)},e.prototype.exdate=function(t){wc(t,this._exdate)},e.prototype.rrules=function(){return this._rrule.map(function(t){return io(t.toString())})},e.prototype.exrules=function(){return this._exrule.map(function(t){return io(t.toString())})},e.prototype.rdates=function(){return this._rdate.map(function(t){return new Date(t.getTime())})},e.prototype.exdates=function(){return this._exdate.map(function(t){return new Date(t.getTime())})},e.prototype.valueOf=function(){var t=[];return!this._rrule.length&&this._dtstart&&(t=t.concat(ao({dtstart:this._dtstart}))),this._rrule.forEach(function(s){t=t.concat(s.toString().split(`
`))}),this._exrule.forEach(function(s){t=t.concat(s.toString().split(`
`).map(function(r){return r.replace(/^RRULE:/,"EXRULE:")}).filter(function(r){return!/^DTSTART/.test(r)}))}),this._rdate.length&&t.push(_c("RDATE",this._rdate,this.tzid())),this._exdate.length&&t.push(_c("EXDATE",this._exdate,this.tzid())),t},e.prototype.toString=function(){return this.valueOf().join(`
`)},e.prototype.clone=function(){var t=new e(!!this._cache);return this._rrule.forEach(function(s){return t.rrule(s.clone())}),this._exrule.forEach(function(s){return t.exrule(s.clone())}),this._rdate.forEach(function(s){return t.rdate(new Date(s.getTime()))}),this._exdate.forEach(function(s){return t.exdate(new Date(s.getTime()))}),t},e}(oe);function bc(n,e){if(!(n instanceof oe))throw new TypeError(String(n)+" is not RRule instance");Je(e.map(String),String(n))||e.push(n)}function wc(n,e){if(!(n instanceof Date))throw new TypeError(String(n)+" is not Date instance");Je(e.map(Number),Number(n))||(e.push(n),ra(e))}function _c(n,e,t){var s=!t||t.toUpperCase()==="UTC",r=s?"".concat(n,":"):"".concat(n,";TZID=").concat(t,":"),a=e.map(function(i){return Yo(i.valueOf(),s)}).join(",");return"".concat(r).concat(a)}class oo{static parse(e){const t=e,s=e.trim().toLowerCase().replace(/\s+/g," ");if(!s)return{frequency:{type:"daily",interval:1},raw:t,isValid:!1,error:"Recurrence string cannot be empty"};const r=s.match(/^every\s+(.+)$/);if(!r)return{frequency:{type:"daily",interval:1},raw:t,isValid:!1,error:"Recurrence must start with 'every'"};let a=r[1],i;const l=a.match(/^(.+?)\s+when\s+done$/),c=a.match(/^(.+?)\s+when\s+due$/);if(l?(a=l[1],i=!0):c&&(a=c[1],i=!1),a==="weekday"||a==="weekdays"){const _=[0,1,2,3,4];return{frequency:{type:"weekly",interval:1,weekdays:_,whenDone:i,rruleString:this.buildWeeklyRRuleString(1,_),naturalLanguage:t},raw:t,isValid:!0}}if(a==="weekend"||a==="weekends"){const _=[5,6];return{frequency:{type:"weekly",interval:1,weekdays:_,whenDone:i,rruleString:this.buildWeeklyRRuleString(1,_),naturalLanguage:t},raw:t,isValid:!0}}const u=this.parseOrdinalWeekdayPattern(a);if(u.matched)return u.error||u.ordinal===void 0||u.weekday===void 0?{frequency:{type:"daily",interval:1,whenDone:i},raw:t,isValid:!1,error:u.error||"Invalid ordinal weekday pattern"}:{frequency:{type:"monthly",interval:1,dayOfMonth:1,whenDone:i,rruleString:this.buildOrdinalRRuleString(u.weekday,u.ordinal),naturalLanguage:t},raw:t,isValid:!0};const d=a.match(/^(\d+\s+)?days?$/);if(d){const _=d[1]?parseInt(d[1]):1;return{frequency:{type:"daily",interval:_,whenDone:i,rruleString:this.buildDailyRRuleString(_),naturalLanguage:t},raw:t,isValid:!0}}const f=a.match(/^(\d+\s+)?weeks?(?:\s+on\s+(.+))?$/);if(f){const _=f[1]?parseInt(f[1]):1,m=f[2];if(!m){const b=[1];return{frequency:{type:"weekly",interval:_,weekdays:b,whenDone:i,rruleString:this.buildWeeklyRRuleString(_,b),naturalLanguage:t},raw:t,isValid:!0}}const g=this.parseDayNames(m);return g.length===0?{frequency:{type:"weekly",interval:_,weekdays:[1],whenDone:i},raw:t,isValid:!1,error:"Invalid day names"}:{frequency:{type:"weekly",interval:_,weekdays:g,whenDone:i,rruleString:this.buildWeeklyRRuleString(_,g),naturalLanguage:t},raw:t,isValid:!0}}const v=a.match(/^(\d+\s+)?months?(?:\s+on\s+the\s+(\d+)(?:st|nd|rd|th)?)?$/);if(v){const _=v[1]?parseInt(v[1]):1,m=v[2]?parseInt(v[2]):1;return m<1||m>31?{frequency:{type:"monthly",interval:_,dayOfMonth:1,whenDone:i},raw:t,isValid:!1,error:"Day of month must be between 1 and 31"}:{frequency:{type:"monthly",interval:_,dayOfMonth:m,whenDone:i,rruleString:this.buildMonthlyRRuleString(_,m),naturalLanguage:t},raw:t,isValid:!0}}const y=a.match(/^(\d+\s+)?years?$/);if(y){const _=y[1]?parseInt(y[1]):1;return{frequency:{type:"yearly",interval:_,month:0,dayOfMonth:1,whenDone:i,rruleString:this.buildYearlyRRuleString(_),naturalLanguage:t},raw:t,isValid:!0}}return{frequency:{type:"daily",interval:1,whenDone:i},raw:t,isValid:!1,error:"Unrecognized recurrence pattern"}}static stringify(e){const t=this.stringifyOrdinalWeekday(e.rruleString);if(t)return e.whenDone?`${t} when done`:t;const s=e.interval;let r;switch(e.type){case"daily":r=s===1?"every day":`every ${s} days`;break;case"weekly":{const a=s===1?"week":`${s} weeks`;if(e.weekdays.length===0)r=`every ${a}`;else{const i=e.weekdays.map(l=>this.getDayName(l)).join(", ");r=`every ${a} on ${i}`}break}case"monthly":{const a=s===1?"month":`${s} months`,i=this.getDaySuffix(e.dayOfMonth);r=`every ${a} on the ${e.dayOfMonth}${i}`;break}case"yearly":{r=`every ${s===1?"year":`${s} years`}`;break}default:r="every day"}return e.whenDone?`${r} when done`:r}static parseDayNames(e){const t={monday:0,mon:0,tuesday:1,tue:1,wednesday:2,wed:2,thursday:3,thu:3,friday:4,fri:4,saturday:5,sat:5,sunday:6,sun:6},s=e.split(",").map(a=>a.trim().toLowerCase()),r=[];for(const a of s)a in t&&r.push(t[a]);return r}static parseOrdinalWeekdayPattern(e){const t=e.split(" ");if(t.length<2)return{matched:!1};const s=this.parseOrdinalToken(t[0]);if(!s.matched)return{matched:!1};if(s.error)return{matched:!0,error:s.error};const r=this.parseSingleDay(t[1]);return r===null?{matched:!0,error:"Invalid weekday name"}:t.length===2?{matched:!0,ordinal:s.value,weekday:r}:t.length===5&&t[2]==="of"&&t[3]==="the"&&t[4]==="month"?{matched:!0,ordinal:s.value,weekday:r}:{matched:!0,error:"Ordinal weekday pattern must be 'every <ordinal> <weekday>' optionally followed by 'of the month'"}}static parseOrdinalToken(e){const t={first:1,second:2,third:3,fourth:4,last:-1};if(e in t)return{matched:!0,value:t[e]};const s=e.match(/^(\d+)(st|nd|rd|th)$/);if(!s)return{matched:!1};const r=parseInt(s[1],10);return r>=1&&r<=4?{matched:!0,value:r}:{matched:!0,error:"Ordinal weekday must be first, second, third, fourth, or last"}}static parseSingleDay(e){const t={monday:0,mon:0,tuesday:1,tue:1,wednesday:2,wed:2,thursday:3,thu:3,friday:4,fri:4,saturday:5,sat:5,sunday:6,sun:6};return e in t?t[e]:null}static stringifyOrdinalWeekday(e){if(!e)return null;const t=this.parseRRuleString(e);if(!t||t.FREQ!=="MONTHLY"||!t.BYDAY||!t.BYSETPOS)return null;const s=this.fromRRuleWeekday(t.BYDAY);if(s===null)return null;const r=Number.parseInt(t.BYSETPOS,10);if(!Number.isFinite(r))return null;const a=this.ordinalWord(r);return a?`every ${a} ${this.getDayName(s)}`:null}static ordinalWord(e){switch(e){case 1:return"first";case 2:return"second";case 3:return"third";case 4:return"fourth";case-1:return"last";default:return null}}static buildOrdinalRRuleString(e,t){return`RRULE:FREQ=MONTHLY;BYDAY=${this.toRRuleWeekday(e)};BYSETPOS=${t}`}static toRRuleWeekday(e){return["MO","TU","WE","TH","FR","SA","SU"][e]||"MO"}static fromRRuleWeekday(e){const s=["MO","TU","WE","TH","FR","SA","SU"].indexOf(e);return s>=0?s:null}static parseRRuleString(e){const t=e.trim().toUpperCase(),s=t.startsWith("RRULE:")?t.slice(6):t;if(!s)return null;const r=s.split(";"),a={};for(const i of r){if(!i)continue;const[l,c]=i.split("=");if(!l||!c)return null;a[l]=c}return a}static getDayName(e){return["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"][e]||"Monday"}static getDaySuffix(e){if(e>=11&&e<=13)return"th";switch(e%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}}static buildDailyRRuleString(e){return`FREQ=DAILY;INTERVAL=${e}`}static buildWeeklyRRuleString(e,t){const s=t.map(r=>this.toRRuleWeekday(r)).join(",");return`FREQ=WEEKLY;INTERVAL=${e};BYDAY=${s}`}static buildMonthlyRRuleString(e,t){return`FREQ=MONTHLY;INTERVAL=${e};BYMONTHDAY=${t===31?-1:t}`}static buildYearlyRRuleString(e){return`FREQ=YEARLY;INTERVAL=${e}`}}var Kb=C('<label><input type="radio" name="priority" class="svelte-1w15n9q"/> <span class="priority-selector__emoji svelte-1w15n9q"> </span> <span class="priority-selector__label svelte-1w15n9q"> </span></label>'),Vb=C('<div class="priority-selector svelte-1w15n9q"></div>');function Qb(n,e){dt(e,!0);let t=rn(e,"value",15,"normal");const s=[{value:"highest",label:"Highest",emoji:"",color:"var(--b3-theme-error, #ef4444)"},{value:"high",label:"High",emoji:"",color:"#f97316"},{value:"medium",label:"Medium",emoji:"",color:"#f59e0b"},{value:"normal",label:"Normal",emoji:"",color:"#eab308"},{value:"low",label:"Low",emoji:"",color:"#22c55e"},{value:"lowest",label:"Lowest",emoji:"",color:"#64748b"}];function r(i){t(i),e.onchange(i)}var a=Vb();je(a,21,()=>s,pt,(i,l)=>{var c=Kb();let u;var d=h(c);d.__change=()=>r(o(l).value);var f=p(d,2),v=h(f),y=p(f,2),_=h(y);$(()=>{u=Xe(c,1,"priority-selector__option svelte-1w15n9q",null,u,{active:t()===o(l).value}),Rs(c,`--priority-color: ${o(l).color??""}`),Io(d,o(l).value),An(d,t()===o(l).value),R(v,o(l).emoji),R(_,o(l).label)}),S(i,c)}),S(n,a),ht()}bt(["change"]);var Zb=C('<label><input type="radio" name="status" class="svelte-v9ezc0"/> <span class="status-selector__icon svelte-v9ezc0"> </span> <span class="status-selector__label svelte-v9ezc0"> </span></label>'),Xb=C('<div class="status-selector svelte-v9ezc0"></div>');function Jb(n,e){dt(e,!0);let t=rn(e,"value",15,"todo");const s=[{value:"todo",label:"Todo",icon:"",color:"var(--b3-theme-on-surface)"},{value:"done",label:"Done",icon:"",color:"#44cc44"},{value:"cancelled",label:"Cancelled",icon:"",color:"#999"}];function r(i){t(i),e.onchange(i)}var a=Xb();je(a,21,()=>s,pt,(i,l)=>{var c=Zb();let u;var d=h(c);d.__change=()=>r(o(l).value);var f=p(d,2),v=h(f),y=p(f,2),_=h(y);$(()=>{u=Xe(c,1,"status-selector__option svelte-v9ezc0",null,u,{active:t()===o(l).value}),Rs(c,`--status-color: ${o(l).color??""}`),Io(d,o(l).value),An(d,t()===o(l).value),R(v,o(l).icon),R(_,o(l).label)}),S(i,c)}),S(n,a),ht()}bt(["change"]);var ew=C('<div class="recurrence-input__valid svelte-787fjp"> Valid recurrence pattern</div>'),tw=C('<div class="recurrence-input__error svelte-787fjp"> </div>'),sw=C('<div class="recurrence-input__feedback svelte-787fjp"><!></div>'),nw=C('<li class="svelte-787fjp"> </li>'),rw=C('<div class="recurrence-input__preview svelte-787fjp"><div class="recurrence-input__preview-title svelte-787fjp">Next occurrences:</div> <ul class="recurrence-input__preview-list svelte-787fjp"></ul></div>'),aw=C('<div class="recurrence-input svelte-787fjp"><input type="text" placeholder="e.g., every week on Monday"/> <!> <!></div>');function iw(n,e){dt(e,!0);let t=rn(e,"value",15,""),s=rn(e,"showPreview",3,!0);const r=Q(()=>oo.parse(t())),a=Q(()=>o(r).isValid),i=Q(()=>o(r).error);function l(b,x=3){const D=[],A=new Date;for(let I=0;I<x;I++){const N=new Date(A);switch(b.type){case"daily":N.setDate(A.getDate()+I*b.interval);break;case"weekly":N.setDate(A.getDate()+I*b.interval*7);break;case"monthly":N.setMonth(A.getMonth()+I*b.interval);break;case"yearly":N.setFullYear(A.getFullYear()+I*b.interval);break}D.push(N.toLocaleDateString())}return D}const c=Q(()=>o(a)&&s()?l(o(r).frequency):[]);function u(b){const D=b.target.value;t(D);const A=oo.parse(D);e.onchange(D,A.isValid?A.frequency:null,A.isValid)}var d=aw(),f=h(d);let v;f.__input=u;var y=p(f,2);{var _=b=>{var x=sw(),D=h(x);{var A=N=>{var P=ew();S(N,P)},I=N=>{var P=tw(),H=h(P);$(()=>R(H,` ${(o(i)||"Invalid recurrence pattern")??""}`)),S(N,P)};W(D,N=>{o(a)?N(A):N(I,!1)})}S(b,x)};W(y,b=>{t().length>0&&b(_)})}var m=p(y,2);{var g=b=>{var x=rw(),D=p(h(x),2);je(D,21,()=>o(c),pt,(A,I)=>{var N=nw(),P=h(N);$(()=>R(P,o(I))),S(A,N)}),S(b,x)};W(m,b=>{o(a)&&s()&&o(c).length>0&&b(g)})}$(()=>{v=Xe(f,1,"recurrence-input__field svelte-787fjp",null,v,{valid:o(a),invalid:!o(a)&&t().length>0}),Ne(f,"aria-invalid",!o(a)&&t().length>0)}),it(f,t),S(n,d),ht()}bt(["input"]);var ow=C('<div class="dependency-picker__chip svelte-10ls0lk"><span class="dependency-picker__chip-text svelte-10ls0lk"> </span> <button type="button" class="dependency-picker__chip-remove svelte-10ls0lk"></button></div>'),lw=C('<div class="dependency-picker__chips svelte-10ls0lk"></div>'),cw=C('<span class="dependency-picker__option-check svelte-10ls0lk"></span>'),uw=C('<button type="button"><span class="dependency-picker__option-name svelte-10ls0lk"> </span> <!></button>'),dw=C('<div class="dependency-picker__dropdown svelte-10ls0lk"></div>'),hw=C('<div class="dependency-picker svelte-10ls0lk"><label class="dependency-picker__label svelte-10ls0lk"> </label> <!> <div class="dependency-picker__search-wrapper svelte-10ls0lk"><input type="text" class="dependency-picker__search svelte-10ls0lk" placeholder="Search tasks..."/> <!></div></div>');function kc(n,e){dt(e,!0);let t=rn(e,"selected",31,()=>xe([])),s=rn(e,"label",3,"Select tasks"),r=K(""),a=K(!1);const i=Q(()=>e.repository.getAllTasks().filter(N=>N.id!==e.excludeId)),l=Q(()=>o(r).trim()?o(i).filter(N=>N.name.toLowerCase().includes(o(r).toLowerCase())):o(i)),c=Q(()=>o(i).filter(N=>t().includes(N.id)));function u(N){if(!t().includes(N)){const P=[...t(),N];t(P),e.onchange(P)}T(r,""),T(a,!1)}function d(N){const P=t().filter(H=>H!==N);t(P),e.onchange(P)}function f(){T(a,!0)}function v(){setTimeout(()=>{T(a,!1)},200)}var y=hw(),_=h(y),m=h(_),g=p(_,2);{var b=N=>{var P=lw();je(P,21,()=>o(c),H=>H.id,(H,j)=>{var Z=ow(),ae=h(Z),re=h(ae),de=p(ae,2);de.__click=()=>d(o(j).id),$(()=>{R(re,o(j).name),Ne(de,"aria-label",`Remove ${o(j).name??""}`)}),S(H,Z)}),S(N,P)};W(g,N=>{o(c).length>0&&N(b)})}var x=p(g,2),D=h(x),A=p(D,2);{var I=N=>{var P=dw();je(P,21,()=>o(l).slice(0,10),H=>H.id,(H,j)=>{var Z=uw();let ae;Z.__click=()=>u(o(j).id);var re=h(Z),de=h(re),V=p(re,2);{var U=O=>{var M=cw();S(O,M)};W(V,O=>{t().includes(o(j).id)&&O(U)})}$((O,M)=>{ae=Xe(Z,1,"dependency-picker__option svelte-10ls0lk",null,ae,O),Z.disabled=M,R(de,o(j).name)},[()=>({selected:t().includes(o(j).id)}),()=>t().includes(o(j).id)]),S(H,Z)}),S(N,P)};W(A,N=>{o(a)&&o(l).length>0&&N(I)})}$(()=>R(m,s())),Lt("focus",D,f),Lt("blur",D,v),it(D,()=>o(r),N=>T(r,N)),S(n,y),ht()}bt(["click"]);var fw=C('<div class="task-editor__error svelte-xc3qs9"> </div>'),vw=C('<div class="task-editor__error svelte-xc3qs9"> </div>'),pw=C('<div class="task-editor__error svelte-xc3qs9"> </div>'),gw=C('<div class="task-editor__timestamp svelte-xc3qs9"><span class="task-editor__timestamp-label svelte-xc3qs9">Completed:</span> <span class="task-editor__timestamp-value svelte-xc3qs9"> </span></div>'),mw=C('<div class="task-editor__timestamp svelte-xc3qs9"><span class="task-editor__timestamp-label svelte-xc3qs9">Cancelled:</span> <span class="task-editor__timestamp-value svelte-xc3qs9"> </span></div>'),yw=C('<div class="task-editor__timestamp svelte-xc3qs9"><span class="task-editor__timestamp-label svelte-xc3qs9">Linked block:</span> <span class="task-editor__timestamp-value svelte-xc3qs9"> </span></div>'),bw=C('<div class="task-editor-overlay svelte-xc3qs9" role="dialog" aria-modal="true" aria-labelledby="task-editor-title" tabindex="-1"><div class="task-editor-modal svelte-xc3qs9" role="document"><div class="task-editor__header svelte-xc3qs9"><h2 id="task-editor-title" class="svelte-xc3qs9"> </h2> <button class="task-editor__close svelte-xc3qs9" type="button" aria-label="Close"></button></div> <div class="task-editor__body svelte-xc3qs9"><div class="task-editor__field svelte-xc3qs9"><label for="task-name" class="svelte-xc3qs9">Description *</label> <input id="task-name" type="text" placeholder="Task name" class="svelte-xc3qs9"/> <!></div> <div class="task-editor__field svelte-xc3qs9"><label for="task-description" class="svelte-xc3qs9">Notes</label> <textarea id="task-description" placeholder="Additional details about this task..." rows="3" class="svelte-xc3qs9"></textarea></div> <div class="task-editor__field svelte-xc3qs9"><label class="svelte-xc3qs9">Priority</label> <!></div> <div class="task-editor__field svelte-xc3qs9"><label class="svelte-xc3qs9">Status</label> <!></div> <div class="task-editor__field svelte-xc3qs9"><label for="task-due" class="svelte-xc3qs9">Due Date *</label> <input id="task-due" type="datetime-local" class="svelte-xc3qs9"/> <!></div> <div class="task-editor__field svelte-xc3qs9"><label for="task-scheduled" class="svelte-xc3qs9">Scheduled Date</label> <input id="task-scheduled" type="datetime-local" class="svelte-xc3qs9"/> <div class="task-editor__hint svelte-xc3qs9">When you plan to start working on this task</div></div> <div class="task-editor__field svelte-xc3qs9"><label for="task-start" class="svelte-xc3qs9">Start Date</label> <input id="task-start" type="datetime-local" class="svelte-xc3qs9"/> <div class="task-editor__hint svelte-xc3qs9">Earliest date this task can begin</div></div> <div class="task-editor__field svelte-xc3qs9"><label for="task-recurrence" class="svelte-xc3qs9">Recurrence</label> <!> <!></div> <div class="task-editor__field svelte-xc3qs9"><!></div> <div class="task-editor__field svelte-xc3qs9"><!></div> <div class="task-editor__timestamps svelte-xc3qs9"><div class="task-editor__timestamp svelte-xc3qs9"><span class="task-editor__timestamp-label svelte-xc3qs9">Created:</span> <span class="task-editor__timestamp-value svelte-xc3qs9"> </span></div> <!> <!> <!></div></div> <div class="task-editor__footer svelte-xc3qs9"><button class="task-editor__cancel svelte-xc3qs9" type="button">Cancel</button> <button class="task-editor__save svelte-xc3qs9" type="button"> </button></div> <div class="task-editor__hint-footer svelte-xc3qs9"> Press <kbd class="svelte-xc3qs9">Esc</kbd> to close, <kbd class="svelte-xc3qs9">/Ctrl+Enter</kbd> to save</div></div></div>');function md(n,e){var we,Ie,vt,Ut,_t,jt,kt,Ot,As,zt,ts,Wt;dt(e,!0);const t="every day",s="Blocked by (tasks that must complete first)",r="Blocks (tasks that depend on this)",a=!e.task;let i=K(xe(((we=e.task)==null?void 0:we.name)||"")),l=K(xe(((Ie=e.task)==null?void 0:Ie.description)||"")),c=K(xe(((vt=e.task)==null?void 0:vt.priority)||"normal")),u=K(xe(((Ut=e.task)==null?void 0:Ut.status)||"todo")),d=K(xe((_t=e.task)!=null&&_t.dueAt?new Date(e.task.dueAt).toISOString().slice(0,16):new Date().toISOString().slice(0,16))),f=K(xe((jt=e.task)!=null&&jt.scheduledAt?new Date(e.task.scheduledAt).toISOString().slice(0,16):"")),v=K(xe((kt=e.task)!=null&&kt.startAt?new Date(e.task.startAt).toISOString().slice(0,16):"")),y=K(xe(((Ot=e.task)==null?void 0:Ot.recurrenceText)||((As=e.task)!=null&&As.frequency?oo.stringify(e.task.frequency):t))),_=K(xe(((zt=e.task)==null?void 0:zt.frequency)||null)),m=K(!0),g=K(xe(((ts=e.task)==null?void 0:ts.blockedBy)||[])),b=K(xe(((Wt=e.task)==null?void 0:Wt.dependsOn)||[])),x=K(xe({name:!1,dueAt:!1,recurrence:!1})),D=K(!1),A=K(null);const I=Q(()=>o(x).name&&!o(i).trim()?"Task name is required":""),N=Q(()=>o(x).dueAt?o(d)?Number.isNaN(new Date(o(d)).getTime())?"Invalid due date":"":"Due date is required":""),P=Q(()=>o(x).recurrence&&!o(m)?"Invalid recurrence pattern":""),H=Q(()=>!!(o(I)||o(N)||o(P)));ha(()=>{requestAnimationFrame(()=>{var Y;(Y=o(A))==null||Y.focus()})});function j(Y,ge,et){T(y,Y,!0),T(_,ge,!0),T(m,et,!0),o(x).recurrence=!0}function Z(Y){T(c,Y,!0)}function ae(Y){T(u,Y,!0)}function re(Y){T(g,Y,!0)}function de(Y){T(b,Y,!0)}async function V(){if(T(x,{name:!0,dueAt:!0,recurrence:!0},!0),o(H)){G.warning("Please fix validation errors");return}if(!o(_)){G.error("Invalid recurrence pattern");return}T(D,!0);try{let Y;a?Y=Bu(o(i).trim(),o(_),new Date(o(d))):(Y={...e.task},Y.name=o(i).trim(),Y.frequency=o(_),Y.dueAt=new Date(o(d)).toISOString()),Y.description=o(l).trim()||void 0,Y.priority=o(c),Y.status=o(u),Y.recurrenceText=o(y),Y.scheduledAt=o(f)?new Date(o(f)).toISOString():void 0,Y.startAt=o(v)?new Date(o(v)).toISOString():void 0,Y.blockedBy=o(g).length>0?o(g):void 0,Y.dependsOn=o(b).length>0?o(b):void 0,Y.updatedAt=new Date().toISOString(),o(u)==="done"&&!Y.lastCompletedAt&&(Y.lastCompletedAt=new Date().toISOString()),o(u)==="cancelled"&&!Y.cancelledAt&&(Y.cancelledAt=new Date().toISOString()),await e.repository.saveTask(Y),e.onSave&&e.onSave(Y),G.success(`Task "${Y.name}" ${a?"created":"updated"}`),Ye.emit("task:refresh",void 0),window.dispatchEvent(new CustomEvent("recurring-task-refresh")),e.onClose()}catch(Y){G.error(`Failed to save task: ${Y}`)}finally{T(D,!1)}}function U(Y){Y.key==="Escape"&&e.onClose(),(Y.metaKey||Y.ctrlKey)&&Y.key==="Enter"&&(Y.preventDefault(),V())}function O(Y){return Y?new Date(Y).toLocaleString():""}var M=bw();M.__keydown=U;var B=h(M),se=h(B),ee=h(se),me=h(ee),he=p(ee,2);he.__click=function(...Y){var ge;(ge=e.onClose)==null||ge.apply(this,Y)};var fe=p(se,2),De=h(fe),Se=p(h(De),2);Se.__input=()=>o(x).name=!0,Ps(Se,Y=>T(A,Y),()=>o(A));var Fe=p(Se,2);{var ve=Y=>{var ge=fw(),et=h(ge);$(()=>R(et,o(I))),S(Y,ge)};W(Fe,Y=>{o(I)&&Y(ve)})}var z=p(De,2),E=p(h(z),2),F=p(z,2),X=p(h(F),2);Qb(X,{get value(){return o(c)},onchange:Z});var ie=p(F,2),L=p(h(ie),2);Jb(L,{get value(){return o(u)},onchange:ae});var q=p(ie,2),te=p(h(q),2);te.__input=()=>o(x).dueAt=!0;var pe=p(te,2);{var ke=Y=>{var ge=vw(),et=h(ge);$(()=>R(et,o(N))),S(Y,ge)};W(pe,Y=>{o(N)&&Y(ke)})}var ye=p(q,2),Ee=p(h(ye),2),Ae=p(ye,2),Ke=p(h(Ae),2),tt=p(Ae,2),Ze=p(h(tt),2);iw(Ze,{get value(){return o(y)},onchange:j,showPreview:!0});var lt=p(Ze,2);{var ft=Y=>{var ge=pw(),et=h(ge);$(()=>R(et,o(P))),S(Y,ge)};W(lt,Y=>{o(P)&&Y(ft)})}var Me=p(tt,2),Le=h(Me);{let Y=Q(()=>{var ge;return(ge=e.task)==null?void 0:ge.id});kc(Le,{get repository(){return e.repository},get selected(){return o(g)},get excludeId(){return o(Y)},onchange:re,label:s})}var Ce=p(Me,2),Ue=h(Ce);{let Y=Q(()=>{var ge;return(ge=e.task)==null?void 0:ge.id});kc(Ue,{get repository(){return e.repository},get selected(){return o(b)},get excludeId(){return o(Y)},onchange:de,label:r})}var We=p(Ce,2),ze=h(We),ct=p(h(ze),2),It=h(ct),Jt=p(ze,2);{var vs=Y=>{var ge=gw(),et=p(h(ge),2),ss=h(et);$(Ht=>R(ss,Ht),[()=>O(e.task.lastCompletedAt)]),S(Y,ge)};W(Jt,Y=>{var ge;(ge=e.task)!=null&&ge.lastCompletedAt&&Y(vs)})}var Ft=p(Jt,2);{var es=Y=>{var ge=mw(),et=p(h(ge),2),ss=h(et);$(Ht=>R(ss,Ht),[()=>O(e.task.cancelledAt)]),S(Y,ge)};W(Ft,Y=>{var ge;(ge=e.task)!=null&&ge.cancelledAt&&Y(es)})}var ps=p(Ft,2);{var ne=Y=>{var ge=yw(),et=p(h(ge),2),ss=h(et);$(()=>R(ss,e.task.linkedBlockId)),S(Y,ge)};W(ps,Y=>{var ge;(ge=e.task)!=null&&ge.linkedBlockId&&Y(ne)})}var be=p(fe,2),qe=h(be);qe.__click=function(...Y){var ge;(ge=e.onClose)==null||ge.apply(this,Y)};var Oe=p(qe,2);Oe.__click=V;var le=h(Oe);$(Y=>{R(me,a?"Create Task":"Edit Task"),Ne(Se,"aria-invalid",!!o(I)),Ne(te,"aria-invalid",!!o(N)),R(It,Y),Oe.disabled=o(D),R(le,o(D)?"Saving...":a?"Create Task":"Save Changes")},[()=>{var Y;return O((Y=e.task)==null?void 0:Y.createdAt)}]),Lt("blur",Se,()=>o(x).name=!0),it(Se,()=>o(i),Y=>T(i,Y)),it(E,()=>o(l),Y=>T(l,Y)),Lt("blur",te,()=>o(x).dueAt=!0),it(te,()=>o(d),Y=>T(d,Y)),it(Ee,()=>o(f),Y=>T(f,Y)),it(Ke,()=>o(v),Y=>T(v,Y)),S(n,M),ht()}bt(["keydown","click","input"]);var ww=C("<option> </option>"),_w=C('<li class="svelte-b8rwae"> </li>'),kw=C('<div class="validation-errors svelte-b8rwae"><h4 class="svelte-b8rwae"> Validation Errors:</h4> <ul class="svelte-b8rwae"></ul></div>'),Tw=C('<div class="profile-editor svelte-b8rwae"><div class="profile-header svelte-b8rwae"><input type="text" placeholder="Profile name" class="profile-name-input svelte-b8rwae"/> <input type="text" placeholder="Description (optional)" class="profile-description-input svelte-b8rwae"/></div> <section class="filter-section svelte-b8rwae"><h3 class="svelte-b8rwae"> Path Scoping</h3> <p class="help-text svelte-b8rwae">Use glob patterns like <code class="svelte-b8rwae">daily/**</code>, <code class="svelte-b8rwae">projects/**</code> <br/> <strong>Tip:</strong> <code class="svelte-b8rwae">**</code> matches any depth, <code class="svelte-b8rwae">*</code> matches within a folder</p> <div class="dual-input svelte-b8rwae"><label class="svelte-b8rwae"><span class="label-with-badge svelte-b8rwae">Include Paths <span class="badge optional svelte-b8rwae">Optional</span></span> <textarea placeholder="daily/** projects/**  Leave empty to include all paths" rows="4" class="svelte-b8rwae"></textarea> <span class="hint svelte-b8rwae">If set, only tasks in these paths are included</span></label> <label class="svelte-b8rwae"><span class="label-with-badge svelte-b8rwae">Exclude Paths <span class="badge wins svelte-b8rwae">Wins</span></span> <textarea placeholder="archive/** templates/** trash/**" rows="4" class="svelte-b8rwae"></textarea> <span class="hint svelte-b8rwae">Always excluded, even if in include list</span></label></div></section> <section class="filter-section svelte-b8rwae"><h3 class="svelte-b8rwae"> Tag Scoping</h3> <p class="help-text svelte-b8rwae">Tags are boundary-safe: <code class="svelte-b8rwae">#work</code>  <code class="svelte-b8rwae">#workshop</code> <br/> <strong>Case-insensitive:</strong> <code class="svelte-b8rwae">#Work</code> = <code class="svelte-b8rwae">#work</code></p> <div class="dual-input svelte-b8rwae"><label class="svelte-b8rwae"><span class="label-with-badge svelte-b8rwae">Include Tags <span class="badge optional svelte-b8rwae">Optional</span></span> <input type="text" placeholder="#task, #work, #active" class="svelte-b8rwae"/> <span class="hint svelte-b8rwae">Task must have at least one of these tags</span></label> <label class="svelte-b8rwae"><span class="label-with-badge svelte-b8rwae">Exclude Tags <span class="badge wins svelte-b8rwae">Wins</span></span> <input type="text" placeholder="#archive, #template, #ignore" class="svelte-b8rwae"/> <span class="hint svelte-b8rwae">Tasks with these tags are always excluded</span></label></div></section> <section class="filter-section svelte-b8rwae"><h3 class="svelte-b8rwae"> Regex Scoping (Advanced)</h3> <p class="help-text svelte-b8rwae">Pattern matching for complex filtering. Invalid regex will be disabled automatically. <br/> <strong>Examples:</strong> <code class="svelte-b8rwae">TODO|FIXME</code>, <code class="svelte-b8rwae">wip|draft</code>, <code class="svelte-b8rwae">^\\[.*\\]</code></p> <div class="dual-input svelte-b8rwae"><label class="svelte-b8rwae"><span class="label-with-badge svelte-b8rwae">Include Regex <span class="badge optional svelte-b8rwae">Optional</span></span> <input type="text" placeholder="TODO|FIXME|IMPORTANT" class="svelte-b8rwae"/> <span class="hint svelte-b8rwae">Task must match this pattern</span></label> <label class="svelte-b8rwae"><span class="label-with-badge svelte-b8rwae">Exclude Regex <span class="badge wins svelte-b8rwae">Wins</span></span> <input type="text" placeholder="wip|draft|skip" class="svelte-b8rwae"/> <span class="hint svelte-b8rwae">Tasks matching this are excluded</span></label></div> <div class="regex-targets svelte-b8rwae"><span class="targets-label svelte-b8rwae">Match against:</span> <label class="checkbox-label svelte-b8rwae"><input type="checkbox" class="svelte-b8rwae"/> <span>Task Text</span></label> <label class="checkbox-label svelte-b8rwae"><input type="checkbox" class="svelte-b8rwae"/> <span>Path</span></label> <label class="checkbox-label svelte-b8rwae"><input type="checkbox" class="svelte-b8rwae"/> <span>File Name</span></label></div></section> <!> <div class="profile-save-actions svelte-b8rwae"><button type="button" class="primary svelte-b8rwae"> Save Profile</button> <button type="button" class="secondary svelte-b8rwae"> Reset All to Defaults</button></div></div>'),Sw=C('<span class="task-path svelte-b8rwae"> </span>'),xw=C('<span class="task-tags svelte-b8rwae"> </span>'),Dw=C('<span class="explanation svelte-b8rwae"> </span>'),Ew=C('<li class="svelte-b8rwae"><div class="task-info svelte-b8rwae"><span class="task-name svelte-b8rwae"> </span> <!> <!></div> <!></li>'),Aw=C('<details open class="svelte-b8rwae"><summary class="svelte-b8rwae">Sample Excluded Tasks (first 20):</summary> <ul class="excluded-samples svelte-b8rwae"></ul></details>'),Cw=C('<div class="no-excluded svelte-b8rwae"> All tasks pass the current filter</div>'),Mw=C('<div class="profile-toolbar svelte-b8rwae"><div class="profile-selector svelte-b8rwae"><label for="profile-select" class="svelte-b8rwae">Active Profile:</label> <select id="profile-select" class="svelte-b8rwae"></select></div> <div class="profile-actions svelte-b8rwae"><button type="button" title="Create new profile" class="svelte-b8rwae">+ New</button> <button type="button" title="Duplicate current profile" class="svelte-b8rwae"> Duplicate</button> <button type="button" title="Delete current profile" class="svelte-b8rwae"> Delete</button> <button type="button" title="Export profile to JSON" class="svelte-b8rwae"> Export</button> <button type="button" title="Import profile from JSON" class="svelte-b8rwae"> Import</button></div></div> <!> <div class="preview svelte-b8rwae"><div class="preview-header svelte-b8rwae"><h3 class="svelte-b8rwae"> Live Preview</h3> <label class="checkbox-label svelte-b8rwae"><input type="checkbox" class="svelte-b8rwae"/> <span>Show Explain Mode</span></label></div> <div class="preview-stats svelte-b8rwae"><div class="stat stat-included svelte-b8rwae"><span class="stat-icon svelte-b8rwae"></span> <div class="stat-content svelte-b8rwae"><span class="stat-value svelte-b8rwae"> </span> <span class="stat-label svelte-b8rwae">Included</span></div></div> <div class="stat stat-excluded svelte-b8rwae"><span class="stat-icon svelte-b8rwae"></span> <div class="stat-content svelte-b8rwae"><span class="stat-value svelte-b8rwae"> </span> <span class="stat-label svelte-b8rwae">Excluded</span></div></div> <div class="stat stat-total svelte-b8rwae"><span class="stat-icon svelte-b8rwae"></span> <div class="stat-content svelte-b8rwae"><span class="stat-value svelte-b8rwae"> </span> <span class="stat-label svelte-b8rwae">Total</span></div></div></div> <!></div> <div class="quick-tips svelte-b8rwae"><h3 class="svelte-b8rwae"> Quick Tips</h3> <ul class="svelte-b8rwae"><li class="svelte-b8rwae"><strong>Precedence:</strong> Exclude always wins over include</li> <li class="svelte-b8rwae"><strong>Performance:</strong> Filters are compiled and optimized for 10k+ tasks</li> <li class="svelte-b8rwae"><strong>Profiles:</strong> Create multiple profiles for different contexts (Work, Personal, etc.)</li> <li class="svelte-b8rwae"><strong>Query Overrides:</strong> Use <code class="svelte-b8rwae">@ignoreGlobalFilter</code> or <code class="svelte-b8rwae">@profile Work</code> in queries</li> <li class="svelte-b8rwae"><strong>Debugging:</strong> Enable "Show Explain Mode" to see why tasks are excluded</li></ul></div>',1),Iw=C('<div class="disabled-state svelte-b8rwae"><p class="svelte-b8rwae">Global Filter is disabled. All tasks will be included.</p> <p class="hint svelte-b8rwae">Enable to start filtering tasks by path, tags, or regex patterns.</p></div>'),Ow=C(`<div class="global-filter-settings svelte-b8rwae"><div class="header svelte-b8rwae"><div class="header-content svelte-b8rwae"><h2 class="svelte-b8rwae">Global Filter Profiles</h2> <p class="subtitle svelte-b8rwae">Control which tasks are included in your plugin universe. 
        Tasks that fail the filter won't appear in queries, dashboards, or notifications.</p></div> <label class="enable-toggle svelte-b8rwae"><input type="checkbox"/> <span class="svelte-b8rwae">Enable Global Filter</span></label></div> <!></div>`);function Nw(n,e){dt(e,!0);const t=us.getInstance();let s=K(xe(e.settingsService.get().globalFilter??Jr)),r=Q(()=>o(s).profiles.find(V=>V.id===o(s).activeProfileId)),a=K(xe({included:0,excluded:0,samples:[]})),i=K(xe([])),l=K(!1),c=K(""),u=K(""),d=K(""),f=K("");xt(()=>{o(r)&&(T(c,o(r).includePaths.join(`
`),!0),T(u,o(r).excludePaths.join(`
`),!0),T(d,o(r).includeTags.join(", "),!0),T(f,o(r).excludeTags.join(", "),!0))});function v(V){o(s).activeProfileId=V,t.setActiveProfile(V),b()}function y(){const V={id:`profile_${Date.now()}`,name:"New Profile",description:"",includePaths:[],excludePaths:[],includeTags:[],excludeTags:[],includeRegex:void 0,excludeRegex:void 0,regexTargets:["taskText"],excludeStatusTypes:[]};o(s).profiles=[...o(s).profiles,V],o(s).activeProfileId=V.id,b(),G.success("Profile created")}function _(){if(!o(r))return;const V={...o(r),id:`profile_${Date.now()}`,name:`${o(r).name} (Copy)`};o(s).profiles=[...o(s).profiles,V],o(s).activeProfileId=V.id,b(),G.success("Profile duplicated")}function m(V){if(o(s).profiles.length<=1){G.error("Cannot delete the last profile");return}o(s).profiles=o(s).profiles.filter(U=>U.id!==V),o(s).activeProfileId===V&&(o(s).activeProfileId=o(s).profiles[0].id),b(),G.success("Profile deleted")}function g(){if(!o(r))return;o(r).includePaths=o(c).split(`
`).map(U=>U.trim()).filter(Boolean),o(r).excludePaths=o(u).split(`
`).map(U=>U.trim()).filter(Boolean),o(r).includeTags=o(d).split(",").map(U=>U.trim()).filter(Boolean),o(r).excludeTags=o(f).split(",").map(U=>U.trim()).filter(Boolean);const V=Ih(o(r));T(i,V.errors,!0),V.valid?(b(),G.success("Profile saved")):G.error("Validation failed - check errors below")}async function b(){t.updateConfig(o(s)),await e.settingsService.update({globalFilter:o(s)}),Ye.emit("task: settings",{source:"global-filter"}),x()}function x(){if(!e.repository){T(a,{included:0,excluded:0,samples:[]},!0);return}const V=e.repository.getAllTasks(),U=us.getInstance(),O=V.filter(M=>!U.shouldIncludeTask(M));T(a,{included:V.length-O.length,excluded:O.length,samples:O.slice(0,20)},!0)}function D(V){const U=t.explainTask(V);let O=U.reason;return U.matchedRule&&(O+=` (${U.matchedRule.type}:  ${U.matchedRule.pattern}`,U.matchedRule.target&&(O+=` on ${U.matchedRule.target}`),O+=")"),O}async function A(){confirm("Reset all profiles to defaults?  This cannot be undone.")&&(T(s,{...Jr},!0),await b(),G.success("Reset to defaults"))}function I(){if(!o(r))return;const V=JSON.stringify(o(r),null,2),U=new Blob([V],{type:"application/json"}),O=URL.createObjectURL(U),M=document.createElement("a");M.href=O,M.download=`${o(r).name.replace(/\s+/g,"-").toLowerCase()}-profile.json`,M.click(),URL.revokeObjectURL(O),G.success("Profile exported")}async function N(){const V=document.createElement("input");V.type="file",V.accept=". json",V.onchange=async U=>{var M;const O=(M=U.target.files)==null?void 0:M[0];if(O)try{const B=await O.text(),se=JSON.parse(B);if(!se.id||!se.name||!Array.isArray(se.includePaths))throw new Error("Invalid profile format");se.id=`profile_${Date.now()}`,o(s).profiles=[...o(s).profiles,se],o(s).activeProfileId=se.id,await b(),G.success(`Profile "${se.name}" imported`)}catch(B){G.error(`Import failed: ${B instanceof Error?B.message:"Unknown error"}`)}},V.click()}xt(()=>{x()});var P=Ow(),H=h(P),j=p(h(H),2),Z=h(j);Z.__change=()=>b();var ae=p(H,2);{var re=V=>{var U=Mw(),O=Qe(U),M=h(O),B=p(h(M),2);B.__change=()=>v(o(s).activeProfileId),je(B,21,()=>o(s).profiles,pt,(Le,Ce)=>{var Ue=ww(),We=h(Ue),ze={};$(()=>{R(We,o(Ce).name),ze!==(ze=o(Ce).id)&&(Ue.value=(Ue.__value=o(Ce).id)??"")}),S(Le,Ue)});var se=p(M,2),ee=h(se);ee.__click=y;var me=p(ee,2);me.__click=_;var he=p(me,2);he.__click=()=>m(o(s).activeProfileId);var fe=p(he,2);fe.__click=I;var De=p(fe,2);De.__click=N;var Se=p(O,2);{var Fe=Le=>{var Ce=Tw(),Ue=h(Ce),We=h(Ue);We.__change=()=>g();var ze=p(We,2);ze.__change=()=>g();var ct=p(Ue,2),It=p(h(ct),4),Jt=h(It),vs=p(h(Jt),2),Ft=p(Jt,2),es=p(h(Ft),2),ps=p(ct,2),ne=p(h(ps),4),be=h(ne),qe=p(h(be),2),Oe=p(be,2),le=p(h(Oe),2),we=p(ps,2),Ie=p(h(we),4),vt=h(Ie),Ut=p(h(vt),2),_t=p(vt,2),jt=p(h(_t),2),kt=p(Ie,2),Ot=p(h(kt),2),As=h(Ot);As.__change=Ve=>{Ve.currentTarget.checked?o(r).regexTargets.includes("taskText")||(o(r).regexTargets=[...o(r).regexTargets,"taskText"]):o(r).regexTargets=o(r).regexTargets.filter(Nt=>Nt!=="taskText")};var zt=p(Ot,2),ts=h(zt);ts.__change=Ve=>{Ve.currentTarget.checked?o(r).regexTargets.includes("path")||(o(r).regexTargets=[...o(r).regexTargets,"path"]):o(r).regexTargets=o(r).regexTargets.filter(Nt=>Nt!=="path")};var Wt=p(zt,2),Y=h(Wt);Y.__change=Ve=>{Ve.currentTarget.checked?o(r).regexTargets.includes("fileName")||(o(r).regexTargets=[...o(r).regexTargets,"fileName"]):o(r).regexTargets=o(r).regexTargets.filter(Nt=>Nt!=="fileName")};var ge=p(we,2);{var et=Ve=>{var Nt=kw(),hn=p(h(Nt),2);je(hn,21,()=>o(i),pt,(ui,di)=>{var pa=_w(),fn=h(pa);$(()=>R(fn,o(di))),S(ui,pa)}),S(Ve,Nt)};W(ge,Ve=>{o(i).length>0&&Ve(et)})}var ss=p(ge,2),Ht=h(ss);Ht.__click=g;var dn=p(Ht,2);dn.__click=A,$((Ve,Nt,hn)=>{An(As,Ve),An(ts,Nt),An(Y,hn)},[()=>o(r).regexTargets.includes("taskText"),()=>o(r).regexTargets.includes("path"),()=>o(r).regexTargets.includes("fileName")]),it(We,()=>o(r).name,Ve=>o(r).name=Ve),it(ze,()=>o(r).description,Ve=>o(r).description=Ve),it(vs,()=>o(c),Ve=>T(c,Ve)),it(es,()=>o(u),Ve=>T(u,Ve)),it(qe,()=>o(d),Ve=>T(d,Ve)),it(le,()=>o(f),Ve=>T(f,Ve)),it(Ut,()=>o(r).includeRegex,Ve=>o(r).includeRegex=Ve),it(jt,()=>o(r).excludeRegex,Ve=>o(r).excludeRegex=Ve),S(Le,Ce)};W(Se,Le=>{o(r)&&Le(Fe)})}var ve=p(Se,2),z=h(ve),E=p(h(z),2),F=h(E),X=p(z,2),ie=h(X),L=p(h(ie),2),q=h(L),te=h(q),pe=p(ie,2),ke=p(h(pe),2),ye=h(ke),Ee=h(ye),Ae=p(pe,2),Ke=p(h(Ae),2),tt=h(Ke),Ze=h(tt),lt=p(X,2);{var ft=Le=>{var Ce=Aw(),Ue=p(h(Ce),2);je(Ue,21,()=>o(a).samples,pt,(We,ze)=>{var ct=Ew(),It=h(ct),Jt=h(It),vs=h(Jt),Ft=p(Jt,2);{var es=Oe=>{var le=Sw(),we=h(le);$(()=>R(we,o(ze).path)),S(Oe,le)};W(Ft,Oe=>{o(ze).path&&Oe(es)})}var ps=p(Ft,2);{var ne=Oe=>{var le=xw(),we=h(le);$(Ie=>R(we,Ie),[()=>o(ze).tags.join(" ")]),S(Oe,le)};W(ps,Oe=>{o(ze).tags&&o(ze).tags.length>0&&Oe(ne)})}var be=p(It,2);{var qe=Oe=>{var le=Dw(),we=h(le);$(Ie=>R(we,Ie),[()=>D(o(ze))]),S(Oe,le)};W(be,Oe=>{o(l)&&Oe(qe)})}$(()=>R(vs,o(ze).name)),S(We,ct)}),S(Le,Ce)},Me=Le=>{var Ce=ut(),Ue=Qe(Ce);{var We=ze=>{var ct=Cw();S(ze,ct)};W(Ue,ze=>{o(s).enabled&&ze(We)},!0)}S(Le,Ce)};W(lt,Le=>{o(a).samples.length>0?Le(ft):Le(Me,!1)})}$(()=>{he.disabled=o(s).profiles.length<=1,R(te,o(a).included),R(Ee,o(a).excluded),R(Ze,o(a).included+o(a).excluded)}),Fu(B,()=>o(s).activeProfileId,Le=>o(s).activeProfileId=Le),Wi(F,()=>o(l),Le=>T(l,Le)),S(V,U)},de=V=>{var U=Iw();S(V,U)};W(ae,V=>{o(s).enabled?V(re):V(de,!1)})}Wi(Z,()=>o(s).enabled,V=>o(s).enabled=V),S(n,P),ht()}bt(["change","click"]);var Rw=C('<button class="delete-btn svelte-1qw3eru">Delete</button>'),Pw=C('<span class="default-badge svelte-1qw3eru">Default</span>'),Lw=C('<tr class="svelte-1qw3eru"><td class="svelte-1qw3eru"><code class="status-symbol svelte-1qw3eru"> </code></td><td class="svelte-1qw3eru"> </td><td class="svelte-1qw3eru"><span class="status-type svelte-1qw3eru"> </span></td><td class="svelte-1qw3eru"><code class="status-symbol svelte-1qw3eru"> </code></td><td class="example-col svelte-1qw3eru"><code class="example svelte-1qw3eru"> </code></td><td class="svelte-1qw3eru"><!></td></tr>'),qw=C('<div class="status-registry-editor svelte-1qw3eru"><h3 class="settings__section-title svelte-1qw3eru">Custom Task Statuses</h3> <p class="description svelte-1qw3eru">Define custom checkbox symbols for different task states</p> <div class="status-list svelte-1qw3eru"><div class="table-container svelte-1qw3eru"><table class="svelte-1qw3eru"><thead class="svelte-1qw3eru"><tr><th class="svelte-1qw3eru">Symbol</th><th class="svelte-1qw3eru">Name</th><th class="svelte-1qw3eru">Type</th><th class="svelte-1qw3eru">Next Symbol</th><th class="svelte-1qw3eru">Example</th><th class="svelte-1qw3eru">Actions</th></tr></thead><tbody class="svelte-1qw3eru"></tbody></table></div></div> <div class="add-status-section svelte-1qw3eru"><h4 class="subsection-title svelte-1qw3eru">Add Custom Status</h4> <div class="add-status-form"><div class="form-row svelte-1qw3eru"><div class="form-field svelte-1qw3eru"><label class="settings__label svelte-1qw3eru">Symbol (1 char)</label> <input type="text" placeholder="!" maxlength="1" class="settings__input svelte-1qw3eru"/></div> <div class="form-field svelte-1qw3eru"><label class="settings__label svelte-1qw3eru">Name</label> <input type="text" placeholder="Important" class="settings__input svelte-1qw3eru"/></div> <div class="form-field svelte-1qw3eru"><label class="settings__label svelte-1qw3eru">Type</label> <select class="settings__input svelte-1qw3eru"><option>TODO</option><option>IN_PROGRESS</option><option>DONE</option><option>CANCELLED</option><option>NON_TASK</option></select></div> <div class="form-field svelte-1qw3eru"><label class="settings__label svelte-1qw3eru">Next Symbol</label> <input type="text" placeholder="x" maxlength="1" class="settings__input svelte-1qw3eru"/></div> <div class="form-field svelte-1qw3eru"><label class="settings__label svelte-1qw3eru">&nbsp;</label> <button class="add-btn svelte-1qw3eru">Add Status</button></div></div></div></div> <div class="actions svelte-1qw3eru"><button class="reset-btn svelte-1qw3eru">Reset to Defaults</button></div> <div class="info-section svelte-1qw3eru"><h4 class="subsection-title svelte-1qw3eru">About Custom Statuses</h4> <ul class="svelte-1qw3eru"><li class="svelte-1qw3eru"><strong>Symbol:</strong> The character shown in the checkbox (e.g., <code class="svelte-1qw3eru">[!]</code>)</li> <li class="svelte-1qw3eru"><strong>Type:</strong> Determines how the task is treated (active, completed, etc.)</li> <li class="svelte-1qw3eru"><strong>Next Symbol:</strong> What symbol to use when toggling the task</li> <li class="svelte-1qw3eru"><strong>Examples:</strong> <code class="svelte-1qw3eru">[!]</code> for urgent, <code class="svelte-1qw3eru">[?]</code> for question, <code class="svelte-1qw3eru">[&gt;]</code> for forwarded</li></ul></div></div>');function Fw(n,e){dt(e,!0);let t=Ws.getInstance(),s=K(xe([])),r=K(""),a=K(""),i=K(xe(yt.TODO)),l=K("x");function c(){T(s,t.getAll(),!0)}function u(){if(!o(r).trim()||!o(a).trim()){G.error("Symbol and name are required");return}if(o(r).length!==1){G.error("Symbol must be a single character");return}const ve={symbol:o(r),name:o(a),type:o(i),nextStatusSymbol:o(l)},z=new Vs(ve);t.register(z),c(),v(),G.success(`Status "${o(a)}" added`)}function d(ve){if([" ","x","/","-"].includes(ve)){G.error("Cannot delete default status");return}t.unregister(ve),c(),G.success("Status deleted")}function f(){confirm("Reset all statuses to defaults? This will remove all custom statuses.")&&(t.reset(),c(),G.success("Statuses reset to defaults"))}function v(){T(r,""),T(a,""),T(i,yt.TODO,!0),T(l,"x")}xt(()=>{c()});var y=qw(),_=p(h(y),4),m=h(_),g=h(m),b=p(h(g));je(b,21,()=>o(s),pt,(ve,z)=>{var E=Lw(),F=h(E),X=h(F),ie=h(X),L=p(F),q=h(L),te=p(L),pe=h(te),ke=h(pe),ye=p(te),Ee=h(ye),Ae=h(Ee),Ke=p(ye),tt=h(Ke),Ze=h(tt),lt=p(Ke),ft=h(lt);{var Me=Ce=>{var Ue=Rw();Ue.__click=()=>d(o(z).symbol),S(Ce,Ue)},Le=Ce=>{var Ue=Pw();S(Ce,Ue)};W(ft,Ce=>{[" ","x","/","-"].includes(o(z).symbol)?Ce(Le,!1):Ce(Me)})}$(()=>{R(ie,`[${o(z).symbol??""}]`),R(q,o(z).name),R(ke,o(z).type),R(Ae,`[${o(z).nextStatusSymbol??""}]`),R(Ze,`- [${o(z).symbol??""}] Task example`)}),S(ve,E)});var x=p(_,2),D=p(h(x),2),A=h(D),I=h(A),N=p(h(I),2),P=p(I,2),H=p(h(P),2),j=p(P,2),Z=p(h(j),2),ae=h(Z),re={},de=p(ae),V={},U=p(de),O={},M=p(U),B={},se=p(M),ee={},me=p(j,2),he=p(h(me),2),fe=p(me,2),De=p(h(fe),2);De.__click=u;var Se=p(x,2),Fe=h(Se);Fe.__click=f,$(()=>{re!==(re=yt.TODO)&&(ae.value=(ae.__value=yt.TODO)??""),V!==(V=yt.IN_PROGRESS)&&(de.value=(de.__value=yt.IN_PROGRESS)??""),O!==(O=yt.DONE)&&(U.value=(U.__value=yt.DONE)??""),B!==(B=yt.CANCELLED)&&(M.value=(M.__value=yt.CANCELLED)??""),ee!==(ee=yt.NON_TASK)&&(se.value=(se.__value=yt.NON_TASK)??"")}),it(N,()=>o(r),ve=>T(r,ve)),it(H,()=>o(a),ve=>T(a,ve)),Fu(Z,()=>o(i),ve=>T(i,ve)),it(he,()=>o(l),ve=>T(l,ve)),S(n,y),ht()}bt(["click"]);var Uw=C('<button class="settings__close-btn svelte-1ke3hir"></button>'),zw=C("<div> </div>"),Bw=C('<section class="settings__section svelte-1ke3hir"><div class="settings__section-header svelte-1ke3hir"><h3 class="settings__section-title svelte-1ke3hir">n8n Webhook</h3> <label class="settings__toggle svelte-1ke3hir"><input type="checkbox" class="svelte-1ke3hir"/> <span>Enabled</span></label></div> <div class="settings__field svelte-1ke3hir"><label class="settings__label svelte-1ke3hir" for="n8n-webhook">Webhook URL</label> <input id="n8n-webhook" class="settings__input svelte-1ke3hir" type="url" placeholder="https://your-n8n-instance.com/webhook/..."/></div> <div class="settings__field svelte-1ke3hir"><label class="settings__label svelte-1ke3hir" for="n8n-secret">Shared Secret</label> <input id="n8n-secret" class="settings__input svelte-1ke3hir" type="password" placeholder="Optional shared secret"/></div> <button class="settings__test-btn svelte-1ke3hir"> </button> <!></section>'),Yw=C('<div class="settings__shortcut-context svelte-1ke3hir"> </div>'),$w=C('<div class="settings__shortcut svelte-1ke3hir"><div class="settings__shortcut-main svelte-1ke3hir"><div class="settings__shortcut-label svelte-1ke3hir"> </div> <div class="settings__shortcut-description svelte-1ke3hir"> </div> <!></div> <div class="settings__shortcut-keys svelte-1ke3hir"><input class="settings__shortcut-input svelte-1ke3hir" type="text" placeholder="Unassigned"/> <div class="settings__shortcut-actions svelte-1ke3hir"><button class="settings__shortcut-btn svelte-1ke3hir" type="button">Save</button> <button class="settings__shortcut-btn settings__shortcut-btn--ghost svelte-1ke3hir" type="button">Reset</button></div> <div class="settings__shortcut-default svelte-1ke3hir"> </div></div></div>'),jw=C(`<section class="settings__section svelte-1ke3hir"><div class="settings__section-header svelte-1ke3hir"><h3 class="settings__section-title svelte-1ke3hir">Keyboard Shortcuts</h3></div> <div class="settings__shortcuts svelte-1ke3hir"></div> <button class="settings__shortcut-reset-all svelte-1ke3hir" type="button">Reset all shortcuts</button> <p class="settings__shortcut-note svelte-1ke3hir">Tip: You can also customize these in SiYuan's native shortcut settings.</p></section>`),Ww=C('<div class="settings__footer svelte-1ke3hir"><button class="settings__save-btn svelte-1ke3hir">Save Settings</button></div>'),Hw=C('<div class="settings svelte-1ke3hir"><div class="settings__header svelte-1ke3hir"><h2 class="settings__title svelte-1ke3hir">Settings</h2> <!></div> <div class="settings__layout svelte-1ke3hir"><nav class="settings__nav svelte-1ke3hir"><button>General</button> <button>Global Filtering & Query</button> <button>Custom Statuses</button> <button>Shortcuts</button></nav> <div class="settings__content svelte-1ke3hir"><!></div></div> <!></div>');function Gw(n,e){dt(e,!0);let t=K(xe(Hi)),s=K(null),r=xe({}),a=K("general"),i=K(xe([])),l=K(xe({}));function c(){if(!e.shortcutManager){T(i,[],!0),T(l,{},!0);return}T(i,e.shortcutManager.getShortcutDisplay(),!0),T(l,o(i).reduce((U,O)=>(U[O.id]=O.currentHotkey||"",U),{}),!0)}function u(U,O){T(l,{...o(l),[U]:O},!0)}async function d(U){if(!e.shortcutManager)return;const O=await e.shortcutManager.updateShortcut(U,o(l)[U]??"");if(!O.success){G.error(O.message||"Failed to update shortcut.");return}G.success("Shortcut updated."),c()}async function f(U){e.shortcutManager&&(await e.shortcutManager.resetShortcut(U),G.success("Shortcut reset."),c())}async function v(){e.shortcutManager&&(await e.shortcutManager.resetAllShortcuts(),G.success("Shortcuts reset to defaults."),c())}xt(()=>{T(t,e.eventService.getConfig(),!0)}),xt(()=>{c()});async function y(){try{await e.eventService.saveConfig(o(t)),G.success("Settings saved successfully!"),e.onClose&&e.onClose()}catch(U){G.error("Failed to save settings: "+U)}}async function _(){T(s,"n8n"),r.n8n={success:!1,message:"Testing..."};try{const U=await e.eventService.testConnection();r.n8n={success:U.success,message:U.success?"Test successful!":U.message||"Test failed. Check configuration."}}catch(U){r.n8n={success:!1,message:"Error: "+(U instanceof Error?U.message:String(U))}}finally{T(s,null)}}var m=Hw(),g=h(m),b=p(h(g),2);{var x=U=>{var O=Uw();O.__click=function(...M){var B;(B=e.onClose)==null||B.apply(this,M)},S(U,O)};W(b,U=>{e.onClose&&U(x)})}var D=p(g,2),A=h(D),I=h(A);I.__click=()=>T(a,"general");var N=p(I,2);N.__click=()=>T(a,"filter");var P=p(N,2);P.__click=()=>T(a,"statuses");var H=p(P,2);H.__click=()=>T(a,"shortcuts");var j=p(A,2),Z=h(j);{var ae=U=>{var O=Bw(),M=h(O),B=p(h(M),2),se=h(B),ee=p(M,2),me=p(h(ee),2),he=p(ee,2),fe=p(h(he),2),De=p(he,2);De.__click=_;var Se=h(De),Fe=p(De,2);{var ve=z=>{var E=zw(),F=h(E);$(()=>{Xe(E,1,`settings__test-result ${r.n8n.success?"success":"error"}`,"svelte-1ke3hir"),R(F,r.n8n.message)}),S(z,E)};W(Fe,z=>{r.n8n&&z(ve)})}$(()=>{me.disabled=!o(t).n8n.enabled,fe.disabled=!o(t).n8n.enabled,De.disabled=!o(t).n8n.enabled||o(s)==="n8n",R(Se,o(s)==="n8n"?"Testing...":"Test Connection")}),Wi(se,()=>o(t).n8n.enabled,z=>o(t).n8n.enabled=z),it(me,()=>o(t).n8n.webhookUrl,z=>o(t).n8n.webhookUrl=z),it(fe,()=>o(t).n8n.sharedSecret,z=>o(t).n8n.sharedSecret=z),S(U,O)},re=U=>{var O=ut(),M=Qe(O);{var B=ee=>{Nw(ee,{get settingsService(){return e.settingsService},get repository(){return e.repository}})},se=ee=>{var me=ut(),he=Qe(me);{var fe=Se=>{Fw(Se,{})},De=Se=>{var Fe=ut(),ve=Qe(Fe);{var z=E=>{var F=jw(),X=p(h(F),2);je(X,21,()=>o(i),pt,(L,q)=>{var te=$w(),pe=h(te),ke=h(pe),ye=h(ke),Ee=p(ke,2),Ae=h(Ee),Ke=p(Ee,2);{var tt=We=>{var ze=Yw(),ct=h(ze);$(()=>R(ct,o(q).context)),S(We,ze)};W(Ke,We=>{o(q).context&&We(tt)})}var Ze=p(pe,2),lt=h(Ze);lt.__input=We=>u(o(q).id,We.currentTarget.value);var ft=p(lt,2),Me=h(ft);Me.__click=()=>d(o(q).id);var Le=p(Me,2);Le.__click=()=>f(o(q).id);var Ce=p(ft,2),Ue=h(Ce);$(()=>{R(ye,o(q).label),R(Ae,o(q).description),Io(lt,o(l)[o(q).id]??""),R(Ue,`Default: ${(o(q).defaultHotkey||"Unassigned")??""}`)}),S(L,te)});var ie=p(X,2);ie.__click=v,S(E,F)};W(ve,E=>{o(a)==="shortcuts"&&E(z)},!0)}S(Se,Fe)};W(he,Se=>{o(a)==="statuses"?Se(fe):Se(De,!1)},!0)}S(ee,me)};W(M,ee=>{o(a)==="filter"?ee(B):ee(se,!1)},!0)}S(U,O)};W(Z,U=>{o(a)==="general"?U(ae):U(re,!1)})}var de=p(D,2);{var V=U=>{var O=Ww(),M=h(O);M.__click=y,S(U,O)};W(de,U=>{o(a)==="general"&&U(V)})}$(()=>{Xe(I,1,`settings__nav-btn ${o(a)==="general"?"active":""}`,"svelte-1ke3hir"),Xe(N,1,`settings__nav-btn ${o(a)==="filter"?"active":""}`,"svelte-1ke3hir"),Xe(P,1,`settings__nav-btn ${o(a)==="statuses"?"active":""}`,"svelte-1ke3hir"),Xe(H,1,`settings__nav-btn ${o(a)==="shortcuts"?"active":""}`,"svelte-1ke3hir")}),S(n,m),ht()}bt(["click","input"]);var Kw=C('<div class="dashboard__overlay svelte-1y1a8hs"><!></div>'),Vw=C('<div class="dashboard__overlay svelte-1y1a8hs"><!></div>'),Qw=C('<span class="dashboard__tab-badge svelte-1y1a8hs"> </span>'),Zw=C('<span class="dashboard__tab-badge svelte-1y1a8hs"> </span>'),Xw=C('<span class="dashboard__tab-badge svelte-1y1a8hs"> </span>'),Jw=C('<span class="dashboard__tab-badge svelte-1y1a8hs"> </span>'),e_=C('<span class="dashboard__tab-badge svelte-1y1a8hs"> </span>'),t_=C('<div class="dashboard__filters svelte-1y1a8hs"><span class="dashboard__filters-label svelte-1y1a8hs">Quick Filters:</span> <button>Not Done</button> <button>Due Today</button> <button>Overdue</button> <button>In Progress</button> <button>Blocked</button> <button>Blocking</button> <button>High Priority</button></div>'),s_=C('<div class="dashboard__tabs svelte-1y1a8hs" role="tablist" aria-label="Dashboard tabs"><button id="dashboard-tab-inbox" role="tab" aria-controls="dashboard-panel"> Inbox <!></button> <button id="dashboard-tab-today" role="tab" aria-controls="dashboard-panel"> Today <!></button> <button id="dashboard-tab-upcoming" role="tab" aria-controls="dashboard-panel"> Upcoming <!></button> <button id="dashboard-tab-done" role="tab" aria-controls="dashboard-panel"> Done <!></button> <button id="dashboard-tab-projects" role="tab" aria-controls="dashboard-panel"> Projects <!></button> <button id="dashboard-tab-search" role="tab" aria-controls="dashboard-panel"> Search</button> <button id="dashboard-tab-all" role="tab" aria-controls="dashboard-panel"> All <span class="dashboard__tab-badge svelte-1y1a8hs"> </span></button> <button id="dashboard-tab-insights" role="tab" aria-controls="dashboard-panel"> Insights</button></div> <!> <div id="dashboard-panel" class="dashboard__content svelte-1y1a8hs" role="tabpanel"><!></div>',1),n_=C('<div class="dashboard svelte-1y1a8hs"><div class="dashboard__header svelte-1y1a8hs"><h1 class="dashboard__title svelte-1y1a8hs">Recurring Tasks</h1> <div class="dashboard__header-actions svelte-1y1a8hs"><button class="dashboard__refresh-btn svelte-1y1a8hs" title="Refresh tasks"> </button> <button class="dashboard__settings-btn svelte-1y1a8hs"> Settings</button></div></div> <!></div>');function r_(n,e){dt(e,!0),ff(qo,e.settingsService.get().urgency);const t=e.scheduler.getTimezoneHandler(),s=e.scheduler.getRecurrenceEngine();let r=K("today"),a=K(!1),i=K(!1),l=K(void 0),c=K(xe(new Set)),u=K(xe([])),d=Q(()=>Mv(o(u))),f=K(!1);const v=Q(()=>["inbox","today","upcoming","done","projects","search","all","insights"].includes(o(r))?`dashboard-tab-${o(r)}`:void 0),y=Q(()=>()=>{let E=o(u);if(o(c).has("notDone")&&(E=E.filter(F=>F.status!=="done"&&F.status!=="cancelled")),o(c).has("dueToday")){const F=new Date;F.setHours(0,0,0,0);const X=new Date(F);X.setDate(X.getDate()+1),E=E.filter(ie=>{if(!ie.dueAt)return!1;const L=new Date(ie.dueAt);return L>=F&&L<X})}if(o(c).has("overdue")){const F=new Date;F.setHours(0,0,0,0),E=E.filter(X=>!X.dueAt||X.status==="done"||X.status==="cancelled"?!1:new Date(X.dueAt)<F)}return o(c).has("inProgress")&&(E=E.filter(F=>F.status==="todo"&&F.statusSymbol&&F.statusSymbol!==" ")),o(c).has("blocked")&&(E=E.filter(F=>Dv(F,o(u)))),o(c).has("blocking")&&(E=E.filter(F=>Ev(F,o(u)))),o(c).has("highPriority")&&(E=E.filter(F=>{const X=Or(F.priority)||"normal";return X==="high"||X==="highest"})),E}),_=Q(()=>o(u).filter(E=>E.status!=="done"&&E.status!=="cancelled"&&!E.dueAt&&!E.scheduledAt&&!E.startAt).length),m=Q(()=>()=>{const E=new Date;E.setHours(0,0,0,0);const F=new Date(E);return F.setDate(F.getDate()+7),o(u).filter(X=>{if(X.status==="done"||X.status==="cancelled"||!X.dueAt)return!1;const ie=new Date(X.dueAt);return ie.setHours(0,0,0,0),ie>E&&ie<=F}).length}),g=Q(()=>()=>{const E=new Date;return E.setDate(E.getDate()-30),E.setHours(0,0,0,0),o(u).filter(F=>F.status!=="done"||!F.doneAt?!1:new Date(F.doneAt)>=E).length}),b=Q(()=>o(u).filter(E=>E.status!=="done"&&E.status!=="cancelled").length);function x(E="initial"){T(f,!0),T(u,e.repository.getAllTasks().map(F=>({...F})),!0),T(f,!1),E!=="initial"&&G.info("Task list reloaded")}x();const D=()=>x("reload");ha(()=>{window.addEventListener("recurring-task-refresh",D)}),lv(()=>{window.removeEventListener("recurring-task-refresh",D)});async function A(E){Ye.emit("task: complete",{taskId:E.id})}async function I(E){const F=o(u),X=ki(o(u),E.id,ie=>{const L={...ie},q=new Date(L.dueAt),te=t.tomorrow();return te.setHours(q.getHours(),q.getMinutes(),0,0),L.dueAt=te.toISOString(),L.snoozeCount=(L.snoozeCount||0)+1,L.updatedAt=new Date().toISOString(),L});T(u,X,!0),G.info(`Task "${E.name}" delayed to tomorrow`);try{await e.eventService.emitTaskEvent("task. snoozed",E),await e.scheduler.delayToTomorrow(E.id)}catch(ie){T(u,F,!0),G.error("Failed to delay task:  "+ie),x("external")}}async function N(E){var X;if(!((X=E.name)!=null&&X.trim())){G.error("Task name is required");return}if(!Uu(E.frequency)){G.error("Invalid frequency configuration");return}const F={...E};T(u,xa(o(u),F),!0),T(a,!1),T(l,void 0),G.success(`Task "${E.name}" saved successfully`),e.repository.saveTask(F).catch(ie=>{G.error("Failed to save task: "+ie),x("external")})}async function P(E){const F=o(u);T(u,Rl(o(u),E.id),!0);const X=window.setTimeout(async()=>{try{await e.repository.deleteTask(E.id)}catch(ie){T(u,F,!0),G.error("Failed to delete task: "+ie),x("external")}},5e3);Yn({message:`Task "${E.name}" deleted`,type:"success",duration:5e3,actionLabel:"Undo",onAction:()=>{window.clearTimeout(X),T(u,F,!0),G.info(`Restored "${E.name}"`)},showCountdown:!0})}async function H(E){const F=E.name.endsWith(" (copy)")?`${E.name} ${new Date().toLocaleDateString()}`:`${E.name} (copy)`,X=$u(E,{name:F});T(u,xa(o(u),X),!0),G.success(`Duplicated "${E.name}"`),e.repository.saveTask(X).catch(ie=>{T(u,Rl(o(u),X.id),!0),G.error("Failed to duplicate task: "+ie),x("external")})}async function j(E){const F=!E.enabled,X={...E,enabled:F},ie=ki(o(u),E.id,()=>X);T(u,ie,!0),G.info(`Task ${F?"enabled":"disabled"}`),e.repository.saveTask(X).catch(L=>{G.error("Failed to update task: "+L),x("external")})}async function Z(E,F){if(E.length===0)return;const X=o(u),ie=new Set(E),L=o(u).map(q=>ie.has(q.id)?{...q,enabled:F}:q);T(u,L,!0),G.info(`${F?"Enabled":"Disabled"} ${E.length} task${E.length===1?"":"s"}`);try{const q=L.filter(te=>ie.has(te.id));await Promise.all(q.map(te=>e.repository.saveTask(te)))}catch(q){T(u,X,!0),G.error(`Failed to ${F?"enable":"disable"} tasks: ${q}`),x("external")}}async function ae(E){if(E.length===0)return;const F=o(u),X=new Set(E),ie=o(u).filter(q=>X.has(q.id));T(u,o(u).filter(q=>!X.has(q.id)),!0);const L=window.setTimeout(async()=>{try{await Promise.all(ie.map(q=>e.repository.deleteTask(q.id)))}catch(q){T(u,F,!0),G.error("Failed to delete tasks: "+q),x("external")}},5e3);Yn({message:`${ie.length} task${ie.length===1?"":"s"} deleted`,type:"success",duration:5e3,actionLabel:"Undo",onAction:()=>{window.clearTimeout(L),T(u,F,!0),G.info("Bulk delete undone")},showCountdown:!0})}function re(E){T(l,E,!0),T(a,!0)}function de(){T(l,void 0),T(a,!0)}function V(){T(a,!1),T(l,void 0)}function U(){T(i,!0)}function O(){T(i,!1)}async function M(E){const F=o(u),X=ki(o(u),E.id,ie=>{const L={...ie};ju(L);const q=s.calculateNext(new Date(L.dueAt),L.frequency);return L.dueAt=q.toISOString(),L});T(u,X,!0),G.info(`Task "${E.name}" skipped to next occurrence`);try{await e.eventService.emitTaskEvent("task.skipped",E),await e.scheduler.skipTaskOccurrence(E.id)}catch(ie){T(u,F,!0),G.error("Failed to skip task: "+ie),x("external")}}function B(E){const F=new Set(o(c));F.has(E)?F.delete(E):F.add(E),T(c,F,!0)}async function se(E){const F={...E,status:"todo",doneAt:void 0};T(u,xa(o(u),F),!0),G.success(`Task "${E.name}" marked as not done`),e.repository.saveTask(F).catch(X=>{G.error("Failed to update task: "+X),x("external")})}var ee=n_(),me=h(ee),he=p(h(me),2),fe=h(he);fe.__click=()=>x("reload");var De=h(fe),Se=p(fe,2);Se.__click=U;var Fe=p(me,2);{var ve=E=>{var F=Kw(),X=h(F);Gw(X,{get eventService(){return e.eventService},get shortcutManager(){return e.shortcutManager},get settingsService(){return e.settingsService},get repository(){return e.repository},onClose:O}),S(E,F)},z=E=>{var F=ut(),X=Qe(F);{var ie=q=>{var te=Vw(),pe=h(te);md(pe,{get task(){return o(l)},get repository(){return e.repository},onSave:N,onClose:V}),S(q,te)},L=q=>{var te=s_(),pe=Qe(te),ke=h(pe);ke.__click=()=>T(r,"inbox");var ye=p(h(ke));{var Ee=le=>{var we=Qw(),Ie=h(we);$(()=>R(Ie,o(_))),S(le,we)};W(ye,le=>{o(_)>0&&le(Ee)})}var Ae=p(ke,2);Ae.__click=()=>T(r,"today");var Ke=p(h(Ae));{var tt=le=>{var we=Zw(),Ie=h(we);$(()=>R(Ie,o(d).length)),S(le,we)};W(Ke,le=>{o(d).length>0&&le(tt)})}var Ze=p(Ae,2);Ze.__click=()=>T(r,"upcoming");var lt=p(h(Ze));{var ft=le=>{var we=Xw(),Ie=h(we);$(()=>R(Ie,o(m))),S(le,we)};W(lt,le=>{o(m)>0&&le(ft)})}var Me=p(Ze,2);Me.__click=()=>T(r,"done");var Le=p(h(Me));{var Ce=le=>{var we=Jw(),Ie=h(we);$(()=>R(Ie,o(g))),S(le,we)};W(Le,le=>{o(g)>0&&le(Ce)})}var Ue=p(Me,2);Ue.__click=()=>T(r,"projects");var We=p(h(Ue));{var ze=le=>{var we=e_(),Ie=h(we);$(()=>R(Ie,o(b))),S(le,we)};W(We,le=>{o(b)>0&&le(ze)})}var ct=p(Ue,2);ct.__click=()=>T(r,"search");var It=p(ct,2);It.__click=()=>T(r,"all");var Jt=p(h(It)),vs=h(Jt),Ft=p(It,2);Ft.__click=()=>T(r,"insights");var es=p(pe,2);{var ps=le=>{var we=t_(),Ie=p(h(we),2);Ie.__click=()=>B("notDone");var vt=p(Ie,2);vt.__click=()=>B("dueToday");var Ut=p(vt,2);Ut.__click=()=>B("overdue");var _t=p(Ut,2);_t.__click=()=>B("inProgress");var jt=p(_t,2);jt.__click=()=>B("blocked");var kt=p(jt,2);kt.__click=()=>B("blocking");var Ot=p(kt,2);Ot.__click=()=>B("highPriority"),$((As,zt,ts,Wt,Y,ge,et)=>{Xe(Ie,1,`dashboard__filter-btn ${As??""}`,"svelte-1y1a8hs"),Xe(vt,1,`dashboard__filter-btn ${zt??""}`,"svelte-1y1a8hs"),Xe(Ut,1,`dashboard__filter-btn ${ts??""}`,"svelte-1y1a8hs"),Xe(_t,1,`dashboard__filter-btn ${Wt??""}`,"svelte-1y1a8hs"),Xe(jt,1,`dashboard__filter-btn ${Y??""}`,"svelte-1y1a8hs"),Xe(kt,1,`dashboard__filter-btn ${ge??""}`,"svelte-1y1a8hs"),Xe(Ot,1,`dashboard__filter-btn ${et??""}`,"svelte-1y1a8hs")},[()=>o(c).has("notDone")?"active":"",()=>o(c).has("dueToday")?"active":"",()=>o(c).has("overdue")?"active":"",()=>o(c).has("inProgress")?"active":"",()=>o(c).has("blocked")?"active":"",()=>o(c).has("blocking")?"active":"",()=>o(c).has("highPriority")?"active":""]),S(le,we)};W(es,le=>{o(r)!=="search"&&o(r)!=="timeline"&&o(r)!=="analytics"&&o(r)!=="insights"&&le(ps)})}var ne=p(es,2),be=h(ne);{var qe=le=>{{let we=Q(()=>o(c).size>0?o(y):o(u));Rp(le,{get tasks(){return o(we)},onEdit:re,onDone:A,onDelete:P})}},Oe=le=>{var we=ut(),Ie=Qe(we);{var vt=_t=>{{let jt=Q(()=>o(c).size>0?o(y).filter(kt=>o(d).some(Ot=>Ot.id===kt.id)):o(d));tp(_t,{get tasks(){return o(jt)},onDone:A,onDelay:I,onSkip:M,onEdit:re,get timezoneHandler(){return t}})}},Ut=_t=>{var jt=ut(),kt=Qe(jt);{var Ot=zt=>{{let ts=Q(()=>o(c).size>0?o(y):o(u));Up(zt,{get tasks(){return o(ts)},onEdit:re,onDone:A,onDelete:P})}},As=zt=>{var ts=ut(),Wt=Qe(ts);{var Y=et=>{{let ss=Q(()=>o(c).size>0?o(y):o(u));Hp(et,{get tasks(){return o(ss)},onEdit:re,onDelete:P,onUncomplete:se})}},ge=et=>{var ss=ut(),Ht=Qe(ss);{var dn=Nt=>{{let hn=Q(()=>o(c).size>0?o(y):o(u));Xp(Nt,{get tasks(){return o(hn)},onEdit:re,onDone:A,onDelete:P})}},Ve=Nt=>{var hn=ut(),ui=Qe(hn);{var di=fn=>{Ly(fn,{get tasks(){return o(u)},onEdit:re,onDone:A,onDelete:P})},pa=fn=>{var Go=ut(),_d=Qe(Go);{var kd=lr=>{{let ga=Q(()=>o(c).size>0?o(y):o(u));up(lr,{get tasks(){return o(ga)},onEdit:re,onDelete:P,onDuplicate:H,onToggleEnabled:j,onBulkEnable:Br=>Z(Br,!0),onBulkDisable:Br=>Z(Br,!1),onBulkDelete:ae,onCreate:de})}},Td=lr=>{var ga=ut(),Br=Qe(ga);{var Sd=cr=>{bp(cr,{get tasks(){return o(u)},get recurrenceEngine(){return s}})},xd=cr=>{var Ko=ut(),Dd=Qe(Ko);{var Ed=ur=>{Mp(ur,{get tasks(){return o(u)}})},Ad=ur=>{var Vo=ut(),Cd=Qe(Vo);{var Md=hi=>{Ky(hi,{get tasks(){return o(u)},onApplySuggestion:async(ma,fi)=>{const Qo={...ma,frequency:fi.suggestedSchedule.frequency,dueAt:fi.suggestedSchedule.time?(()=>{const ya=new Date(ma.dueAt),[Id,Od]=fi.suggestedSchedule.time.split(":").map(Number);return ya.setHours(Id,Od||0,0,0),ya.toISOString()})():ma.dueAt,updatedAt:new Date().toISOString()};T(u,xa(o(u),Qo),!0),G.success(`Schedule updated for "${ma.name}"`);try{await e.repository.saveTask(Qo)}catch(ya){G.error("Failed to save schedule update: "+ya),x("external")}}})};W(Cd,hi=>{o(r)==="insights"&&hi(Md)},!0)}S(ur,Vo)};W(Dd,ur=>{o(r)==="analytics"?ur(Ed):ur(Ad,!1)},!0)}S(cr,Ko)};W(Br,cr=>{o(r)==="timeline"?cr(Sd):cr(xd,!1)},!0)}S(lr,ga)};W(_d,lr=>{o(r)==="all"?lr(kd):lr(Td,!1)},!0)}S(fn,Go)};W(ui,fn=>{o(r)==="search"?fn(di):fn(pa,!1)},!0)}S(Nt,hn)};W(Ht,Nt=>{o(r)==="projects"?Nt(dn):Nt(Ve,!1)},!0)}S(et,ss)};W(Wt,et=>{o(r)==="done"?et(Y):et(ge,!1)},!0)}S(zt,ts)};W(kt,zt=>{o(r)==="upcoming"?zt(Ot):zt(As,!1)},!0)}S(_t,jt)};W(Ie,_t=>{o(r)==="today"?_t(vt):_t(Ut,!1)},!0)}S(le,we)};W(be,le=>{o(r)==="inbox"?le(qe):le(Oe,!1)})}$(()=>{Xe(ke,1,`dashboard__tab ${o(r)==="inbox"?"active":""}`,"svelte-1y1a8hs"),Ne(ke,"aria-selected",o(r)==="inbox"),Xe(Ae,1,`dashboard__tab ${o(r)==="today"?"active":""}`,"svelte-1y1a8hs"),Ne(Ae,"aria-selected",o(r)==="today"),Xe(Ze,1,`dashboard__tab ${o(r)==="upcoming"?"active":""}`,"svelte-1y1a8hs"),Ne(Ze,"aria-selected",o(r)==="upcoming"),Xe(Me,1,`dashboard__tab ${o(r)==="done"?"active":""}`,"svelte-1y1a8hs"),Ne(Me,"aria-selected",o(r)==="done"),Xe(Ue,1,`dashboard__tab ${o(r)==="projects"?"active":""}`,"svelte-1y1a8hs"),Ne(Ue,"aria-selected",o(r)==="projects"),Xe(ct,1,`dashboard__tab ${o(r)==="search"?"active":""}`,"svelte-1y1a8hs"),Ne(ct,"aria-selected",o(r)==="search"),Xe(It,1,`dashboard__tab ${o(r)==="all"?"active":""}`,"svelte-1y1a8hs"),Ne(It,"aria-selected",o(r)==="all"),R(vs,o(u).length),Xe(Ft,1,`dashboard__tab ${o(r)==="insights"?"active":""}`,"svelte-1y1a8hs"),Ne(Ft,"aria-selected",o(r)==="insights"),Ne(ne,"aria-labelledby",o(v))}),S(q,te)};W(X,q=>{o(a)?q(ie):q(L,!1)},!0)}S(E,F)};W(Fe,E=>{o(i)?E(ve):E(z,!1)})}$(()=>{fe.disabled=o(f),R(De,o(f)?"":"")}),S(n,ee),ht()}bt(["click"]);var a_=C('<div class="quick-add-card__error svelte-1q3w22"> </div>'),i_=C('<div class="quick-add-card__error svelte-1q3w22"> </div>'),o_=C('<div class="quick-add-card__linked svelte-1q3w22">Linked block: <span class="svelte-1q3w22"> </span></div>'),l_=C('<button class="quick-add-card__advanced svelte-1q3w22" type="button">Advanced...</button>'),c_=C('<div class="quick-add-overlay svelte-1q3w22" role="dialog" aria-modal="true" aria-labelledby="quick-add-title"><div class="quick-add-card svelte-1q3w22" role="document"><div class="quick-add-card__header svelte-1q3w22"><h2 id="quick-add-title" class="svelte-1q3w22">Quick Add</h2> <button class="quick-add-card__close svelte-1q3w22" type="button" aria-label="Close"></button></div> <div class="quick-add-card__field svelte-1q3w22"><label for="quick-task-name">Task Name *</label> <input id="quick-task-name" type="text" placeholder="e.g. Review daily notes" class="svelte-1q3w22"/> <!></div> <div class="quick-add-card__field svelte-1q3w22"><label for="quick-task-due">Due *</label> <input id="quick-task-due" type="datetime-local" class="svelte-1q3w22"/> <!></div> <!> <div class="quick-add-card__actions svelte-1q3w22"><button class="quick-add-card__cancel svelte-1q3w22" type="button">Cancel</button> <!> <button class="quick-add-card__save svelte-1q3w22" type="button"> </button></div> <p class="quick-add-card__hint svelte-1q3w22">Tip: Press /Ctrl + Enter to save.</p></div></div>');function u_(n,e){var O;dt(e,!0);let t=K(xe(((O=e.prefill)==null?void 0:O.suggestedName)??"")),s=K(xe(new Date().toISOString().slice(0,16))),r=K(xe({name:!1,dueAt:!1})),a=K(!1),i=K(null);const l=Q(()=>o(r).name&&!o(t).trim()?"Task name is required.":""),c=Q(()=>o(r).dueAt?o(s)?Number.isNaN(new Date(o(s)).getTime())?"Enter a valid date and time.":"":"Due date and time are required.":""),u=Q(()=>!!(o(l)||o(c)));ha(()=>{var M;if((M=e.prefill)!=null&&M.suggestedTime){const B=new Date,[se,ee]=e.prefill.suggestedTime.split(":").map(Number);B.setHours(se,ee,0,0),T(s,B.toISOString().slice(0,16),!0)}requestAnimationFrame(()=>{var B;(B=o(i))==null||B.focus()})});async function d(){var ee,me;if(T(r,{name:!0,dueAt:!0},!0),o(u)){G.warning("Please fill out the required fields.");return}const M=uv(),B=o(s).slice(11,16);if(M.time=B,!Uu(M)){G.error("Invalid frequency configuration.");return}const se=Bu(o(t).trim(),M,new Date(o(s)));se.linkedBlockId=((ee=e.prefill)==null?void 0:ee.linkedBlockId)||void 0,se.linkedBlockContent=((me=e.prefill)==null?void 0:me.linkedBlockContent)||void 0,T(a,!0);try{await e.repository.saveTask(se),G.success(`Task "${se.name}" created`),Ye.emit("task:refresh",void 0),window.dispatchEvent(new CustomEvent("recurring-task-refresh")),e.onClose()}catch(he){G.error("Failed to create task: "+he)}finally{T(a,!1)}}function f(M){M.key==="Escape"&&e.onClose(),(M.metaKey||M.ctrlKey)&&M.key==="Enter"&&(M.preventDefault(),d())}var v=c_();v.__keydown=f;var y=h(v),_=h(y),m=p(h(_),2);m.__click=function(...M){var B;(B=e.onClose)==null||B.apply(this,M)};var g=p(_,2),b=p(h(g),2);b.__input=()=>o(r).name=!0,Ps(b,M=>T(i,M),()=>o(i));var x=p(b,2);{var D=M=>{var B=a_(),se=h(B);$(()=>R(se,o(l))),S(M,B)};W(x,M=>{o(l)&&M(D)})}var A=p(g,2),I=p(h(A),2);I.__input=()=>o(r).dueAt=!0;var N=p(I,2);{var P=M=>{var B=i_(),se=h(B);$(()=>R(se,o(c))),S(M,B)};W(N,M=>{o(c)&&M(P)})}var H=p(A,2);{var j=M=>{var B=o_(),se=p(h(B)),ee=h(se);$(()=>R(ee,e.prefill.linkedBlockId)),S(M,B)};W(H,M=>{var B;(B=e.prefill)!=null&&B.linkedBlockId&&M(j)})}var Z=p(H,2),ae=h(Z);ae.__click=function(...M){var B;(B=e.onClose)==null||B.apply(this,M)};var re=p(ae,2);{var de=M=>{var B=l_();B.__click=function(...se){var ee;(ee=e.onAdvanced)==null||ee.apply(this,se)},S(M,B)};W(re,M=>{e.onAdvanced&&M(de)})}var V=p(re,2);V.__click=d;var U=h(V);$(()=>{Ne(b,"aria-invalid",!!o(l)),Ne(I,"aria-invalid",!!o(c)),V.disabled=o(a),R(U,o(a)?"Saving":"Create Task")}),Lt("blur",b,()=>o(r).name=!0),it(b,()=>o(t),M=>T(t,M)),Lt("blur",I,()=>o(r).dueAt=!0),it(I,()=>o(s),M=>T(s,M)),S(n,v),ht()}bt(["keydown","click","input"]);var d_=C('<button class="postpone-card__option svelte-tkdeu6" type="button" role="listitem"> </button>'),h_=C('<div class="postpone-overlay svelte-tkdeu6" role="dialog" aria-modal="true" aria-labelledby="postpone-title"><div class="postpone-card svelte-tkdeu6" role="document"><div class="postpone-card__header svelte-tkdeu6"><h2 id="postpone-title" class="svelte-tkdeu6">Postpone task</h2> <button class="postpone-card__close svelte-tkdeu6" type="button" aria-label="Close"></button></div> <p class="postpone-card__summary svelte-tkdeu6">Choose a new due offset for <strong> </strong>.</p> <div class="postpone-card__options svelte-tkdeu6" role="list"></div> <div class="postpone-card__actions svelte-tkdeu6"><button class="postpone-card__cancel svelte-tkdeu6" type="button">Cancel</button></div></div></div>');function f_(n,e){dt(e,!0);let t=K(null);function s(m,g){g&&T(t,m,!0)}ha(()=>{requestAnimationFrame(()=>{var m;(m=o(t))==null||m.focus()})});function r(m){m.key==="Escape"&&e.onClose()}var a=h_();a.__keydown=r;var i=h(a),l=h(i),c=p(h(l),2);c.__click=function(...m){var g;(g=e.onClose)==null||g.apply(this,m)};var u=p(l,2),d=p(h(u)),f=h(d),v=p(u,2);je(v,21,()=>gv,pt,(m,g,b)=>{var x=d_();x.__click=()=>e.onSelect(o(g).minutes);var D=h(x);Xf(x,(A,I)=>s==null?void 0:s(A,I),()=>b===0),$(()=>R(D,o(g).label)),S(m,x)});var y=p(v,2),_=h(y);_.__click=function(...m){var g;(g=e.onClose)==null||g.apply(this,m)},$(()=>R(f,e.taskName)),S(n,a),ht()}bt(["keydown","click"]);function yd(){return Intl.DateTimeFormat().resolvedOptions().timeZone}class v_{static migrateFrequency(e,t){if(e.rruleString)return e;const s=this.legacyToRRule(e),r=t?t.toISOString():new Date().toISOString();return{...e,rruleString:s.toString(),dtstart:r,naturalLanguage:s.toText(),timezone:e.timezone||yd()}}static legacyToRRule(e){const t={freq:this.mapFreqType(e.type),interval:e.interval||1};return e.type==="weekly"&&e.weekdays&&e.weekdays.length>0&&(t.byweekday=e.weekdays.map(this.mapWeekday)),e.type==="monthly"&&e.dayOfMonth&&(e.dayOfMonth===31?t.bymonthday=-1:t.bymonthday=e.dayOfMonth),e.type==="yearly"&&(e.month!==void 0&&(t.bymonth=e.month+1),e.dayOfMonth&&(e.dayOfMonth===31?t.bymonthday=-1:t.bymonthday=e.dayOfMonth)),new oe(t)}static mapFreqType(e){switch(e){case"daily":return oe.DAILY;case"weekly":return oe.WEEKLY;case"monthly":return oe.MONTHLY;case"yearly":return oe.YEARLY;default:return oe.DAILY}}static mapWeekday(e){return[oe.MO,oe.TU,oe.WE,oe.TH,oe.FR,oe.SA,oe.SU][e]||oe.MO}static migrateTask(e){var t;if((t=e.frequency)!=null&&t.rruleString||!e.frequency)return e;try{const s=new Date(e.dueAt),r=this.migrateFrequency(e.frequency,s),a={type:e.frequency.type,interval:e.frequency.interval,weekdays:"weekdays"in e.frequency?e.frequency.weekdays:void 0,dayOfMonth:"dayOfMonth"in e.frequency?e.frequency.dayOfMonth:void 0,month:"month"in e.frequency?e.frequency.month:void 0,migratedAt:new Date().toISOString()};return{...e,frequency:r,legacyRecurrenceSnapshot:a,updatedAt:new Date().toISOString()}}catch(s){throw Te(`Failed to migrate task ${e.id}:`,s),s}}}async function p_(n){let e=0,t=0,s=0;const r=[];for(const a of n)try{if(!a.frequency){t++,r.push(a);continue}if(a.frequency.rruleString){t++,r.push(a);continue}const i=v_.migrateTask(a);r.push(i),e++,ue(`Migrated task ${a.id} to RRULE format`)}catch(i){Te(`Failed to migrate task ${a.id}:`,i),s++,r.push(a)}return ue(`RRULE Migration complete: ${e} migrated, ${t} skipped, ${s} errors`),{migrated:e,skipped:t,errors:s,migratedTasks:r}}class g_{constructor(e){w(this,"plugin");this.plugin=e}getCurrentVersion(){return gn}async createBackup(e,t){try{const s=await this.plugin.loadData(e);if(s){const r=new Date().toISOString().replace(/[:.]/g,"-"),a=t!==void 0?`v${t}`:"unknown",i=`${e}-backup-${a}-${r}`;return await this.plugin.saveData(i,s),ue(`Created backup: ${i}`),i}throw new Error("No data to backup")}catch(s){throw Te("Failed to create backup",s),s}}async migrate(e){try{const t=await this.plugin.loadData(e);if(!t)return ue("No data to migrate"),{migrated:!1,tasksAffected:0,toVersion:gn};const s=Array.isArray(t)?t:Array.isArray(t.tasks)?t.tasks:[];if(s.length===0)return ue("No data to migrate"),{migrated:!1,tasksAffected:0,toVersion:gn};let r=!1,a,i,l=0;for(let u=0;u<s.length;u++){const d=s[u],f=d.version||0;f<gn&&(r||(i=f,a=await this.createBackup(e,f),r=!0),s[u]=this.migrateTask(d,f),l++,ue(`Migrated task ${d.id} from v${f} to v${gn}`))}const c=await p_(s);if(c.migrated>0){r||(i=4,a=await this.createBackup(e,i),r=!0),l+=c.migrated;for(let u=0;u<c.migratedTasks.length;u++)s[u]=c.migratedTasks[u]}if(r){const u=Array.isArray(t)?s:{...t,tasks:s};return await this.plugin.saveData(e,u),ue(`Migration complete: ${l} tasks migrated`),{migrated:!0,tasksAffected:l,fromVersion:i,toVersion:gn,backupKey:a}}else return ue("No migration needed - all tasks up to date"),{migrated:!1,tasksAffected:0,toVersion:gn}}catch(t){throw Te("Migration failed",t),t}}migrateTask(e,t){let s={...e};return t<1&&(s.version=1),t<2&&(s={...s,version:2,timezone:s.timezone||Intl.DateTimeFormat().resolvedOptions().timeZone,completionCount:s.completionCount||0,missCount:s.missCount||0,currentStreak:s.currentStreak||0,bestStreak:s.bestStreak||0,recentCompletions:s.recentCompletions||[],priority:s.priority||"normal",tags:s.tags||[],notificationChannels:s.notificationChannels||[],snoozeCount:s.snoozeCount||0,maxSnoozes:s.maxSnoozes||3}),t<3&&(s={...s,version:3,escalationPolicy:s.escalationPolicy||{enabled:!1,levels:[]},linkedBlockContent:s.linkedBlockContent||void 0,category:s.category||void 0,description:s.description||void 0}),t<4&&(s={...s,version:4,onCompletion:s.onCompletion||"keep",dependsOn:s.dependsOn||[],blockedBy:s.blockedBy||[]}),t<5&&(s={...s,version:5}),s}}class m_{constructor(e,t=50){w(this,"pendingState",null);w(this,"writeInProgress",!1);w(this,"scheduledTimer",null);w(this,"flushResolvers",[]);this.writer=e,this.debounceMs=t}requestSave(e){this.pendingState=e,!(this.writeInProgress||this.scheduledTimer)&&(this.scheduledTimer=setTimeout(()=>{this.scheduledTimer=null,this.drainQueue()},this.debounceMs))}async flush(){if(!(!this.pendingState&&!this.writeInProgress&&!this.scheduledTimer))return new Promise(e=>{this.flushResolvers.push(e),!this.writeInProgress&&!this.scheduledTimer&&this.pendingState&&this.drainQueue()})}async drainQueue(){if(!this.writeInProgress){this.writeInProgress=!0;try{for(;this.pendingState;){const e=this.pendingState;if(this.pendingState=null,!await this.writeWithRetry(e)){this.pendingState=e;break}}}finally{this.writeInProgress=!1,this.pendingState||this.resolveFlushes(),this.pendingState&&!this.scheduledTimer&&(this.scheduledTimer=setTimeout(()=>{this.scheduledTimer=null,this.drainQueue()},this.debounceMs))}}}async writeWithRetry(e){try{return await this.writer.write(e),!0}catch(t){Te("Task persistence write failed, retrying once",t)}try{return await this.writer.write(e),!0}catch(t){return Te("Task persistence write failed after retry",t),!1}}resolveFlushes(){if(this.flushResolvers.length===0)return;const e=[...this.flushResolvers];this.flushResolvers=[];for(const t of e)t()}}const lo={},y_=Object.freeze(Object.defineProperty({__proto__:null,default:lo},Symbol.toStringTag,{value:"Module"})),Tc=new Set;function Pa(n){const e=`${n.feature}:${n.capability}:${n.message}`;Tc.has(e)||(Tc.add(e),ot(n.message,{feature:n.feature,capability:n.capability,cause:n.cause}))}class bd extends Error{constructor(t,s,r){super(r);w(this,"capability");w(this,"feature");this.name="SiYuanCapabilityError",this.feature=t,this.capability=s}}class wd extends Error{constructor(t,s,r,a){super(r);w(this,"capability");w(this,"feature");w(this,"cause");this.name="SiYuanApiExecutionError",this.feature=t,this.capability=s,this.cause=a}}class b_{constructor(e=globalThis){w(this,"supportedCapabilities");w(this,"globalScope");this.globalScope=e,this.supportedCapabilities={setBlockAttrs:this.isSetBlockAttrsAvailable(),dataDir:this.isDataDirAvailable()}}isSetBlockAttrsAvailable(){var e;return typeof((e=this.globalScope)==null?void 0:e.setBlockAttrs)=="function"}isDataDirAvailable(){var e,t,s,r;return typeof((r=(s=(t=(e=this.globalScope)==null?void 0:e.siyuan)==null?void 0:t.config)==null?void 0:s.system)==null?void 0:r.dataDir)=="string"}getDataDir(){var e,t,s;return this.isDataDirAvailable()?((s=(t=(e=this.globalScope.siyuan)==null?void 0:e.config)==null?void 0:t.system)==null?void 0:s.dataDir)??null:null}async setBlockAttrs(e,t){const s=this.getSetBlockAttrs();try{await s(e,t)}catch(r){throw new wd("Block attribute sync","setBlockAttrs","Failed to sync block attributes via SiYuan API.",r)}}getSetBlockAttrs(){if(!this.isSetBlockAttrsAvailable())throw new bd("Block attribute sync","setBlockAttrs","Block attribute sync unavailable in this SiYuan version. Tasks will continue without block sync.");return this.globalScope.setBlockAttrs}}const w_=".tmp";class __{constructor(e,t){w(this,"plugin");w(this,"apiAdapter");w(this,"fsPromises");this.plugin=e,this.apiAdapter=t}async loadActive(){try{const e=await this.plugin.loadData(Bn);if(e&&Array.isArray(e.tasks))return new Map(e.tasks.map(t=>[t.id,t]))}catch(e){Te("Failed to load active tasks",e)}return new Map}async saveActive(e){await this.write({tasks:Array.from(e.values())})}async write(e){try{await this.saveActiveAtomic(e),ue(`Saved ${e.tasks.length} active tasks`)}catch(t){throw Te("Failed to save active tasks",t),t}}async saveActiveAtomic(e){const t=await this.getFsPromises();if(!t){await this.plugin.saveData(Bn,e);return}const s=this.resolveStoragePath(Bn);if(!s){await this.plugin.saveData(Bn,e);return}const r=lo.dirname(s);await t.mkdir(r,{recursive:!0});const a=`${s}${w_}`,i=JSON.stringify(e),l=await t.open(a,"w");try{await l.writeFile(i,"utf8"),await l.sync()}finally{await l.close()}try{await t.rename(a,s)}catch{await t.rm(s,{force:!0}),await t.rename(a,s)}}async getFsPromises(){if(this.fsPromises!==void 0)return this.fsPromises;try{const e=await Promise.resolve().then(()=>y_);return this.fsPromises=e.promises,this.fsPromises}catch(e){return ot("Node.js fs unavailable; falling back to plugin storage without atomic writes.",e),this.fsPromises=null,null}}resolveStoragePath(e){const t=this.apiAdapter.getDataDir(),s=this.plugin.name;return!t||!s?(t||Pa({feature:"Atomic task storage",capability:"dataDir",message:"SiYuan dataDir unavailable; falling back to plugin storage without atomic writes."}),null):lo.join(t,"storage",`p${s}`,`${e}.json`)}}const Sc=1,xc=1e3;class k_{constructor(e){w(this,"plugin");this.plugin=e}async archiveTask(e){await this.archiveTasks([e])}async archiveTasks(e){if(e.length===0)return;const t=await this.loadIndex(),s=this.groupByYear(e);for(const[r,a]of s.entries())await this.appendTasksToYear(t,r,a);await this.saveIndex(t)}async loadArchive(e){const t=await this.loadIndex();if(t.chunks.length===0)return[];const s=this.filterChunks(t.chunks,e),r=[];for(const l of s){const c=await this.loadChunk(l.key);if(c)for(const u of c.tasks)this.matchesQuery(u,e)&&r.push(u)}const a=(e==null?void 0:e.offset)??0,i=(e==null?void 0:e.limit)??r.length;return r.slice(a,a+i)}async loadIndex(){try{const e=await this.plugin.loadData(Oa);if(e&&typeof e=="object"&&Array.isArray(e.chunks))return{version:e.version??Sc,totalCount:e.totalCount??0,chunks:e.chunks}}catch(e){Te("Failed to load archive index",e)}return{version:Sc,totalCount:0,chunks:[]}}async saveIndex(e){try{await this.plugin.saveData(Oa,e)}catch(t){throw Te("Failed to save archive index",t),t}}buildChunkKey(e,t){return`${Oa}-${e}-${t}`}async loadChunk(e){try{const t=await this.plugin.loadData(e);if(t&&Array.isArray(t.tasks))return t}catch(t){Te("Failed to load archive chunk",{key:e,err:t})}return null}async saveChunk(e,t){try{await this.plugin.saveData(e,t)}catch(s){throw Te("Failed to save archive chunk",{key:e,err:s}),s}}groupByYear(e){const t=new Map;for(const s of e){const r=this.getCompletionTimestamp(s),a=new Date(r).getFullYear(),i=t.get(a);i?i.push(s):t.set(a,[s])}return t}async appendTasksToYear(e,t,s){let r=[...s];for(;r.length>0;){const a=this.findOrCreateChunk(e,t),i=await this.loadChunk(a.key)||{tasks:[]},l=xc-i.tasks.length,c=r.slice(0,l);i.tasks.push(...c),r=r.slice(c.length);const u=this.updateChunkMeta(a,c);a.count=u.count,a.start=u.start,a.end=u.end,await this.saveChunk(a.key,i),e.totalCount+=c.length}}findOrCreateChunk(e,t){const r=e.chunks.filter(l=>l.year===t).sort((l,c)=>l.sequence-c.sequence).at(-1);if(r&&r.count<xc)return r;const a=r?r.sequence+1:1,i={key:this.buildChunkKey(t,a),year:t,sequence:a,count:0};return e.chunks.push(i),i}updateChunkMeta(e,t){let s=e.start,r=e.end;for(const a of t){const i=this.getCompletionTimestamp(a);(!s||i<s)&&(s=i),(!r||i>r)&&(r=i)}return{...e,count:e.count+t.length,start:s,end:r}}filterChunks(e,t){if(!(t!=null&&t.from)&&!(t!=null&&t.to))return e;const s=t!=null&&t.from?new Date(t.from).getTime():null,r=t!=null&&t.to?new Date(t.to).getTime():null;return e.filter(a=>{const i=a.start?new Date(a.start).getTime():null,l=a.end?new Date(a.end).getTime():null;return!(s&&l&&l<s||r&&i&&i>r)})}matchesQuery(e,t){if(!t)return!0;if(t.taskId&&e.id!==t.taskId)return!1;const s=this.getCompletionTimestamp(e),r=new Date(s).getTime();return!(t.from&&r<new Date(t.from).getTime()||t.to&&r>new Date(t.to).getTime())}getCompletionTimestamp(e){return e.lastCompletedAt||e.updatedAt||e.dueAt}}class T_{constructor(e,t=new b_){w(this,"plugin");w(this,"activeTasks");w(this,"blockIndex",new Map);w(this,"taskBlockIndex",new Map);w(this,"dueIndex",new Map);w(this,"activeStore");w(this,"archiveStore");w(this,"persistence");w(this,"blockAttrSyncEnabled",!0);w(this,"blockApi");w(this,"apiAdapter");w(this,"syncRetryQueue",new Map);w(this,"retryProcessorInterval");this.plugin=e,this.activeTasks=new Map,this.apiAdapter=t,this.blockApi=t,this.activeStore=new __(e,t),this.archiveStore=new k_(e),this.persistence=new m_(this.activeStore)}async init(){await this.migrateLegacyStorage();const e=await this.activeStore.loadActive(),t=us.getInstance(),s=new Map;for(const[r,a]of e.entries())t.shouldIncludeTask(a)&&s.set(r,a);this.activeTasks=s,ue(`Loaded ${this.activeTasks.size} active tasks from storage (after global filter)`),this.rebuildBlockIndex(),this.rebuildDueIndex(),this.startSyncRetryProcessor()}async loadActiveTasks(e=1e3,t){const s=await this.activeStore.loadActive(),r=Array.from(s.values()),a=us.getInstance(),i=r.filter(u=>a.shouldIncludeTask(u)),l=i.length;if(l===0)return[];const c=[];for(let u=0;u<l;u+=e){const d=i.slice(u,Math.min(u+e,l));c.push(...d),t&&t(c.length,l),await new Promise(f=>setTimeout(f,0))}return c}rebuildBlockIndex(){this.blockIndex.clear(),this.taskBlockIndex.clear();for(const e of this.activeTasks.values())e.linkedBlockId&&(this.blockIndex.set(e.linkedBlockId,e.id),this.taskBlockIndex.set(e.id,e.linkedBlockId));ue(`Rebuilt block index with ${this.blockIndex.size} entries`)}rebuildDueIndex(){this.dueIndex.clear();for(const e of this.activeTasks.values())e.enabled&&this.addToDueIndex(e);ue(`Rebuilt due index with ${this.dueIndex.size} date entries`)}addToDueIndex(e){const t=e.dueAt.slice(0,10);this.dueIndex.has(t)||this.dueIndex.set(t,new Set),this.dueIndex.get(t).add(e.id)}removeFromDueIndex(e){const t=e.dueAt.slice(0,10),s=this.dueIndex.get(t);s&&(s.delete(e.id),s.size===0&&this.dueIndex.delete(t))}getTasksDueOn(e){const t=e.toISOString().slice(0,10);return this.getTasksForDueKey(t)}getTasksDueOnOrBefore(e){const t=e.toISOString().slice(0,10),s=[];for(const[r]of this.dueIndex)r<=t&&s.push(...this.getTasksForDueKey(r));return s}getTasksForDueKey(e){const t=this.dueIndex.get(e);if(!t)return[];const s=[];for(const r of t){const a=this.activeTasks.get(r);if(!a){this.removeStaleDueIndexEntry(e,r,"missing task");continue}if(!a.enabled){this.removeStaleDueIndexEntry(e,r,"task disabled");continue}if(a.dueAt.slice(0,10)!==e){this.removeStaleDueIndexEntry(e,r,"date mismatch");continue}s.push(a)}return s}removeStaleDueIndexEntry(e,t,s){const r=this.dueIndex.get(e);r&&(r.delete(t),r.size===0&&this.dueIndex.delete(e),ot("Removed stale due index entry",{taskId:t,dateKey:e,reason:s}))}async save(){this.persistence.requestSave({tasks:Array.from(this.activeTasks.values())})}async flush(){await this.persistence.flush()}getAllTasks(){return Array.from(this.activeTasks.values())}getTask(e){return this.activeTasks.get(e)}getTaskByBlockId(e){const t=this.blockIndex.get(e);return t?this.activeTasks.get(t):void 0}async saveTask(e){const t=this.activeTasks.get(e.id);if(t&&e.version!==void 0&&t.version!==void 0&&e.version<t.version)throw new Error(`Concurrent modification detected for task "${e.name}". Please refresh and try again.`);e.version=(e.version??0)+1;const s=this.activeTasks.get(e.id),r=this.taskBlockIndex.get(e.id);r&&r!==e.linkedBlockId&&(this.blockIndex.delete(r),this.taskBlockIndex.delete(e.id)),s&&s.enabled&&(s.dueAt!==e.dueAt||!e.enabled)&&this.removeFromDueIndex(s),e.linkedBlockId&&(this.blockIndex.set(e.linkedBlockId,e.id),this.taskBlockIndex.set(e.id,e.linkedBlockId)),e.enabled&&this.addToDueIndex(e),e.updatedAt=new Date().toISOString(),this.activeTasks.set(e.id,e),await this.save(),e.linkedBlockId&&await this.syncTaskToBlockAttrsWithRetry(e),r&&r!==e.linkedBlockId&&await this.clearBlockAttrs(r)}async syncTaskToBlockAttrs(e){e.linkedBlockId&&await this.updateBlockAttrs(e.linkedBlockId,{[Cl]:e.id,[Ml]:e.dueAt,[Il]:e.enabled?"true":"false"})}async clearBlockAttrs(e){await this.updateBlockAttrs(e,{[Cl]:"",[Ml]:"",[Il]:""})}async updateBlockAttrs(e,t){if(this.blockAttrSyncEnabled){if(!this.apiAdapter.supportedCapabilities.setBlockAttrs){Pa({feature:"Block attribute sync",capability:"setBlockAttrs",message:"Block attribute sync unavailable in current SiYuan version. Tasks will continue to function without block sync."}),this.blockAttrSyncEnabled=!1;return}try{await this.blockApi.setBlockAttrs(e,t)}catch(s){s instanceof bd||s instanceof wd?Pa({feature:s.feature,capability:s.capability,message:s.message,cause:s.cause}):Pa({feature:"Block attribute sync",capability:"setBlockAttrs",message:"Unexpected error while syncing block attributes. Block sync disabled to keep tasks stable.",cause:s}),this.blockAttrSyncEnabled=!1}}}async deleteTask(e){const t=this.activeTasks.get(e);t!=null&&t.linkedBlockId&&(this.blockIndex.delete(t.linkedBlockId),await this.clearBlockAttrs(t.linkedBlockId)),this.taskBlockIndex.delete(e),t&&this.removeFromDueIndex(t),this.activeTasks.delete(e),await this.save()}getEnabledTasks(){return this.getAllTasks().filter(e=>e.enabled)}getTodayAndOverdueTasks(){const e=new Date,t=new Date(e);return t.setHours(23,59,59,999),this.getEnabledTasks().filter(s=>new Date(s.dueAt)<=t)}getTasksInRange(e,t){return this.getEnabledTasks().filter(s=>{const r=new Date(s.dueAt);return r>=e&&r<=t})}async clearAll(){this.activeTasks.clear(),await this.save()}async loadActive(){return this.activeStore.loadActive()}async saveActive(e){this.persistence.requestSave({tasks:Array.from(e.values())})}async archiveTask(e){await this.archiveStore.archiveTask(e)}async loadArchive(e){return this.archiveStore.loadArchive(e)}async migrateLegacyStorage(){const e=await this.plugin.loadData(Bn);if(e&&Array.isArray(e.tasks))return;const t=await this.plugin.loadData(bl);if(!t)return;const s=Array.isArray(t.tasks)?t.tasks:Array.isArray(t)?t:[];if(s.length===0)return;await this.plugin.saveData(wl,t),ue(`Created legacy backup at ${wl}`);const r=s.filter(l=>!l.enabled&&l.lastCompletedAt),a=s.filter(l=>!r.includes(l)),i=new Map(a.map(l=>[l.id,l]));this.persistence.requestSave({tasks:Array.from(i.values())}),await this.persistence.flush(),r.length>0&&await this.archiveStore.archiveTasks(r),ue("Legacy storage migration complete",{activeCount:a.length,archivedCount:r.length,legacyKey:bl,activeKey:Bn,archiveIndexKey:Oa})}async syncTaskToBlockAttrsWithRetry(e){try{await this.syncTaskToBlockAttrs(e),this.syncRetryQueue.delete(e.id)}catch(t){const s=this.syncRetryQueue.get(e.id)||{task:e,attempts:0,nextRetry:Date.now()};s.attempts<Sa?(s.attempts++,s.nextRetry=Date.now()+Ol[s.attempts-1],s.task=e,this.syncRetryQueue.set(e.id,s),ot(`Block sync failed for task ${e.id}, added to retry queue`,{taskId:e.id,attempts:s.attempts,nextRetry:new Date(s.nextRetry).toISOString(),error:t instanceof Error?t.message:String(t)})):(Te(`Block sync failed for task ${e.id} after ${Sa} attempts`,{taskId:e.id,error:t instanceof Error?t.message:String(t)}),this.syncRetryQueue.delete(e.id))}}startSyncRetryProcessor(){this.retryProcessorInterval&&clearInterval(this.retryProcessorInterval),this.retryProcessorInterval=setInterval(async()=>{const e=Date.now(),t=[];for(const[s,r]of this.syncRetryQueue.entries())r.nextRetry<=e&&t.push({id:s,entry:r});for(const{id:s,entry:r}of t)try{await this.syncTaskToBlockAttrs(r.task),this.syncRetryQueue.delete(s),ue(`Block sync retry succeeded for task ${s}`,{taskId:s,attempts:r.attempts})}catch(a){r.attempts<Sa?(r.attempts++,r.nextRetry=Date.now()+Ol[r.attempts-1],this.syncRetryQueue.set(s,r),ot(`Block sync retry failed for task ${s}`,{taskId:s,attempts:r.attempts,nextRetry:new Date(r.nextRetry).toISOString(),error:a instanceof Error?a.message:String(a)})):(Te(`Block sync retry exhausted for task ${s} after ${Sa} attempts`,{taskId:s,error:a instanceof Error?a.message:String(a)}),this.syncRetryQueue.delete(s))}},bv)}stopSyncRetryProcessor(){this.retryProcessorInterval&&(clearInterval(this.retryProcessorInterval),this.retryProcessorInterval=void 0)}}class S_{constructor(e){this.storage=e}getAllTasks(){return this.storage.getAllTasks()}getTask(e){return this.storage.getTask(e)}getTaskByBlockId(e){return this.storage.getTaskByBlockId(e)}getEnabledTasks(){return this.storage.getEnabledTasks()}getTasksDueOnOrBefore(e){return this.storage.getTasksDueOnOrBefore(e)}getTodayAndOverdueTasks(){return this.storage.getTodayAndOverdueTasks()}getTasksInRange(e,t){return this.storage.getTasksInRange(e,t)}async saveTask(e){await this.storage.saveTask(e)}async deleteTask(e){await this.storage.deleteTask(e)}async archiveTask(e){await this.storage.archiveTask(e)}async loadArchive(e){return this.storage.loadArchive(e)}async flush(){await this.storage.flush()}}class x_{normalizeInterval(e){return!Number.isFinite(e)||e<1?1:Math.floor(e)}normalizeWeekdays(e){if(!Array.isArray(e))return[];const t=new Set;for(const s of e)Number.isFinite(s)&&s>=0&&s<=6&&t.add(Math.floor(s));return Array.from(t).sort((s,r)=>s-r)}normalizeDayOfMonth(e,t){const s=Number.isFinite(e)?Math.floor(e):t;return Math.min(Math.max(s,1),31)}normalizeMonth(e,t){const s=Number.isFinite(e)?Math.floor(e):t;return Math.min(Math.max(s,0),11)}calculateNext(e,t,s){if(s!=null&&s.timezone||yd(),t.rruleString)return this.calculateNextWithRRule(e,t,s);const a=((s==null?void 0:s.whenDone)??t.whenDone??!1)&&(s!=null&&s.completionDate)?s.completionDate:e,{type:i,time:l}=t,c=this.normalizeInterval(t.interval);let u;switch(i){case"daily":u=this.calculateNextDaily(a,c);break;case"weekly":u=this.calculateNextWeekly(a,c,this.normalizeWeekdays(t.weekdays));break;case"monthly":u=this.calculateNextMonthly(a,c,this.normalizeDayOfMonth(t.dayOfMonth,a.getDate()));break;case"yearly":u=this.calculateNextYearly(a,c,this.normalizeMonth(t.month,a.getMonth()),this.normalizeDayOfMonth(t.dayOfMonth,a.getDate()));break;default:throw new Error(`Unknown frequency type: ${i}`)}if(l){const{hours:d,minutes:f}=Gi(l);if(Number.isFinite(d)&&Number.isFinite(f)){const{date:v,shifted:y}=Ll(u,d,f);y&&ot("DST shift detected while applying recurrence time",{requestedTime:l,original:u.toISOString(),adjusted:v.toISOString()}),u=v}}return u}calculateNextWithRRule(e,t,s){try{const a=((s==null?void 0:s.whenDone)??t.whenDone??!1)&&(s!=null&&s.completionDate)?s.completionDate:e,l=io(t.rruleString).after(a,!1);if(!l){ot("RRule returned no next occurrence, falling back to legacy logic",{rruleString:t.rruleString,baseDate:a.toISOString()});const{rruleString:u,naturalLanguage:d,...f}=t;return this.calculateNext(a,f,s)}let c=l;if(t.time){const{hours:u,minutes:d}=Gi(t.time);if(Number.isFinite(u)&&Number.isFinite(d)){const{date:f,shifted:v}=Ll(c,u,d);v&&ot("DST shift detected while applying recurrence time",{requestedTime:t.time,original:c.toISOString(),adjusted:f.toISOString()}),c=f}}return c}catch(r){Te("Failed to parse rrule, falling back to legacy logic",{error:r instanceof Error?r.message:String(r),rruleString:t.rruleString});const{rruleString:a,naturalLanguage:i,...l}=t;return this.calculateNext(e,l,s)}}calculateNextDaily(e,t){return Cn(e,t)}calculateNextWeekly(e,t,s){if(!s||s.length===0)return Pl(e,t);const r=this.getMondayIndex(e),a=Math.min(wi,t*14);for(let i=1;i<=a;i++){if(Math.floor((r+i)/7)%t!==0)continue;const c=Cn(e,i),u=this.getMondayIndex(c);if(s.includes(u))return c}return ot("Weekly recurrence guard hit, falling back to interval weeks.",{currentDue:e.toISOString(),interval:t,weekdays:s}),Pl(e,t)}getMondayIndex(e){return(e.getDay()+6)%7}calculateNextMonthly(e,t,s){const r=s??e.getDate(),a=e.getFullYear(),l=e.getMonth()+t,c=a+Math.floor(l/12),u=(l%12+12)%12,d=new Date(c,u+1,0).getDate(),f=Math.min(r,d),v=new Date(e);return v.setFullYear(c,u,f),v}calculateNextYearly(e,t,s,r){const a=r??e.getDate(),i=e.getFullYear()+t,l=new Date(i,s+1,0).getDate(),c=Math.min(a,l),u=new Date(e);return u.setFullYear(i,s,c),u}getOccurrencesInRange(e,t,s,r){const a=[];let i=new Date(r),l=0;for(;i<=t&&l<wi;)i>=e&&a.push(new Date(i)),i=this.calculateNext(i,s),l++;return a}getMissedOccurrences(e,t,s,r){const a=[];let i=new Date(r),l=0;for(;i<=e&&l<wi;)i=this.calculateNext(i,s),l++;let c=0;for(;i<t&&c<Na;)a.push(new Date(i)),i=this.calculateNext(i,s),c++;return c>=Na&&ot("Recovery iteration cap hit while computing missed occurrences",{lastCheckedAt:e.toISOString(),now:t.toISOString(),frequency:s,firstOccurrence:r.toISOString(),cap:Na}),a}}class D_{getTimezone(){return Intl.DateTimeFormat().resolvedOptions().timeZone}toLocal(e){return new Date(e)}createLocalDateTime(e,t){const{hours:s,minutes:r}=Gi(t);if(!Number.isFinite(s)||!Number.isFinite(r))return new Date(e);const a=new Date(e);return a.setHours(s,r,0,0),a}isSameLocalDay(e,t){const s=new Date(e),r=new Date(t);return s.getFullYear()===r.getFullYear()&&s.getMonth()===r.getMonth()&&s.getDate()===r.getDate()}startOfLocalDay(e){const t=e?new Date(e):new Date;return t.setHours(0,0,0,0),t}endOfLocalDay(e){const t=e?new Date(e):new Date;return t.setHours(23,59,59,999),t}formatLocal(e){return e.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}formatLocalTime(e){return e.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"})}formatLocalDate(e){return e.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}getRelativeTime(e){const t=new Date,s=e.getTime()-t.getTime(),r=Math.trunc(s/(1e3*60)),a=Math.trunc(s/(1e3*60*60)),i=Math.trunc(s/(1e3*60*60*24));return Math.abs(s)<1e3*60?"now":Math.abs(r)<60?r>0?`in ${r}m`:`${-r}m ago`:Math.abs(a)<24?a>0?`in ${a}h`:`${-a}h ago`:i>0?`in ${i}d`:`${-i}d ago`}isToday(e){return this.isSameLocalDay(e,new Date)}isPast(e){return e<new Date}isOverdue(e){return this.isPast(e)&&!this.isToday(e)}addDays(e,t){const s=new Date(e);return s.setDate(s.getDate()+t),s}tomorrow(){return this.addDays(new Date,1)}nextWeek(){return this.addDays(new Date,7)}}class E_{constructor(e){w(this,"siyuanApi");this.siyuanApi=e}async execute(e,t){try{if(t==="keep")return ue(`Task "${e.name}" completed and kept`,{taskId:e.id}),{success:!0};if(t==="delete"){if(!e.linkedBlockId)return ot(`Task "${e.name}" has no linkedBlockId, cannot delete from document`,{taskId:e.id}),{success:!0,warnings:["Task has no linked block, removed from task list only"]};if(await this.hasNestedItems(e.linkedBlockId))return ot("Cannot delete task with nested items",{taskId:e.id,blockId:e.linkedBlockId}),{success:!1,error:"Cannot delete task with nested items",warnings:['Task has sub-items. Please remove them first or use "keep" mode.']};if(this.siyuanApi&&this.siyuanApi.deleteBlock)await this.siyuanApi.deleteBlock({id:e.linkedBlockId}),ue(`Task "${e.name}" completed and deleted from document`,{taskId:e.id,blockId:e.linkedBlockId});else return ot("SiYuan API not available, cannot delete block from document"),{success:!0,warnings:["Block could not be deleted from document (API unavailable)"]};return{success:!0}}return{success:!1,error:`Unknown onCompletion action: ${t}`}}catch(s){return Te("Failed to execute onCompletion action",{taskId:e.id,action:t,error:s}),{success:!1,error:s instanceof Error?s.message:"Unknown error occurred"}}}async hasNestedItems(e){if(!this.siyuanApi||!this.siyuanApi.getChildBlocks)return ot("SiYuan API not available for nested item check"),!0;try{const t=await this.siyuanApi.getChildBlocks({id:e});return t&&t.length>0}catch(t){return Te("Failed to check for nested items",{blockId:e,error:t}),!0}}}class A_{constructor(e,t){w(this,"intervalMs");w(this,"timeoutId",null);w(this,"isRunning",!1);this.onTick=t,this.intervalMs=e}start(){this.isRunning||(this.isRunning=!0,this.scheduleNextTick())}stop(){this.timeoutId!==null&&(globalThis.clearTimeout(this.timeoutId),this.timeoutId=null),this.isRunning=!1}setInterval(e){this.intervalMs=e}isActive(){return this.isRunning}scheduleNextTick(){if(!this.isRunning)return;const e=Date.now(),t=this.intervalMs>0?this.intervalMs:No,s=t-e%t;this.timeoutId=globalThis.setTimeout(()=>{this.onTick(),this.scheduleNextTick()},s)}}class C_{constructor(e,t=No,s){w(this,"storage");w(this,"recurrenceEngine");w(this,"onCompletionHandler");w(this,"emittedDue",new Set);w(this,"emittedMissed",new Set);w(this,"timezoneHandler");w(this,"isChecking",!1);w(this,"lastCheckStartTime",0);w(this,"plugin",null);w(this,"listeners",{"task:due":new Set,"task:overdue":new Set});w(this,"MAX_EMITTED_ENTRIES",1e3);w(this,"EMITTED_RETENTION_DAYS",30);w(this,"EMITTED_SAVE_DEBOUNCE_MS",1500);w(this,"persistTimeoutId",null);w(this,"emittedStateReady",null);w(this,"timer");this.storage=e,this.recurrenceEngine=new x_,this.onCompletionHandler=new E_(s),this.timezoneHandler=new D_,this.plugin=s||null,this.timer=new A_(t,()=>{this.checkDueTasks()})}on(e,t){return this.listeners[e].add(t),()=>this.listeners[e].delete(t)}start(){this.ensureEmittedStateLoaded().finally(()=>{this.checkDueTasks(),this.timer.start(),ue("Scheduler started")})}stop(){this.timer.stop(),this.persistEmittedState(),ue("Scheduler stopped")}runOnce(){this.checkDueTasks()}isActive(e){return e.enabled===!0}checkDueTasks(){if(this.isChecking)if(Date.now()-(this.lastCheckStartTime||0)>3e4)ot("Scheduler check timeout detected, forcing reset"),this.isChecking=!1;else return;this.isChecking=!0,this.lastCheckStartTime=Date.now();const e=new Date,t=this.storage.getTasksDueOnOrBefore(e);try{for(const s of t){if(!this.isActive(s))continue;const r=new Date(s.dueAt),a=r<=e;if(a){const l=this.buildOccurrenceKey(s.id,r,"hour");this.emittedDue.has(l)||(this.emitEvent("task:due",{taskId:s.id,dueAt:r,context:"today",task:s}),this.registerEmittedKey("due",l),ue(`Task due: ${s.name}`,{taskId:s.id,dueAt:s.dueAt}))}const i=s.lastCompletedAt?new Date(s.lastCompletedAt):null;if(a&&e.getTime()-r.getTime()>=vv&&(!i||i<r)){const l=this.buildOccurrenceKey(s.id,r,"hour");this.emittedMissed.has(l)||(this.emitEvent("task:overdue",{taskId:s.id,dueAt:r,context:"overdue",task:s}),this.registerEmittedKey("missed",l),ot(`Task missed: ${s.name}`,{taskId:s.id,dueAt:s.dueAt}))}}this.cleanupEmittedSets()}finally{this.isChecking=!1}}cleanupEmittedSets(){const e=new Date;e.setDate(e.getDate()-this.EMITTED_RETENTION_DAYS);const t=this.pruneEmittedSet("due",this.emittedDue,e),s=this.pruneEmittedSet("missed",this.emittedMissed,e);this.emittedDue=t.set,this.emittedMissed=s.set,(t.didTrim||s.didTrim)&&this.schedulePersistEmittedState()}pruneEmittedSet(e,t,s){const r=s.getTime(),a=Array.from(t).map(u=>({entry:u,time:this.parseOccurrenceKeyTimestamp(u)}));let i=a.filter(({time:u})=>u===null||u>=r),l=i.length!==a.length;i.length>this.MAX_EMITTED_ENTRIES&&(i=i.sort((u,d)=>(u.time??0)-(d.time??0)).slice(-this.MAX_EMITTED_ENTRIES),l=!0);const c=new Set(i.map(({entry:u})=>u));return l&&ue(`Cleaned up emitted${e==="due"?"Due":"Missed"} set: ${t.size} -> ${c.size}`),{set:c,didTrim:l}}parseOccurrenceKeyTimestamp(e){const t=e.indexOf(":");if(t===-1)return null;const s=e.slice(t+1);if(!s)return null;const r=s.length===13?`${s}:00:00.000Z`:s,a=new Date(r);return Number.isNaN(a.getTime())?null:a.getTime()}async markTaskDone(e){const t=this.storage.getTask(e);if(!t)throw new Error(`Task not found: ${e}`);const s=new Date;t.doneAt=s.toISOString(),xv(t);const r=JSON.parse(JSON.stringify(t));await this.storage.archiveTask(r);const a=t.onCompletion||"keep",i=await this.onCompletionHandler.execute(t,a);if(i.success||Te(`OnCompletion action failed for task "${t.name}"`,{taskId:t.id,action:a,error:i.error}),i.warnings)for(const u of i.warnings)ot(u,{taskId:t.id});const l=new Date(t.dueAt),c=this.recurrenceEngine.calculateNext(l,t.frequency,{completionDate:s,whenDone:t.whenDone});t.dueAt=c.toISOString(),t.doneAt=void 0,await this.storage.saveTask(t),ue(`Task "${t.name}" completed and rescheduled to ${c.toISOString()}`)}async delayTask(e,t){const s=this.storage.getTask(e);if(!s)throw new Error(`Task not found: ${e}`);this.assertSnoozeAvailable(s);const r=new Date(s.dueAt),a=new Date(r.getTime()+t*60*1e3);s.dueAt=a.toISOString(),s.snoozeCount=(s.snoozeCount||0)+1,await this.storage.saveTask(s),ue(`Task "${s.name}" delayed by ${t} minutes to ${a.toISOString()}`)}async delayToTomorrow(e){const t=this.storage.getTask(e);if(!t)throw new Error(`Task not found: ${e}`);this.assertSnoozeAvailable(t);const s=new Date(t.dueAt),r=this.timezoneHandler.tomorrow();r.setHours(s.getHours(),s.getMinutes(),0,0),t.dueAt=r.toISOString(),t.snoozeCount=(t.snoozeCount||0)+1,await this.storage.saveTask(t),ue(`Task "${t.name}" delayed to tomorrow: ${r.toISOString()}`)}async skipOccurrence(e){const t=this.storage.getTask(e);if(!t)throw new Error(`Task not found: ${e}`);ju(t);const s=new Date(t.dueAt),r=this.recurrenceEngine.calculateNext(s,t.frequency);t.dueAt=r.toISOString(),await this.storage.saveTask(t),ue(`Task "${t.name}" skipped to ${r.toISOString()}`)}async delayTaskToTomorrow(e){return this.delayToTomorrow(e)}async skipTaskOccurrence(e){return this.skipOccurrence(e)}async recoverMissedTasks(){await this.ensureEmittedStateLoaded();const e=await this.loadLastRunTimestamp(),t=new Date;if(!e){await this.saveLastRunTimestamp(t),ue("First run detected, no recovery needed");return}ue(`Recovering missed tasks since ${e.toISOString()}`);for(const s of this.storage.getEnabledTasks())try{const r=this.recurrenceEngine.getMissedOccurrences(e,t,s.frequency,new Date(s.createdAt));for(const a of r){const i=this.buildOccurrenceKey(s.id,a,"exact");this.emittedMissed.has(i)||(this.emitEvent("task:overdue",{taskId:s.id,dueAt:a,context:"overdue",task:s}),this.registerEmittedKey("missed",i))}await this.advanceToNextFutureOccurrence(s,t)}catch(r){Te(`Failed to recover task ${s.id}:`,r)}await this.saveLastRunTimestamp(t),this.cleanupEmittedSets(),ue("Missed task recovery completed")}async advanceToNextFutureOccurrence(e,t){const s=new Date(e.dueAt);if(s>=t)return;let r=s,a=0;for(;r<t&&a<Na;)r=this.recurrenceEngine.calculateNext(r,e.frequency),a++;r>s&&(e.dueAt=r.toISOString(),await this.storage.saveTask(e),ue(`Advanced task "${e.name}" to ${r.toISOString()}`))}async loadLastRunTimestamp(){if(!this.plugin)return null;try{const e=await this.plugin.loadData(Al);if(e&&e.timestamp)return new Date(e.timestamp)}catch(e){Te("Failed to load last run timestamp:",e)}return null}async saveLastRunTimestamp(e){if(this.plugin)try{await this.plugin.saveData(Al,{timestamp:e.toISOString()})}catch(t){Te("Failed to save last run timestamp:",t)}}getRecurrenceEngine(){return this.recurrenceEngine}getTimezoneHandler(){return this.timezoneHandler}emitEvent(e,t){const s=this.listeners[e];for(const r of s)try{const a=r(t);a instanceof Promise&&a.catch(i=>{Te(`Scheduler listener error for ${e}:`,i)})}catch(a){Te(`Scheduler listener error for ${e}:`,a)}}assertSnoozeAvailable(e){const t=e.maxSnoozes??pv,s=e.snoozeCount??0;if(t<=0)throw new Error("Snoozing is disabled for this task.");if(s>=t)throw new Error(`Snooze limit reached (${t}).`)}registerEmittedKey(e,t){e==="due"?this.emittedDue.add(t):this.emittedMissed.add(t),this.schedulePersistEmittedState()}ensureEmittedStateLoaded(){return this.emittedStateReady||(this.emittedStateReady=this.restoreEmittedState()),this.emittedStateReady}async restoreEmittedState(){if(this.plugin)try{const e=await this.plugin.loadData(Tl),t=Array.isArray(e==null?void 0:e.due)?e.due.filter(r=>typeof r=="string"):[],s=Array.isArray(e==null?void 0:e.missed)?e.missed.filter(r=>typeof r=="string"):[];this.emittedDue=new Set(t.slice(-this.MAX_EMITTED_ENTRIES)),this.emittedMissed=new Set(s.slice(-this.MAX_EMITTED_ENTRIES)),ue("Restored scheduler emitted state",{due:this.emittedDue.size,missed:this.emittedMissed.size})}catch(e){Te("Failed to restore scheduler emitted state:",e)}}schedulePersistEmittedState(){this.plugin&&this.persistTimeoutId===null&&(this.persistTimeoutId=globalThis.setTimeout(()=>{this.persistTimeoutId=null,this.persistEmittedState()},this.EMITTED_SAVE_DEBOUNCE_MS))}async persistEmittedState(){if(this.plugin)try{await this.plugin.saveData(Tl,{due:Array.from(this.emittedDue),missed:Array.from(this.emittedMissed)})}catch(e){Te("Failed to persist scheduler emitted state:",e)}}buildOccurrenceKey(e,t,s){return s==="exact"?`${e}:${t.toISOString()}`:`${e}:${t.toISOString().slice(0,13)}`}}const M_=7,I_=2e3;class O_{constructor(e,t){w(this,"plugin");w(this,"storageKey");w(this,"notifications",new Map);w(this,"escalations",new Map);w(this,"lastCleanup",new Date);w(this,"isDirty",!1);this.plugin=e,this.storageKey=t}async load(){try{const e=await this.plugin.loadData(this.storageKey);if(e){const t=e;if(Array.isArray(t.notifications))for(const s of t.notifications)this.notifications.set(s.taskKey,s);if(Array.isArray(t.escalations))for(const s of t.escalations)this.escalations.set(s.taskId,s);t.lastCleanup&&(this.lastCleanup=new Date(t.lastCleanup)),ue(`Loaded notification state: ${this.notifications.size} notifications, ${this.escalations.size} escalations`),this.cleanupOldEntries()}}catch(e){Te("Failed to load notification state",e),this.notifications.clear(),this.escalations.clear()}}async save(){if(this.isDirty)try{const e={notifications:Array.from(this.notifications.values()),escalations:Array.from(this.escalations.values()),lastCleanup:this.lastCleanup.toISOString()};await this.plugin.saveData(this.storageKey,e),this.isDirty=!1,Hu("Saved notification state")}catch(e){Te("Failed to save notification state",e)}}async forceSave(){this.isDirty=!0,await this.save()}hasNotified(e){const t=this.notifications.get(e);return t!==void 0&&t.type==="due"}markNotified(e){this.notifications.set(e,{taskKey:e,notifiedAt:new Date().toISOString(),type:"due"}),this.isDirty=!0,this.notifications.size>I_&&Array.from(this.notifications.keys()).slice(0,100).forEach(s=>this.notifications.delete(s))}hasMissed(e){const t=this.notifications.get(e);return t!==void 0&&t.type==="missed"}markMissed(e){this.notifications.set(e,{taskKey:e,notifiedAt:new Date().toISOString(),type:"missed"}),this.isDirty=!0}getEscalationLevel(e){const t=this.escalations.get(e);return(t==null?void 0:t.level)||0}incrementEscalation(e){const s=this.getEscalationLevel(e)+1;return this.escalations.set(e,{taskId:e,level:s,lastEscalatedAt:new Date().toISOString()}),this.isDirty=!0,s}resetEscalation(e){this.escalations.delete(e),this.isDirty=!0}generateTaskKey(e,t){const s=new Date(t);return`${e}:${s.toISOString().slice(0,13)}`}cleanupOldEntries(){const e=new Date;if((e.getTime()-this.lastCleanup.getTime())/(1e3*60*60*24)<1)return;const s=new Date(e.getTime()-M_*24*60*60*1e3);let r=0;for(const[a,i]of this.notifications.entries())new Date(i.notifiedAt)<s&&(this.notifications.delete(a),r++);r>0&&(ue(`Cleaned up ${r} old notification records`),this.isDirty=!0),this.lastCleanup=e}}function N_(n){return{id:n.id,name:n.name,dueAt:n.dueAt,frequency:n.frequency,linkedBlockId:n.linkedBlockId,linkedBlockContent:n.linkedBlockContent,priority:n.priority,tags:n.tags,notificationChannels:n.notificationChannels,completionCount:n.completionCount,missCount:n.missCount,currentStreak:n.currentStreak,bestStreak:n.bestStreak}}const R_=30*1e3,P_=30*60*1e3,Ln=500;class L_{constructor(e,t={}){w(this,"plugin");w(this,"config");w(this,"queue",[]);w(this,"dedupeKeys",new Set);w(this,"flushIntervalId",null);w(this,"fetcher");w(this,"notificationState");w(this,"schedulerUnsubscribe",[]);this.plugin=e,this.fetcher=t.fetcher??fetch,this.config={...Hi},this.notificationState=t.notificationState??new O_(this.plugin,dv)}async init(){await this.notificationState.load(),await this.loadConfig(),await this.loadQueue(),await this.flushQueueOnStartup(),this.startQueueWorker()}async flushQueueOnStartup(){this.queue.length>0&&(console.log(`Found ${this.queue.length} pending events from previous session`),await this.flushQueue())}async loadConfig(){try{const e=await this.plugin.loadData(_l);e&&(this.config={...Hi,...e})}catch(e){console.error("Failed to load event config:",e)}}async saveConfig(e){this.config=e,await this.plugin.saveData(_l,e)}async loadQueue(){try{const e=await this.plugin.loadData(kl);if(e){this.queue=Array.isArray(e.queue)?e.queue:[];const t=Array.isArray(e.dedupeKeys)?e.dedupeKeys:[];if(this.dedupeKeys=new Set(t),this.queue.length>Ln){const s=this.queue.length-Ln;this.queue=this.queue.slice(-Ln),console.warn(`Event queue trimmed to ${Ln} entries (dropped ${s}).`)}}}catch(e){console.error("Failed to load event queue:",e),this.queue=[],this.dedupeKeys=new Set}}async persistQueue(){const e=Array.from(this.dedupeKeys).slice(-bi);await this.plugin.saveData(kl,{queue:this.queue,dedupeKeys:e})}startQueueWorker(){this.flushIntervalId===null&&(this.flushQueue(),this.flushIntervalId=globalThis.setInterval(()=>{this.flushQueue()},fv))}stopQueueWorker(){this.flushIntervalId!==null&&(globalThis.clearInterval(this.flushIntervalId),this.flushIntervalId=null)}async shutdown(){this.stopQueueWorker(),await this.notificationState.forceSave()}bindScheduler(e){this.unbindScheduler(),this.schedulerUnsubscribe=[e.on("task:due",t=>{this.handleTaskDue(t)}),e.on("task:overdue",t=>{this.handleTaskOverdue(t)})]}unbindScheduler(){this.schedulerUnsubscribe.forEach(e=>e()),this.schedulerUnsubscribe=[]}async handleTaskCompleted(e){await this.emitTaskEvent("task.completed",e,0),this.notificationState.resetEscalation(e.id),await this.notificationState.save()}async handleTaskSnoozed(e){await this.emitTaskEvent("task.snoozed",e,0)}async handleTaskDue(e){const t=this.notificationState.generateTaskKey(e.taskId,e.dueAt.toISOString());if(this.notificationState.hasNotified(t))return;const s=this.notificationState.getEscalationLevel(e.taskId);await this.emitTaskEvent("task.due",e.task,s),this.notificationState.markNotified(t),this.notificationState.save()}async handleTaskOverdue(e){const t=this.notificationState.generateTaskKey(e.taskId,e.dueAt.toISOString());if(this.notificationState.hasMissed(t))return;const s=this.notificationState.getEscalationLevel(e.taskId);await this.emitTaskEvent("task.missed",e.task,s),this.notificationState.markMissed(t),this.notificationState.incrementEscalation(e.taskId),this.notificationState.save()}async emitTaskEvent(e,t,s=0){if(!this.config.n8n.enabled||!this.config.n8n.webhookUrl)return;const r=this.buildDedupeKey(e,t);if(this.isDuplicate(r))return;const a=this.buildPayload(e,t,r,1,s);await this.sendPayload(a)?(this.markDelivered(r),await this.persistQueue()):this.enqueue(a)}async testConnection(){if(!this.config.n8n.enabled||!this.config.n8n.webhookUrl)return{success:!1,message:"n8n webhook not configured"};try{const e=`test.ping:${new Date().toISOString()}`,t={event:"test.ping",source:Sl,version:xl,occurredAt:new Date().toISOString(),delivery:{dedupeKey:e,attempt:1}},s=await this.fetcher(this.config.n8n.webhookUrl,{method:"POST",headers:await this.buildHeaders(t),body:JSON.stringify(t)});return s.ok?{success:!0,message:"Connection successful"}:{success:!1,message:`HTTP ${s.status}: ${s.statusText}`}}catch(e){return{success:!1,message:`Connection failed: ${e.message}`}}}async flushQueue(){if(!this.config.n8n.enabled||!this.config.n8n.webhookUrl)return;const e=Date.now();let t=!1;const s=[];for(const r of this.queue){if(new Date(r.nextAttemptAt).getTime()>e){s.push(r);continue}const a={...r.payload,delivery:{...r.payload.delivery,attempt:r.attempt}};if(await this.sendPayload(a))this.markDelivered(a.delivery.dedupeKey),t=!0;else{const l=r.attempt+1,c=this.getRetryDelay(l);s.push({...r,attempt:l,nextAttemptAt:new Date(e+c).toISOString()}),t=!0}}t&&(this.queue=s,await this.persistQueue())}getConfig(){return{...this.config}}buildPayload(e,t,s,r,a=0){const i=new Date,l=new Date(t.dueAt),c=i.getTime()-l.getTime();return{event:e,source:Sl,version:xl,occurredAt:i.toISOString(),task:N_(t),context:{timezone:t.timezone||Intl.DateTimeFormat().resolvedOptions().timeZone,delayMs:c>0?c:void 0,previousDueAt:t.lastCompletedAt,nextDueAt:void 0},routing:{escalationLevel:a,channels:t.notificationChannels||[]},delivery:{dedupeKey:s,attempt:r}}}buildDedupeKey(e,t){const s=new Date(t.dueAt).toISOString().slice(0,16);return`${e}:${t.id}:${s}`}isDuplicate(e){return this.dedupeKeys.has(e)?!0:this.queue.some(t=>t.payload.delivery.dedupeKey===e)}markDelivered(e){if(this.dedupeKeys.add(e),this.dedupeKeys.size>bi){const t=Array.from(this.dedupeKeys).slice(-bi);this.dedupeKeys=new Set(t)}}enqueue(e){const t=Date.now();if(this.queue.length>=Ln){const s=this.queue.length-Ln+1;this.queue.splice(0,s),console.warn(`Event queue capped at ${Ln}. Dropped ${s} oldest entr${s===1?"y":"ies"}.`)}this.queue.push({id:`${e.delivery.dedupeKey}:${e.delivery.attempt}`,payload:e,attempt:e.delivery.attempt,nextAttemptAt:new Date(t+this.getRetryDelay(e.delivery.attempt)).toISOString()}),this.persistQueue()}getRetryDelay(e){const t=R_*Math.pow(2,e-1);return Math.min(t,P_)}async generateSignature(e,t){try{if(typeof crypto<"u"&&crypto.subtle){const s=new TextEncoder,r=s.encode(t),a=s.encode(e),i=await crypto.subtle.importKey("raw",r,{name:"HMAC",hash:"SHA-256"},!1,["sign"]),l=await crypto.subtle.sign("HMAC",i,a);return Array.from(new Uint8Array(l)).map(u=>u.toString(16).padStart(2,"0")).join("")}return console.warn("Web Crypto API not available - signature generation disabled"),""}catch(s){return console.error("Failed to generate signature:",s),""}}async buildHeaders(e){const t=JSON.stringify(e),s=new Date().toISOString();let r="";this.config.n8n.sharedSecret&&(r=await this.generateSignature(t+s,this.config.n8n.sharedSecret));const a={"Content-Type":"application/json","X-Shehab-Event":e.event,"X-Shehab-Timestamp":s};return r&&(a["X-Shehab-Signature"]=r),this.config.n8n.sharedSecret&&(a["X-Shehab-Note-Secret"]=this.config.n8n.sharedSecret),a}async sendPayload(e,t=!1){try{const s=JSON.stringify(e),r=await this.buildHeaders(e),a=await this.fetcher(this.config.n8n.webhookUrl,{method:"POST",headers:r,body:s});if(!a.ok)return console.error("n8n webhook failed:",a.statusText),!1;if(t){const i=await a.json().catch(()=>null);return!!(i&&i.ok)}return!0}catch(s){return console.error("Failed to send n8n event:",s),!1}}}const Dt={dates:{autoAddCreated:!1,autoAddDone:!0,autoAddCancelled:!0},recurrence:{newTaskPosition:"below",removeScheduledOnRecurrence:!1,preserveOriginalTime:!0},dependencies:{warnOnCycles:!0,autoValidate:!0},filenameDate:{enabled:!1,patterns:["YYYY-MM-DD","YYYYMMDD"],folders:["daily/","journal/"],targetField:"scheduled"},globalFilter:Jr,globalQuery:od,urgency:Ro,smartRecurrence:{enabled:!0,autoAdjust:!1,minCompletionsForLearning:10,confidenceThreshold:.7},naturalLanguage:{enabled:!0,showConfidenceScore:!0,provideExamples:!0},crossNoteDependencies:{enabled:!0,checkInterval:5,notifyWhenMet:!0},smartSuggestions:{enabled:!0,minConfidence:.65,showDismissed:!1,autoApplyHighConfidence:!1},predictiveScheduling:{enabled:!0,showHeatmap:!0,minDataPoints:5,workingHours:{start:6,end:22},preferredDays:[1,2,3,4,5]},keyboardNavigation:{enabled:!1,useVimKeybindings:!0,customKeybindings:{},showModeIndicator:!0,showQuickHints:!0,enableCommandPalette:!0}};function Dc(n){var e,t,s,r;if(n.globalFilter&&!n.globalFilter.profiles){const a=n.globalFilter,i={id:"migrated-default",name:"Migrated Settings",description:"Automatically migrated from previous version",includePaths:[],excludePaths:[...a.excludeFolders||[],...a.excludeFilePatterns||[]],includeTags:[],excludeTags:a.excludeTags||[],includeRegex:void 0,excludeRegex:void 0,regexTargets:["taskText"],excludeStatusTypes:a.excludeStatusTypes||[]};n.globalFilter={enabled:a.enabled??!1,mode:a.mode??"all",activeProfileId:"migrated-default",profiles:[i]}}return{dates:{...Dt.dates,...n.dates},recurrence:{...Dt.recurrence,...n.recurrence},dependencies:{...Dt.dependencies,...n.dependencies},filenameDate:{...Dt.filenameDate,...n.filenameDate},globalFilter:{...Dt.globalFilter,...n.globalFilter,profiles:((e=n.globalFilter)==null?void 0:e.profiles)??Dt.globalFilter.profiles},globalQuery:{...Dt.globalQuery,...n.globalQuery},urgency:{...Dt.urgency,...n.urgency},smartRecurrence:{...Dt.smartRecurrence,...n.smartRecurrence},naturalLanguage:{...Dt.naturalLanguage,...n.naturalLanguage},crossNoteDependencies:{...Dt.crossNoteDependencies,...n.crossNoteDependencies},smartSuggestions:{...Dt.smartSuggestions,...n.smartSuggestions},predictiveScheduling:{...Dt.predictiveScheduling,...n.predictiveScheduling,preferredDays:((t=n.predictiveScheduling)==null?void 0:t.preferredDays)??Dt.predictiveScheduling.preferredDays,workingHours:((s=n.predictiveScheduling)==null?void 0:s.workingHours)??Dt.predictiveScheduling.workingHours},keyboardNavigation:{...Dt.keyboardNavigation,...n.keyboardNavigation,customKeybindings:((r=n.keyboardNavigation)==null?void 0:r.customKeybindings)??Dt.keyboardNavigation.customKeybindings}}}const Mi="plugin-settings";class q_{constructor(e){w(this,"plugin");w(this,"settings");this.plugin=e,this.settings=Dt}async load(){try{const e=await this.plugin.loadData(Mi);e&&typeof e=="object"&&(this.settings=Dc(e))}catch(e){console.error("Failed to load plugin settings:",e)}}async save(e){this.settings=e,await this.plugin.saveData(Mi,e),Ye.emit("task:refresh",void 0)}get(){return this.settings}async update(e){this.settings=Dc(e),await this.plugin.saveData(Mi,this.settings),Ye.emit("task:refresh",void 0)}}const mn=class mn{constructor(e){w(this,"plugin");w(this,"isInitialized",!1);w(this,"storage");w(this,"repository");w(this,"scheduler");w(this,"eventService");w(this,"settingsService");this.plugin=e}static getInstance(e){if(!mn.instance){if(!e)return null;mn.instance=new mn(e)}return mn.instance}async initialize(){if(this.isInitialized){ot("TaskManager already initialized");return}ue("Initializing TaskManager"),this.settingsService=new q_(this.plugin),await this.settingsService.load();const e=this.settingsService.get();us.getInstance().initialize(e.globalFilter),na.getInstance().initialize(e.globalQuery),this.storage=new T_(this.plugin),await this.storage.init(),this.repository=new S_(this.storage),this.eventService=new L_(this.plugin),await this.eventService.init(),this.scheduler=new C_(this.storage,No,this.plugin),this.eventService.bindScheduler(this.scheduler),this.isInitialized=!0,ue("TaskManager initialized successfully")}async start(e,t){if(!this.isInitialized)throw new Error("TaskManager must be initialized before starting");e&&this.scheduler.on("task:due",({task:s})=>e(s)),t&&this.scheduler.on("task:overdue",({task:s})=>t(s)),this.scheduler.start(),await this.scheduler.recoverMissedTasks(),ue("TaskManager started")}async destroy(){ue("Destroying TaskManager"),this.scheduler&&this.scheduler.stop(),this.eventService&&await this.eventService.shutdown(),this.storage&&await this.storage.flush(),this.isInitialized=!1,mn.instance=null,ue("TaskManager destroyed")}getStorage(){return this.ensureInitialized(),this.storage}getRepository(){return this.ensureInitialized(),this.repository}getScheduler(){return this.ensureInitialized(),this.scheduler}getEventService(){return this.ensureInitialized(),this.eventService}getSettingsService(){return this.ensureInitialized(),this.settingsService}isReady(){return this.isInitialized}ensureInitialized(){if(!this.isInitialized)throw new Error("TaskManager is not initialized. Call initialize() first.")}};w(mn,"instance",null);let Ka=mn;function F_(n){let t=`- [${n.status==="done"?"x":" "}] ${n.name}`;if(n.dueAt){const s=new Date(n.dueAt);t+=`  ${s.toISOString().split("T")[0]}`}return n.frequency&&(t+=`  every ${n.frequency.interval} ${n.frequency.type}${n.frequency.interval>1?"s":""}`),t}class U_{constructor(e,t,s,r){this.storage=e,this.recurrenceEngine=t,this.settings=s,this.siyuanApi=r}async onComplete(e,t){try{const s=[],r=this.addCompletionDate(e,t);let a;return e.frequency&&(a=await this.generateNextInstance(r,t),a&&(await this.placeNextInstance(r,a)||s.push("Could not place next instance in document (API unavailable)"),await this.storage.saveTask(a))),e.onCompletion==="delete"?await this.hasNestedItems(e.linkedBlockId)?(ot("Cannot delete task with nested items",{taskId:e.id,blockId:e.linkedBlockId}),await this.storage.saveTask(r),s.push("Task has nested items - kept instead of deleted")):await this.deleteTask(e):await this.storage.saveTask(r),{success:!0,nextTask:a,warnings:s.length>0?s:void 0}}catch(s){return Te("Failed to handle task completion",{taskId:e.id,error:s}),{success:!1,error:s instanceof Error?s.message:"Unknown error occurred"}}}addCompletionDate(e,t){const s={...e},r=t.toISOString();return e.status==="done"&&this.settings.dates.autoAddDone?(s.doneAt=r,s.cancelledAt=void 0):e.status==="cancelled"&&this.settings.dates.autoAddCancelled&&(s.cancelledAt=r,s.doneAt=void 0),s}async generateNextInstance(e,t){if(e.frequency)try{const s=new Date(e.dueAt),r=this.recurrenceEngine.calculateNext(s,e.frequency,{completionDate:t,whenDone:e.frequency.whenDone||e.whenDone}),a=$u(e,{dueAt:r.toISOString(),status:"todo",doneAt:void 0,cancelledAt:void 0,linkedBlockId:void 0,linkedBlockContent:void 0});return this.settings.recurrence.removeScheduledOnRecurrence&&(a.scheduledAt=void 0),a}catch(s){Te("Failed to generate next recurrence instance",{taskId:e.id,frequency:e.frequency,error:s});return}}async placeNextInstance(e,t){if(!e.linkedBlockId)return ot("Original task has no linkedBlockId, cannot place next instance"),!1;if(!this.siyuanApi)return ot("SiYuan API not available, cannot place next instance"),!1;const s=this.settings.recurrence.newTaskPosition,r=F_(t);try{let a;return s==="above"&&this.siyuanApi.insertBlockAbove?a=await this.siyuanApi.insertBlockAbove(e.linkedBlockId,r):s==="below"&&this.siyuanApi.insertBlockBelow&&(a=await this.siyuanApi.insertBlockBelow(e.linkedBlockId,r)),a!=null&&a.id?(t.linkedBlockId=a.id,t.linkedBlockContent=r,!0):!1}catch(a){return Te("Failed to place next instance in document",{taskId:e.id,placement:s,error:a}),!1}}async hasNestedItems(e){var t;if(!e||!((t=this.siyuanApi)!=null&&t.getChildBlocks))return!1;try{const s=await this.siyuanApi.getChildBlocks({id:e});return s&&s.length>0}catch(s){return Te("Failed to check for nested items",{blockId:e,error:s}),!1}}async deleteTask(e){var t;if(await this.storage.deleteTask(e.id),e.linkedBlockId&&((t=this.siyuanApi)!=null&&t.deleteBlock))try{await this.siyuanApi.deleteBlock({id:e.linkedBlockId}),ue("Task deleted from document and storage",{taskId:e.id,blockId:e.linkedBlockId})}catch(s){Te("Failed to delete task from document",{taskId:e.id,blockId:e.linkedBlockId,error:s})}else ue("Task deleted from storage only (no linked block)",{taskId:e.id})}}class z_{constructor(e,t,s,r){w(this,"completionHandler");this.repository=e,this.recurrenceEngine=t,this.getSettings=s,this.siyuanApi=r,t&&s&&(this.completionHandler=new U_(e,t,s(),r))}get settings(){var e;return(e=this.getSettings)==null?void 0:e.call(this)}async toggleStatus(e){var t,s;try{const r=this.repository.getTask(e);if(!r){G.error("Task not found");return}const a=Ws.getInstance(),i=r.statusSymbol||" ",l=a.getNextSymbol(i),c={...r,statusSymbol:l},u=a.getStatus(l);if(u.type==="DONE"){if(c.status="done",r.frequency&&this.completionHandler){const d=await this.completionHandler.onComplete(c,new Date);d.success?(d.nextTask?(ue("Next recurrence created",{taskId:c.id,nextTaskId:d.nextTask.id,nextDue:d.nextTask.dueAt}),G.success("Task completed - next occurrence scheduled")):G.success(`Task status updated to ${u.name}`),d.warnings&&d.warnings.forEach(f=>G.warning(f))):G.error(`Failed to complete task: ${d.error}`)}else(t=this.settings)!=null&&t.dates.autoAddDone&&!c.doneAt&&(c.doneAt=new Date().toISOString()),await this.repository.saveTask(c),G.success(`Task status updated to ${u.name}`);Ye.emit("task:updated",{taskId:e})}else u.type==="CANCELLED"?(c.status="cancelled",(s=this.settings)!=null&&s.dates.autoAddCancelled&&!c.cancelledAt&&(c.cancelledAt=new Date().toISOString()),await this.repository.saveTask(c),Ye.emit("task:updated",{taskId:e}),G.success(`Task status updated to ${u.name}`)):u.type==="TODO"&&(c.status="todo",await this.repository.saveTask(c),Ye.emit("task:updated",{taskId:e}),G.success(`Task status updated to ${u.name}`))}catch(r){Te("Failed to toggle task status",r),G.error("Failed to toggle status")}}async completeTask(e){var t;try{const s=this.repository.getTask(e);if(!s){G.error("Task not found");return}const r={...s,status:"done"};if(s.frequency&&this.completionHandler){const a=await this.completionHandler.onComplete(r,new Date);a.success?(a.nextTask?(ue("Next recurrence created",{taskId:r.id,nextTaskId:a.nextTask.id,nextDue:a.nextTask.dueAt}),G.success(`Task "${s.name}" completed - next occurrence scheduled`)):G.success(`Task "${s.name}" completed`),a.warnings&&a.warnings.forEach(i=>G.warning(i))):G.error(`Failed to complete task: ${a.error}`)}else(t=this.settings)!=null&&t.dates.autoAddDone&&!r.doneAt&&(r.doneAt=new Date().toISOString()),await this.repository.saveTask(r),G.success(`Task "${s.name}" completed`);Ye.emit("task:complete",{taskId:e})}catch(s){Te("Failed to complete task",s),G.error("Failed to complete task")}}async deleteTask(e){try{const t=this.repository.getTask(e);if(!t){G.error("Task not found");return}const r=this.repository.getAllTasks().filter(a=>{var i,l;return((i=a.blockedBy)==null?void 0:i.includes(e))||((l=a.dependsOn)==null?void 0:l.includes(e))});if(r.length>0&&!confirm(`This task is blocking ${r.length} other task(s). Are you sure you want to delete it?`))return;await this.repository.deleteTask(e),Ye.emit("task:deleted",{taskId:e}),G.success(`Task "${t.name}" deleted`)}catch(t){Te("Failed to delete task",t),G.error("Failed to delete task")}}async rescheduleToToday(e){try{const t=this.repository.getTask(e);if(!t){G.error("Task not found");return}const s=new Date;s.setHours(12,0,0,0);const r={...t,scheduledAt:s.toISOString(),updatedAt:new Date().toISOString()};await this.repository.saveTask(r),Ye.emit("task:updated",{taskId:e}),G.success("Task rescheduled to today")}catch(t){Te("Failed to reschedule task",t),G.error("Failed to reschedule task")}}async deferTask(e,t){try{const s=this.repository.getTask(e);if(!s){G.error("Task not found");return}const r={...s,updatedAt:new Date().toISOString()};if(s.dueAt){const a=new Date(s.dueAt);a.setDate(a.getDate()+t),r.dueAt=a.toISOString()}if(s.scheduledAt){const a=new Date(s.scheduledAt);a.setDate(a.getDate()+t),r.scheduledAt=a.toISOString()}await this.repository.saveTask(r),Ye.emit("task:updated",{taskId:e}),G.success(`Task deferred by ${t} day${t!==1?"s":""}`)}catch(s){Te("Failed to defer task",s),G.error("Failed to defer task")}}}class B_{constructor(e,t,s){w(this,"plugin");w(this,"storageKey");w(this,"settings");w(this,"defaults");this.plugin=e,this.storageKey=t,this.defaults={...s},this.settings={...s}}async load(){try{const e=await this.plugin.loadData(this.storageKey);e&&(this.settings={...this.defaults,...e})}catch(e){console.error(`Failed to load settings from ${this.storageKey}:`,e),this.settings={...this.defaults}}return this.settings}async save(e){e&&(this.settings=e);try{await this.plugin.saveData(this.storageKey,this.settings)}catch(t){throw console.error(`Failed to save settings to ${this.storageKey}:`,t),t}}get(){return{...this.settings}}async set(e,t){this.settings[e]=t,await this.save()}async reset(){this.settings={...this.defaults},await this.save()}has(e){return e in this.settings}getValue(e){return this.settings[e]}}const mr=[{id:"quickAddTask",langKey:"quickAddTask",label:"Quick add recurring task",description:"Open the quick add dialog with focus on the task title.",defaultHotkey:"Ctrl+Shift+T",context:"Global / Editor"},{id:"markTaskDone",langKey:"markTaskDone",label:"Mark task as done",description:"Complete the focused task and trigger recurrence.",defaultHotkey:"Ctrl+Enter",context:"Task focus / Task block"},{id:"postponeTask",langKey:"postponeTask",label:"Postpone task",description:"Open the snooze selector for the focused task.",defaultHotkey:"Ctrl+Shift+P",context:"Task focus"},{id:"openRecurringTasksDock",langKey:"openRecurringTasksDock",label:"Open recurring tasks dock",description:"Focus the recurring tasks dashboard.",defaultHotkey:"Ctrl+Shift+O",context:"Global"},{id:"createRecurringTask",langKey:"createRecurringTask",label:"Create recurring task from selection",description:"Create a recurring task based on the current editor block.",defaultHotkey:"Ctrl+Shift+R",context:"Editor"},{id:"quickCompleteNextTask",langKey:"quickCompleteNextTask",label:"Quick complete next task",description:"Marks the most overdue task as complete.",defaultHotkey:"Ctrl+Shift+D",context:"Global"},{id:"toggleTaskStatus",langKey:"toggleTaskStatus",label:"Toggle task status",description:"Cycle the status of the focused task.",defaultHotkey:"Ctrl+Shift+X",context:"Task focus"},{id:"openTaskEditor",langKey:"openTaskEditor",label:"Open task editor",description:"Open the full task editor modal.",defaultHotkey:"Ctrl+Shift+E",context:"Global"}],Ii=mr.reduce((n,e)=>(n[e.id]=e.defaultHotkey,n),{});function co(n,e){Ye.emit("task:snooze",{taskId:n,minutes:e}),window.dispatchEvent(new CustomEvent("task-snooze",{detail:{taskId:n,minutes:e}})),ue(`Snoozing task ${n} for ${e} minutes`)}function Y_(n){const e=new Date,t=new Date(e);t.setDate(t.getDate()+1);const s=Vi(t),r=Math.max(0,Math.floor((s.getTime()-e.getTime())/(60*1e3)));Ye.emit("task:snooze",{taskId:n,minutes:r}),window.dispatchEvent(new CustomEvent("task-snooze",{detail:{taskId:n,minutes:r}})),ue(`Snoozing task ${n} to tomorrow`)}function $_(n){n.eventBus.on("click-blockicon",({detail:e})=>{var i,l,c;const t=e.blockElements;if(!t||t.length===0)return;const s=t[0],r=s==null?void 0:s.getAttribute("data-node-id");if(!r)return;const a=(s==null?void 0:s.textContent)||"";e.menu.addItem({icon:"iconCalendar",label:((i=n.i18n)==null?void 0:i.createRecurringTask)||"Create Recurring Task",click:()=>{Ye.emit("task:create",{source:"block-menu",linkedBlockId:r,linkedBlockContent:a,suggestedName:uo(a),suggestedTime:ho(a)}),window.dispatchEvent(new CustomEvent("recurring-task-create",{detail:{source:"block-menu",linkedBlockId:r,linkedBlockContent:a,suggestedName:uo(a),suggestedTime:ho(a)}}))}});try{const u=Ka.getInstance();if(u&&u.isReady()){const f=u.getRepository().getTaskByBlockId(r);if(f){e.menu.addSeparator(),e.menu.addItem({icon:"iconCheck",label:((l=n.i18n)==null?void 0:l.completeTask)||"Complete Task",click:()=>{Ye.emit("task:complete",{taskId:f.id}),window.dispatchEvent(new CustomEvent("recurring-task-complete",{detail:{taskId:f.id}}))}});const v=[{label:"15 minutes",click:()=>co(f.id,15)},{label:"1 hour",click:()=>co(f.id,60)},{label:"Tomorrow",click:()=>Y_(f.id)}];e.menu.addItem({icon:"iconClock",label:((c=n.i18n)==null?void 0:c.snoozeTask)||"Snooze Task",submenu:v})}}}catch{Hu("TaskManager not available for quick actions")}}),ue("Registered block context menu")}function uo(n){const e=n.split(`
`)[0].trim();return e.length>50?e.substring(0,50)+"...":e}function ho(n){var s;const e=/\b(\d{1,2}):(\d{2})\s*(AM|PM|am|pm)?\b/,t=n.match(e);if(t){let r=parseInt(t[1],10);const a=t[2],i=(s=t[3])==null?void 0:s.toUpperCase();return i==="PM"&&r<12?r+=12:i==="AM"&&r===12&&(r=0),`${r.toString().padStart(2,"0")}:${a}`}return null}const j_="recurring-task-shortcuts",W_=350;class H_{constructor(e,t,s,r,a){w(this,"settingsStore");w(this,"settings",{...Ii});w(this,"taskCommands");w(this,"cooldownTimers",new Map);this.plugin=e,this.repository=t,this.handlers=a,this.settingsStore=new B_(e,j_,Ii),this.taskCommands=new z_(t,s,r,void 0)}async initialize(){this.settings=await this.settingsStore.load()}registerShortcuts(){mr.forEach(e=>{const t=this.settings[e.id]||e.defaultHotkey;this.plugin.addCommand({langKey:e.langKey,hotkey:t,callback:()=>{this.handleShortcut(e.id)}})}),ue("Registered shortcut commands",{shortcuts:mr.map(e=>({id:e.id,hotkey:this.settings[e.id]}))})}getShortcutDisplay(){return mr.map(e=>({id:e.id,label:e.label,description:e.description,context:e.context,currentHotkey:this.settings[e.id]||"",defaultHotkey:e.defaultHotkey}))}async updateShortcut(e,t){const s=t.trim(),r=this.findDuplicateHotkey(e,s);return r?{success:!1,message:`Hotkey already assigned to "${r.label}".`}:(this.settings={...this.settings,[e]:s},await this.settingsStore.save(this.settings),this.registerShortcuts(),{success:!0})}async resetShortcut(e){const t=this.getDefinition(e);t&&(this.settings={...this.settings,[e]:t.defaultHotkey},await this.settingsStore.save(this.settings),this.registerShortcuts())}async resetAllShortcuts(){this.settings={...Ii},await this.settingsStore.save(this.settings),this.registerShortcuts()}destroy(){this.cooldownTimers.forEach(e=>globalThis.clearTimeout(e)),this.cooldownTimers.clear()}async handleShortcut(e){if(!this.shouldIgnoreShortcut(e))switch(e){case"quickAddTask":this.guardCooldown(e,W_,()=>{this.handlers.createTask(this.buildCreatePayload("shortcut"))});break;case"createRecurringTask":this.handlers.createTask(this.buildCreatePayload("shortcut"));break;case"openRecurringTasksDock":this.handlers.openDock();break;case"markTaskDone":{const t=this.resolveTaskId();if(!t)return;await this.handlers.completeTask(t);break}case"postponeTask":{const t=this.resolveTaskId();if(!t)return;this.handlers.postponeTask(t);break}case"quickCompleteNextTask":await this.quickCompleteNextTask();break;case"toggleTaskStatus":{const t=this.resolveTaskId();if(!t)return;await this.taskCommands.toggleStatus(t);break}case"openTaskEditor":this.handlers.openTaskEditor();break}}guardCooldown(e,t,s){if(this.cooldownTimers.has(e))return;s();const r=globalThis.setTimeout(()=>{this.cooldownTimers.delete(e)},t);this.cooldownTimers.set(e,r)}shouldIgnoreShortcut(e){const t=document.activeElement;if(!t)return!1;const s=t.tagName.toLowerCase();return["input","textarea","select"].includes(s)?!0:t.isContentEditable?!this.isEditorAllowedShortcut(e):!1}isEditorAllowedShortcut(e){return e==="quickAddTask"||e==="createRecurringTask"}resolveTaskId(){const e=this.getFocusedTaskId();if(e)return e;const t=this.getSelectedBlockContext();if(!t)return null;const s=this.repository.getTaskByBlockId(t.blockId);return(s==null?void 0:s.id)??null}getFocusedTaskId(){const e=document.activeElement;if(!e)return null;const t=e.closest("[data-task-id]");return(t==null?void 0:t.dataset.taskId)??null}getSelectedBlockContext(){const e=window.getSelection(),t=e==null?void 0:e.anchorNode;if(!t)return null;const s=t instanceof HTMLElement?t:t.parentElement;if(!s)return null;const r=s.closest("[data-node-id]");if(!r)return null;const a=r.getAttribute("data-node-id");return a?{blockId:a,blockContent:r.textContent||""}:null}buildCreatePayload(e){const t=this.getSelectedBlockContext();return t?{source:e,linkedBlockId:t.blockId,linkedBlockContent:t.blockContent,suggestedName:uo(t.blockContent),suggestedTime:ho(t.blockContent)}:{source:e}}async quickCompleteNextTask(){try{const e=this.repository.getTodayAndOverdueTasks();if(e.length===0)return;const t=e[0];await this.taskCommands.completeTask(t.id)}catch(e){Te("Failed to quick complete task",e),G.error("Failed to complete task")}}getDefinition(e){return mr.find(t=>t.id===e)}findDuplicateHotkey(e,t){if(!t)return null;const s=t.toLowerCase(),r=mr.find(a=>a.id===e?!1:(this.settings[a.id]||"").toLowerCase()===s);return r?{id:r.id,label:r.label,description:r.description,context:r.context,currentHotkey:this.settings[r.id],defaultHotkey:r.defaultHotkey}:null}}async function G_(n,e,t,s,r){const a=new H_(n,e,s,r,t);return await a.initialize(),a.registerShortcuts(),a}class K_{constructor(e,t){w(this,"plugin");w(this,"repository");w(this,"topbarElement",null);w(this,"updateIntervalId",null);this.plugin=e,this.repository=t}init(){this.createTopbarButton(),this.startAutoUpdate(),ue("Topbar menu initialized")}destroy(){this.updateIntervalId!==null&&(window.clearInterval(this.updateIntervalId),this.updateIntervalId=null),this.topbarElement&&(this.topbarElement.remove(),this.topbarElement=null),ue("Topbar menu destroyed")}createTopbarButton(){const e=this.plugin.addTopBar({icon:"iconCalendar",title:"Recurring Tasks",position:"right",callback:()=>{this.toggleMenu()}});this.topbarElement=e,this.updateBadge()}updateBadge(){if(!this.topbarElement)return;const e=this.repository.getTodayAndOverdueTasks(),t=e.filter(s=>{const r=new Date(s.dueAt);return r<new Date&&!Fo(r)}).length;if(e.length>0){const s=this.topbarElement.querySelector(".b3-badge");if(s)s.textContent=e.length.toString(),s.style.display="block",t>0?s.style.backgroundColor="var(--b3-theme-error)":s.style.backgroundColor="var(--b3-theme-primary)";else{const r=document.createElement("span");r.className="b3-badge",r.textContent=e.length.toString(),r.style.display="block",r.style.backgroundColor=t>0?"var(--b3-theme-error)":"var(--b3-theme-primary)",this.topbarElement.appendChild(r)}}else{const s=this.topbarElement.querySelector(".b3-badge");s&&s.remove()}}toggleMenu(){Ye.emit("task:settings",{action:"toggle"});const e=new CustomEvent("recurring-task-settings",{detail:{action:"toggle"}});window.dispatchEvent(e)}startAutoUpdate(){this.updateIntervalId=window.setInterval(()=>{this.updateBadge()},60*1e3)}update(){this.updateBadge()}}class V_{constructor(e="tasks"){w(this,"codeLanguage");w(this,"cachedCodeBlocks",new WeakMap);w(this,"cachedAttributeBlocks",new WeakMap);this.codeLanguage=e.toLowerCase()}parse(e){const t=[];let s=this.cachedCodeBlocks.get(e);s||(s=e.querySelectorAll('[data-type="NodeCodeBlock"]'),this.cachedCodeBlocks.set(e,s)),s.forEach(a=>{var d;if((a.dataset.subtype||a.getAttribute("data-subtype")||"").toLowerCase()!==this.codeLanguage)return;const l=a.querySelector("code")||a.querySelector("textarea")||a.querySelector(".hljs")||a,c=((d=l==null?void 0:l.textContent)==null?void 0:d.trim())??"";if(!c)return;const u=a.getAttribute("data-node-id")||`inline-query-${t.length}`;t.push({id:u,query:c,element:a,source:"code"})});let r=this.cachedAttributeBlocks.get(e);return r||(r=e.querySelectorAll("[data-node-id]"),this.cachedAttributeBlocks.set(e,r)),r.forEach(a=>{if(a.classList.contains("rt-inline-query")||a.getAttribute("data-type")==="NodeCodeBlock")return;const i=this.parseAttributes(a);if(!i.query)return;const l=a.getAttribute("data-node-id")||`inline-query-${t.length}`;t.push({id:l,query:i.query,view:i.view,element:a,source:"attribute"})}),t}parseAttributes(e){var a;const t=e.getAttribute("custom-task-query")||e.getAttribute("data-attr-custom-task-query")||e.dataset.customTaskQuery||e.dataset.attrCustomTaskQuery,s=e.getAttribute("custom-task-view")||e.getAttribute("data-attr-custom-task-view")||e.dataset.customTaskView||e.dataset.attrCustomTaskView;if(t)return{query:t.trim(),view:s};const r=e.getAttribute("data-attrs");if(!r)return{};try{const i=JSON.parse(r),l=(a=i["custom-task-query"])==null?void 0:a.trim(),c=i["custom-task-view"];return{query:l,view:c}}catch{return{}}}}class Q_{constructor(e=6e4,t=100){w(this,"cache",new Map);w(this,"metrics",{hits:0,misses:0,evictions:0});w(this,"maxSize");this.ttlMs=e,this.maxSize=t}buildKey(e,t){return`${e}::${t}`}get(e){const t=this.cache.get(e);return t?this.ttlMs>0&&Date.now()-t.updatedAt>this.ttlMs?(this.cache.delete(e),this.metrics.misses++,null):(t.lastAccessedAt=Date.now(),this.cache.delete(e),this.cache.set(e,t),this.metrics.hits++,t):(this.metrics.misses++,null)}set(e,t){this.cache.size>=this.maxSize&&!this.cache.has(e)&&this.evictLRU();const s=Date.now();this.cache.set(e,{result:t,updatedAt:s,lastAccessedAt:s})}clear(){this.cache.clear()}evictLRU(){const e=this.cache.keys().next().value;e&&(this.cache.delete(e),this.metrics.evictions++)}getMetrics(){return{hits:this.metrics.hits,misses:this.metrics.misses,size:this.cache.size,evictions:this.metrics.evictions}}resetMetrics(){this.metrics.hits=0,this.metrics.misses=0,this.metrics.evictions=0}}class Z_{render(e,t){if(e.innerHTML="",e.classList.add("rt-inline-query"),e.dataset.query=t.query,e.dataset.view=t.view,e.setAttribute("role","region"),e.setAttribute("aria-label","Task query results"),t.isIndexing){e.appendChild(this.renderLoadingState());return}if(t.error){e.appendChild(this.renderErrorState(t.error));return}if(!t.result){e.appendChild(this.renderState("No results yet."));return}const s=t.result.tasks,r=s.length;if(r===0||s.length===0){e.appendChild(this.renderEmptyState());return}const a=document.createElement("div");a.className="rt-inline-query__header",a.textContent=`Inline Tasks  ${r}`,e.appendChild(a);const i=t.view||"list",l=t.result.groups;if(l&&l.size>0?l.forEach((c,u)=>{const d=this.renderGroupSection(u,c,i,t);e.appendChild(d)}):e.appendChild(this.renderTaskCollection(s,i,t)),typeof t.maxItems=="number"&&typeof t.renderedCount=="number"&&t.renderedCount<r){const c=document.createElement("div");c.className="rt-inline-query__footer";const u=document.createElement("button");u.type="button",u.className="rt-inline-query__more",u.dataset.rtAction="more",u.textContent=`Show more (${t.renderedCount}/${r})`,c.appendChild(u),e.appendChild(c)}}renderGroupSection(e,t,s,r){const a=document.createElement("section");a.className="rt-inline-query__group";const i=document.createElement("div");return i.className="rt-inline-query__group-title",i.textContent=e||"Untitled",a.appendChild(i),a.appendChild(this.renderTaskCollection(t,s,r)),a}renderTaskCollection(e,t,s){return t==="table"?this.renderTable(e,s):this.renderList(e,s)}renderList(e,t){const s=document.createElement("ul");s.className="rt-inline-query__list",s.setAttribute("role","list"),s.setAttribute("aria-label","Tasks");const r=document.createDocumentFragment();return this.getRenderedTasks(e,t).forEach(i=>{const l=document.createElement("li");l.className="rt-inline-query__item",l.dataset.taskId=i.id;const c=document.createElement("button");c.type="button",c.className="rt-inline-query__checkbox",c.dataset.rtAction="toggle",c.setAttribute("aria-pressed",String(i.status==="done"));const u=i.status==="done"?`Mark incomplete: ${i.name.replace(/"/g,"'")}`:`Mark complete: ${i.name.replace(/"/g,"'")}`;c.setAttribute("aria-label",u),c.textContent=i.status==="done"?"":"";const d=document.createElement("span");d.className="rt-inline-query__title",d.textContent=i.name,i.status==="done"&&d.classList.add("rt-inline-query__title--done");const f=document.createElement("span");f.className="rt-inline-query__meta",f.textContent=this.formatTaskMeta(i);const v=this.renderSource(i),y=document.createElement("button");y.type="button",y.className="rt-inline-query__edit",y.dataset.rtAction="edit",y.setAttribute("aria-label",`Edit task: ${i.name.replace(/"/g,"'")}`),y.textContent="Edit",l.appendChild(c),l.appendChild(d),l.appendChild(f),v&&l.appendChild(v),l.appendChild(y),r.appendChild(l)}),s.appendChild(r),s}renderTable(e,t){const s=document.createElement("table");s.className="rt-inline-query__table",s.setAttribute("role","table"),s.setAttribute("aria-label","Tasks table");const r=document.createElement("thead"),a=document.createElement("tr");["Status","Task","Dates","Priority","Source",""].forEach(u=>{const d=document.createElement("th");d.textContent=u,a.appendChild(d)}),r.appendChild(a),s.appendChild(r);const i=document.createElement("tbody"),l=document.createDocumentFragment();return this.getRenderedTasks(e,t).forEach(u=>{const d=document.createElement("tr");d.dataset.taskId=u.id;const f=document.createElement("td"),v=document.createElement("button");v.type="button",v.className="rt-inline-query__checkbox",v.dataset.rtAction="toggle",v.setAttribute("aria-pressed",String(u.status==="done"));const y=u.status==="done"?`Mark incomplete: ${u.name.replace(/"/g,"'")}`:`Mark complete: ${u.name.replace(/"/g,"'")}`;v.setAttribute("aria-label",y),v.textContent=u.status==="done"?"":"",f.appendChild(v);const _=document.createElement("td");_.textContent=u.name,u.status==="done"&&_.classList.add("rt-inline-query__title--done");const m=document.createElement("td");m.textContent=this.formatTaskDates(u);const g=document.createElement("td");g.textContent=u.priority??"";const b=document.createElement("td"),x=this.renderSource(u);x?b.appendChild(x):b.textContent="";const D=document.createElement("td"),A=document.createElement("button");A.type="button",A.className="rt-inline-query__edit",A.dataset.rtAction="edit",A.setAttribute("aria-label",`Edit task: ${u.name.replace(/"/g,"'")}`),A.textContent="Edit",D.appendChild(A),d.appendChild(f),d.appendChild(_),d.appendChild(m),d.appendChild(g),d.appendChild(b),d.appendChild(D),l.appendChild(d)}),i.appendChild(l),s.appendChild(i),s}getRenderedTasks(e,t){return t.maxItems?e.slice(0,t.maxItems):e}formatTaskDates(e){const t=[];return e.dueAt&&t.push(`Due ${this.formatDate(e.dueAt)}`),e.scheduledAt&&t.push(`Scheduled ${this.formatDate(e.scheduledAt)}`),e.startAt&&t.push(`Start ${this.formatDate(e.startAt)}`),t.length>0?t.join("  "):""}formatTaskMeta(e){const t=[];return e.dueAt&&t.push(`Due ${this.formatDate(e.dueAt)}`),e.scheduledAt&&t.push(`Scheduled ${this.formatDate(e.scheduledAt)}`),e.startAt&&t.push(`Start ${this.formatDate(e.startAt)}`),e.priority&&t.push(`Priority ${e.priority}`),t.length>0?t.join("  "):"No dates"}formatDate(e){if(!e)return"";try{return new Date(e).toLocaleDateString()}catch{return e}}renderSource(e){if(!e.linkedBlockId&&!e.path)return null;const t=document.createElement("a");return t.className="rt-inline-query__source",t.dataset.rtAction="jump",t.dataset.blockId=e.linkedBlockId??"",e.linkedBlockId&&(t.href=`siyuan://blocks/${e.linkedBlockId}`),t.textContent=this.formatSourceLabel(e),t.title=e.path??e.linkedBlockId??"",t}formatSourceLabel(e){if(e.path){const t=e.path.split("/");return t[t.length-1]||e.path}return e.linkedBlockId?"Block":"Source"}renderState(e,t="info"){const s=document.createElement("div");return s.className=`rt-inline-query__state rt-inline-query__state--${t}`,s.textContent=e,s}renderLoadingState(){const e=document.createElement("div");e.className="rt-inline-query__loading",e.setAttribute("role","status"),e.setAttribute("aria-live","polite"),e.setAttribute("aria-label","Loading tasks");const t=document.createElement("div");t.className="rt-inline-query__spinner";const s=document.createElement("div");return s.className="rt-inline-query__loading-text",s.textContent="Building index",e.appendChild(t),e.appendChild(s),e}renderErrorState(e){const t=document.createElement("div");t.className="rt-inline-query__state rt-inline-query__state--error",t.setAttribute("role","alert");const s=document.createElement("div");s.className="rt-inline-query__error-icon",s.textContent="";const r=document.createElement("div");r.className="rt-inline-query__error-message",r.textContent=e;const a=document.createElement("div");return a.className="rt-inline-query__error-hint",a.textContent="Check your query syntax and try again.",t.appendChild(s),t.appendChild(r),t.appendChild(a),t}renderEmptyState(){const e=document.createElement("div");e.className="rt-inline-query__state rt-inline-query__state--empty";const t=document.createElement("div");t.className="rt-inline-query__empty-icon",t.textContent="";const s=document.createElement("div");s.className="rt-inline-query__empty-message",s.textContent="No tasks match this query";const r=document.createElement("div");return r.className="rt-inline-query__empty-hint",r.textContent="Try adjusting your filters or create a new task.",e.appendChild(t),e.appendChild(s),e.appendChild(r),e}}class X_{constructor(e){w(this,"parser",new V_);w(this,"renderer",new Z_);w(this,"cache",new Q_);w(this,"queryComposer",new id(new tr));w(this,"blocks",new Map);w(this,"refreshTimer");w(this,"indexReady",!1);w(this,"unsubs",[]);w(this,"debounceMs");w(this,"pageSize");this.options=e,this.debounceMs=e.debounceMs??300,this.pageSize=e.pageSize??50}mount(){var r,a,i,l;this.refreshAll();const{plugin:e}=this.options,t=()=>this.scheduleRefresh(),s=()=>this.scheduleRefresh();try{const c=(a=(r=e.eventBus).on)==null?void 0:a.call(r,"loaded-protyle",t),u=(l=(i=e.eventBus).on)==null?void 0:l.call(i,"switch-protyle",s);typeof c=="function"&&this.unsubs.push(c),typeof u=="function"&&this.unsubs.push(u)}catch(c){ot("Inline query controller failed to bind protyle events",c)}this.unsubs.push(Ye.on("task:refresh",()=>{this.cache.clear(),this.scheduleRefresh()})),this.unsubs.push(Ye.on("task:settings",()=>{this.cache.clear(),this.scheduleRefresh()}))}destroy(){this.refreshTimer&&globalThis.clearTimeout(this.refreshTimer),this.blocks.forEach(({container:e})=>e.remove()),this.blocks.clear(),this.unsubs.forEach(e=>e()),this.unsubs=[]}scheduleRefresh(){this.refreshTimer&&globalThis.clearTimeout(this.refreshTimer),this.refreshTimer=globalThis.setTimeout(()=>{this.refreshAll()},this.debounceMs)}refreshAll(){const e=this.getProtyleRoots();if(e.length===0)return;const t=new Set;e.forEach(s=>{this.parser.parse(s).forEach(a=>{t.add(a.id);const i=this.getOrCreateBlockState(a);this.renderBlock(i)})}),Array.from(this.blocks.keys()).forEach(s=>{if(!t.has(s)){const r=this.blocks.get(s);r==null||r.container.remove(),this.blocks.delete(s)}}),this.indexReady=!0}renderBlock(e){const{block:t}=e,s=t.view??"list";if(!this.indexReady){this.renderer.render(e.container,{query:t.query,view:s,isIndexing:!0});return}let r,a;try{a=this.executeQuery(t.query)}catch(l){r=l instanceof Error?l.message:String(l)}const i=a?Math.min(e.renderLimit,a.tasks.length):0;this.renderer.render(e.container,{query:t.query,view:s,result:a,error:r,maxItems:e.renderLimit,renderedCount:i})}executeQuery(e){const t=this.options.settingsService.get(),s=this.buildSettingsHash(t),r=this.cache.buildKey(e,s),a=this.cache.get(r);if(a)return a.result;const i={getAllTasks:()=>this.options.repository.getAllTasks()},l=new ad(i,{urgencySettings:t.urgency}),c=na.getInstance();if(c.isEnabled()&&c.getError())throw new Error(`Global query error: ${c.getError()}`);const u=this.queryComposer.compose(e,c.getAST()).ast,d=l.execute(u);return this.cache.set(r,d),d}buildSettingsHash(e){try{return JSON.stringify(e)}catch{return String(Date.now())}}getOrCreateBlockState(e){const t=this.blocks.get(e.id);if(t)return t.block=e,t;const s=document.createElement("div");s.dataset.rtInlineQuery=e.id,s.className="rt-inline-query",e.element.insertAdjacentElement("afterend",s),s.addEventListener("click",a=>this.handleContainerClick(a));const r={block:e,container:s,renderLimit:this.pageSize};return this.blocks.set(e.id,r),r}handleContainerClick(e){const t=e.target;if(!t)return;const s=t.closest("[data-rt-action]");if(!s)return;const r=s.dataset.rtAction,a=t.closest(".rt-inline-query");if(!a)return;const i=a.dataset.rtInlineQuery;if(!i)return;const l=this.blocks.get(i);if(!l)return;if(r==="more"){l.renderLimit+=this.pageSize,this.renderBlock(l);return}const c=t.closest("[data-task-id]"),u=c==null?void 0:c.dataset.taskId;if(u){if(r==="toggle"){this.options.onToggleTask(u);return}if(r==="edit"){const d=this.options.repository.getTask(u);d&&this.options.onEditTask(d)}}}getProtyleRoots(){return Array.from(document.querySelectorAll(".protyle-wysiwyg"))}}class J_ extends vo.Plugin{constructor(){super(...arguments);w(this,"taskManager");w(this,"repository");w(this,"scheduler");w(this,"eventService");w(this,"migrationManager");w(this,"topbarMenu");w(this,"settingsService");w(this,"dashboardComponent",null);w(this,"dockEl");w(this,"quickAddComponent",null);w(this,"quickAddContainer",null);w(this,"taskEditorComponent",null);w(this,"taskEditorContainer",null);w(this,"postponeComponent",null);w(this,"postponeContainer",null);w(this,"pendingCompletionTimeouts",new Map);w(this,"shortcutManager",null);w(this,"inlineQueryController",null);w(this,"handleCreateTaskEvent",t=>{try{const s=t;ue("Create task event received",s.detail),this.openQuickAdd(s.detail)}catch(s){Te("Failed to handle create task event",s),G.error("Failed to open task creator.")}});w(this,"handleSettingsEvent",t=>{try{ue("Settings event received",t.detail),this.openDock()}catch(s){Te("Failed to handle settings event",s),G.error("Failed to open settings.")}});w(this,"handleCompleteTaskEvent",async t=>{try{const s=t,{taskId:r}=s.detail??{};if(!r)throw new Error("Missing taskId for completion event.");await this.handleCompleteTask(r)}catch(s){Te("Failed to complete task",s),G.error("Failed to complete task.")}});w(this,"handleSnoozeTaskEvent",async t=>{try{const s=t,{taskId:r,minutes:a}=s.detail??{};if(!r||typeof a!="number")throw new Error("Missing task snooze details.");await this.handleSnoozeTask(r,a)}catch(s){Te("Failed to snooze task",s),G.error("Failed to snooze task.")}})}async onload(){ue("Loading Recurring Tasks Plugin"),this.migrationManager=new g_(this);try{await this.migrationManager.migrate(Bn)}catch(r){Te("Migration failed, continuing with existing data",r)}const t=Ka.getInstance(this);if(!t)throw new Error("TaskManager failed to initialize");this.taskManager=t,await this.taskManager.initialize(),this.repository=this.taskManager.getRepository(),this.scheduler=this.taskManager.getScheduler(),this.eventService=this.taskManager.getEventService();const s=this.taskManager.getSettingsService();this.settingsService=s;try{await this.taskManager.start()}catch(r){Te("Failed to start TaskManager",r)}this.shortcutManager=await G_(this,this.repository,{createTask:r=>this.dispatchCreateTask(r),completeTask:r=>Ye.emit("task:complete",{taskId:r}),postponeTask:r=>this.openPostponePicker(r),openDock:()=>this.openDock(),openTaskEditor:()=>this.openTaskEditor()},this.scheduler.getRecurrenceEngine(),()=>s.get()),this.addCommand({langString:"switchGlobalFilterProfile",hotkey:"F",callback:async()=>{var d;const a=us.getInstance().getConfig();if(!a.enabled){showMessage(this.i18n.globalFilterDisabled||"Global Filter is disabled. Enable it in settings first.",3e3,"info");return}if(a.profiles.length===0){showMessage(this.i18n.noProfiles||"No profiles found. Create one in settings.",3e3,"info");return}const i=new Menu;a.profiles.forEach(f=>{i.addItem({label:f.name,icon:f.id===a.activeProfileId?"iconCheck":"",click:async()=>{await this.switchToProfile(f.id)}})}),i.addSeparator(),i.addItem({label:this.i18n.manageProfiles||"Manage Profiles...",icon:"iconSettings",click:()=>{this.openSettings("global-filter")}});const l=(d=document.activeElement)==null?void 0:d.getBoundingClientRect(),c=l?l.left:window.innerWidth/2,u=l?l.bottom+5:100;i.showAtPosition({x:c,y:u})}}),this.addCommand({langString:"toggleGlobalFilter",hotkey:"",callback:async()=>{const r=us.getInstance(),a=r.getConfig(),i=!a.enabled;await this.settingsService.update({globalFilter:{...a,enabled:i}}),r.updateConfig({...a,enabled:i}),showMessage(i?this.i18n.globalFilterEnabled||"Global Filter enabled":this.i18n.globalFilterDisabled||"Global Filter disabled",2e3,"info"),Ye.emit("task:refresh",void 0)}}),this.addCommand({langString:"showGlobalFilterStatus",hotkey:"",callback:async()=>{const r=us.getInstance(),a=r.getConfig(),i=r.getActiveProfile();if(!a.enabled){showMessage(this.i18n.globalFilterDisabled||"Global Filter: Disabled",3e3,"info");return}if(!i){showMessage(this.i18n.noActiveProfile||"No active profile",3e3,"error");return}const l=await this.repository.getAllTasks(),c=l.filter(v=>r.shouldIncludeTask(v)).length,u=l.length-c,d=`
          <div style="padding: 10px;">
            <h3 style="margin: 0 0 10px 0;">Global Filter Status</h3>
            <p><strong>Active Profile:</strong> ${i.name}</p>
            ${i.description?`<p style="color: var(--text-muted); font-size: 0.9em;">${i.description}</p>`:""}
            <p><strong>Included Tasks:</strong> ${c}</p>
            <p><strong>Excluded Tasks:</strong> ${u}</p>
            <p><strong>Total Tasks:</strong> ${l.length}</p>
          </div>
        `;new Dialog({title:"Global Filter Status",content:d,width:"400px"}).open()}}),this.addCommand({langString:"createGlobalFilterProfile",hotkey:"",callback:async()=>{const r=await this.promptForInput(this.i18n.enterProfileName||"Enter profile name:","");if(!r||r.trim()==="")return;const a=us.getInstance(),i=a.getConfig(),l={id:`profile_${Date.now()}`,name:r.trim(),description:"",includePaths:[],excludePaths:[],includeTags:[],excludeTags:[],includeRegex:void 0,excludeRegex:void 0,regexTargets:["taskText"],excludeStatusTypes:[]},c={...i,profiles:[...i.profiles,l],activeProfileId:l.id};a.updateConfig(c),await this.settingsService.update({globalFilter:c}),showMessage(`Profile "${r}" created and activated`,2e3,"info"),await this.confirmDialog(this.i18n.configureNewProfile||"Configure new profile now?")&&this.openSettings("global-filter")}}),this.addCommand({langString:"explainTaskExclusion",hotkey:"",callback:async()=>{const r=us.getInstance();if(!r.getConfig().enabled){showMessage(this.i18n.globalFilterDisabled||"Global Filter is disabled",2e3,"info");return}const i=await this.getFocusedTask();if(!i){showMessage(this.i18n.noTaskSelected||"No task selected. Click on a task first.",3e3,"info");return}const l=r.explainTask(i);let c=`
          <div style="padding: 10px;">
            <h3 style="margin: 0 0 10px 0;">Filter Explanation</h3>
            <p><strong>Task:</strong> ${i.name}</p>
        `;l.included?c+=`
            <p style="color: var(--text-success); font-weight: 600;"> Task is INCLUDED</p>
            <p>${l.reason}</p>
          `:(c+=`
            <p style="color: var(--text-error); font-weight: 600;"> Task is EXCLUDED</p>
            <p><strong>Reason:</strong> ${l.reason}</p>
          `,l.matchedRule&&(c+=`
              <p><strong>Matched Rule:</strong></p>
              <ul style="margin-left: 20px;">
                <li><strong>Type:</strong> ${l.matchedRule.type}</li>
                <li><strong>Pattern:</strong> <code>${l.matchedRule.pattern}</code></li>
                ${l.matchedRule.target?`<li><strong>Target:</strong> ${l.matchedRule.target}</li>`:""}
              </ul>
            `)),c+="</div>",new Dialog({title:"Task Filter Explanation",content:c,width:"500px"}).open()}}),$_(this),this.topbarMenu=new K_(this,this.repository),this.topbarMenu.init(),this.addDock({config:{position:"RightBottom",size:{width:400,height:600},icon:"iconCalendar",title:"Recurring Tasks"},data:null,type:hv,init:r=>{this.dockEl=r.element,this.renderDashboard()},destroy:()=>{this.destroyDashboard()}}),this.addEventListeners(),this.inlineQueryController=new X_({plugin:this,repository:this.repository,settingsService:this.settingsService,onEditTask:r=>this.openTaskEditor(r),onToggleTask:r=>Ye.emit("task:complete",{taskId:r})}),this.inlineQueryController.mount(),ue("Recurring Tasks Plugin loaded successfully")}async onunload(){ue("Unloading Recurring Tasks Plugin"),this.pendingCompletionTimeouts.forEach(t=>{globalThis.clearTimeout(t)}),this.pendingCompletionTimeouts.clear(),this.taskManager&&await this.taskManager.destroy(),this.topbarMenu&&this.topbarMenu.destroy(),this.destroyDashboard(),this.closeQuickAdd(),this.closeTaskEditor(),this.closePostponePicker(),this.removeEventListeners(),this.shortcutManager&&(this.shortcutManager.destroy(),this.shortcutManager=null),this.inlineQueryController&&(this.inlineQueryController.destroy(),this.inlineQueryController=null)}renderDashboard(){this.dockEl&&!this.dashboardComponent&&(this.dashboardComponent=_a(r_,{target:this.dockEl,props:{repository:this.repository,scheduler:this.scheduler,eventService:this.eventService,shortcutManager:this.shortcutManager,settingsService:this.settingsService}}))}destroyDashboard(){this.dashboardComponent&&(ka(this.dashboardComponent),this.dashboardComponent=null)}addEventListeners(){try{Ye.on("task:create",t=>{ue("Create task event received",t),this.openQuickAdd(t)}),Ye.on("task:complete",async t=>{await this.handleCompleteTask(t.taskId)}),Ye.on("task:snooze",async t=>{await this.handleSnoozeTask(t.taskId,t.minutes)}),Ye.on("task:settings",()=>{this.openDock()}),Ye.on("task:refresh",()=>{}),window.addEventListener("recurring-task-create",this.handleCreateTaskEvent),window.addEventListener("recurring-task-settings",this.handleSettingsEvent),window.addEventListener("recurring-task-complete",this.handleCompleteTaskEvent),window.addEventListener("task-snooze",this.handleSnoozeTaskEvent)}catch(t){Te("Failed to add event listeners",t),this.removeEventListeners()}}removeEventListeners(){Ye.clear(),window.removeEventListener("recurring-task-create",this.handleCreateTaskEvent),window.removeEventListener("recurring-task-settings",this.handleSettingsEvent),window.removeEventListener("recurring-task-complete",this.handleCompleteTaskEvent),window.removeEventListener("task-snooze",this.handleSnoozeTaskEvent)}async handleCompleteTask(t){const s=this.repository.getTask(t);if(s){if(this.pendingCompletionTimeouts.has(t)){G.info(`Completion already pending for "${s.name}".`);return}const r=globalThis.setTimeout(async()=>{this.pendingCompletionTimeouts.delete(t);try{await this.eventService.handleTaskCompleted(s),await this.scheduler.markTaskDone(t),this.topbarMenu&&this.topbarMenu.update(),Ye.emit("task:refresh",void 0),ue(`Task completed: ${s.name}`)}catch(i){Te("Failed to finalize task completion",i),G.error("Failed to complete task.")}},5e3);this.pendingCompletionTimeouts.set(t,r);const a=()=>{const i=this.pendingCompletionTimeouts.get(t);i&&(globalThis.clearTimeout(i),this.pendingCompletionTimeouts.delete(t),G.info(`Undo: "${s.name}" restored`))};Yn({message:`Task "${s.name}" completed.`,type:"success",duration:5e3,actionLabel:"Undo",onAction:a,showCountdown:!0})}}async handleSnoozeTask(t,s){const r=this.repository.getTask(t);r&&(await this.eventService.handleTaskSnoozed(r),await this.scheduler.delayTask(t,s),this.topbarMenu&&this.topbarMenu.update(),ue(`Task snoozed: ${r.name} for ${s} minutes`))}openQuickAdd(t){this.quickAddComponent&&this.closeQuickAdd(),this.quickAddContainer=document.createElement("div"),document.body.appendChild(this.quickAddContainer),this.quickAddComponent=_a(u_,{target:this.quickAddContainer,props:{repository:this.repository,prefill:t,onClose:()=>this.closeQuickAdd(),onAdvanced:()=>{this.closeQuickAdd(),this.openTaskEditor()}}})}openPostponePicker(t){const s=this.repository.getTask(t);if(!s){G.error("Task not found");return}this.postponeComponent&&this.closePostponePicker(),this.postponeContainer=document.createElement("div"),document.body.appendChild(this.postponeContainer),this.postponeComponent=_a(f_,{target:this.postponeContainer,props:{taskName:s.name,onClose:()=>this.closePostponePicker(),onSelect:r=>{co(t,r),this.closePostponePicker()}}})}closePostponePicker(){this.postponeComponent&&(ka(this.postponeComponent),this.postponeComponent=null),this.postponeContainer&&(this.postponeContainer.remove(),this.postponeContainer=null)}dispatchCreateTask(t){Ye.emit("task:create",t),window.dispatchEvent(new CustomEvent("recurring-task-create",{detail:t}))}closeQuickAdd(){this.quickAddComponent&&(ka(this.quickAddComponent),this.quickAddComponent=null),this.quickAddContainer&&(this.quickAddContainer.remove(),this.quickAddContainer=null)}openTaskEditor(t){this.taskEditorComponent&&this.closeTaskEditor(),this.taskEditorContainer=document.createElement("div"),document.body.appendChild(this.taskEditorContainer),this.taskEditorComponent=_a(md,{target:this.taskEditorContainer,props:{repository:this.repository,task:t,onClose:()=>this.closeTaskEditor(),onSave:()=>{window.dispatchEvent(new CustomEvent("recurring-task-refresh"))}}})}closeTaskEditor(){this.taskEditorComponent&&(ka(this.taskEditorComponent),this.taskEditorComponent=null),this.taskEditorContainer&&(this.taskEditorContainer.remove(),this.taskEditorContainer=null)}async switchToProfile(t){const s=us.getInstance(),r=s.getConfig(),a=r.profiles.find(i=>i.id===t);if(!a){showMessage(this.i18n.profileNotFound||"Profile not found",2e3,"error");return}s.setActiveProfile(t),await this.settingsService.update({globalFilter:{...r,activeProfileId:t}}),showMessage(`Switched to profile: ${a.name}`,2e3,"info"),Ye.emit("task:refresh",void 0)}openSettings(t){const s=new SettingsDialog(this,this.settingsService);t&&s.openToSection(t),s.open()}async promptForInput(t,s){return new Promise(r=>{var l;const a=new Dialog({title:t,content:`
          <div style="padding: 10px;">
            <input 
              type="text" 
              id="input-value" 
              value="${s}" 
              style="width: 100%; padding: 8px; border: 1px solid var(--background-modifier-border); border-radius: 4px;"
            />
          </div>
        `,width:"400px"});(l=a.element.querySelector("#input-value"))==null||l.addEventListener("keypress",c=>{var u;if(c.key==="Enter"){const d=(u=a.element.querySelector("#input-value"))==null?void 0:u.value;a.destroy(),r(d||null)}});const i=a.element.querySelector(".b3-dialog__footer");if(i){const c=document.createElement("button");c.textContent="OK",c.className="b3-button b3-button--primary",c.onclick=()=>{var f;const d=(f=a.element.querySelector("#input-value"))==null?void 0:f.value;a.destroy(),r(d||null)};const u=document.createElement("button");u.textContent="Cancel",u.className="b3-button",u.onclick=()=>{a.destroy(),r(null)},i.appendChild(u),i.appendChild(c)}a.open()})}async confirmDialog(t){return new Promise(s=>{const r=new Dialog({title:"Confirm",content:`<div style="padding: 10px;">${t}</div>`,width:"350px"}),a=r.element.querySelector(".b3-dialog__footer");if(a){const i=document.createElement("button");i.textContent="Yes",i.className="b3-button b3-button--primary",i.onclick=()=>{r.destroy(),s(!0)};const l=document.createElement("button");l.textContent="No",l.className="b3-button",l.onclick=()=>{r.destroy(),s(!1)},a.appendChild(l),a.appendChild(i)}r.open()})}async getFocusedTask(){const t=document.activeElement,s=t==null?void 0:t.getAttribute("data-task-id");return s?this.repository.getTask(s)||null:(this.taskEditorComponent,null)}}module.exports=J_;

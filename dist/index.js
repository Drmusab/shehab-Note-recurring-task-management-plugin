"use strict";var Hd=Object.defineProperty;var nl=n=>{throw TypeError(n)};var Gd=(n,e,t)=>e in n?Hd(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var b=(n,e,t)=>Gd(n,typeof e!="symbol"?e+"":e,t),bi=(n,e,t)=>e.has(n)||nl("Cannot "+t);var k=(n,e,t)=>(bi(n,e,"read from private field"),t?t.call(n):e.get(n)),Te=(n,e,t)=>e.has(n)?nl("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),fe=(n,e,t,s)=>(bi(n,e,"write to private field"),s?s.call(n,t):e.set(n,t),t),it=(n,e,t)=>(bi(n,e,"access private method"),t);const _o=require("siyuan");function Kd(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Vd=qc;function qc(n,e,t){n instanceof RegExp&&(n=rl(n,t)),e instanceof RegExp&&(e=rl(e,t));var s=Uc(n,e,t);return s&&{start:s[0],end:s[1],pre:t.slice(0,s[0]),body:t.slice(s[0]+n.length,s[1]),post:t.slice(s[1]+e.length)}}function rl(n,e){var t=e.match(n);return t?t[0]:null}qc.range=Uc;function Uc(n,e,t){var s,r,a,i,l,c=t.indexOf(n),u=t.indexOf(e,c+1),d=c;if(c>=0&&u>0){if(n===e)return[c,u];for(s=[],a=t.length;d>=0&&!l;)d==c?(s.push(d),c=t.indexOf(n,d+1)):s.length==1?l=[s.pop(),u]:(r=s.pop(),r<a&&(a=r,i=u),u=t.indexOf(e,d+1)),d=c<u&&c>=0?c:u;s.length&&(l=[a,i])}return l}var Bc=Vd,Qd=Jd,zc="\0SLASH"+Math.random()+"\0",$c="\0OPEN"+Math.random()+"\0",wo="\0CLOSE"+Math.random()+"\0",Yc="\0COMMA"+Math.random()+"\0",jc="\0PERIOD"+Math.random()+"\0";function _i(n){return parseInt(n,10)==n?parseInt(n,10):n.charCodeAt(0)}function Xd(n){return n.split("\\\\").join(zc).split("\\{").join($c).split("\\}").join(wo).split("\\,").join(Yc).split("\\.").join(jc)}function Zd(n){return n.split(zc).join("\\").split($c).join("{").split(wo).join("}").split(Yc).join(",").split(jc).join(".")}function Wc(n){if(!n)return[""];var e=[],t=Bc("{","}",n);if(!t)return n.split(",");var s=t.pre,r=t.body,a=t.post,i=s.split(",");i[i.length-1]+="{"+r+"}";var l=Wc(a);return a.length&&(i[i.length-1]+=l.shift(),i.push.apply(i,l)),e.push.apply(e,i),e}function Jd(n){return n?(n.substr(0,2)==="{}"&&(n="\\{\\}"+n.substr(2)),jr(Xd(n),!0).map(Zd)):[]}function eh(n){return"{"+n+"}"}function th(n){return/^-?0\d/.test(n)}function sh(n,e){return n<=e}function nh(n,e){return n>=e}function jr(n,e){var t=[],s=Bc("{","}",n);if(!s)return[n];var r=s.pre,a=s.post.length?jr(s.post,!1):[""];if(/\$$/.test(s.pre))for(var i=0;i<a.length;i++){var l=r+"{"+s.body+"}"+a[i];t.push(l)}else{var c=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(s.body),u=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(s.body),d=c||u,f=s.body.indexOf(",")>=0;if(!d&&!f)return s.post.match(/,(?!,).*\}/)?(n=s.pre+"{"+s.body+wo+s.post,jr(n)):[n];var p;if(d)p=s.body.split(/\.\./);else if(p=Wc(s.body),p.length===1&&(p=jr(p[0],!1).map(eh),p.length===1))return a.map(function(X){return s.pre+p[0]+X});var y;if(d){var w=_i(p[0]),m=_i(p[1]),g=Math.max(p[0].length,p[1].length),_=p.length==3?Math.abs(_i(p[2])):1,x=sh,D=m<w;D&&(_*=-1,x=nh);var E=p.some(th);y=[];for(var R=w;x(R,m);R+=_){var P;if(u)P=String.fromCharCode(R),P==="\\"&&(P="");else if(P=String(R),E){var L=g-P.length;if(L>0){var H=new Array(L+1).join("0");R<0?P="-"+H+P.slice(1):P=H+P}}y.push(P)}}else{y=[];for(var Y=0;Y<p.length;Y++)y.push.apply(y,jr(p[Y],!1))}for(var Y=0;Y<y.length;Y++)for(var i=0;i<a.length;i++){var l=r+y[Y]+a[i];(!e||d||l)&&t.push(l)}}return t}const rh=Kd(Qd),ah=1024*64,Ua=n=>{if(typeof n!="string")throw new TypeError("invalid pattern");if(n.length>ah)throw new TypeError("pattern is too long")},ih={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},Yr=n=>n.replace(/[[\]\\-]/g,"\\$&"),oh=n=>n.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),al=n=>n.join(""),lh=(n,e)=>{const t=e;if(n.charAt(t)!=="[")throw new Error("not in a brace expression");const s=[],r=[];let a=t+1,i=!1,l=!1,c=!1,u=!1,d=t,f="";e:for(;a<n.length;){const m=n.charAt(a);if((m==="!"||m==="^")&&a===t+1){u=!0,a++;continue}if(m==="]"&&i&&!c){d=a+1;break}if(i=!0,m==="\\"&&!c){c=!0,a++;continue}if(m==="["&&!c){for(const[g,[_,x,D]]of Object.entries(ih))if(n.startsWith(g,a)){if(f)return["$.",!1,n.length-t,!0];a+=g.length,D?r.push(_):s.push(_),l=l||x;continue e}}if(c=!1,f){m>f?s.push(Yr(f)+"-"+Yr(m)):m===f&&s.push(Yr(m)),f="",a++;continue}if(n.startsWith("-]",a+1)){s.push(Yr(m+"-")),a+=2;continue}if(n.startsWith("-",a+1)){f=m,a+=2;continue}s.push(Yr(m)),a++}if(d<a)return["",!1,0,!1];if(!s.length&&!r.length)return["$.",!1,n.length-t,!0];if(r.length===0&&s.length===1&&/^\\?.$/.test(s[0])&&!u){const m=s[0].length===2?s[0].slice(-1):s[0];return[oh(m),!1,d-t,!1]}const p="["+(u?"^":"")+al(s)+"]",y="["+(u?"":"^")+al(r)+"]";return[s.length&&r.length?"("+p+"|"+y+")":s.length?p:y,l,d-t,!0]},Wr=(n,{windowsPathsNoEscape:e=!1}={})=>e?n.replace(/\[([^\/\\])\]/g,"$1"):n.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1"),ch=new Set(["!","?","+","*","@"]),il=n=>ch.has(n),uh="(?!(?:^|/)\\.\\.?(?:$|/))",ka="(?!\\.)",dh=new Set(["[","."]),hh=new Set(["..","."]),fh=new Set("().*{}+?[]^$\\!"),vh=n=>n.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),ko="[^/]",ol=ko+"*?",ll=ko+"+?";var At,Mt,Xs,ot,bt,bn,jn,_n,Us,Wn,oa,ir,Hc,Mn,Oa,Ui,Gc;const Qt=class Qt{constructor(e,t,s={}){Te(this,ir);b(this,"type");Te(this,At);Te(this,Mt);Te(this,Xs,!1);Te(this,ot,[]);Te(this,bt);Te(this,bn);Te(this,jn);Te(this,_n,!1);Te(this,Us);Te(this,Wn);Te(this,oa,!1);this.type=e,e&&fe(this,Mt,!0),fe(this,bt,t),fe(this,At,k(this,bt)?k(k(this,bt),At):this),fe(this,Us,k(this,At)===this?s:k(k(this,At),Us)),fe(this,jn,k(this,At)===this?[]:k(k(this,At),jn)),e==="!"&&!k(k(this,At),_n)&&k(this,jn).push(this),fe(this,bn,k(this,bt)?k(k(this,bt),ot).length:0)}get hasMagic(){if(k(this,Mt)!==void 0)return k(this,Mt);for(const e of k(this,ot))if(typeof e!="string"&&(e.type||e.hasMagic))return fe(this,Mt,!0);return k(this,Mt)}toString(){return k(this,Wn)!==void 0?k(this,Wn):this.type?fe(this,Wn,this.type+"("+k(this,ot).map(e=>String(e)).join("|")+")"):fe(this,Wn,k(this,ot).map(e=>String(e)).join(""))}push(...e){for(const t of e)if(t!==""){if(typeof t!="string"&&!(t instanceof Qt&&k(t,bt)===this))throw new Error("invalid part: "+t);k(this,ot).push(t)}}toJSON(){var t;const e=this.type===null?k(this,ot).slice().map(s=>typeof s=="string"?s:s.toJSON()):[this.type,...k(this,ot).map(s=>s.toJSON())];return this.isStart()&&!this.type&&e.unshift([]),this.isEnd()&&(this===k(this,At)||k(k(this,At),_n)&&((t=k(this,bt))==null?void 0:t.type)==="!")&&e.push({}),e}isStart(){var t;if(k(this,At)===this)return!0;if(!((t=k(this,bt))!=null&&t.isStart()))return!1;if(k(this,bn)===0)return!0;const e=k(this,bt);for(let s=0;s<k(this,bn);s++){const r=k(e,ot)[s];if(!(r instanceof Qt&&r.type==="!"))return!1}return!0}isEnd(){var t,s,r;if(k(this,At)===this||((t=k(this,bt))==null?void 0:t.type)==="!")return!0;if(!((s=k(this,bt))!=null&&s.isEnd()))return!1;if(!this.type)return(r=k(this,bt))==null?void 0:r.isEnd();const e=k(this,bt)?k(k(this,bt),ot).length:0;return k(this,bn)===e-1}copyIn(e){typeof e=="string"?this.push(e):this.push(e.clone(this))}clone(e){const t=new Qt(this.type,e);for(const s of k(this,ot))t.copyIn(s);return t}static fromGlob(e,t={}){var r;const s=new Qt(null,void 0,t);return it(r=Qt,Mn,Oa).call(r,e,s,0,t),s}toMMPattern(){if(this!==k(this,At))return k(this,At).toMMPattern();const e=this.toString(),[t,s,r,a]=this.toRegExpSource();if(!(r||k(this,Mt)||k(this,Us).nocase&&!k(this,Us).nocaseMagicOnly&&e.toUpperCase()!==e.toLowerCase()))return s;const l=(k(this,Us).nocase?"i":"")+(a?"u":"");return Object.assign(new RegExp(`^${t}$`,l),{_src:t,_glob:e})}get options(){return k(this,Us)}toRegExpSource(e){var c;const t=e??!!k(this,Us).dot;if(k(this,At)===this&&it(this,ir,Hc).call(this),!this.type){const u=this.isStart()&&this.isEnd(),d=k(this,ot).map(w=>{var D;const[m,g,_,x]=typeof w=="string"?it(D=Qt,Mn,Gc).call(D,w,k(this,Mt),u):w.toRegExpSource(e);return fe(this,Mt,k(this,Mt)||_),fe(this,Xs,k(this,Xs)||x),m}).join("");let f="";if(this.isStart()&&typeof k(this,ot)[0]=="string"&&!(k(this,ot).length===1&&hh.has(k(this,ot)[0]))){const m=dh,g=t&&m.has(d.charAt(0))||d.startsWith("\\.")&&m.has(d.charAt(2))||d.startsWith("\\.\\.")&&m.has(d.charAt(4)),_=!t&&!e&&m.has(d.charAt(0));f=g?uh:_?ka:""}let p="";return this.isEnd()&&k(k(this,At),_n)&&((c=k(this,bt))==null?void 0:c.type)==="!"&&(p="(?:$|\\/)"),[f+d+p,Wr(d),fe(this,Mt,!!k(this,Mt)),k(this,Xs)]}const s=this.type==="*"||this.type==="+",r=this.type==="!"?"(?:(?!(?:":"(?:";let a=it(this,ir,Ui).call(this,t);if(this.isStart()&&this.isEnd()&&!a&&this.type!=="!"){const u=this.toString();return fe(this,ot,[u]),this.type=null,fe(this,Mt,void 0),[u,Wr(this.toString()),!1,!1]}let i=!s||e||t||!ka?"":it(this,ir,Ui).call(this,!0);i===a&&(i=""),i&&(a=`(?:${a})(?:${i})*?`);let l="";if(this.type==="!"&&k(this,oa))l=(this.isStart()&&!t?ka:"")+ll;else{const u=this.type==="!"?"))"+(this.isStart()&&!t&&!e?ka:"")+ol+")":this.type==="@"?")":this.type==="?"?")?":this.type==="+"&&i?")":this.type==="*"&&i?")?":`)${this.type}`;l=r+a+u}return[l,Wr(a),fe(this,Mt,!!k(this,Mt)),k(this,Xs)]}};At=new WeakMap,Mt=new WeakMap,Xs=new WeakMap,ot=new WeakMap,bt=new WeakMap,bn=new WeakMap,jn=new WeakMap,_n=new WeakMap,Us=new WeakMap,Wn=new WeakMap,oa=new WeakMap,ir=new WeakSet,Hc=function(){if(this!==k(this,At))throw new Error("should only call on root");if(k(this,_n))return this;this.toString(),fe(this,_n,!0);let e;for(;e=k(this,jn).pop();){if(e.type!=="!")continue;let t=e,s=k(t,bt);for(;s;){for(let r=k(t,bn)+1;!s.type&&r<k(s,ot).length;r++)for(const a of k(e,ot)){if(typeof a=="string")throw new Error("string part in extglob AST??");a.copyIn(k(s,ot)[r])}t=s,s=k(t,bt)}}return this},Mn=new WeakSet,Oa=function(e,t,s,r){var y,w;let a=!1,i=!1,l=-1,c=!1;if(t.type===null){let m=s,g="";for(;m<e.length;){const _=e.charAt(m++);if(a||_==="\\"){a=!a,g+=_;continue}if(i){m===l+1?(_==="^"||_==="!")&&(c=!0):_==="]"&&!(m===l+2&&c)&&(i=!1),g+=_;continue}else if(_==="["){i=!0,l=m,c=!1,g+=_;continue}if(!r.noext&&il(_)&&e.charAt(m)==="("){t.push(g),g="";const x=new Qt(_,t);m=it(y=Qt,Mn,Oa).call(y,e,x,m,r),t.push(x);continue}g+=_}return t.push(g),m}let u=s+1,d=new Qt(null,t);const f=[];let p="";for(;u<e.length;){const m=e.charAt(u++);if(a||m==="\\"){a=!a,p+=m;continue}if(i){u===l+1?(m==="^"||m==="!")&&(c=!0):m==="]"&&!(u===l+2&&c)&&(i=!1),p+=m;continue}else if(m==="["){i=!0,l=u,c=!1,p+=m;continue}if(il(m)&&e.charAt(u)==="("){d.push(p),p="";const g=new Qt(m,d);d.push(g),u=it(w=Qt,Mn,Oa).call(w,e,g,u,r);continue}if(m==="|"){d.push(p),p="",f.push(d),d=new Qt(null,t);continue}if(m===")")return p===""&&k(t,ot).length===0&&fe(t,oa,!0),d.push(p),p="",t.push(...f,d),u;p+=m}return t.type=null,fe(t,Mt,void 0),fe(t,ot,[e.substring(s-1)]),u},Ui=function(e){return k(this,ot).map(t=>{if(typeof t=="string")throw new Error("string type in extglob ast??");const[s,r,a,i]=t.toRegExpSource(e);return fe(this,Xs,k(this,Xs)||i),s}).filter(t=>!(this.isStart()&&this.isEnd())||!!t).join("|")},Gc=function(e,t,s=!1){let r=!1,a="",i=!1;for(let l=0;l<e.length;l++){const c=e.charAt(l);if(r){r=!1,a+=(fh.has(c)?"\\":"")+c;continue}if(c==="\\"){l===e.length-1?a+="\\\\":r=!0;continue}if(c==="["){const[u,d,f,p]=lh(e,l);if(f){a+=u,i=i||d,l+=f-1,t=t||p;continue}}if(c==="*"){s&&e==="*"?a+=ll:a+=ol,t=!0;continue}if(c==="?"){a+=ko,t=!0;continue}a+=vh(c)}return[a,Wr(e),!!t,i]},Te(Qt,Mn);let Ba=Qt;const ph=(n,{windowsPathsNoEscape:e=!1}={})=>e?n.replace(/[?*()[\]]/g,"[$&]"):n.replace(/[?*()[\]\\]/g,"\\$&"),es=(n,e,t={})=>(Ua(e),!t.nocomment&&e.charAt(0)==="#"?!1:new Ar(e,t).match(n)),gh=/^\*+([^+@!?\*\[\(]*)$/,mh=n=>e=>!e.startsWith(".")&&e.endsWith(n),yh=n=>e=>e.endsWith(n),bh=n=>(n=n.toLowerCase(),e=>!e.startsWith(".")&&e.toLowerCase().endsWith(n)),_h=n=>(n=n.toLowerCase(),e=>e.toLowerCase().endsWith(n)),wh=/^\*+\.\*+$/,kh=n=>!n.startsWith(".")&&n.includes("."),Th=n=>n!=="."&&n!==".."&&n.includes("."),Sh=/^\.\*+$/,xh=n=>n!=="."&&n!==".."&&n.startsWith("."),Dh=/^\*+$/,Eh=n=>n.length!==0&&!n.startsWith("."),Ah=n=>n.length!==0&&n!=="."&&n!=="..",Ch=/^\?+([^+@!?\*\[\(]*)?$/,Ih=([n,e=""])=>{const t=Kc([n]);return e?(e=e.toLowerCase(),s=>t(s)&&s.toLowerCase().endsWith(e)):t},Mh=([n,e=""])=>{const t=Vc([n]);return e?(e=e.toLowerCase(),s=>t(s)&&s.toLowerCase().endsWith(e)):t},Oh=([n,e=""])=>{const t=Vc([n]);return e?s=>t(s)&&s.endsWith(e):t},Rh=([n,e=""])=>{const t=Kc([n]);return e?s=>t(s)&&s.endsWith(e):t},Kc=([n])=>{const e=n.length;return t=>t.length===e&&!t.startsWith(".")},Vc=([n])=>{const e=n.length;return t=>t.length===e&&t!=="."&&t!==".."},Qc=typeof process=="object"&&process?typeof process.env=="object"&&process.env&&process.env.__MINIMATCH_TESTING_PLATFORM__||process.platform:"posix",cl={win32:{sep:"\\"},posix:{sep:"/"}},Nh=Qc==="win32"?cl.win32.sep:cl.posix.sep;es.sep=Nh;const ys=Symbol("globstar **");es.GLOBSTAR=ys;const Ph="[^/]",Lh=Ph+"*?",Fh="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",qh="(?:(?!(?:\\/|^)\\.).)*?",Uh=(n,e={})=>t=>es(t,n,e);es.filter=Uh;const ms=(n,e={})=>Object.assign({},n,e),Bh=n=>{if(!n||typeof n!="object"||!Object.keys(n).length)return es;const e=es;return Object.assign((s,r,a={})=>e(s,r,ms(n,a)),{Minimatch:class extends e.Minimatch{constructor(r,a={}){super(r,ms(n,a))}static defaults(r){return e.defaults(ms(n,r)).Minimatch}},AST:class extends e.AST{constructor(r,a,i={}){super(r,a,ms(n,i))}static fromGlob(r,a={}){return e.AST.fromGlob(r,ms(n,a))}},unescape:(s,r={})=>e.unescape(s,ms(n,r)),escape:(s,r={})=>e.escape(s,ms(n,r)),filter:(s,r={})=>e.filter(s,ms(n,r)),defaults:s=>e.defaults(ms(n,s)),makeRe:(s,r={})=>e.makeRe(s,ms(n,r)),braceExpand:(s,r={})=>e.braceExpand(s,ms(n,r)),match:(s,r,a={})=>e.match(s,r,ms(n,a)),sep:e.sep,GLOBSTAR:ys})};es.defaults=Bh;const Xc=(n,e={})=>(Ua(n),e.nobrace||!/\{(?:(?!\{).)*\}/.test(n)?[n]:rh(n));es.braceExpand=Xc;const zh=(n,e={})=>new Ar(n,e).makeRe();es.makeRe=zh;const $h=(n,e,t={})=>{const s=new Ar(e,t);return n=n.filter(r=>s.match(r)),s.options.nonull&&!n.length&&n.push(e),n};es.match=$h;const ul=/[?*]|[+@!]\(.*?\)|\[|\]/,Yh=n=>n.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");class Ar{constructor(e,t={}){b(this,"options");b(this,"set");b(this,"pattern");b(this,"windowsPathsNoEscape");b(this,"nonegate");b(this,"negate");b(this,"comment");b(this,"empty");b(this,"preserveMultipleSlashes");b(this,"partial");b(this,"globSet");b(this,"globParts");b(this,"nocase");b(this,"isWindows");b(this,"platform");b(this,"windowsNoMagicRoot");b(this,"regexp");Ua(e),t=t||{},this.options=t,this.pattern=e,this.platform=t.platform||Qc,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!t.windowsPathsNoEscape||t.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!t.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!t.nonegate,this.comment=!1,this.empty=!1,this.partial=!!t.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=t.windowsNoMagicRoot!==void 0?t.windowsNoMagicRoot:!!(this.isWindows&&this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(const e of this.set)for(const t of e)if(typeof t!="string")return!0;return!1}debug(...e){}make(){const e=this.pattern,t=this.options;if(!t.nocomment&&e.charAt(0)==="#"){this.comment=!0;return}if(!e){this.empty=!0;return}this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],t.debug&&(this.debug=(...a)=>console.error(...a)),this.debug(this.pattern,this.globSet);const s=this.globSet.map(a=>this.slashSplit(a));this.globParts=this.preprocess(s),this.debug(this.pattern,this.globParts);let r=this.globParts.map((a,i,l)=>{if(this.isWindows&&this.windowsNoMagicRoot){const c=a[0]===""&&a[1]===""&&(a[2]==="?"||!ul.test(a[2]))&&!ul.test(a[3]),u=/^[a-z]:/i.test(a[0]);if(c)return[...a.slice(0,4),...a.slice(4).map(d=>this.parse(d))];if(u)return[a[0],...a.slice(1).map(d=>this.parse(d))]}return a.map(c=>this.parse(c))});if(this.debug(this.pattern,r),this.set=r.filter(a=>a.indexOf(!1)===-1),this.isWindows)for(let a=0;a<this.set.length;a++){const i=this.set[a];i[0]===""&&i[1]===""&&this.globParts[a][2]==="?"&&typeof i[3]=="string"&&/^[a-z]:$/i.test(i[3])&&(i[2]="?")}this.debug(this.pattern,this.set)}preprocess(e){if(this.options.noglobstar)for(let s=0;s<e.length;s++)for(let r=0;r<e[s].length;r++)e[s][r]==="**"&&(e[s][r]="*");const{optimizationLevel:t=1}=this.options;return t>=2?(e=this.firstPhasePreProcess(e),e=this.secondPhasePreProcess(e)):t>=1?e=this.levelOneOptimize(e):e=this.adjascentGlobstarOptimize(e),e}adjascentGlobstarOptimize(e){return e.map(t=>{let s=-1;for(;(s=t.indexOf("**",s+1))!==-1;){let r=s;for(;t[r+1]==="**";)r++;r!==s&&t.splice(s,r-s)}return t})}levelOneOptimize(e){return e.map(t=>(t=t.reduce((s,r)=>{const a=s[s.length-1];return r==="**"&&a==="**"?s:r===".."&&a&&a!==".."&&a!=="."&&a!=="**"?(s.pop(),s):(s.push(r),s)},[]),t.length===0?[""]:t))}levelTwoFileOptimize(e){Array.isArray(e)||(e=this.slashSplit(e));let t=!1;do{if(t=!1,!this.preserveMultipleSlashes){for(let r=1;r<e.length-1;r++){const a=e[r];r===1&&a===""&&e[0]===""||(a==="."||a==="")&&(t=!0,e.splice(r,1),r--)}e[0]==="."&&e.length===2&&(e[1]==="."||e[1]==="")&&(t=!0,e.pop())}let s=0;for(;(s=e.indexOf("..",s+1))!==-1;){const r=e[s-1];r&&r!=="."&&r!==".."&&r!=="**"&&(t=!0,e.splice(s-1,2),s-=2)}}while(t);return e.length===0?[""]:e}firstPhasePreProcess(e){let t=!1;do{t=!1;for(let s of e){let r=-1;for(;(r=s.indexOf("**",r+1))!==-1;){let i=r;for(;s[i+1]==="**";)i++;i>r&&s.splice(r+1,i-r);let l=s[r+1];const c=s[r+2],u=s[r+3];if(l!==".."||!c||c==="."||c===".."||!u||u==="."||u==="..")continue;t=!0,s.splice(r,1);const d=s.slice(0);d[r]="**",e.push(d),r--}if(!this.preserveMultipleSlashes){for(let i=1;i<s.length-1;i++){const l=s[i];i===1&&l===""&&s[0]===""||(l==="."||l==="")&&(t=!0,s.splice(i,1),i--)}s[0]==="."&&s.length===2&&(s[1]==="."||s[1]==="")&&(t=!0,s.pop())}let a=0;for(;(a=s.indexOf("..",a+1))!==-1;){const i=s[a-1];if(i&&i!=="."&&i!==".."&&i!=="**"){t=!0;const c=a===1&&s[a+1]==="**"?["."]:[];s.splice(a-1,2,...c),s.length===0&&s.push(""),a-=2}}}}while(t);return e}secondPhasePreProcess(e){for(let t=0;t<e.length-1;t++)for(let s=t+1;s<e.length;s++){const r=this.partsMatch(e[t],e[s],!this.preserveMultipleSlashes);if(r){e[t]=[],e[s]=r;break}}return e.filter(t=>t.length)}partsMatch(e,t,s=!1){let r=0,a=0,i=[],l="";for(;r<e.length&&a<t.length;)if(e[r]===t[a])i.push(l==="b"?t[a]:e[r]),r++,a++;else if(s&&e[r]==="**"&&t[a]===e[r+1])i.push(e[r]),r++;else if(s&&t[a]==="**"&&e[r]===t[a+1])i.push(t[a]),a++;else if(e[r]==="*"&&t[a]&&(this.options.dot||!t[a].startsWith("."))&&t[a]!=="**"){if(l==="b")return!1;l="a",i.push(e[r]),r++,a++}else if(t[a]==="*"&&e[r]&&(this.options.dot||!e[r].startsWith("."))&&e[r]!=="**"){if(l==="a")return!1;l="b",i.push(t[a]),r++,a++}else return!1;return e.length===t.length&&i}parseNegate(){if(this.nonegate)return;const e=this.pattern;let t=!1,s=0;for(let r=0;r<e.length&&e.charAt(r)==="!";r++)t=!t,s++;s&&(this.pattern=e.slice(s)),this.negate=t}matchOne(e,t,s=!1){const r=this.options;if(this.isWindows){const m=typeof e[0]=="string"&&/^[a-z]:$/i.test(e[0]),g=!m&&e[0]===""&&e[1]===""&&e[2]==="?"&&/^[a-z]:$/i.test(e[3]),_=typeof t[0]=="string"&&/^[a-z]:$/i.test(t[0]),x=!_&&t[0]===""&&t[1]===""&&t[2]==="?"&&typeof t[3]=="string"&&/^[a-z]:$/i.test(t[3]),D=g?3:m?0:void 0,E=x?3:_?0:void 0;if(typeof D=="number"&&typeof E=="number"){const[R,P]=[e[D],t[E]];R.toLowerCase()===P.toLowerCase()&&(t[E]=R,E>D?t=t.slice(E):D>E&&(e=e.slice(D)))}}const{optimizationLevel:a=1}=this.options;a>=2&&(e=this.levelTwoFileOptimize(e)),this.debug("matchOne",this,{file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var i=0,l=0,c=e.length,u=t.length;i<c&&l<u;i++,l++){this.debug("matchOne loop");var d=t[l],f=e[i];if(this.debug(t,d,f),d===!1)return!1;if(d===ys){this.debug("GLOBSTAR",[t,d,f]);var p=i,y=l+1;if(y===u){for(this.debug("** at the end");i<c;i++)if(e[i]==="."||e[i]===".."||!r.dot&&e[i].charAt(0)===".")return!1;return!0}for(;p<c;){var w=e[p];if(this.debug(`
globstar while`,e,p,t,y,w),this.matchOne(e.slice(p),t.slice(y),s))return this.debug("globstar found match!",p,c,w),!0;if(w==="."||w===".."||!r.dot&&w.charAt(0)==="."){this.debug("dot detected!",e,p,t,y);break}this.debug("globstar swallow a segment, and continue"),p++}return!!(s&&(this.debug(`
>>> no match, partial?`,e,p,t,y),p===c))}let m;if(typeof d=="string"?(m=f===d,this.debug("string match",d,f,m)):(m=d.test(f),this.debug("pattern match",d,f,m)),!m)return!1}if(i===c&&l===u)return!0;if(i===c)return s;if(l===u)return i===c-1&&e[i]==="";throw new Error("wtf?")}braceExpand(){return Xc(this.pattern,this.options)}parse(e){Ua(e);const t=this.options;if(e==="**")return ys;if(e==="")return"";let s,r=null;(s=e.match(Dh))?r=t.dot?Ah:Eh:(s=e.match(gh))?r=(t.nocase?t.dot?_h:bh:t.dot?yh:mh)(s[1]):(s=e.match(Ch))?r=(t.nocase?t.dot?Mh:Ih:t.dot?Oh:Rh)(s):(s=e.match(wh))?r=t.dot?Th:kh:(s=e.match(Sh))&&(r=xh);const a=Ba.fromGlob(e,this.options).toMMPattern();return r&&typeof a=="object"&&Reflect.defineProperty(a,"test",{value:r}),a}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;const e=this.set;if(!e.length)return this.regexp=!1,this.regexp;const t=this.options,s=t.noglobstar?Lh:t.dot?Fh:qh,r=new Set(t.nocase?["i"]:[]);let a=e.map(c=>{const u=c.map(d=>{if(d instanceof RegExp)for(const f of d.flags.split(""))r.add(f);return typeof d=="string"?Yh(d):d===ys?ys:d._src});return u.forEach((d,f)=>{const p=u[f+1],y=u[f-1];d!==ys||y===ys||(y===void 0?p!==void 0&&p!==ys?u[f+1]="(?:\\/|"+s+"\\/)?"+p:u[f]=s:p===void 0?u[f-1]=y+"(?:\\/|"+s+")?":p!==ys&&(u[f-1]=y+"(?:\\/|\\/"+s+"\\/)"+p,u[f+1]=ys))}),u.filter(d=>d!==ys).join("/")}).join("|");const[i,l]=e.length>1?["(?:",")"]:["",""];a="^"+i+a+l+"$",this.negate&&(a="^(?!"+a+").+$");try{this.regexp=new RegExp(a,[...r].join(""))}catch{this.regexp=!1}return this.regexp}slashSplit(e){return this.preserveMultipleSlashes?e.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(e)?["",...e.split(/\/+/)]:e.split(/\/+/)}match(e,t=this.partial){if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&t)return!0;const s=this.options;this.isWindows&&(e=e.split("\\").join("/"));const r=this.slashSplit(e);this.debug(this.pattern,"split",r);const a=this.set;this.debug(this.pattern,"set",a);let i=r[r.length-1];if(!i)for(let l=r.length-2;!i&&l>=0;l--)i=r[l];for(let l=0;l<a.length;l++){const c=a[l];let u=r;if(s.matchBase&&c.length===1&&(u=[i]),this.matchOne(u,c,t))return s.flipNegate?!0:!this.negate}return s.flipNegate?!1:this.negate}static defaults(e){return es.defaults(e).Minimatch}}es.AST=Ba;es.Minimatch=Ar;es.escape=ph;es.unescape=Wr;function jh(n){const e=[];if((!n.name||n.name.trim().length===0)&&e.push("name: Profile name cannot be empty"),(!n.regexTargets||n.regexTargets.length===0)&&e.push("regexTargets: Must include at least one target"),n.includeRegex)try{new RegExp(n.includeRegex)}catch(t){e.push(`includeRegex: ${t instanceof Error?t.message:String(t)}`)}if(n.excludeRegex)try{new RegExp(n.excludeRegex)}catch(t){e.push(`excludeRegex: ${t instanceof Error?t.message:String(t)}`)}return[...n.includeTags,...n.excludeTags].forEach(t=>{t.startsWith("#")||e.push(`Invalid tag "${t}" - must start with #`)}),{valid:e.length===0,errors:e}}const Wh={id:"default",name:"Default",description:"Include all tasks",includePaths:[],excludePaths:[],includeTags:[],excludeTags:[],includeRegex:void 0,excludeRegex:void 0,regexTargets:["taskText"],excludeStatusTypes:[]},ta={enabled:!1,mode:"all",activeProfileId:"default",profiles:[Wh]};class Hh{constructor(e){b(this,"includePathMatchers",[]);b(this,"excludePathMatchers",[]);b(this,"includeTagsSet",new Set);b(this,"excludeTagsSet",new Set);b(this,"includeRegex");b(this,"excludeRegex");b(this,"regexTargets");if(this.includePathMatchers=e.includePaths.map(t=>new Ar(this.normalizePath(t),{dot:!0,matchBase:!0})),this.excludePathMatchers=e.excludePaths.map(t=>new Ar(this.normalizePath(t),{dot:!0,matchBase:!0})),this.includeTagsSet=new Set(e.includeTags.map(t=>this.normalizeTag(t))),this.excludeTagsSet=new Set(e.excludeTags.map(t=>this.normalizeTag(t))),e.includeRegex)try{this.includeRegex=new RegExp(e.includeRegex)}catch{}if(e.excludeRegex)try{this.excludeRegex=new RegExp(e.excludeRegex)}catch{}this.regexTargets=new Set(e.regexTargets)}matches(e){return this.explain(e).included}explain(e){const t=this.buildContext(e);if(this.excludePathMatchers.length>0&&t.path){for(const s of this.excludePathMatchers)if(s.match(t.path))return{included:!1,reason:"Excluded by path pattern",matchedRule:{type:"excludePath",pattern:s.pattern}}}if(this.includePathMatchers.length>0){if(!t.path)return{included:!1,reason:"includePaths set but task has no path metadata"};let s=!1;for(const r of this.includePathMatchers)if(r.match(t.path)){s=!0;break}if(!s)return{included:!1,reason:"Did not match any includePath pattern"}}if(this.excludeTagsSet.size>0&&t.tags.length>0){for(const s of t.tags)if(this.excludeTagsSet.has(s))return{included:!1,reason:"Excluded by tag",matchedRule:{type:"excludeTag",pattern:s}}}if(this.includeTagsSet.size>0){if(t.tags.length===0)return{included:!1,reason:"includeTags set but task has no tags"};let s=!1;for(const r of t.tags)if(this.includeTagsSet.has(r)){s=!0;break}if(!s)return{included:!1,reason:"Did not match any includeTag"}}if(this.excludeRegex){const s=this.extractRegexTargets(e,t);for(const[r,a]of s)if(this.excludeRegex.test(a))return{included:!1,reason:"Excluded by regex",matchedRule:{type:"excludeRegex",pattern:this.excludeRegex.source,target:r}}}if(this.includeRegex){const s=this.extractRegexTargets(e,t);let r=!1;for(const[,a]of s)if(this.includeRegex.test(a)){r=!0;break}if(!r)return{included:!1,reason:"Did not match includeRegex",matchedRule:{type:"includeRegex",pattern:this.includeRegex.source}}}return{included:!0,reason:"Passed all filters"}}buildContext(e){return{path:e.path?this.normalizePath(e.path):void 0,fileName:e.path?this.extractFileName(e.path):void 0,tags:(e.tags||[]).map(t=>this.normalizeTag(t)),taskText:e.name||""}}extractRegexTargets(e,t){const s=[];return this.regexTargets.has("taskText")&&s.push(["taskText",t.taskText]),this.regexTargets.has("path")&&t.path&&s.push(["path",t.path]),this.regexTargets.has("fileName")&&t.fileName&&s.push(["fileName",t.fileName]),s}normalizePath(e){return e.replace(/\\/g,"/").replace(/^\/+/,"")}normalizeTag(e){return e.startsWith("#")?e.toLowerCase():`#${e}`.toLowerCase()}extractFileName(e){return e.split("/").pop()||""}}const qn=class qn{constructor(){b(this,"config");b(this,"compiled",null);this.config=ta}static getInstance(){return qn.instance||(qn.instance=new qn),qn.instance}initialize(e){this.updateConfig(e)}updateConfig(e){this.config=e,this.compile()}compile(){if(!this.config.enabled){this.compiled=null;return}const e=this.config.profiles.find(t=>t.id===this.config.activeProfileId)||this.config.profiles[0];if(!e){this.compiled=null;return}this.compiled=new Hh(e)}shouldTreatAsTask(e,t){if(!this.compiled)return!0;const s=this.extractTagsFromContent(e),r={name:e,path:t,tags:s};return this.compiled.matches(r)}shouldIncludeTask(e){return this.compiled?this.compiled.matches(e):!0}explainTask(e){return this.compiled?this.compiled.explain(e):{included:!0,reason:"Global filter disabled"}}extractTagsFromContent(e){return e.match(/#[\w\/-]+/g)||[]}getConfig(){return this.config}getActiveProfile(){return this.config.profiles.find(e=>e.id===this.config.activeProfileId)}setActiveProfile(e){this.config.profiles.some(t=>t.id===e)&&(this.config.activeProfileId=e,this.compile())}reset(){this.updateConfig(ta)}};b(qn,"instance");let fs=qn;const Bi=!1;var To=Array.isArray,Gh=Array.prototype.indexOf,si=Array.from,Kh=Object.defineProperty,wr=Object.getOwnPropertyDescriptor,Zc=Object.getOwnPropertyDescriptors,Vh=Object.prototype,Qh=Array.prototype,So=Object.getPrototypeOf,dl=Object.isExtensible;function Xh(n){for(var e=0;e<n.length;e++)n[e]()}function Jc(){var n,e,t=new Promise((s,r)=>{n=s,e=r});return{promise:t,resolve:n,reject:e}}function eu(n,e){if(Array.isArray(n))return n;if(!(Symbol.iterator in n))return Array.from(n);const t=[];for(const s of n)if(t.push(s),t.length===e)break;return t}const zt=2,za=4,ni=8,tu=1<<24,on=16,ln=32,or=64,xo=128,Ds=512,Ht=1024,ts=2048,cn=4096,ps=8192,tn=16384,Do=32768,Cr=65536,hl=1<<17,su=1<<18,Lr=1<<19,Zh=1<<20,Js=1<<25,nr=32768,zi=1<<21,Eo=1<<22,En=1<<23,sn=Symbol("$state"),Jh=Symbol("legacy props"),ef=Symbol(""),br=new class extends Error{constructor(){super(...arguments);b(this,"name","StaleReactionError");b(this,"message","The reaction that called `getAbortSignal()` was re-run or destroyed")}};function Ao(n){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function tf(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function sf(n){throw new Error("https://svelte.dev/e/effect_in_teardown")}function nf(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function rf(n){throw new Error("https://svelte.dev/e/effect_orphan")}function af(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function of(n){throw new Error("https://svelte.dev/e/props_invalid_value")}function lf(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function cf(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function uf(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function df(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const hf=1,ff=2,nu=4,vf=8,pf=16,gf=1,mf=4,yf=8,bf=16,_f=1,wf=2,qt=Symbol(),kf="http://www.w3.org/1999/xhtml";function Tf(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function Sf(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function ru(n){return n===this.v}function au(n,e){return n!=n?e==e:n!==e||n!==null&&typeof n=="object"||typeof n=="function"}function iu(n){return!au(n,this.v)}let xf=!1,Ct=null;function Ir(n){Ct=n}function ou(n){return cu().get(n)}function Df(n,e){return cu().set(n,e),e}function ht(n,e=!1,t){Ct={p:Ct,i:!1,c:null,e:null,s:n,x:null,l:null}}function ft(n){var e=Ct,t=e.e;if(t!==null){e.e=null;for(var s of t)Au(s)}return e.i=!0,Ct=e.p,{}}function lu(){return!0}function cu(n){return Ct===null&&Ao(),Ct.c??(Ct.c=new Map(Ef(Ct)||void 0))}function Ef(n){let e=n.p;for(;e!==null;){const t=e.c;if(t!==null)return t;e=e.p}return null}let zn=[];function uu(){var n=zn;zn=[],Xh(n)}function Fr(n){if(zn.length===0&&!Qr){var e=zn;queueMicrotask(()=>{e===zn&&uu()})}zn.push(n)}function Af(){for(;zn.length>0;)uu()}function du(n){var e=Qe;if(e===null)return qe.f|=En,n;if(e.f&Do)Mr(n,e);else{if(!(e.f&xo))throw n;e.b.error(n)}}function Mr(n,e){for(;e!==null;){if(e.f&xo)try{e.b.error(n);return}catch(t){n=t}e=e.parent}throw n}const Cf=-7169;function Nt(n,e){n.f=n.f&Cf|e}function Co(n){n.f&Ds||n.deps===null?Nt(n,Ht):Nt(n,cn)}function hu(n){if(n!==null)for(const e of n)!(e.f&zt)||!(e.f&nr)||(e.f^=nr,hu(e.deps))}function fu(n,e,t){n.f&ts?e.add(n):n.f&cn&&t.add(n),hu(n.deps),Nt(n,Ht)}const Ta=new Set;let Fe=null,Vr=null,Ut=null,Ts=[],ri=null,$i=!1,Qr=!1;var kr,Tr,Hn,Gn,la,Sr,xr,Es,Yi,ji,vu,pu;const Ja=class Ja{constructor(){Te(this,Es);b(this,"committed",!1);b(this,"current",new Map);b(this,"previous",new Map);Te(this,kr,new Set);Te(this,Tr,new Set);Te(this,Hn,0);Te(this,Gn,0);Te(this,la,null);Te(this,Sr,new Set);Te(this,xr,new Set);b(this,"skipped_effects",new Set);b(this,"is_fork",!1)}is_deferred(){return this.is_fork||k(this,Gn)>0}process(e){var r;Ts=[],Vr=null,this.apply();var t=[],s=[];for(const a of e)it(this,Es,Yi).call(this,a,t,s);this.is_fork||it(this,Es,vu).call(this),this.is_deferred()?(it(this,Es,ji).call(this,s),it(this,Es,ji).call(this,t)):(Vr=this,Fe=null,fl(s),fl(t),Vr=null,(r=k(this,la))==null||r.resolve()),Ut=null}capture(e,t){t!==qt&&!this.previous.has(e)&&this.previous.set(e,t),e.f&En||(this.current.set(e,e.v),Ut==null||Ut.set(e,e.v))}activate(){Fe=this,this.apply()}deactivate(){Fe===this&&(Fe=null,Ut=null)}flush(){if(this.activate(),Ts.length>0){if(gu(),Fe!==null&&Fe!==this)return}else k(this,Hn)===0&&this.process([]);this.deactivate()}discard(){for(const e of k(this,Tr))e(this);k(this,Tr).clear()}increment(e){fe(this,Hn,k(this,Hn)+1),e&&fe(this,Gn,k(this,Gn)+1)}decrement(e){fe(this,Hn,k(this,Hn)-1),e&&fe(this,Gn,k(this,Gn)-1),this.revive()}revive(){for(const e of k(this,Sr))k(this,xr).delete(e),Nt(e,ts),rn(e);for(const e of k(this,xr))Nt(e,cn),rn(e);this.flush()}oncommit(e){k(this,kr).add(e)}ondiscard(e){k(this,Tr).add(e)}settled(){return(k(this,la)??fe(this,la,Jc())).promise}static ensure(){if(Fe===null){const e=Fe=new Ja;Ta.add(Fe),Qr||Ja.enqueue(()=>{Fe===e&&e.flush()})}return Fe}static enqueue(e){Fr(e)}apply(){}};kr=new WeakMap,Tr=new WeakMap,Hn=new WeakMap,Gn=new WeakMap,la=new WeakMap,Sr=new WeakMap,xr=new WeakMap,Es=new WeakSet,Yi=function(e,t,s){e.f^=Ht;for(var r=e.first,a=null;r!==null;){var i=r.f,l=(i&(ln|or))!==0,c=l&&(i&Ht)!==0,u=c||(i&ps)!==0||this.skipped_effects.has(r);if(!u&&r.fn!==null){l?r.f^=Ht:a!==null&&i&(za|ni|tu)?a.b.defer_effect(r):i&za?t.push(r):fa(r)&&(i&on&&k(this,Sr).add(r),na(r));var d=r.first;if(d!==null){r=d;continue}}var f=r.parent;for(r=r.next;r===null&&f!==null;)f===a&&(a=null),r=f.next,f=f.parent}},ji=function(e){for(var t=0;t<e.length;t+=1)fu(e[t],k(this,Sr),k(this,xr))},vu=function(){if(k(this,Gn)===0){for(const e of k(this,kr))e();k(this,kr).clear()}k(this,Hn)===0&&it(this,Es,pu).call(this)},pu=function(){var r;if(Ta.size>1){this.previous.clear();var e=Ut,t=!0;for(const a of Ta){if(a===this){t=!1;continue}const i=[];for(const[c,u]of this.current){if(a.current.has(c))if(t&&u!==a.current.get(c))a.current.set(c,u);else continue;i.push(c)}if(i.length===0)continue;const l=[...a.current.keys()].filter(c=>!this.current.has(c));if(l.length>0){var s=Ts;Ts=[];const c=new Set,u=new Map;for(const d of i)mu(d,l,c,u);if(Ts.length>0){Fe=a,a.apply();for(const d of Ts)it(r=a,Es,Yi).call(r,d,[],[]);a.deactivate()}Ts=s}}Fe=null,Ut=e}this.committed=!0,Ta.delete(this)};let en=Ja;function If(n){var e=Qr;Qr=!0;try{for(var t;;){if(Af(),Ts.length===0&&(Fe==null||Fe.flush(),Ts.length===0))return ri=null,t;gu()}}finally{Qr=e}}function gu(){var n=Jn;$i=!0;var e=null;try{var t=0;for(Ya(!0);Ts.length>0;){var s=en.ensure();if(t++>1e3){var r,a;Mf()}s.process(Ts),An.clear()}}finally{$i=!1,Ya(n),ri=null}}function Mf(){try{af()}catch(n){Mr(n,ri)}}let Is=null;function fl(n){var e=n.length;if(e!==0){for(var t=0;t<e;){var s=n[t++];if(!(s.f&(tn|ps))&&fa(s)&&(Is=new Set,na(s),s.deps===null&&s.first===null&&s.nodes===null&&(s.teardown===null&&s.ac===null?Ou(s):s.fn=null),(Is==null?void 0:Is.size)>0)){An.clear();for(const r of Is){if(r.f&(tn|ps))continue;const a=[r];let i=r.parent;for(;i!==null;)Is.has(i)&&(Is.delete(i),a.push(i)),i=i.parent;for(let l=a.length-1;l>=0;l--){const c=a[l];c.f&(tn|ps)||na(c)}}Is.clear()}}Is=null}}function mu(n,e,t,s){if(!t.has(n)&&(t.add(n),n.reactions!==null))for(const r of n.reactions){const a=r.f;a&zt?mu(r,e,t,s):a&(Eo|on)&&!(a&ts)&&yu(r,e,s)&&(Nt(r,ts),rn(r))}}function yu(n,e,t){const s=t.get(n);if(s!==void 0)return s;if(n.deps!==null)for(const r of n.deps){if(e.includes(r))return!0;if(r.f&zt&&yu(r,e,t))return t.set(r,!0),!0}return t.set(n,!1),!1}function rn(n){for(var e=ri=n;e.parent!==null;){e=e.parent;var t=e.f;if($i&&e===Qe&&t&on&&!(t&su))return;if(t&(or|ln)){if(!(t&Ht))return;e.f^=Ht}}Ts.push(e)}function Of(n){let e=0,t=rr(0),s;return()=>{Oo()&&(o(t),ha(()=>(e===0&&(s=Rn(()=>n(()=>Xr(t)))),e+=1,()=>{Fr(()=>{e-=1,e===0&&(s==null||s(),s=void 0,Xr(t))})})))}}var Rf=Cr|Lr|xo;function Nf(n,e,t){new Pf(n,e,t)}var ws,bo,Bs,Kn,zs,ks,as,$s,Zs,wn,Vn,kn,Qn,Dr,Er,Tn,ei,Rt,Lf,Ff,Wi,Ra,Na,Hi;class Pf{constructor(e,t,s){Te(this,Rt);b(this,"parent");b(this,"is_pending",!1);Te(this,ws);Te(this,bo,null);Te(this,Bs);Te(this,Kn);Te(this,zs);Te(this,ks,null);Te(this,as,null);Te(this,$s,null);Te(this,Zs,null);Te(this,wn,null);Te(this,Vn,0);Te(this,kn,0);Te(this,Qn,!1);Te(this,Dr,new Set);Te(this,Er,new Set);Te(this,Tn,null);Te(this,ei,Of(()=>(fe(this,Tn,rr(k(this,Vn))),()=>{fe(this,Tn,null)})));fe(this,ws,e),fe(this,Bs,t),fe(this,Kn,s),this.parent=Qe.b,this.is_pending=!!k(this,Bs).pending,fe(this,zs,Po(()=>{Qe.b=this;{var r=it(this,Rt,Wi).call(this);try{fe(this,ks,Ss(()=>s(r)))}catch(a){this.error(a)}k(this,kn)>0?it(this,Rt,Na).call(this):this.is_pending=!1}return()=>{var a;(a=k(this,wn))==null||a.remove()}},Rf))}defer_effect(e){fu(e,k(this,Dr),k(this,Er))}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!k(this,Bs).pending}update_pending_count(e){it(this,Rt,Hi).call(this,e),fe(this,Vn,k(this,Vn)+e),k(this,Tn)&&Or(k(this,Tn),k(this,Vn))}get_effect_pending(){return k(this,ei).call(this),o(k(this,Tn))}error(e){var t=k(this,Bs).onerror;let s=k(this,Bs).failed;if(k(this,Qn)||!t&&!s)throw e;k(this,ks)&&(cs(k(this,ks)),fe(this,ks,null)),k(this,as)&&(cs(k(this,as)),fe(this,as,null)),k(this,$s)&&(cs(k(this,$s)),fe(this,$s,null));var r=!1,a=!1;const i=()=>{if(r){Sf();return}r=!0,a&&df(),en.ensure(),fe(this,Vn,0),k(this,$s)!==null&&Zn(k(this,$s),()=>{fe(this,$s,null)}),this.is_pending=this.has_pending_snippet(),fe(this,ks,it(this,Rt,Ra).call(this,()=>(fe(this,Qn,!1),Ss(()=>k(this,Kn).call(this,k(this,ws)))))),k(this,kn)>0?it(this,Rt,Na).call(this):this.is_pending=!1};var l=qe;try{ls(null),a=!0,t==null||t(e,i),a=!1}catch(c){Mr(c,k(this,zs)&&k(this,zs).parent)}finally{ls(l)}s&&Fr(()=>{fe(this,$s,it(this,Rt,Ra).call(this,()=>{en.ensure(),fe(this,Qn,!0);try{return Ss(()=>{s(k(this,ws),()=>e,()=>i)})}catch(c){return Mr(c,k(this,zs).parent),null}finally{fe(this,Qn,!1)}}))})}}ws=new WeakMap,bo=new WeakMap,Bs=new WeakMap,Kn=new WeakMap,zs=new WeakMap,ks=new WeakMap,as=new WeakMap,$s=new WeakMap,Zs=new WeakMap,wn=new WeakMap,Vn=new WeakMap,kn=new WeakMap,Qn=new WeakMap,Dr=new WeakMap,Er=new WeakMap,Tn=new WeakMap,ei=new WeakMap,Rt=new WeakSet,Lf=function(){try{fe(this,ks,Ss(()=>k(this,Kn).call(this,k(this,ws))))}catch(e){this.error(e)}},Ff=function(){const e=k(this,Bs).pending;e&&(fe(this,as,Ss(()=>e(k(this,ws)))),en.enqueue(()=>{var t=it(this,Rt,Wi).call(this);fe(this,ks,it(this,Rt,Ra).call(this,()=>(en.ensure(),Ss(()=>k(this,Kn).call(this,t))))),k(this,kn)>0?it(this,Rt,Na).call(this):(Zn(k(this,as),()=>{fe(this,as,null)}),this.is_pending=!1)}))},Wi=function(){var e=k(this,ws);return this.is_pending&&(fe(this,wn,nn()),k(this,ws).before(k(this,wn)),e=k(this,wn)),e},Ra=function(e){var t=Qe,s=qe,r=Ct;Ws(k(this,zs)),ls(k(this,zs)),Ir(k(this,zs).ctx);try{return e()}catch(a){return du(a),null}finally{Ws(t),ls(s),Ir(r)}},Na=function(){const e=k(this,Bs).pending;k(this,ks)!==null&&(fe(this,Zs,document.createDocumentFragment()),k(this,Zs).append(k(this,wn)),Pu(k(this,ks),k(this,Zs))),k(this,as)===null&&fe(this,as,Ss(()=>e(k(this,ws))))},Hi=function(e){var t;if(!this.has_pending_snippet()){this.parent&&it(t=this.parent,Rt,Hi).call(t,e);return}if(fe(this,kn,k(this,kn)+e),k(this,kn)===0){this.is_pending=!1;for(const s of k(this,Dr))Nt(s,ts),rn(s);for(const s of k(this,Er))Nt(s,cn),rn(s);k(this,Dr).clear(),k(this,Er).clear(),k(this,as)&&Zn(k(this,as),()=>{fe(this,as,null)}),k(this,Zs)&&(k(this,ws).before(k(this,Zs)),fe(this,Zs,null))}};function qf(n,e,t,s){const r=ai;if(t.length===0&&n.length===0){s(e.map(r));return}var a=Fe,i=Qe,l=Uf();function c(){Promise.all(t.map(u=>Bf(u))).then(u=>{l();try{s([...e.map(r),...u])}catch(d){i.f&tn||Mr(d,i)}a==null||a.deactivate(),$a()}).catch(u=>{Mr(u,i)})}n.length>0?Promise.all(n).then(()=>{l();try{return c()}finally{a==null||a.deactivate(),$a()}}):c()}function Uf(){var n=Qe,e=qe,t=Ct,s=Fe;return function(a=!0){Ws(n),ls(e),Ir(t),a&&(s==null||s.activate())}}function $a(){Ws(null),ls(null),Ir(null)}function ai(n){var e=zt|ts,t=qe!==null&&qe.f&zt?qe:null;return Qe!==null&&(Qe.f|=Lr),{ctx:Ct,deps:null,effects:null,equals:ru,f:e,fn:n,reactions:null,rv:0,v:qt,wv:0,parent:t??Qe,ac:null}}function Bf(n,e,t){let s=Qe;s===null&&tf();var r=s.b,a=void 0,i=rr(qt),l=!qe,c=new Map;return Xf(()=>{var y;var u=Jc();a=u.promise;try{Promise.resolve(n()).then(u.resolve,u.reject).then(()=>{d===Fe&&d.committed&&d.deactivate(),$a()})}catch(w){u.reject(w),$a()}var d=Fe;if(l){var f=r.is_rendered();r.update_pending_count(1),d.increment(f),(y=c.get(d))==null||y.reject(br),c.delete(d),c.set(d,u)}const p=(w,m=void 0)=>{if(d.activate(),m)m!==br&&(i.f|=En,Or(i,m));else{i.f&En&&(i.f^=En),Or(i,w);for(const[g,_]of c){if(c.delete(g),g===d)break;_.reject(br)}}l&&(r.update_pending_count(-1),d.decrement(f))};u.promise.then(p,w=>p(null,w||"unknown"))}),Ro(()=>{for(const u of c.values())u.reject(br)}),new Promise(u=>{function d(f){function p(){f===a?u(i):d(a)}f.then(p,p)}d(a)})}function J(n){const e=ai(n);return Lu(e),e}function bu(n){const e=ai(n);return e.equals=iu,e}function _u(n){var e=n.effects;if(e!==null){n.effects=null;for(var t=0;t<e.length;t+=1)cs(e[t])}}function zf(n){for(var e=n.parent;e!==null;){if(!(e.f&zt))return e.f&tn?null:e;e=e.parent}return null}function Io(n){var e,t=Qe;Ws(zf(n));try{n.f&=~nr,_u(n),e=Bu(n)}finally{Ws(t)}return e}function wu(n){var e=Io(n);if(!n.equals(e)&&(n.wv=qu(),(!(Fe!=null&&Fe.is_fork)||n.deps===null)&&(n.v=e,n.deps===null))){Nt(n,Ht);return}On||(Ut!==null?(Oo()||Fe!=null&&Fe.is_fork)&&Ut.set(n,e):Co(n))}let Gi=new Set;const An=new Map;let ku=!1;function rr(n,e){var t={f:0,v:n,reactions:null,equals:ru,rv:0,wv:0};return t}function V(n,e){const t=rr(n);return Lu(t),t}function $f(n,e=!1,t=!0){const s=rr(n);return e||(s.equals=iu),s}function T(n,e,t=!1){qe!==null&&(!Rs||qe.f&hl)&&lu()&&qe.f&(zt|on|Eo|hl)&&!(Jt!=null&&Jt.includes(n))&&uf();let s=t?De(e):e;return Or(n,s)}function Or(n,e){if(!n.equals(e)){var t=n.v;On?An.set(n,e):An.set(n,t),n.v=e;var s=en.ensure();if(s.capture(n,t),n.f&zt){const r=n;n.f&ts&&Io(r),Co(r)}n.wv=qu(),Tu(n,ts),Qe!==null&&Qe.f&Ht&&!(Qe.f&(ln|or))&&(_s===null?Jf([n]):_s.push(n)),!s.is_fork&&Gi.size>0&&!ku&&Yf()}return e}function Yf(){ku=!1;var n=Jn;Ya(!0);const e=Array.from(Gi);try{for(const t of e)t.f&Ht&&Nt(t,cn),fa(t)&&na(t)}finally{Ya(n)}Gi.clear()}function vl(n,e=1){var t=o(n),s=e===1?t++:t--;return T(n,t),s}function Xr(n){T(n,n.v+1)}function Tu(n,e){var t=n.reactions;if(t!==null)for(var s=t.length,r=0;r<s;r++){var a=t[r],i=a.f,l=(i&ts)===0;if(l&&Nt(a,e),i&zt){var c=a;Ut==null||Ut.delete(c),i&nr||(i&Ds&&(a.f|=nr),Tu(c,cn))}else l&&(i&on&&Is!==null&&Is.add(a),rn(a))}}function De(n){if(typeof n!="object"||n===null||sn in n)return n;const e=So(n);if(e!==Vh&&e!==Qh)return n;var t=new Map,s=To(n),r=V(0),a=er,i=l=>{if(er===a)return l();var c=qe,u=er;ls(null),bl(a);var d=l();return ls(c),bl(u),d};return s&&t.set("length",V(n.length)),new Proxy(n,{defineProperty(l,c,u){(!("value"in u)||u.configurable===!1||u.enumerable===!1||u.writable===!1)&&lf();var d=t.get(c);return d===void 0?d=i(()=>{var f=V(u.value);return t.set(c,f),f}):T(d,u.value,!0),!0},deleteProperty(l,c){var u=t.get(c);if(u===void 0){if(c in l){const d=i(()=>V(qt));t.set(c,d),Xr(r)}}else T(u,qt),Xr(r);return!0},get(l,c,u){var y;if(c===sn)return n;var d=t.get(c),f=c in l;if(d===void 0&&(!f||(y=wr(l,c))!=null&&y.writable)&&(d=i(()=>{var w=De(f?l[c]:qt),m=V(w);return m}),t.set(c,d)),d!==void 0){var p=o(d);return p===qt?void 0:p}return Reflect.get(l,c,u)},getOwnPropertyDescriptor(l,c){var u=Reflect.getOwnPropertyDescriptor(l,c);if(u&&"value"in u){var d=t.get(c);d&&(u.value=o(d))}else if(u===void 0){var f=t.get(c),p=f==null?void 0:f.v;if(f!==void 0&&p!==qt)return{enumerable:!0,configurable:!0,value:p,writable:!0}}return u},has(l,c){var p;if(c===sn)return!0;var u=t.get(c),d=u!==void 0&&u.v!==qt||Reflect.has(l,c);if(u!==void 0||Qe!==null&&(!d||(p=wr(l,c))!=null&&p.writable)){u===void 0&&(u=i(()=>{var y=d?De(l[c]):qt,w=V(y);return w}),t.set(c,u));var f=o(u);if(f===qt)return!1}return d},set(l,c,u,d){var D;var f=t.get(c),p=c in l;if(s&&c==="length")for(var y=u;y<f.v;y+=1){var w=t.get(y+"");w!==void 0?T(w,qt):y in l&&(w=i(()=>V(qt)),t.set(y+"",w))}if(f===void 0)(!p||(D=wr(l,c))!=null&&D.writable)&&(f=i(()=>V(void 0)),T(f,De(u)),t.set(c,f));else{p=f.v!==qt;var m=i(()=>De(u));T(f,m)}var g=Reflect.getOwnPropertyDescriptor(l,c);if(g!=null&&g.set&&g.set.call(d,u),!p){if(s&&typeof c=="string"){var _=t.get("length"),x=Number(c);Number.isInteger(x)&&x>=_.v&&T(_,x+1)}Xr(r)}return!0},ownKeys(l){o(r);var c=Reflect.ownKeys(l).filter(f=>{var p=t.get(f);return p===void 0||p.v!==qt});for(var[u,d]of t)d.v!==qt&&!(u in l)&&c.push(u);return c},setPrototypeOf(){cf()}})}function pl(n){try{if(n!==null&&typeof n=="object"&&sn in n)return n[sn]}catch{}return n}function jf(n,e){return Object.is(pl(n),pl(e))}var gl,Su,xu,Du;function Wf(){if(gl===void 0){gl=window,Su=/Firefox/.test(navigator.userAgent);var n=Element.prototype,e=Node.prototype,t=Text.prototype;xu=wr(e,"firstChild").get,Du=wr(e,"nextSibling").get,dl(n)&&(n.__click=void 0,n.__className=void 0,n.__attributes=null,n.__style=void 0,n.__e=void 0),dl(t)&&(t.__t=void 0)}}function nn(n=""){return document.createTextNode(n)}function Sn(n){return xu.call(n)}function da(n){return Du.call(n)}function h(n,e){return Sn(n)}function Ve(n,e=!1){{var t=Sn(n);return t instanceof Comment&&t.data===""?da(t):t}}function v(n,e=1,t=!1){let s=n;for(;e--;)s=da(s);return s}function Hf(n){n.textContent=""}function Eu(){return!1}let ml=!1;function Gf(){ml||(ml=!0,document.addEventListener("reset",n=>{Promise.resolve().then(()=>{var e;if(!n.defaultPrevented)for(const t of n.target.elements)(e=t.__on_r)==null||e.call(t)})},{capture:!0}))}function ii(n){var e=qe,t=Qe;ls(null),Ws(null);try{return n()}finally{ls(e),Ws(t)}}function Mo(n,e,t,s=t){n.addEventListener(e,()=>ii(t));const r=n.__on_r;r?n.__on_r=()=>{r(),s(!0)}:n.__on_r=()=>s(!0),Gf()}function Kf(n){Qe===null&&(qe===null&&rf(),nf()),On&&sf()}function Vf(n,e){var t=e.last;t===null?e.last=e.first=n:(t.next=n,n.prev=t,e.last=n)}function un(n,e,t){var s=Qe;s!==null&&s.f&ps&&(n|=ps);var r={ctx:Ct,deps:null,nodes:null,f:n|ts|Ds,first:null,fn:e,last:null,next:null,parent:s,b:s&&s.b,prev:null,teardown:null,wv:0,ac:null};if(t)try{na(r),r.f|=Do}catch(l){throw cs(r),l}else e!==null&&rn(r);var a=r;if(t&&a.deps===null&&a.teardown===null&&a.nodes===null&&a.first===a.last&&!(a.f&Lr)&&(a=a.first,n&on&&n&Cr&&a!==null&&(a.f|=Cr)),a!==null&&(a.parent=s,s!==null&&Vf(a,s),qe!==null&&qe.f&zt&&!(n&or))){var i=qe;(i.effects??(i.effects=[])).push(a)}return r}function Oo(){return qe!==null&&!Rs}function Ro(n){const e=un(ni,null,!1);return Nt(e,Ht),e.teardown=n,e}function kt(n){Kf();var e=Qe.f,t=!qe&&(e&ln)!==0&&(e&Do)===0;if(t){var s=Ct;(s.e??(s.e=[])).push(n)}else return Au(n)}function Au(n){return un(za|Zh,n,!1)}function Qf(n){en.ensure();const e=un(or|Lr,n,!0);return(t={})=>new Promise(s=>{t.outro?Zn(e,()=>{cs(e),s(void 0)}):(cs(e),s(void 0))})}function No(n){return un(za,n,!1)}function Xf(n){return un(Eo|Lr,n,!0)}function ha(n,e=0){return un(ni|e,n,!0)}function $(n,e=[],t=[],s=[]){qf(s,e,t,r=>{un(ni,()=>n(...r.map(o)),!0)})}function Po(n,e=0){var t=un(on|e,n,!0);return t}function Ss(n){return un(ln|Lr,n,!0)}function Cu(n){var e=n.teardown;if(e!==null){const t=On,s=qe;yl(!0),ls(null);try{e.call(null)}finally{yl(t),ls(s)}}}function Iu(n,e=!1){var t=n.first;for(n.first=n.last=null;t!==null;){const r=t.ac;r!==null&&ii(()=>{r.abort(br)});var s=t.next;t.f&or?t.parent=null:cs(t,e),t=s}}function Zf(n){for(var e=n.first;e!==null;){var t=e.next;e.f&ln||cs(e),e=t}}function cs(n,e=!0){var t=!1;(e||n.f&su)&&n.nodes!==null&&n.nodes.end!==null&&(Mu(n.nodes.start,n.nodes.end),t=!0),Iu(n,e&&!t),ja(n,0),Nt(n,tn);var s=n.nodes&&n.nodes.t;if(s!==null)for(const a of s)a.stop();Cu(n);var r=n.parent;r!==null&&r.first!==null&&Ou(n),n.next=n.prev=n.teardown=n.ctx=n.deps=n.fn=n.nodes=n.ac=null}function Mu(n,e){for(;n!==null;){var t=n===e?null:da(n);n.remove(),n=t}}function Ou(n){var e=n.parent,t=n.prev,s=n.next;t!==null&&(t.next=s),s!==null&&(s.prev=t),e!==null&&(e.first===n&&(e.first=s),e.last===n&&(e.last=t))}function Zn(n,e,t=!0){var s=[];Ru(n,s,!0);var r=()=>{t&&cs(n),e&&e()},a=s.length;if(a>0){var i=()=>--a||r();for(var l of s)l.out(i)}else r()}function Ru(n,e,t){if(!(n.f&ps)){n.f^=ps;var s=n.nodes&&n.nodes.t;if(s!==null)for(const l of s)(l.is_global||t)&&e.push(l);for(var r=n.first;r!==null;){var a=r.next,i=(r.f&Cr)!==0||(r.f&ln)!==0&&(n.f&on)!==0;Ru(r,e,i?t:!1),r=a}}}function Lo(n){Nu(n,!0)}function Nu(n,e){if(n.f&ps){n.f^=ps,n.f&Ht||(Nt(n,ts),rn(n));for(var t=n.first;t!==null;){var s=t.next,r=(t.f&Cr)!==0||(t.f&ln)!==0;Nu(t,r?e:!1),t=s}var a=n.nodes&&n.nodes.t;if(a!==null)for(const i of a)(i.is_global||e)&&i.in()}}function Pu(n,e){if(n.nodes)for(var t=n.nodes.start,s=n.nodes.end;t!==null;){var r=t===s?null:da(t);e.append(t),t=r}}let Jn=!1;function Ya(n){Jn=n}let On=!1;function yl(n){On=n}let qe=null,Rs=!1;function ls(n){qe=n}let Qe=null;function Ws(n){Qe=n}let Jt=null;function Lu(n){qe!==null&&(Jt===null?Jt=[n]:Jt.push(n))}let Xt=null,ds=0,_s=null;function Jf(n){_s=n}let Fu=1,sa=0,er=sa;function bl(n){er=n}function qu(){return++Fu}function fa(n){var e=n.f;if(e&ts)return!0;if(e&zt&&(n.f&=~nr),e&cn){for(var t=n.deps,s=t.length,r=0;r<s;r++){var a=t[r];if(fa(a)&&wu(a),a.wv>n.wv)return!0}e&Ds&&Ut===null&&Nt(n,Ht)}return!1}function Uu(n,e,t=!0){var s=n.reactions;if(s!==null&&!(Jt!=null&&Jt.includes(n)))for(var r=0;r<s.length;r++){var a=s[r];a.f&zt?Uu(a,e,!1):e===a&&(t?Nt(a,ts):a.f&Ht&&Nt(a,cn),rn(a))}}function Bu(n){var w;var e=Xt,t=ds,s=_s,r=qe,a=Jt,i=Ct,l=Rs,c=er,u=n.f;Xt=null,ds=0,_s=null,qe=u&(ln|or)?null:n,Jt=null,Ir(n.ctx),Rs=!1,er=++sa,n.ac!==null&&(ii(()=>{n.ac.abort(br)}),n.ac=null);try{n.f|=zi;var d=n.fn,f=d(),p=n.deps;if(Xt!==null){var y;if(ja(n,ds),p!==null&&ds>0)for(p.length=ds+Xt.length,y=0;y<Xt.length;y++)p[ds+y]=Xt[y];else n.deps=p=Xt;if(Oo()&&n.f&Ds)for(y=ds;y<p.length;y++)((w=p[y]).reactions??(w.reactions=[])).push(n)}else p!==null&&ds<p.length&&(ja(n,ds),p.length=ds);if(lu()&&_s!==null&&!Rs&&p!==null&&!(n.f&(zt|cn|ts)))for(y=0;y<_s.length;y++)Uu(_s[y],n);return r!==null&&r!==n&&(sa++,_s!==null&&(s===null?s=_s:s.push(..._s))),n.f&En&&(n.f^=En),f}catch(m){return du(m)}finally{n.f^=zi,Xt=e,ds=t,_s=s,qe=r,Jt=a,Ir(i),Rs=l,er=c}}function ev(n,e){let t=e.reactions;if(t!==null){var s=Gh.call(t,n);if(s!==-1){var r=t.length-1;r===0?t=e.reactions=null:(t[s]=t[r],t.pop())}}if(t===null&&e.f&zt&&(Xt===null||!Xt.includes(e))){var a=e;a.f&Ds&&(a.f^=Ds,a.f&=~nr),Co(a),_u(a),ja(a,0)}}function ja(n,e){var t=n.deps;if(t!==null)for(var s=e;s<t.length;s++)ev(n,t[s])}function na(n){var e=n.f;if(!(e&tn)){Nt(n,Ht);var t=Qe,s=Jn;Qe=n,Jn=!0;try{e&(on|tu)?Zf(n):Iu(n),Cu(n);var r=Bu(n);n.teardown=typeof r=="function"?r:null,n.wv=Fu;var a;Bi&&xf&&n.f&ts&&n.deps}finally{Jn=s,Qe=t}}}async function zu(){await Promise.resolve(),If()}function o(n){var e=n.f,t=(e&zt)!==0;if(qe!==null&&!Rs){var s=Qe!==null&&(Qe.f&tn)!==0;if(!s&&!(Jt!=null&&Jt.includes(n))){var r=qe.deps;if(qe.f&zi)n.rv<sa&&(n.rv=sa,Xt===null&&r!==null&&r[ds]===n?ds++:Xt===null?Xt=[n]:Xt.includes(n)||Xt.push(n));else{(qe.deps??(qe.deps=[])).push(n);var a=n.reactions;a===null?n.reactions=[qe]:a.includes(qe)||a.push(qe)}}}if(On&&An.has(n))return An.get(n);if(t){var i=n;if(On){var l=i.v;return(!(i.f&Ht)&&i.reactions!==null||Yu(i))&&(l=Io(i)),An.set(i,l),l}var c=(i.f&Ds)===0&&!Rs&&qe!==null&&(Jn||(qe.f&Ds)!==0),u=i.deps===null;fa(i)&&(c&&(i.f|=Ds),wu(i)),c&&!u&&$u(i)}if(Ut!=null&&Ut.has(n))return Ut.get(n);if(n.f&En)throw n.v;return n.v}function $u(n){if(n.deps!==null){n.f|=Ds;for(const e of n.deps)(e.reactions??(e.reactions=[])).push(n),e.f&zt&&!(e.f&Ds)&&$u(e)}}function Yu(n){if(n.v===qt)return!0;if(n.deps===null)return!1;for(const e of n.deps)if(An.has(e)||e.f&zt&&Yu(e))return!0;return!1}function Rn(n){var e=Rs;try{return Rs=!0,n()}finally{Rs=e}}function tv(n){if(!(typeof n!="object"||!n||n instanceof EventTarget)){if(sn in n)Ki(n);else if(!Array.isArray(n))for(let e in n){const t=n[e];typeof t=="object"&&t&&sn in t&&Ki(t)}}}function Ki(n,e=new Set){if(typeof n=="object"&&n!==null&&!(n instanceof EventTarget)&&!e.has(n)){e.add(n),n instanceof Date&&n.getTime();for(let s in n)try{Ki(n[s],e)}catch{}const t=So(n);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const s=Zc(t);for(let r in s){const a=s[r].get;if(a)try{a.call(n)}catch{}}}}}const sv=["touchstart","touchmove"];function nv(n){return sv.includes(n)}const ju=new Set,Vi=new Set;function rv(n,e,t,s={}){function r(a){if(s.capture||Hr.call(e,a),!a.cancelBubble)return ii(()=>t==null?void 0:t.call(this,a))}return n.startsWith("pointer")||n.startsWith("touch")||n==="wheel"?Fr(()=>{e.addEventListener(n,r,s)}):e.addEventListener(n,r,s),r}function Bt(n,e,t,s,r){var a={capture:s,passive:r},i=rv(n,e,t,a);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&Ro(()=>{e.removeEventListener(n,i,a)})}function Tt(n){for(var e=0;e<n.length;e++)ju.add(n[e]);for(var t of Vi)t(n)}let _l=null;function Hr(n){var g;var e=this,t=e.ownerDocument,s=n.type,r=((g=n.composedPath)==null?void 0:g.call(n))||[],a=r[0]||n.target;_l=n;var i=0,l=_l===n&&n.__root;if(l){var c=r.indexOf(l);if(c!==-1&&(e===document||e===window)){n.__root=e;return}var u=r.indexOf(e);if(u===-1)return;c<=u&&(i=c)}if(a=r[i]||n.target,a!==e){Kh(n,"currentTarget",{configurable:!0,get(){return a||t}});var d=qe,f=Qe;ls(null),Ws(null);try{for(var p,y=[];a!==null;){var w=a.assignedSlot||a.parentNode||a.host||null;try{var m=a["__"+s];m!=null&&(!a.disabled||n.target===a)&&m.call(a,n)}catch(_){p?y.push(_):p=_}if(n.cancelBubble||w===e||w===null)break;a=w}if(p){for(let _ of y)queueMicrotask(()=>{throw _});throw p}}finally{n.__root=e,delete n.currentTarget,ls(d),Ws(f)}}}function Wu(n){var e=document.createElement("template");return e.innerHTML=n.replaceAll("<!>","<!---->"),e.content}function ra(n,e){var t=Qe;t.nodes===null&&(t.nodes={start:n,end:e,a:null,t:null})}function C(n,e){var t=(e&_f)!==0,s=(e&wf)!==0,r,a=!n.startsWith("<!>");return()=>{r===void 0&&(r=Wu(a?n:"<!>"+n),t||(r=Sn(r)));var i=s||Su?document.importNode(r,!0):r.cloneNode(!0);if(t){var l=Sn(i),c=i.lastChild;ra(l,c)}else ra(i,i);return i}}function wi(n=""){{var e=nn(n+"");return ra(e,e),e}}function lt(){var n=document.createDocumentFragment(),e=document.createComment(""),t=nn();return n.append(e,t),ra(e,t),n}function S(n,e){n!==null&&n.before(e)}function N(n,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(n.__t??(n.__t=n.nodeValue))&&(n.__t=t,n.nodeValue=t+"")}function Sa(n,e){return av(n,e)}const hr=new Map;function av(n,{target:e,anchor:t,props:s={},events:r,context:a,intro:i=!0}){Wf();var l=new Set,c=f=>{for(var p=0;p<f.length;p++){var y=f[p];if(!l.has(y)){l.add(y);var w=nv(y);e.addEventListener(y,Hr,{passive:w});var m=hr.get(y);m===void 0?(document.addEventListener(y,Hr,{passive:w}),hr.set(y,1)):hr.set(y,m+1)}}};c(si(ju)),Vi.add(c);var u=void 0,d=Qf(()=>{var f=t??e.appendChild(nn());return Nf(f,{pending:()=>{}},p=>{if(a){ht({});var y=Ct;y.c=a}r&&(s.$$events=r),u=n(p,s)||{},a&&ft()}),()=>{var w;for(var p of l){e.removeEventListener(p,Hr);var y=hr.get(p);--y===0?(document.removeEventListener(p,Hr),hr.delete(p)):hr.set(p,y)}Vi.delete(c),f!==t&&((w=f.parentNode)==null||w.removeChild(f))}});return Qi.set(u,d),u}let Qi=new WeakMap;function xa(n,e){const t=Qi.get(n);return t?(Qi.delete(n),t(e)):Promise.resolve()}var Ms,Ys,hs,Xn,ca,ua,ti;class iv{constructor(e,t=!0){b(this,"anchor");Te(this,Ms,new Map);Te(this,Ys,new Map);Te(this,hs,new Map);Te(this,Xn,new Set);Te(this,ca,!0);Te(this,ua,()=>{var e=Fe;if(k(this,Ms).has(e)){var t=k(this,Ms).get(e),s=k(this,Ys).get(t);if(s)Lo(s),k(this,Xn).delete(t);else{var r=k(this,hs).get(t);r&&(k(this,Ys).set(t,r.effect),k(this,hs).delete(t),r.fragment.lastChild.remove(),this.anchor.before(r.fragment),s=r.effect)}for(const[a,i]of k(this,Ms)){if(k(this,Ms).delete(a),a===e)break;const l=k(this,hs).get(i);l&&(cs(l.effect),k(this,hs).delete(i))}for(const[a,i]of k(this,Ys)){if(a===t||k(this,Xn).has(a))continue;const l=()=>{if(Array.from(k(this,Ms).values()).includes(a)){var u=document.createDocumentFragment();Pu(i,u),u.append(nn()),k(this,hs).set(a,{effect:i,fragment:u})}else cs(i);k(this,Xn).delete(a),k(this,Ys).delete(a)};k(this,ca)||!s?(k(this,Xn).add(a),Zn(i,l,!1)):l()}}});Te(this,ti,e=>{k(this,Ms).delete(e);const t=Array.from(k(this,Ms).values());for(const[s,r]of k(this,hs))t.includes(s)||(cs(r.effect),k(this,hs).delete(s))});this.anchor=e,fe(this,ca,t)}ensure(e,t){var s=Fe,r=Eu();if(t&&!k(this,Ys).has(e)&&!k(this,hs).has(e))if(r){var a=document.createDocumentFragment(),i=nn();a.append(i),k(this,hs).set(e,{effect:Ss(()=>t(i)),fragment:a})}else k(this,Ys).set(e,Ss(()=>t(this.anchor)));if(k(this,Ms).set(s,e),r){for(const[l,c]of k(this,Ys))l===e?s.skipped_effects.delete(c):s.skipped_effects.add(c);for(const[l,c]of k(this,hs))l===e?s.skipped_effects.delete(c.effect):s.skipped_effects.add(c.effect);s.oncommit(k(this,ua)),s.ondiscard(k(this,ti))}else k(this,ua).call(this)}}Ms=new WeakMap,Ys=new WeakMap,hs=new WeakMap,Xn=new WeakMap,ca=new WeakMap,ua=new WeakMap,ti=new WeakMap;function j(n,e,t=!1){var s=new iv(n),r=t?Cr:0;function a(i,l){s.ensure(i,l)}Po(()=>{var i=!1;e((l,c=!0)=>{i=!0,a(c,l)}),i||a(!1,null)},r)}function yt(n,e){return e}function ov(n,e,t){for(var s=[],r=e.length,a,i=e.length,l=0;l<r;l++){let f=e[l];Zn(f,()=>{if(a){if(a.pending.delete(f),a.done.add(f),a.pending.size===0){var p=n.outrogroups;Xi(si(a.done)),p.delete(a),p.size===0&&(n.outrogroups=null)}}else i-=1},!1)}if(i===0){var c=s.length===0&&t!==null;if(c){var u=t,d=u.parentNode;Hf(d),d.append(u),n.items.clear()}Xi(e,!c)}else a={pending:new Set(e),done:new Set},(n.outrogroups??(n.outrogroups=new Set)).add(a)}function Xi(n,e=!0){for(var t=0;t<n.length;t++)cs(n[t],e)}var wl;function We(n,e,t,s,r,a=null){var i=n,l=new Map,c=(e&nu)!==0;if(c){var u=n;i=u.appendChild(nn())}var d=null,f=bu(()=>{var _=t();return To(_)?_:_==null?[]:si(_)}),p,y=!0;function w(){g.fallback=d,lv(g,p,i,e,s),d!==null&&(p.length===0?d.f&Js?(d.f^=Js,Gr(d,null,i)):Lo(d):Zn(d,()=>{d=null}))}var m=Po(()=>{p=o(f);for(var _=p.length,x=new Set,D=Fe,E=Eu(),R=0;R<_;R+=1){var P=p[R],L=s(P,R),H=y?null:l.get(L);H?(H.v&&Or(H.v,P),H.i&&Or(H.i,R),E&&D.skipped_effects.delete(H.e)):(H=cv(l,y?i:wl??(wl=nn()),P,L,R,r,e,t),y||(H.e.f|=Js),l.set(L,H)),x.add(L)}if(_===0&&a&&!d&&(y?d=Ss(()=>a(i)):(d=Ss(()=>a(wl??(wl=nn()))),d.f|=Js)),!y)if(E){for(const[Y,X]of l)x.has(Y)||D.skipped_effects.add(X.e);D.oncommit(w),D.ondiscard(()=>{})}else w();o(f)}),g={effect:m,items:l,outrogroups:null,fallback:d};y=!1}function lv(n,e,t,s,r){var X,oe,ae,ve,Q,Z,U,M,I;var a=(s&vf)!==0,i=e.length,l=n.items,c=n.effect.first,u,d=null,f,p=[],y=[],w,m,g,_;if(a)for(_=0;_<i;_+=1)w=e[_],m=r(w,_),g=l.get(m).e,g.f&Js||((oe=(X=g.nodes)==null?void 0:X.a)==null||oe.measure(),(f??(f=new Set)).add(g));for(_=0;_<i;_+=1){if(w=e[_],m=r(w,_),g=l.get(m).e,n.outrogroups!==null)for(const G of n.outrogroups)G.pending.delete(g),G.done.delete(g);if(g.f&Js)if(g.f^=Js,g===c)Gr(g,null,t);else{var x=d?d.next:c;g===n.effect.last&&(n.effect.last=g.prev),g.prev&&(g.prev.next=g.next),g.next&&(g.next.prev=g.prev),pn(n,d,g),pn(n,g,x),Gr(g,x,t),d=g,p=[],y=[],c=d.next;continue}if(g.f&ps&&(Lo(g),a&&((ve=(ae=g.nodes)==null?void 0:ae.a)==null||ve.unfix(),(f??(f=new Set)).delete(g))),g!==c){if(u!==void 0&&u.has(g)){if(p.length<y.length){var D=y[0],E;d=D.prev;var R=p[0],P=p[p.length-1];for(E=0;E<p.length;E+=1)Gr(p[E],D,t);for(E=0;E<y.length;E+=1)u.delete(y[E]);pn(n,R.prev,P.next),pn(n,d,R),pn(n,P,D),c=D,d=P,_-=1,p=[],y=[]}else u.delete(g),Gr(g,c,t),pn(n,g.prev,g.next),pn(n,g,d===null?n.effect.first:d.next),pn(n,d,g),d=g;continue}for(p=[],y=[];c!==null&&c!==g;)(u??(u=new Set)).add(c),y.push(c),c=c.next;if(c===null)continue}g.f&Js||p.push(g),d=g,c=g.next}if(n.outrogroups!==null){for(const G of n.outrogroups)G.pending.size===0&&(Xi(si(G.done)),(Q=n.outrogroups)==null||Q.delete(G));n.outrogroups.size===0&&(n.outrogroups=null)}if(c!==null||u!==void 0){var L=[];if(u!==void 0)for(g of u)g.f&ps||L.push(g);for(;c!==null;)!(c.f&ps)&&c!==n.fallback&&L.push(c),c=c.next;var H=L.length;if(H>0){var Y=s&nu&&i===0?t:null;if(a){for(_=0;_<H;_+=1)(U=(Z=L[_].nodes)==null?void 0:Z.a)==null||U.measure();for(_=0;_<H;_+=1)(I=(M=L[_].nodes)==null?void 0:M.a)==null||I.fix()}ov(n,L,Y)}}a&&Fr(()=>{var G,se;if(f!==void 0)for(g of f)(se=(G=g.nodes)==null?void 0:G.a)==null||se.apply()})}function cv(n,e,t,s,r,a,i,l){var c=i&hf?i&pf?rr(t):$f(t,!1,!1):null,u=i&ff?rr(r):null;return{v:c,i:u,e:Ss(()=>(a(e,c??t,u??r,l),()=>{n.delete(s)}))}}function Gr(n,e,t){if(n.nodes)for(var s=n.nodes.start,r=n.nodes.end,a=e&&!(e.f&Js)?e.nodes.start:t;s!==null;){var i=da(s);if(a.before(s),s===r)return;s=i}}function pn(n,e,t){e===null?n.effect.first=t:e.next=t,t===null?n.effect.last=e:t.prev=e}function uv(n,e,t=!1,s=!1,r=!1){var a=n,i="";$(()=>{var l=Qe;if(i!==(i=e()??"")&&(l.nodes!==null&&(Mu(l.nodes.start,l.nodes.end),l.nodes=null),i!=="")){var c=i+"";t?c=`<svg>${c}</svg>`:s&&(c=`<math>${c}</math>`);var u=Wu(c);if((t||s)&&(u=Sn(u)),ra(Sn(u),u.lastChild),t||s)for(;Sn(u);)a.before(Sn(u));else a.before(u)}})}function dv(n,e,t){No(()=>{var s=Rn(()=>e(n,t==null?void 0:t())||{});if(t&&(s!=null&&s.update)){var r=!1,a={};ha(()=>{var i=t();tv(i),r&&au(a,i)&&(a=i,s.update(i))}),r=!0}if(s!=null&&s.destroy)return()=>s.destroy()})}function Hu(n){var e,t,s="";if(typeof n=="string"||typeof n=="number")s+=n;else if(typeof n=="object")if(Array.isArray(n)){var r=n.length;for(e=0;e<r;e++)n[e]&&(t=Hu(n[e]))&&(s&&(s+=" "),s+=t)}else for(t in n)n[t]&&(s&&(s+=" "),s+=t);return s}function hv(){for(var n,e,t=0,s="",r=arguments.length;t<r;t++)(n=arguments[t])&&(e=Hu(n))&&(s&&(s+=" "),s+=e);return s}function fv(n){return typeof n=="object"?hv(n):n??""}const kl=[...` 	
\r\f\v\uFEFF`];function vv(n,e,t){var s=n==null?"":""+n;if(e&&(s=s?s+" "+e:e),t){for(var r in t)if(t[r])s=s?s+" "+r:r;else if(s.length)for(var a=r.length,i=0;(i=s.indexOf(r,i))>=0;){var l=i+a;(i===0||kl.includes(s[i-1]))&&(l===s.length||kl.includes(s[l]))?s=(i===0?"":s.substring(0,i))+s.substring(l+1):i=l}}return s===""?null:s}function pv(n,e){return n==null?null:String(n)}function Je(n,e,t,s,r,a){var i=n.__className;if(i!==t||i===void 0){var l=vv(t,s,a);l==null?n.removeAttribute("class"):n.className=l,n.__className=t}else if(a&&r!==a)for(var c in a){var u=!!a[c];(r==null||u!==!!r[c])&&n.classList.toggle(c,u)}return a}function Ns(n,e,t,s){var r=n.__style;if(r!==e){var a=pv(e);a==null?n.removeAttribute("style"):n.style.cssText=a,n.__style=e}return s}function Gu(n,e,t=!1){if(n.multiple){if(e==null)return;if(!To(e))return Tf();for(var s of n.options)s.selected=e.includes(Zr(s));return}for(s of n.options){var r=Zr(s);if(jf(r,e)){s.selected=!0;return}}(!t||e!==void 0)&&(n.selectedIndex=-1)}function gv(n){var e=new MutationObserver(()=>{Gu(n,n.__value)});e.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ro(()=>{e.disconnect()})}function Ku(n,e,t=e){var s=new WeakSet,r=!0;Mo(n,"change",a=>{var i=a?"[selected]":":checked",l;if(n.multiple)l=[].map.call(n.querySelectorAll(i),Zr);else{var c=n.querySelector(i)??n.querySelector("option:not([disabled])");l=c&&Zr(c)}t(l),Fe!==null&&s.add(Fe)}),No(()=>{var a=e();if(n===document.activeElement){var i=Vr??Fe;if(s.has(i))return}if(Gu(n,a,r),r&&a===void 0){var l=n.querySelector(":checked");l!==null&&(a=Zr(l),t(a))}n.__value=a,r=!1}),gv(n)}function Zr(n){return"__value"in n?n.__value:n.value}const mv=Symbol("is custom element"),yv=Symbol("is html");function Fo(n,e){var t=qo(n);t.value===(t.value=e??void 0)||n.value===e&&(e!==0||n.nodeName!=="PROGRESS")||(n.value=e??"")}function Cn(n,e){var t=qo(n);t.checked!==(t.checked=e??void 0)&&(n.checked=e)}function Le(n,e,t,s){var r=qo(n);r[e]!==(r[e]=t)&&(e==="loading"&&(n[ef]=t),t==null?n.removeAttribute(e):typeof t!="string"&&bv(n).includes(e)?n[e]=t:n.setAttribute(e,t))}function qo(n){return n.__attributes??(n.__attributes={[mv]:n.nodeName.includes("-"),[yv]:n.namespaceURI===kf})}var Tl=new Map;function bv(n){var e=n.getAttribute("is")||n.nodeName,t=Tl.get(e);if(t)return t;Tl.set(e,t=[]);for(var s,r=n,a=Element.prototype;a!==r;){s=Zc(r);for(var i in s)s[i].set&&t.push(i);r=So(r)}return t}function ut(n,e,t=e){var s=new WeakSet;Mo(n,"input",async r=>{var a=r?n.defaultValue:n.value;if(a=ki(n)?Ti(a):a,t(a),Fe!==null&&s.add(Fe),await zu(),a!==(a=e())){var i=n.selectionStart,l=n.selectionEnd,c=n.value.length;if(n.value=a??"",l!==null){var u=n.value.length;i===l&&l===c&&u>c?(n.selectionStart=u,n.selectionEnd=u):(n.selectionStart=i,n.selectionEnd=Math.min(l,u))}}}),Rn(e)==null&&n.value&&(t(ki(n)?Ti(n.value):n.value),Fe!==null&&s.add(Fe)),ha(()=>{var r=e();if(n===document.activeElement){var a=Vr??Fe;if(s.has(a))return}ki(n)&&r===Ti(n.value)||n.type==="date"&&!r&&!n.value||r!==n.value&&(n.value=r??"")})}function Ls(n,e,t=e){Mo(n,"change",s=>{var r=s?n.defaultChecked:n.checked;t(r)}),Rn(e)==null&&t(n.checked),ha(()=>{var s=e();n.checked=!!s})}function ki(n){var e=n.type;return e==="number"||e==="range"}function Ti(n){return n===""?null:+n}function Sl(n,e){return n===e||(n==null?void 0:n[sn])===e}function Ps(n={},e,t,s){return No(()=>{var r,a;return ha(()=>{r=a,a=(s==null?void 0:s())||[],Rn(()=>{n!==t(...a)&&(e(n,...a),r&&Sl(t(...r),n)&&e(null,...r))})}),()=>{Fr(()=>{a&&Sl(t(...a),n)&&e(null,...a)})}}),n}let Da=!1;function _v(n){var e=Da;try{return Da=!1,[n(),Da]}finally{Da=e}}function an(n,e,t,s){var x;var r=(t&yf)!==0,a=(t&bf)!==0,i=s,l=!0,c=()=>(l&&(l=!1,i=a?Rn(s):s),i),u;if(r){var d=sn in n||Jh in n;u=((x=wr(n,e))==null?void 0:x.set)??(d&&e in n?D=>n[e]=D:void 0)}var f,p=!1;r?[f,p]=_v(()=>n[e]):f=n[e],f===void 0&&s!==void 0&&(f=c(),u&&(of(),u(f)));var y;if(y=()=>{var D=n[e];return D===void 0?c():(l=!0,D)},!(t&mf))return y;if(u){var w=n.$$legacy;return function(D,E){return arguments.length>0?((!E||w||p)&&u(E?y():D),D):y()}}var m=!1,g=(t&gf?ai:bu)(()=>(m=!1,y()));r&&o(g);var _=Qe;return function(D,E){if(arguments.length>0){const R=E?o(g):r?De(D):D;return T(g,R),m=!0,i!==void 0&&(i=R),D}return On&&m||_.f&tn?g.v:o(g)}}function va(n){Ct===null&&Ao(),kt(()=>{const e=Rn(n);if(typeof e=="function")return e})}function wv(n){Ct===null&&Ao(),va(()=>()=>Rn(n))}const kv="5";var Fc;typeof window<"u"&&((Fc=window.__svelte??(window.__svelte={})).v??(Fc.v=new Set)).add(kv);function oi(){return{type:"daily",interval:1,time:"09:00"}}function Vu(n){return!n||!n.type||!n.interval||n.interval<1?!1:n.type==="weekly"?Array.isArray(n.weekdays)&&n.weekdays.length>0&&n.weekdays.every(e=>e>=0&&e<=6):n.type==="monthly"?n.dayOfMonth>=1&&n.dayOfMonth<=31:n.type==="yearly"?n.month>=0&&n.month<=11&&n.dayOfMonth>=1&&n.dayOfMonth<=31:!0}const $n="recurring-tasks-active",Pa="recurring-tasks-archive",xl="recurring-tasks",Dl="recurring-tasks.json.bak",El="n8n-event-settings",Al="n8n-event-queue",Tv="notification-state",Sv="recurring-tasks-dock",Cl="scheduler-emitted-occurrences",mn=5,Zi={n8n:{webhookUrl:"",sharedSecret:"",enabled:!1}},Uo=60*1e3,xv=30*1e3,Si=2e3,Il="shehab-note-recurring-plugin",Ml="1.0.0",Dv=60*60*1e3,Ev=3,Ol=10,xi=1e3,La=100,Rl=[{label:"15 minutes",minutes:15},{label:"30 minutes",minutes:30},{label:"1 hour",minutes:60},{label:"2 hours",minutes:120},{label:"4 hours",minutes:240}],Av=[{label:"+1 day",minutes:60*24},{label:"+3 days",minutes:60*24*3},{label:"+1 week",minutes:60*24*7}],Cv={lowest:"#94a3b8",low:"#64748b",normal:"#3b82f6",medium:"#f59e0b",high:"#f97316",highest:"#ef4444"},Iv=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],Nl="last-run-timestamp",Pl="custom-recurring-task-id",Ll="custom-recurring-task-due",Fl="custom-recurring-task-enabled",Ea=3,ql=[1e3,5e3,3e4],Mv=1e4,Bo={dueSoonScoreMax:100,dueSoonScoreMin:0,dueDateWeight:10,overdueBaseScore:110,overduePenaltyWeight:15,noDueDateScore:0,priorityMultipliers:{lowest:.8,low:1,normal:1.1,medium:1.2,high:1.5,highest:2},maxUrgency:200,minUrgency:0},Qu=24*60*60*1e3,Ov=(n,e,t)=>Math.min(t,Math.max(e,n)),Ul=n=>new Date(n.getFullYear(),n.getMonth(),n.getDate()),Rv=(n,e)=>{const t=Ul(n),s=Ul(e);return Math.round((s.getTime()-t.getTime())/Qu)},Nv=(n,e)=>e.priorityMultipliers[n]??1;function zo(n,e={}){return Pv(n,e).score}function Pv(n,e={}){const t=e.now??new Date,s=e.settings??Bo;if(!$o(n))return{score:0,breakdown:{priorityContribution:0,dueDateContribution:0,overdueContribution:0}};const r=Rr(n.priority)??"normal",a=Nv(r,s);if(!n.dueAt){const w=s.noDueDateScore,m=w*a;return{score:Di(m,s),breakdown:{priorityContribution:m-w,dueDateContribution:w,overdueContribution:0}}}const i=new Date(n.dueAt);if(Number.isNaN(i.getTime())){const w=s.noDueDateScore,m=w*a;return{score:Di(m,s),breakdown:{priorityContribution:m-w,dueDateContribution:w,overdueContribution:0}}}const l=i.getTime()<t.getTime(),c=Rv(t,i),u=l?Math.max(1,Math.ceil((t.getTime()-i.getTime())/Qu)):0,d=l?0:Ov(s.dueSoonScoreMax-c*s.dueDateWeight,s.dueSoonScoreMin,s.dueSoonScoreMax),f=l?s.overdueBaseScore+u*s.overduePenaltyWeight:0,p=d+f,y=p*a;return{score:Di(y,s),breakdown:{priorityContribution:y-p,dueDateContribution:d,overdueContribution:f}}}function Di(n,e){const t=e.maxUrgency!==void 0?Math.min(e.maxUrgency,n):n;return Math.round(Math.max(e.minUrgency,t))}function pa(n,e,t){const s=new Date().toISOString(),r=t||new Date;return{id:Xu(),name:n,lastCompletedAt:void 0,dueAt:r.toISOString(),frequency:e,enabled:!0,priority:"normal",timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,completionCount:0,missCount:0,currentStreak:0,bestStreak:0,recentCompletions:[],snoozeCount:0,maxSnoozes:3,version:mn,createdAt:s,updatedAt:s}}const Lv=["lowest","low","normal","medium","high","highest"];function Rr(n){if(!n)return;const e=n.toLowerCase();if(e==="urgent")return"highest";if(e==="none")return"normal";if(Lv.includes(e))return e}function Xu(){return`task_${Date.now()}_${Math.random().toString(36).slice(2,11)}`}function Zu(n,e={}){const t=new Date().toISOString();return{...{...n,id:Xu(),createdAt:t,updatedAt:t,lastCompletedAt:void 0,completionCount:0,missCount:0,currentStreak:0,bestStreak:0,recentCompletions:[],snoozeCount:0},...e}}function Fv(n){var s;const e=new Date,t=e.toISOString();if(n.completionCount=(n.completionCount||0)+1,n.currentStreak=(n.currentStreak||0)+1,n.bestStreak=Math.max(n.bestStreak||0,n.currentStreak),n.recentCompletions||(n.recentCompletions=[]),n.recentCompletions.push(t),n.recentCompletions.length>Ol&&(n.recentCompletions=n.recentCompletions.slice(-Ol)),(s=n.smartRecurrence)!=null&&s.enabled){n.completionHistory||(n.completionHistory=[]);const r=new Date(n.dueAt),a=Math.round((e.getTime()-r.getTime())/(1e3*60)),i={scheduledFor:n.dueAt,completedAt:t,delayMinutes:a,dayOfWeek:e.getDay(),context:{tags:n.tags||[],relatedBlocks:n.linkedBlockId?[n.linkedBlockId]:[]}};n.completionHistory.push(i),n.completionHistory.length>100&&(n.completionHistory=n.completionHistory.slice(-100))}n.snoozeCount=0,n.lastCompletedAt=t,n.updatedAt=t}function Ju(n){n.missCount=(n.missCount||0)+1,n.currentStreak=0,n.updatedAt=new Date().toISOString()}function ed(n){const e=n.completionCount||0,t=n.missCount||0,s=e+t;if(s===0)return 100;let a=e/s*70;const i=n.currentStreak||0,l=Math.min(30,i*3);return a+=l,Math.round(Math.min(100,a))}function qv(n,e){const t=new Set([...n.blockedBy??[],...n.dependsOn??[]]);return t.size===0?!1:e.filter(r=>t.has(r.id)).some(r=>$o(r))}function Uv(n,e){return e.some(t=>t.id===n.id||!new Set([...t.blockedBy??[],...t.dependsOn??[]]).has(n.id)?!1:$o(t))}function $o(n){return n.status?n.status==="todo":n.enabled}function Yn(n){const{message:e,type:t="info",duration:s=3e3,actionLabel:r,onAction:a,showCountdown:i=!1}=n,l=document.createElement("div");l.className=`recurring-tasks-toast recurring-tasks-toast--${t}`;const c=document.createElement("span");c.textContent=e,l.appendChild(c);let u=null;if(r&&a){const f=document.createElement("button");f.type="button";let p=Math.max(1,Math.ceil(s/1e3));f.textContent=i?`${r} (${p}s)`:r,f.className="recurring-tasks-toast__action",f.addEventListener("click",()=>{a(),u!==null&&window.clearInterval(u),l.parentElement&&l.parentElement.removeChild(l)}),l.appendChild(f),i&&s>0&&(u=window.setInterval(()=>{p=Math.max(0,p-1),f.textContent=`${r} (${p}s)`,p<=0&&u!==null&&(window.clearInterval(u),u=null)},1e3))}Object.assign(l.style,{position:"fixed",top:"20px",right:"20px",padding:"12px 20px",borderRadius:"6px",backgroundColor:Bv(t),color:"white",fontSize:"14px",fontWeight:"500",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",zIndex:"10000",maxWidth:"420px",display:"flex",alignItems:"center",gap:"12px",animation:"slideInRight 0.3s ease-out"}),document.body.appendChild(l);const d=()=>{u!==null&&window.clearInterval(u),l.style.animation="slideOutRight 0.3s ease-out",setTimeout(()=>{l.parentElement&&l.parentElement.removeChild(l)},300)};s>0&&setTimeout(()=>{d()},s)}function Bv(n){switch(n){case"success":return"#4caf50";case"error":return"#f44336";case"warning":return"#ff9800";case"info":default:return"#2196f3"}}const W={success:(n,e)=>Yn({message:n,type:"success",duration:e}),error:(n,e)=>Yn({message:n,type:"error",duration:e}),warning:(n,e)=>Yn({message:n,type:"warning",duration:e}),info:(n,e)=>Yn({message:n,type:"info",duration:e})};if(typeof document<"u"){const n=document.createElement("style");n.textContent=`
    @keyframes slideInRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    @keyframes slideOutRight {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(100%);
        opacity: 0;
      }
    }

    .recurring-tasks-toast__action {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      padding: 6px 10px;
      border-radius: 4px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s ease;
      white-space: nowrap;
    }

    .recurring-tasks-toast__action:hover {
      background: rgba(255, 255, 255, 0.3);
    }
  `,document.head.appendChild(n)}class zv{constructor(){b(this,"handlers",new Map)}on(e,t){return this.handlers.has(e)||this.handlers.set(e,new Set),this.handlers.get(e).add(t),()=>{var s;return(s=this.handlers.get(e))==null?void 0:s.delete(t)}}emit(e,t){var s;(s=this.handlers.get(e))==null||s.forEach(r=>r(t))}clear(){this.handlers.clear()}}const Ye=new zv;function Aa(n,e){const t=n.findIndex(r=>r.id===e.id);if(t===-1)return[...n,e];const s=[...n];return s[t]=e,s}function Bl(n,e){const t=n.filter(s=>s.id!==e);return t.length===n.length?n:t}function Ei(n,e,t){let s=!1;const r=n.map(a=>a.id!==e?a:(s=!0,t(a)));return s?r:n}function $v(n,e=new Date){const t=new Date(e);return t.setHours(23,59,59,999),n.filter(s=>s.enabled?new Date(s.dueAt)<=t:!1)}const Yo=Symbol("urgency-settings"),Yv=(()=>{try{if(typeof process<"u"&&process.env)return process.env.DEBUG==="true"}catch{}return!1})();function li(n,e,t){const s={timestamp:new Date().toISOString()},r=`[${n.toUpperCase()}] [${s.timestamp}]`;n==="error"?console.error(r,e,t||""):n==="warn"?console.warn(r,e,t||""):n==="debug"&&Yv?console.debug(r,e,t||""):n==="info"&&console.log(r,e,t||"")}function td(n,e){li("debug",n,e)}function re(n,e){li("info",n,e)}function et(n,e){li("warn",n,e)}function Se(n,e){li("error",n,e)}async function jv(n){return new Promise(e=>{try{_o.fetchPost("/api/block/getBlockInfo",{id:n},t=>{var r,a,i;const s=((r=t==null?void 0:t.data)==null?void 0:r.content)??((a=t==null?void 0:t.data)==null?void 0:a.markdown)??((i=t==null?void 0:t.data)==null?void 0:i.name)??null;e(s?s.trim():null)})}catch(t){et("Failed to fetch block preview",t),e(null)}})}async function Wv(n){return new Promise(e=>{try{_o.fetchPost("/api/block/getBlockHTML",{id:n},t=>{var r;const s=((r=t==null?void 0:t.data)==null?void 0:r.html)??null;e(s?s.trim():null)})}catch(t){et("Failed to fetch block embed",t),e(null)}})}function Ji(n){const[e,t]=n.split(":").map(Number);return{hours:e,minutes:t}}function Hv(n){const e=n.getHours().toString().padStart(2,"0"),t=n.getMinutes().toString().padStart(2,"0");return`${e}:${t}`}function Gv(n){return n.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}function eo(n){return n.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function jo(n){const e=new Date;return n.getDate()===e.getDate()&&n.getMonth()===e.getMonth()&&n.getFullYear()===e.getFullYear()}function Kv(n){return n<new Date}function Vv(n){return Kv(n)&&!jo(n)}function In(n,e){const t=new Date(n);return t.setDate(t.getDate()+e),t}function zl(n,e){return In(n,e*7)}function Ai(n,e,t){const s=new Date(n);return s.setHours(e,t,0,0),s}function $l(n,e,t){const s=new Date(n);s.setHours(e,t,0,0);const r=s.getHours()!==e||s.getMinutes()!==t;return{date:s,shifted:r}}function to(n){const e=new Date(n);return e.setHours(0,0,0,0),e}function Qv(n){const e=new Date(n);return e.setHours(23,59,59,999),e}function Xv(n,e){const s=Math.abs(e.getTime()-n.getTime());return Math.floor(s/864e5)}function Zv(n,e){const t=[];for(let s=0;s<e;s++)t.push(In(n,s));return t}var Jv=C('<span class="task-card__streak svelte-yjw1ud"> </span>'),ep=C('<button class="task-card__edit-btn svelte-yjw1ud" title="Edit"></button>'),tp=C('<span class="task-card__relative svelte-yjw1ud"> </span>'),sp=C('<div class="task-card__last-completed svelte-yjw1ud"><span class="task-card__label svelte-yjw1ud">Last completed:</span> <span class="task-card__value svelte-yjw1ud"> </span></div>'),np=C('<div class="task-card__block-preview-html svelte-yjw1ud"><!></div>'),rp=C('<div class="task-card__block-preview svelte-yjw1ud" role="tooltip"><!></div>'),ap=C('<div class="task-card__linked-block svelte-yjw1ud"><button class="task-card__block-link svelte-yjw1ud"> </button> <!></div>'),ip=C('<button class="task-card__snooze-chip"> </button>'),op=C('<button class="task-card__snooze-option" role="menuitem"> </button>'),lp=C('<div class="task-card__snooze-menu" role="menu" tabindex="0" aria-label="Snooze options"></div>'),cp=C('<div role="article" tabindex="0"><div class="task-card__header svelte-yjw1ud"><div class="task-card__title-row svelte-yjw1ud"><div class="task-card__priority-indicator svelte-yjw1ud"></div> <h3 class="task-card__name svelte-yjw1ud"> </h3> <!></div> <!></div> <div class="task-card__details svelte-yjw1ud"><div class="task-card__due svelte-yjw1ud"><span class="task-card__label svelte-yjw1ud">Due:</span> <span class="task-card__value svelte-yjw1ud"> </span> <!></div> <div class="task-card__urgency svelte-yjw1ud"><span class="task-card__label svelte-yjw1ud">Urgency:</span> <span class="task-card__value svelte-yjw1ud"> </span></div> <!> <!></div> <div><div class="task-card__health-bar"></div></div> <div class="task-card__actions svelte-yjw1ud"><div class="task-card__snooze-container svelte-yjw1ud"><button class="task-card__action task-card__action--snooze" aria-label="Snooze task" aria-haspopup="menu"> Snooze</button> <div class="task-card__snooze-quick"><!> <button class="task-card__snooze-chip task-card__snooze-chip--tomorrow" aria-label="Snooze until tomorrow">Tomorrow</button></div> <!></div> <button class="task-card__action task-card__action--delay" aria-label="Delay task to tomorrow"> Tomorrow</button> <button class="task-card__action task-card__action--skip" aria-label="Skip this occurrence"> Skip</button> <button class="task-card__action task-card__action--done" aria-label="Mark task as done"> Done</button></div></div>');function qr(n,e){ht(e,!0);const t=J(()=>new Date(e.task.dueAt)),s=J(()=>Vv(o(t))),r=J(()=>jo(o(t))),a=J(()=>o(s)?Xv(new Date(e.task.dueAt),new Date):0),i=J(()=>o(s)?"task-card--overdue":o(r)?"task-card--today":""),l=J(()=>()=>o(s)?`rgba(244, 67, 54, ${Math.min(.45,.12+o(a)*.05)})`:""),c=J(()=>()=>o(s)?`rgba(244, 67, 54, ${Math.min(.8,.3+o(a)*.08)})`:""),u=J(()=>()=>{const ne=Rr(e.task.priority)||"normal";return Cv[ne]}),d=J(()=>()=>e.timezoneHandler?e.timezoneHandler.getRelativeTime(o(t)):""),f=J(()=>(e.task.currentStreak||0)>0),p=J(()=>()=>""),y=J(()=>ed(e.task)),w=J(()=>o(y)>=80?"health--good":o(y)>=50?"health--fair":"health--poor"),m=ou(Yo),g=J(()=>zo(e.task,{settings:m}));let _=V(!1),x=V(-1),D=[],E=V(!1),R=V(null),P=V(null),L=V(!1);const H=J(()=>()=>e.task.linkedBlockId?e.task.linkedBlockId.length>10?`${e.task.linkedBlockId.slice(0,10)}`:e.task.linkedBlockId:""),Y=J(()=>()=>{if(!o(R))return"";const ne=o(R).replace(/\s+/g," ").trim();return ne.length>220?`${ne.slice(0,220)}`:ne}),X=J(()=>()=>Rl.filter(ne=>[15,60,120].includes(ne.minutes))),oe=J(()=>()=>`snooze-menu-${e.task.id}`);kt(()=>{T(R,e.task.linkedBlockContent??null,!0),T(P,null),T(L,!1)});function ae(){e.onDone(e.task)}function ve(){e.onDelay(e.task)}function Q(){e.onEdit&&e.onEdit(e.task)}function Z(){e.onSkip(e.task)}async function U(){T(_,!o(_)),o(_)&&(await zu(),T(x,-1),D=[])}function M(ne){const we=new CustomEvent("task-snooze",{detail:{taskId:e.task.id,minutes:ne}});window.dispatchEvent(we),T(_,!1),T(x,-1)}function I(ne){var ge,Oe,he,ke;const we=o(X);ne.key==="ArrowDown"?(ne.preventDefault(),T(x,Math.min(o(x)+1,we.length-1),!0),(ge=D[o(x)])==null||ge.focus()):ne.key==="ArrowUp"?(ne.preventDefault(),T(x,Math.max(o(x)-1,0),!0),(Oe=D[o(x)])==null||Oe.focus()):ne.key==="Escape"?(T(_,!1),T(x,-1)):ne.key==="Home"?(ne.preventDefault(),T(x,0),(he=D[0])==null||he.focus()):ne.key==="End"&&(ne.preventDefault(),T(x,we.length-1),(ke=D[o(x)])==null||ke.focus())}function G(ne){if(ne.key==="Escape"&&o(_)){T(_,!1);return}(ne.key==="Enter"||ne.key===" ")&&(ne.preventDefault(),U())}async function se(){if(T(E,!0),!e.task.linkedBlockId||o(L)||o(P))return;T(L,!0);const[ne,we]=await Promise.all([Wv(e.task.linkedBlockId),jv(e.task.linkedBlockId)]);T(P,ne,!0),T(R,we,!0),T(L,!1)}function be(){T(E,!1)}const pe=J(()=>()=>`Task:  ${e.task.name.replace(/[<>"&]/g,we=>({"<":"&lt;",">":"&gt;",'"':"&quot;","&":"&amp;"})[we]||we)}`);var ce=cp();ce.__keydown=ne=>{ne.key==="Escape"&&o(_)&&T(_,!1)};var Ie=h(ce),Me=h(Ie),Be=h(Me),de=v(Be,2),B=h(de),A=v(de,2);{var F=ne=>{var we=Jv(),ge=h(we);$(Oe=>{Le(we,"title",`${e.task.currentStreak??""} day streak`),N(ge,`${Oe??""} ${e.task.currentStreak??""}`)},[()=>o(p)()]),S(ne,we)};j(A,ne=>{o(f)&&ne(F)})}var K=v(Me,2);{var ie=ne=>{var we=ep();we.__click=Q,S(ne,we)};j(K,ne=>{e.onEdit&&ne(ie)})}var O=v(Ie,2),q=h(O),ee=v(h(q),2),me=h(ee),_e=v(ee,2);{var ue=ne=>{var we=tp(),ge=h(we);$(Oe=>N(ge,Oe),[()=>o(d)()]),S(ne,we)};j(_e,ne=>{e.timezoneHandler&&ne(ue)})}var Ee=v(q,2),Ae=v(h(Ee),2),ze=h(Ae),Ze=v(Ee,2);{var He=ne=>{var we=sp(),ge=v(h(we),2),Oe=h(ge);$(he=>N(Oe,he),[()=>eo(new Date(e.task.lastCompletedAt))]),S(ne,we)};j(Ze,ne=>{e.task.lastCompletedAt&&ne(He)})}var at=v(Ze,2);{var dt=ne=>{var we=ap(),ge=h(we),Oe=h(ge),he=v(ge,2);{var ke=Re=>{var pt=rp(),$t=h(pt);{var xt=Dt=>{var Lt=wi("Loading preview");S(Dt,Lt)},Gt=Dt=>{var Lt=lt(),As=Ve(Lt);{var Yt=Kt=>{var z=np(),ye=h(z);uv(ye,()=>o(P)),S(Kt,z)},ns=Kt=>{var z=lt(),ye=Ve(z);{var nt=Vt=>{var hn=wi();$(()=>N(hn,o(Y))),S(Vt,hn)},rs=Vt=>{var hn=wi("No preview available.");S(Vt,hn)};j(ye,Vt=>{o(R)?Vt(nt):Vt(rs,!1)},!0)}S(Kt,z)};j(As,Kt=>{o(P)?Kt(Yt):Kt(ns,!1)},!0)}S(Dt,Lt)};j($t,Dt=>{o(L)?Dt(xt):Dt(Gt,!1)})}S(Re,pt)};j(he,Re=>{o(E)&&Re(ke)})}$(()=>{Le(ge,"title",`Linked block: ${e.task.linkedBlockId}`),N(Oe,` Block ${o(H)??""}`)}),Bt("mouseenter",ge,se),Bt("mouseleave",ge,be),Bt("focus",ge,se),Bt("blur",ge,be),S(ne,we)};j(at,ne=>{e.task.linkedBlockId&&ne(dt)})}var Ce=v(O,2),Ne=h(Ce),xe=v(Ce,2),Pe=h(xe),Ge=h(Pe);Ge.__click=U,Ge.__keydown=G;var Ue=v(Ge,2),st=h(Ue);We(st,17,()=>o(X),yt,(ne,we)=>{var ge=ip();ge.__click=()=>M(o(we).minutes);var Oe=h(ge);$(()=>{Le(ge,"aria-label",`Snooze for ${o(we).label}`),N(Oe,o(we).label)}),S(ne,ge)});var gt=v(st,2);gt.__click=ve;var vt=v(Ue,2);{var It=ne=>{var we=lp();we.__keydown=I,We(we,21,()=>Rl,yt,(ge,Oe,he)=>{var ke=op();ke.__click=()=>M(o(Oe).minutes),Le(ke,"tabindex",he===0?0:-1);var Re=h(ke);Ps(ke,(pt,$t)=>D[$t]=pt,pt=>D==null?void 0:D[pt],()=>[he]),$(()=>N(Re,o(Oe).label)),S(ge,ke)}),$(()=>Le(we,"id",o(oe))),S(ne,we)};j(vt,ne=>{o(_)&&ne(It)})}var mt=v(Pe,2);mt.__click=ve;var Pt=v(mt,2);Pt.__click=Z;var ss=v(Pt,2);ss.__click=ae,$((ne,we)=>{Je(ce,1,`task-card ${o(i)??""}`,"svelte-yjw1ud"),Ns(ce,`--overdue-tint: ${o(l)??""}; --overdue-border: ${o(c)??""};`),Le(ce,"aria-label",ne),Le(ce,"data-task-id",e.task.id),Ns(Be,`background-color: ${o(u)??""}`),Le(Be,"title",`Priority:  ${(e.task.priority||"normal")??""}`),N(B,e.task.name),N(me,we),Le(Ee,"title",`Urgency score: ${o(g)??""}`),N(ze,o(g)),Je(Ce,1,`task-card__health ${o(w)??""}`,"svelte-yjw1ud"),Le(Ce,"title",`Task health:  ${o(y)??""}%`),Ns(Ne,`width: ${o(y)??""}%`),Le(Ge,"aria-expanded",o(_)),Le(Ge,"aria-controls",o(oe))},[()=>o(pe)(),()=>eo(o(t))]),S(n,ce),ft()}Tt(["keydown","click"]);var up=C(`<div class="today-tab__empty svelte-u7986x"><p class="svelte-u7986x"> No tasks due today or overdue!</p> <p class="today-tab__empty-subtitle svelte-u7986x">You're all caught up.</p></div>`),dp=C('<div class="today-tab__card-wrapper svelte-u7986x" role="listitem"><!></div>'),hp=C('<div class="today-tab svelte-u7986x"><div class="today-tab__header svelte-u7986x"><h2 class="today-tab__title svelte-u7986x">Today & Overdue Tasks</h2> <p class="today-tab__subtitle svelte-u7986x"> </p></div> <div class="today-tab__content svelte-u7986x" role="list" aria-label="Today and overdue tasks"><!></div></div>');function fp(n,e){ht(e,!0);const t=J(()=>[...e.tasks].sort((m,g)=>new Date(m.dueAt).getTime()-new Date(g.dueAt).getTime()));let s=V(0),r=De([]);kt(()=>{o(s)>=o(t).length&&T(s,Math.max(0,o(t).length-1),!0)});function a(m){var _;if(o(t).length===0)return;const g=Math.max(0,Math.min(m,o(t).length-1));T(s,g,!0),(_=r[g])==null||_.focus()}function i(m,g){m.key==="ArrowDown"?(m.preventDefault(),a(g+1)):m.key==="ArrowUp"?(m.preventDefault(),a(g-1)):m.key==="Home"?(m.preventDefault(),a(0)):m.key==="End"&&(m.preventDefault(),a(o(t).length-1))}var l=hp(),c=h(l),u=v(h(c),2),d=h(u),f=v(c,2),p=h(f);{var y=m=>{var g=up();S(m,g)},w=m=>{var g=lt(),_=Ve(g);We(_,19,()=>o(t),x=>x.id,(x,D,E)=>{var R=dp();R.__keydown=L=>i(L,o(E));var P=h(R);qr(P,{get task(){return o(D)},get onDone(){return e.onDone},get onDelay(){return e.onDelay},get onSkip(){return e.onSkip},get onEdit(){return e.onEdit},get timezoneHandler(){return e.timezoneHandler}}),Ps(R,(L,H)=>r[H]=L,L=>r==null?void 0:r[L],()=>[o(E)]),$(()=>Le(R,"tabindex",o(E)===o(s)?0:-1)),Bt("focus",R,()=>T(s,o(E),!0)),S(x,R)}),S(m,g)};j(p,m=>{o(t).length===0?m(y):m(w,!1)})}$(()=>N(d,`${e.tasks.length??""} task${e.tasks.length!==1?"s":""} requiring attention`)),S(n,l),ft()}Tt(["keydown"]);var vp=C('<div class="all-tasks-tab__empty svelte-i091qn"><p class="svelte-i091qn">No recurring tasks yet.</p> <p class="all-tasks-tab__empty-subtitle svelte-i091qn">Create your first task to get started!</p></div>'),pp=C('<div class="all-tasks-tab__empty svelte-i091qn"><p class="svelte-i091qn"> </p> <p class="all-tasks-tab__empty-subtitle svelte-i091qn">Try a different search term.</p></div>'),gp=C('<tr><td class="all-tasks-tab__select-col svelte-i091qn"><input type="checkbox"/></td><td class="task-name svelte-i091qn"> </td><td class="svelte-i091qn"> </td><td class="svelte-i091qn"> </td><td class="svelte-i091qn"><label class="toggle-switch svelte-i091qn"><input type="checkbox" class="svelte-i091qn"/> <span class="toggle-slider svelte-i091qn"></span></label></td><td class="svelte-i091qn"><div class="task-actions svelte-i091qn"><button class="task-action-btn task-action-btn--edit svelte-i091qn" title="Edit"></button> <button class="task-action-btn task-action-btn--duplicate svelte-i091qn" title="Duplicate"></button> <button class="task-action-btn task-action-btn--delete svelte-i091qn" title="Delete"></button></div></td></tr>'),mp=C('<table class="all-tasks-tab__table svelte-i091qn"><thead class="svelte-i091qn"><tr class="svelte-i091qn"><th class="all-tasks-tab__select-col svelte-i091qn"><input class="all-tasks-tab__select-all svelte-i091qn" type="checkbox" aria-label="Select all visible tasks"/></th><th class="svelte-i091qn">Task Name</th><th class="svelte-i091qn">Next Due</th><th class="svelte-i091qn">Frequency</th><th class="svelte-i091qn">Status</th><th class="svelte-i091qn">Actions</th></tr></thead><tbody></tbody></table>'),yp=C('<div class="all-tasks-tab__table-wrapper svelte-i091qn"><!></div>'),bp=C('<div class="delete-confirm-overlay svelte-i091qn"><div class="delete-confirm-dialog svelte-i091qn"><h3 class="svelte-i091qn">Delete Task?</h3> <p class="svelte-i091qn"> </p> <div class="delete-confirm-actions svelte-i091qn"><button class="btn-cancel svelte-i091qn">Cancel</button> <button class="btn-delete svelte-i091qn">Delete</button></div></div></div>'),_p=C('<div class="delete-confirm-overlay svelte-i091qn"><div class="delete-confirm-dialog svelte-i091qn"><h3 class="svelte-i091qn">Delete Selected Tasks?</h3> <p class="svelte-i091qn"> </p> <div class="delete-confirm-actions svelte-i091qn"><button class="btn-cancel svelte-i091qn">Cancel</button> <button class="btn-delete svelte-i091qn">Delete</button></div></div></div>'),wp=C('<div class="all-tasks-tab svelte-i091qn"><div class="all-tasks-tab__header svelte-i091qn"><h2 class="all-tasks-tab__title svelte-i091qn">All Recurring Tasks</h2> <div class="all-tasks-tab__actions svelte-i091qn"><div class="all-tasks-tab__search svelte-i091qn"><span class="all-tasks-tab__search-icon svelte-i091qn"></span> <input class="all-tasks-tab__search-input svelte-i091qn" type="search" placeholder="Search tasks (name, tags, block content)" aria-label="Search tasks" title="Searches task names, descriptions, tags, and linked block content."/></div> <button class="all-tasks-tab__create-btn svelte-i091qn">+ Create New Task</button></div></div> <div class="all-tasks-tab__content svelte-i091qn"><div class="all-tasks-tab__bulk svelte-i091qn"><div class="all-tasks-tab__bulk-info"> </div> <div class="all-tasks-tab__bulk-actions svelte-i091qn"><button class="all-tasks-tab__bulk-btn svelte-i091qn">Enable</button> <button class="all-tasks-tab__bulk-btn svelte-i091qn">Disable</button> <button class="all-tasks-tab__bulk-btn all-tasks-tab__bulk-btn--danger svelte-i091qn">Delete</button></div></div> <!></div></div> <!> <!>',1);function kp(n,e){ht(e,!0);let t=V(null),s=V(!1),r=V(""),a=V(""),i=V(De(new Set)),l=V(0),c=De([]),u=V(null);const d=J(()=>[...e.tasks].sort((O,q)=>new Date(O.dueAt).getTime()-new Date(q.dueAt).getTime())),f=J(()=>()=>{const O=o(a).trim().toLowerCase();return O?o(d).filter(q=>{var me;return[q.name,q.description,q.category,q.linkedBlockContent,(me=q.tags)==null?void 0:me.join(" ")].filter(Boolean).join(" ").toLowerCase().includes(O)}):o(d)}),p=J(()=>o(f).map(O=>O.id)),y=J(()=>o(i).size>0),w=J(()=>o(f).length>0&&o(f).every(O=>o(i).has(O.id))),m=J(()=>o(f).some(O=>o(i).has(O.id))&&!o(w));kt(()=>{const O=new Set([...o(i)].filter(q=>e.tasks.some(ee=>ee.id===q)));O.size!==o(i).size&&T(i,O,!0)}),kt(()=>{o(u)&&(o(u).indeterminate=o(m))}),kt(()=>{o(l)>=o(f).length&&T(l,Math.max(0,o(f).length-1),!0)}),kt(()=>{const O=window.setTimeout(()=>{T(a,o(r),!0)},300);return()=>{window.clearTimeout(O)}});function g(O){T(t,O,!0)}function _(){o(t)&&(e.onDelete(o(t)),T(t,null))}function x(){T(t,null)}function D(O){const q=new Set(o(i));q.has(O)?q.delete(O):q.add(O),T(i,q,!0)}function E(){const O=new Set(o(i));o(w)?o(p).forEach(q=>O.delete(q)):o(p).forEach(q=>O.add(q)),T(i,O,!0)}function R(O){var ee;if(o(f).length===0)return;const q=Math.max(0,Math.min(O,o(f).length-1));T(l,q,!0),(ee=c[q])==null||ee.focus()}function P(O,q){O.key==="ArrowDown"?(O.preventDefault(),R(q+1)):O.key==="ArrowUp"?(O.preventDefault(),R(q-1)):O.key==="Home"?(O.preventDefault(),R(0)):O.key==="End"&&(O.preventDefault(),R(o(f).length-1))}function L(){if(o(i).size===0){T(s,!1);return}e.onBulkDelete([...o(i)]),T(i,new Set,!0),T(s,!1)}function H(){T(s,!1)}function Y(O){const{type:q,interval:ee}=O.frequency,me=q==="daily"?"day":q==="weekly"?"week":q==="monthly"?"month":"year",_e=ee===1?`Every ${me}`:`Every ${ee} ${me}s`;if(q==="weekly")return`${_e} on ${O.frequency.weekdays.map(ue=>Iv[ue]??ue).join(", ")}`;if(q==="monthly")return`${_e} on day ${O.frequency.dayOfMonth}`;if(q==="yearly"){const ue=X[O.frequency.month]??`Month ${O.frequency.month+1}`;return`${_e} on ${ue} ${O.frequency.dayOfMonth}`}return _e}const X=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var oe=wp(),ae=Ve(oe),ve=h(ae),Q=v(h(ve),2),Z=h(Q),U=v(h(Z),2),M=v(Z,2);M.__click=function(...O){var q;(q=e.onCreate)==null||q.apply(this,O)};var I=v(ve,2),G=h(I),se=h(G),be=h(se),pe=v(se,2),ce=h(pe);ce.__click=()=>e.onBulkEnable([...o(i)]);var Ie=v(ce,2);Ie.__click=()=>e.onBulkDisable([...o(i)]);var Me=v(Ie,2);Me.__click=()=>T(s,!0);var Be=v(G,2);{var de=O=>{var q=vp();S(O,q)},B=O=>{var q=yp(),ee=h(q);{var me=ue=>{var Ee=pp(),Ae=h(Ee),ze=h(Ae);$(Ze=>N(ze,`No tasks match "${Ze??""}".`),[()=>o(a).trim()]),S(ue,Ee)},_e=ue=>{var Ee=mp(),Ae=h(Ee),ze=h(Ae),Ze=h(ze),He=h(Ze);He.__click=E,Ps(He,dt=>T(u,dt),()=>o(u));var at=v(Ae);We(at,23,()=>o(f),dt=>dt.id,(dt,Ce,Ne)=>{var xe=gp();xe.__keydown=Re=>P(Re,o(Ne));var Pe=h(xe),Ge=h(Pe);Ge.__click=()=>D(o(Ce).id);var Ue=v(Pe),st=h(Ue),gt=v(Ue),vt=h(gt),It=v(gt),mt=h(It),Pt=v(It),ss=h(Pt),ne=h(ss);ne.__change=()=>e.onToggleEnabled(o(Ce));var we=v(Pt),ge=h(we),Oe=h(ge);Oe.__click=()=>e.onEdit(o(Ce));var he=v(Oe,2);he.__click=()=>e.onDuplicate(o(Ce));var ke=v(he,2);ke.__click=()=>g(o(Ce)),Ps(xe,(Re,pt)=>c[pt]=Re,Re=>c==null?void 0:c[Re],()=>[o(Ne)]),$((Re,pt,$t,xt)=>{Je(xe,1,fv(o(Ce).enabled?"":"disabled"),"svelte-i091qn"),Le(xe,"tabindex",o(Ne)===o(l)?0:-1),Le(xe,"aria-selected",Re),Le(Ge,"aria-label",`Select ${o(Ce).name}`),Cn(Ge,pt),N(st,o(Ce).name),N(vt,$t),N(mt,xt),Cn(ne,o(Ce).enabled)},[()=>o(i).has(o(Ce).id),()=>o(i).has(o(Ce).id),()=>eo(new Date(o(Ce).dueAt)),()=>Y(o(Ce))]),Bt("focus",xe,()=>T(l,o(Ne),!0)),S(dt,xe)}),$(()=>{Cn(He,o(w)),He.disabled=o(f).length===0}),S(ue,Ee)};j(ee,ue=>{o(f).length===0?ue(me):ue(_e,!1)})}S(O,q)};j(Be,O=>{o(d).length===0?O(de):O(B,!1)})}var A=v(ae,2);{var F=O=>{var q=bp(),ee=h(q),me=v(h(ee),2),_e=h(me),ue=v(me,2),Ee=h(ue);Ee.__click=x;var Ae=v(Ee,2);Ae.__click=_,$(()=>N(_e,`Are you sure you want to delete "${o(t).name??""}"? This action cannot be undone.`)),S(O,q)};j(A,O=>{o(t)&&O(F)})}var K=v(A,2);{var ie=O=>{var q=_p(),ee=h(q),me=v(h(ee),2),_e=h(me),ue=v(me,2),Ee=h(ue);Ee.__click=H;var Ae=v(Ee,2);Ae.__click=L,$(()=>N(_e,`Are you sure you want to delete ${o(i).size??""} task${o(i).size===1?"":"s"}? This action cannot be undone.`)),S(O,q)};j(K,O=>{o(s)&&O(ie)})}$(()=>{U.disabled=o(d).length===0,N(be,`${o(i).size??""} selected`),ce.disabled=!o(y),Ie.disabled=!o(y),Me.disabled=!o(y)}),ut(U,()=>o(r),O=>T(r,O)),S(n,oe),ft()}Tt(["click","keydown","change"]);var Tp=C('<div class="timeline-tab__empty svelte-11jqy0n"><p> </p></div>'),Sp=C('<span class="timeline-task__meta-item svelte-11jqy0n"> </span>'),xp=C('<span class="timeline-task__meta-item svelte-11jqy0n"> </span>'),Dp=C('<span class="timeline-task__meta-item svelte-11jqy0n"> </span>'),Ep=C('<div class="timeline-task svelte-11jqy0n"><div class="timeline-task__time svelte-11jqy0n"> </div> <div class="timeline-task__content svelte-11jqy0n"><div class="timeline-task__name svelte-11jqy0n"> </div> <div class="timeline-task__meta svelte-11jqy0n"><!> <!> <!></div></div></div>'),Ap=C('<div class="timeline-day svelte-11jqy0n"><div class="timeline-day__date svelte-11jqy0n"><div class="timeline-day__date-label svelte-11jqy0n"> </div> <div class="timeline-day__weekday svelte-11jqy0n"> </div></div> <div class="timeline-day__tasks svelte-11jqy0n"></div></div>'),Cp=C('<div class="timeline-tab__timeline svelte-11jqy0n"></div>'),Ip=C('<div class="timeline-tab svelte-11jqy0n"><div class="timeline-tab__header svelte-11jqy0n"><h2 class="timeline-tab__title svelte-11jqy0n">Scheduled Timeline</h2> <p class="timeline-tab__subtitle svelte-11jqy0n"> </p></div> <div class="timeline-tab__content svelte-11jqy0n"><!></div></div>');function Mp(n,e){ht(e,!0);let t=an(e,"days",3,30);function s(_){const{frequency:x}=_;if(x.type==="weekly"){const D=[...x.weekdays].sort((E,R)=>E-R).join(",");return`weekly:${x.interval}:${x.time??""}:${D}`}return x.type==="monthly"?`monthly:${x.interval}:${x.time??""}:${x.dayOfMonth}`:x.type==="yearly"?`yearly:${x.interval}:${x.time??""}:${x.month}:${x.dayOfMonth}`:`daily:${x.interval}:${x.time??""}`}function r(_,x){const D=_.map(E=>`${E.id}:${E.enabled}:${E.dueAt}:${s(E)}`).join("|");return`${x}:${D}`}function a(_,x){const D=to(new Date),E=Qv(In(D,x-1)),R=24*60*60*1e3,L=Zv(D,x).map(H=>({date:H,tasks:[]}));for(const H of _.filter(Y=>Y.enabled)){const Y=new Date(H.dueAt),X=e.recurrenceEngine.getOccurrencesInRange(D,E,H.frequency,Y);for(const oe of X){const ae=to(oe),ve=Math.floor((ae.getTime()-D.getTime())/R);ve>=0&&ve<x&&L[ve].tasks.push({task:H,occurrence:oe})}}for(const H of L)H.tasks.sort((Y,X)=>Y.occurrence.getTime()-X.occurrence.getTime());return L}const i=(()=>{let _="",x=[];return{get(D,E){const R=r(D,E);return R===_||(_=R,x=a(D,E)),x}}})(),l=J(()=>i.get(e.tasks,t())),c=J(()=>o(l).some(_=>_.tasks.length>0));var u=Ip(),d=h(u),f=v(h(d),2),p=h(f),y=v(d,2),w=h(y);{var m=_=>{var x=Tp(),D=h(x),E=h(D);$(()=>N(E,`No tasks scheduled in the next ${t()??""} days.`)),S(_,x)},g=_=>{var x=Cp();We(x,21,()=>o(l),D=>D.date.toISOString(),(D,E)=>{var R=lt(),P=Ve(R);{var L=H=>{var Y=Ap(),X=h(Y),oe=h(X),ae=h(oe),ve=v(oe,2),Q=h(ve),Z=v(X,2);We(Z,21,()=>o(E).tasks,({task:U,occurrence:M})=>U.id+M.toISOString(),(U,M)=>{let I=()=>o(M).task,G=()=>o(M).occurrence;var se=Ep(),be=h(se),pe=h(be),ce=v(be,2),Ie=h(ce),Me=h(Ie),Be=v(Ie,2),de=h(Be);{var B=O=>{var q=Sp(),ee=h(q);$(()=>N(ee,` ${I().linkedBlockId??""}`)),S(O,q)};j(de,O=>{I().linkedBlockId&&O(B)})}var A=v(de,2);{var F=O=>{var q=xp(),ee=h(q);$(()=>N(ee,` ${I().priority??""}`)),S(O,q)};j(A,O=>{I().priority&&O(F)})}var K=v(A,2);{var ie=O=>{var q=Dp(),ee=h(q);$(me=>N(ee,` ${me??""}`),[()=>I().tags.join(", ")]),S(O,q)};j(K,O=>{var q;(q=I().tags)!=null&&q.length&&O(ie)})}$(O=>{N(pe,O),N(Me,I().name)},[()=>Hv(G())]),S(U,se)}),$((U,M)=>{N(ae,U),N(Q,M)},[()=>Gv(o(E).date),()=>o(E).date.toLocaleDateString(void 0,{weekday:"short"})]),S(H,Y)};j(P,H=>{o(E).tasks.length>0&&H(L)})}S(D,R)}),S(_,x)};j(w,_=>{o(c)?_(g,!1):_(m)})}$(()=>N(p,`Next ${t()??""} days`)),S(n,u),ft()}var Op=C('<span class="leaderboard-item__badge svelte-1ptoc1q"> Best</span>'),Rp=C('<div class="leaderboard-item svelte-1ptoc1q"><div class="leaderboard-item__rank svelte-1ptoc1q"></div> <div class="leaderboard-item__name svelte-1ptoc1q"> </div> <div class="leaderboard-item__value svelte-1ptoc1q"> <!></div></div>'),Np=C('<div class="analytics-section svelte-1ptoc1q"><h3 class="analytics-section__title svelte-1ptoc1q"> Current Streaks</h3> <div class="leaderboard svelte-1ptoc1q"></div></div>'),Pp=C('<div class="health-item svelte-1ptoc1q"><div class="health-item__name svelte-1ptoc1q"> </div> <div class="health-item__bar-container svelte-1ptoc1q"><div class="health-item__bar svelte-1ptoc1q"></div> <div class="health-item__score svelte-1ptoc1q"> </div></div></div>'),Lp=C('<h4 class="subsection-title svelte-1ptoc1q"> Best Performing</h4> <div class="health-list svelte-1ptoc1q"></div>',1),Fp=C('<div class="health-item svelte-1ptoc1q"><div class="health-item__name svelte-1ptoc1q"> </div> <div class="health-item__bar-container svelte-1ptoc1q"><div class="health-item__bar svelte-1ptoc1q"></div> <div class="health-item__score svelte-1ptoc1q"> </div></div></div>'),qp=C('<h4 class="subsection-title svelte-1ptoc1q"> Needs Attention</h4> <div class="health-list svelte-1ptoc1q"></div>',1),Up=C('<div class="activity-item svelte-1ptoc1q"><div class="activity-item__icon svelte-1ptoc1q"></div> <div class="activity-item__details svelte-1ptoc1q"><div class="activity-item__name svelte-1ptoc1q"> </div> <div class="activity-item__time svelte-1ptoc1q"> </div></div></div>'),Bp=C('<div class="analytics-section svelte-1ptoc1q"><h3 class="analytics-section__title svelte-1ptoc1q">Recent Activity</h3> <div class="activity-list svelte-1ptoc1q"></div></div>'),zp=C('<div class="analytics-tab svelte-1ptoc1q"><div class="analytics-tab__header svelte-1ptoc1q"><h2 class="analytics-tab__title svelte-1ptoc1q">Task Analytics</h2> <p class="analytics-tab__subtitle svelte-1ptoc1q">Performance insights and statistics</p></div> <div class="analytics-tab__content svelte-1ptoc1q"><div class="analytics-section svelte-1ptoc1q"><h3 class="analytics-section__title svelte-1ptoc1q">Overall Performance</h3> <div class="stats-grid svelte-1ptoc1q"><div class="stat-card svelte-1ptoc1q"><div class="stat-card__value svelte-1ptoc1q"> </div> <div class="stat-card__label svelte-1ptoc1q">Total Completions</div></div> <div class="stat-card svelte-1ptoc1q"><div class="stat-card__value svelte-1ptoc1q"> </div> <div class="stat-card__label svelte-1ptoc1q">Total Misses</div></div> <div class="stat-card stat-card--highlight svelte-1ptoc1q"><div class="stat-card__value svelte-1ptoc1q"> </div> <div class="stat-card__label svelte-1ptoc1q">Completion Rate</div></div></div></div> <!> <div class="analytics-section svelte-1ptoc1q"><h3 class="analytics-section__title svelte-1ptoc1q">Task Health Scores</h3> <!> <!></div> <!></div></div>');function $p(n,e){ht(e,!0);const t=J(()=>()=>{let U=0,M=0;for(const se of e.tasks)U+=se.completionCount||0,M+=se.missCount||0;const I=U+M,G=I>0?U/I*100:100;return{totalCompletions:U,totalMisses:M,completionRate:Math.round(G)}}),s=J(()=>()=>[...e.tasks].filter(U=>(U.currentStreak||0)>0).sort((U,M)=>(M.currentStreak||0)-(U.currentStreak||0)).slice(0,10)),r=J(()=>()=>[...e.tasks].map(U=>({task:U,health:ed(U)})).sort((U,M)=>U.health-M.health)),a=J(()=>()=>o(r)().slice(-5).reverse()),i=J(()=>()=>o(r)().slice(0,5)),l=J(()=>()=>{const U=[];for(const M of e.tasks)if(M.recentCompletions&&M.recentCompletions.length>0)for(const I of M.recentCompletions)U.push({task:M,completedAt:I});return U.sort((M,I)=>new Date(I.completedAt).getTime()-new Date(M.completedAt).getTime()).slice(0,10)});function c(U){return new Date(U).toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function u(U){return U>=80?"#10b981":U>=60?"#3b82f6":U>=40?"#f59e0b":"#ef4444"}var d=zp(),f=v(h(d),2),p=h(f),y=v(h(p),2),w=h(y),m=h(w),g=h(m),_=v(w,2),x=h(_),D=h(x),E=v(_,2),R=h(E),P=h(R),L=v(p,2);{var H=U=>{var M=Np(),I=v(h(M),2);We(I,21,()=>o(s)(),yt,(G,se,be)=>{var pe=Rp(),ce=h(pe);ce.textContent=`#${be+1}`;var Ie=v(ce,2),Me=h(Ie),Be=v(Ie,2),de=h(Be),B=v(de);{var A=F=>{var K=Op();S(F,K)};j(B,F=>{o(se).bestStreak&&o(se).currentStreak===o(se).bestStreak&&F(A)})}$(()=>{N(Me,o(se).name),N(de,`${o(se).currentStreak??""} day${o(se).currentStreak!==1?"s":""} `)}),S(G,pe)}),S(U,M)};j(L,U=>{o(s)().length>0&&U(H)})}var Y=v(L,2),X=v(h(Y),2);{var oe=U=>{var M=Lp(),I=v(Ve(M),2);We(I,21,()=>o(a)(),yt,(G,se)=>{let be=()=>o(se).task,pe=()=>o(se).health;var ce=Pp(),Ie=h(ce),Me=h(Ie),Be=v(Ie,2),de=h(Be),B=v(de,2),A=h(B);$(F=>{N(Me,be().name),Ns(de,`width: ${pe()??""}%; background-color: ${F??""}`),N(A,`${pe()??""}/100`)},[()=>u(pe())]),S(G,ce)}),S(U,M)};j(X,U=>{o(a)().length>0&&U(oe)})}var ae=v(X,2);{var ve=U=>{var M=qp(),I=v(Ve(M),2);We(I,21,()=>o(i)(),yt,(G,se)=>{let be=()=>o(se).task,pe=()=>o(se).health;var ce=Fp(),Ie=h(ce),Me=h(Ie),Be=v(Ie,2),de=h(Be),B=v(de,2),A=h(B);$(F=>{N(Me,be().name),Ns(de,`width: ${pe()??""}%; background-color: ${F??""}`),N(A,`${pe()??""}/100`)},[()=>u(pe())]),S(G,ce)}),S(U,M)};j(ae,U=>{o(i)().length>0&&o(i)()[0].health<80&&U(ve)})}var Q=v(Y,2);{var Z=U=>{var M=Bp(),I=v(h(M),2);We(I,21,()=>o(l)(),yt,(G,se)=>{let be=()=>o(se).task,pe=()=>o(se).completedAt;var ce=Up(),Ie=v(h(ce),2),Me=h(Ie),Be=h(Me),de=v(Me,2),B=h(de);$(A=>{N(Be,be().name),N(B,A)},[()=>c(pe())]),S(G,ce)}),S(U,M)};j(Q,U=>{o(l)().length>0&&U(Z)})}$((U,M,I)=>{N(g,U),N(D,M),N(P,`${I??""}%`)},[()=>o(t)().totalCompletions,()=>o(t)().totalMisses,()=>o(t)().completionRate]),S(n,d),ft()}var Yp=C('<div class="inbox-tab__empty svelte-1jnb97y"><p class="svelte-1jnb97y"> No tasks in inbox</p> <p class="inbox-tab__empty-subtitle svelte-1jnb97y">Create your first task or schedule your existing tasks!</p></div>'),jp=C('<div class="inbox-tab__card-wrapper svelte-1jnb97y" role="listitem"><!></div>'),Wp=C('<div class="inbox-tab svelte-1jnb97y"><div class="inbox-tab__header svelte-1jnb97y"><h2 class="inbox-tab__title svelte-1jnb97y">Inbox</h2> <p class="inbox-tab__subtitle svelte-1jnb97y"> </p></div> <div class="inbox-tab__content svelte-1jnb97y" role="list" aria-label="Inbox tasks"><!></div></div>');function Hp(n,e){ht(e,!0);const t=J(()=>e.tasks.filter(m=>m.status!=="done"&&m.status!=="cancelled"&&!m.dueAt&&!m.scheduledAt&&!m.startAt).sort((m,g)=>new Date(g.createdAt).getTime()-new Date(m.createdAt).getTime()));let s=V(0),r=De([]);kt(()=>{o(s)>=o(t).length&&T(s,Math.max(0,o(t).length-1),!0)});function a(m){var _;if(o(t).length===0)return;const g=Math.max(0,Math.min(m,o(t).length-1));T(s,g,!0),(_=r[g])==null||_.focus()}function i(m,g){m.key==="ArrowDown"?(m.preventDefault(),a(g+1)):m.key==="ArrowUp"?(m.preventDefault(),a(g-1)):m.key==="Enter"&&e.onEdit?(m.preventDefault(),e.onEdit(o(t)[g])):m.key===" "&&e.onDone&&(m.preventDefault(),e.onDone(o(t)[g]))}var l=Wp(),c=h(l),u=v(h(c),2),d=h(u),f=v(c,2),p=h(f);{var y=m=>{var g=Yp();S(m,g)},w=m=>{var g=lt(),_=Ve(g);We(_,19,()=>o(t),x=>x.id,(x,D,E)=>{var R=jp();R.__keydown=L=>i(L,o(E));var P=h(R);qr(P,{get task(){return o(D)},get onEdit(){return e.onEdit},get onDone(){return e.onDone},get onDelete(){return e.onDelete}}),Ps(R,(L,H)=>r[H]=L,L=>r==null?void 0:r[L],()=>[o(E)]),$(()=>Le(R,"tabindex",o(E)===o(s)?0:-1)),Bt("focus",R,()=>T(s,o(E),!0)),S(x,R)}),S(m,g)};j(p,m=>{o(t).length===0?m(y):m(w,!1)})}$(()=>N(d,`${o(t).length??""} task${o(t).length!==1?"s":""} without dates`)),S(n,l),ft()}Tt(["keydown"]);var Gp=C('<div class="upcoming-tab__empty svelte-102jr7u"><p class="svelte-102jr7u"> </p> <p class="upcoming-tab__empty-subtitle svelte-102jr7u">You have a clear schedule ahead!</p></div>'),Kp=C('<div class="upcoming-tab__card-wrapper svelte-102jr7u" role="listitem"><!></div>'),Vp=C('<div class="upcoming-tab__date-group svelte-102jr7u"><h3 class="upcoming-tab__date-header svelte-102jr7u"> </h3> <!></div>'),Qp=C('<div class="upcoming-tab svelte-102jr7u"><div class="upcoming-tab__header svelte-102jr7u"><h2 class="upcoming-tab__title svelte-102jr7u">Upcoming</h2> <p class="upcoming-tab__subtitle svelte-102jr7u"> </p></div> <div class="upcoming-tab__content svelte-102jr7u" role="list" aria-label="Upcoming tasks"><!></div></div>');function Xp(n,e){ht(e,!0);let t=an(e,"daysAhead",3,7);const s=new Date;s.setHours(0,0,0,0);const r=new Date(s);r.setDate(r.getDate()+t());const a=J(()=>e.tasks.filter(D=>{if(D.status==="done"||D.status==="cancelled"||!D.dueAt)return!1;const E=new Date(D.dueAt);return E.setHours(0,0,0,0),E>s&&E<=r}).sort((D,E)=>new Date(D.dueAt).getTime()-new Date(E.dueAt).getTime())),i=J(()=>()=>{const D=new Map;return o(a).forEach(E=>{const R=new Date(E.dueAt);R.setHours(0,0,0,0);const P=R.toISOString().split("T")[0];D.has(P)||D.set(P,[]),D.get(P).push(E)}),D});function l(D){const E=new Date(D),R=Math.floor((E.getTime()-s.getTime())/(1e3*60*60*24)),P=E.toLocaleDateString("en-US",{weekday:"long"}),L=E.toLocaleDateString("en-US",{month:"short",day:"numeric"});return R===1?`Tomorrow - ${P}, ${L}`:`${P}, ${L} (in ${R} days)`}let c=V(0),u=De([]);kt(()=>{o(c)>=o(a).length&&T(c,Math.max(0,o(a).length-1),!0)});function d(D,E){D.key==="ArrowDown"?(D.preventDefault(),T(c,Math.min(o(c)+1,o(a).length-1),!0)):D.key==="ArrowUp"?(D.preventDefault(),T(c,Math.max(o(c)-1,0),!0)):D.key==="Enter"&&e.onEdit?(D.preventDefault(),e.onEdit(o(a)[E])):D.key===" "&&e.onDone&&(D.preventDefault(),e.onDone(o(a)[E]))}var f=Qp(),p=h(f),y=v(h(p),2),w=h(y),m=v(p,2),g=h(m);{var _=D=>{var E=Gp(),R=h(E),P=h(R);$(()=>N(P,` No tasks scheduled for the next ${t()??""} days`)),S(D,E)},x=D=>{var E=lt(),R=Ve(E);We(R,17,()=>[...o(i).entries()],yt,(P,L)=>{var H=J(()=>eu(o(L),2));let Y=()=>o(H)[0],X=()=>o(H)[1];var oe=Vp(),ae=h(oe),ve=h(ae),Q=v(ae,2);We(Q,19,X,Z=>Z.id,(Z,U)=>{const M=J(()=>o(a).indexOf(o(U)));var I=Kp();I.__keydown=se=>d(se,o(M));var G=h(I);qr(G,{get task(){return o(U)},get onEdit(){return e.onEdit},get onDone(){return e.onDone},get onDelete(){return e.onDelete}}),Ps(I,(se,be)=>u[be]=se,se=>u==null?void 0:u[se],()=>[o(M)]),$(()=>Le(I,"tabindex",o(M)===o(c)?0:-1)),Bt("focus",I,()=>T(c,o(M),!0)),S(Z,I)}),$(Z=>N(ve,Z),[()=>l(Y())]),S(P,oe)}),S(D,E)};j(g,D=>{o(a).length===0?D(_):D(x,!1)})}$(()=>N(w,`${o(a).length??""} task${o(a).length!==1?"s":""} in the next ${t()??""} days`)),S(n,f),ft()}Tt(["keydown"]);var Zp=C('<div class="done-tab__empty svelte-z9ywjc"><p class="svelte-z9ywjc"> No completed tasks yet</p> <p class="done-tab__empty-subtitle svelte-z9ywjc">Complete some tasks to see them here!</p></div>'),Jp=C('<button class="done-tab__uncomplete-btn svelte-z9ywjc" title="Mark as not done">Undo</button>'),eg=C('<div class="done-tab__card-wrapper svelte-z9ywjc" role="listitem"><div class="done-tab__task-header svelte-z9ywjc"><span class="done-tab__done-date svelte-z9ywjc"> </span> <!></div> <!></div>'),tg=C('<div class="done-tab__pagination svelte-z9ywjc"><button class="done-tab__page-btn svelte-z9ywjc"> Previous</button> <span class="done-tab__page-info svelte-z9ywjc"> </span> <button class="done-tab__page-btn svelte-z9ywjc">Next </button></div>'),sg=C("<!> <!>",1),ng=C('<div class="done-tab svelte-z9ywjc"><div class="done-tab__header svelte-z9ywjc"><h2 class="done-tab__title svelte-z9ywjc">Done</h2> <p class="done-tab__subtitle svelte-z9ywjc"> </p></div> <div class="done-tab__content svelte-z9ywjc" role="list" aria-label="Completed tasks"><!></div></div>');function rg(n,e){ht(e,!0);let t=an(e,"daysBack",3,30),s=V(0);const r=50,a=new Date;a.setDate(a.getDate()-t()),a.setHours(0,0,0,0);const i=J(()=>e.tasks.filter(L=>L.status!=="done"||!L.doneAt?!1:new Date(L.doneAt)>=a).sort((L,H)=>new Date(H.doneAt).getTime()-new Date(L.doneAt).getTime())),l=J(()=>Math.ceil(o(i).length/r)),c=J(()=>o(i).slice(o(s)*r,(o(s)+1)*r));kt(()=>{o(s)>=o(l)&&o(l)>0&&T(s,o(l)-1)});function u(){o(s)<o(l)-1&&vl(s)}function d(){o(s)>0&&vl(s,-1)}function f(L){const H=new Date(L),Y=new Date,X=Y.getTime()-H.getTime(),oe=Math.floor(X/(1e3*60*60*24));return oe===0?"Today":oe===1?"Yesterday":oe<7?`${oe} days ago`:H.toLocaleDateString("en-US",{month:"short",day:"numeric",year:H.getFullYear()!==Y.getFullYear()?"numeric":void 0})}let p=V(0),y=De([]);kt(()=>{o(p)>=o(c).length&&T(p,Math.max(0,o(c).length-1),!0)});function w(L,H){L.key==="ArrowDown"?(L.preventDefault(),T(p,Math.min(o(p)+1,o(c).length-1),!0)):L.key==="ArrowUp"?(L.preventDefault(),T(p,Math.max(o(p)-1,0),!0)):L.key==="Enter"&&e.onEdit&&(L.preventDefault(),e.onEdit(o(c)[H]))}var m=ng(),g=h(m),_=v(h(g),2),x=h(_),D=v(g,2),E=h(D);{var R=L=>{var H=Zp();S(L,H)},P=L=>{var H=sg(),Y=Ve(H);We(Y,19,()=>o(c),ae=>ae.id,(ae,ve,Q)=>{var Z=eg();Z.__keydown=pe=>w(pe,o(Q));var U=h(Z),M=h(U),I=h(M),G=v(M,2);{var se=pe=>{var ce=Jp();ce.__click=()=>e.onUncomplete(o(ve)),S(pe,ce)};j(G,pe=>{e.onUncomplete&&pe(se)})}var be=v(U,2);qr(be,{get task(){return o(ve)},get onEdit(){return e.onEdit},get onDelete(){return e.onDelete}}),Ps(Z,(pe,ce)=>y[ce]=pe,pe=>y==null?void 0:y[pe],()=>[o(Q)]),$(pe=>{Le(Z,"tabindex",o(Q)===o(p)?0:-1),N(I,`Completed ${pe??""}`)},[()=>f(o(ve).doneAt)]),Bt("focus",Z,()=>T(p,o(Q),!0)),S(ae,Z)});var X=v(Y,2);{var oe=ae=>{var ve=tg(),Q=h(ve);Q.__click=d;var Z=v(Q,2),U=h(Z),M=v(Z,2);M.__click=u,$(()=>{Q.disabled=o(s)===0,N(U,`Page ${o(s)+1} of ${o(l)??""}`),M.disabled=o(s)>=o(l)-1}),S(ae,ve)};j(X,ae=>{o(l)>1&&ae(oe)})}S(L,H)};j(E,L=>{o(i).length===0?L(R):L(P,!1)})}$(()=>N(x,`${o(i).length??""} completed task${o(i).length!==1?"s":""} in the last ${t()??""} days`)),S(n,m),ft()}Tt(["keydown","click"]);var ag=C('<div class="projects-tab__empty svelte-8ybpha"><p class="svelte-8ybpha"> No active projects</p> <p class="projects-tab__empty-subtitle svelte-8ybpha">Create tasks to see them organized by project!</p></div>'),ig=C('<div class="projects-tab__card-wrapper svelte-8ybpha" role="listitem"><!></div>'),og=C('<div class="projects-tab__project-tasks svelte-8ybpha" role="list"></div>'),lg=C('<div class="projects-tab__project svelte-8ybpha"><button class="projects-tab__project-header svelte-8ybpha"><span class="projects-tab__expand-icon svelte-8ybpha"> </span> <span class="projects-tab__project-name svelte-8ybpha"> </span> <span class="projects-tab__project-count svelte-8ybpha"> </span></button> <!></div>'),cg=C('<div class="projects-tab svelte-8ybpha"><div class="projects-tab__header svelte-8ybpha"><div class="projects-tab__header-main svelte-8ybpha"><h2 class="projects-tab__title svelte-8ybpha">Projects</h2> <p class="projects-tab__subtitle svelte-8ybpha"> </p></div> <div class="projects-tab__actions svelte-8ybpha"><button class="projects-tab__action-btn svelte-8ybpha">Expand All</button> <button class="projects-tab__action-btn svelte-8ybpha">Collapse All</button></div></div> <div class="projects-tab__content svelte-8ybpha" role="region" aria-label="Project task lists"><!></div></div>');function ug(n,e){ht(e,!0);const t=J(()=>()=>{const Y=new Map;return e.tasks.filter(oe=>oe.status!=="done"&&oe.status!=="cancelled").forEach(oe=>{const ae=oe.linkedBlockPath||"Uncategorized";Y.has(ae)||Y.set(ae,[]),Y.get(ae).push(oe)}),Y.forEach(oe=>{oe.sort((ae,ve)=>!ae.dueAt&&!ve.dueAt?0:ae.dueAt?ve.dueAt?new Date(ae.dueAt).getTime()-new Date(ve.dueAt).getTime():-1:1)}),new Map([...Y.entries()].sort(([oe],[ae])=>oe.localeCompare(ae)))}),s=J(()=>[...o(t).values()].reduce((Y,X)=>Y+X.length,0));let r=V(De(new Set([...o(t).keys()])));function a(Y){const X=new Set(o(r));X.has(Y)?X.delete(Y):X.add(Y),T(r,X,!0)}function i(){T(r,new Set([...o(t).keys()]),!0)}function l(){T(r,new Set,!0)}let c=V(0),u=De([]);const d=J(()=>()=>{const Y=[];return o(t).forEach((X,oe)=>{o(r).has(oe)&&Y.push(...X)}),Y});kt(()=>{o(c)>=o(d).length&&T(c,Math.max(0,o(d).length-1),!0)});function f(Y,X){Y.key==="ArrowDown"?(Y.preventDefault(),T(c,Math.min(o(c)+1,o(d).length-1),!0)):Y.key==="ArrowUp"?(Y.preventDefault(),T(c,Math.max(o(c)-1,0),!0)):Y.key==="Enter"&&e.onEdit?(Y.preventDefault(),e.onEdit(o(d)[X])):Y.key===" "&&e.onDone&&(Y.preventDefault(),e.onDone(o(d)[X]))}function p(Y){const X=Y.split("/");return X[X.length-1]||Y}var y=cg(),w=h(y),m=h(w),g=v(h(m),2),_=h(g),x=v(m,2),D=h(x);D.__click=i;var E=v(D,2);E.__click=l;var R=v(w,2),P=h(R);{var L=Y=>{var X=ag();S(Y,X)},H=Y=>{var X=lt(),oe=Ve(X);We(oe,17,()=>[...o(t).entries()],yt,(ae,ve)=>{var Q=J(()=>eu(o(ve),2));let Z=()=>o(Q)[0],U=()=>o(Q)[1];var M=lg(),I=h(M);I.__click=()=>a(Z());var G=h(I),se=h(G),be=v(G,2),pe=h(be),ce=v(be,2),Ie=h(ce),Me=v(I,2);{var Be=de=>{var B=og();We(B,23,U,A=>A.id,(A,F)=>{const K=J(()=>o(d).indexOf(o(F)));var ie=ig();ie.__keydown=q=>f(q,o(K));var O=h(ie);qr(O,{get task(){return o(F)},get onEdit(){return e.onEdit},get onDone(){return e.onDone},get onDelete(){return e.onDelete}}),Ps(ie,(q,ee)=>u[ee]=q,q=>u==null?void 0:u[q],()=>[o(K)]),$(()=>Le(ie,"tabindex",o(K)===o(c)?0:-1)),Bt("focus",ie,()=>T(c,o(K),!0)),S(A,ie)}),$(A=>Le(B,"aria-label",A),[()=>`Tasks for ${p(Z())}`]),S(de,B)};j(Me,de=>{o(r).has(Z())&&de(Be)})}$((de,B)=>{N(se,de),Le(be,"title",Z()),N(pe,B),N(Ie,U().length)},[()=>o(r).has(Z())?"":"",()=>p(Z())]),S(ae,M)}),S(Y,X)};j(P,Y=>{o(t).size===0?Y(L):Y(H,!1)})}$(()=>N(_,`${o(s)??""} task${o(s)!==1?"s":""} in ${o(t).size??""} project${o(t).size!==1?"s":""}`)),S(n,y),ft()}Tt(["click","keydown"]);class Cs extends Error{constructor(e,t,s,r){super(e),this.line=t,this.column=s,this.suggestion=r,this.name="QuerySyntaxError"}}class fr extends Error{constructor(e,t){super(e),this.cause=t,this.name="QueryExecutionError"}}var wt=(n=>(n.TODO="TODO",n.IN_PROGRESS="IN_PROGRESS",n.DONE="DONE",n.CANCELLED="CANCELLED",n.NON_TASK="NON_TASK",n.EMPTY="EMPTY",n))(wt||{});const qs=class qs{constructor(e){b(this,"symbol");b(this,"name");b(this,"nextStatusSymbol");b(this,"type");this.symbol=e.symbol,this.name=e.name,this.nextStatusSymbol=e.nextStatusSymbol,this.type=e.type}static getTypeForUnknownSymbol(e){switch(e){case"x":case"X":return"DONE";case"/":return"IN_PROGRESS";case"-":return"CANCELLED";case" ":default:return"TODO"}}isCompleted(){return this.type==="DONE"||this.type==="CANCELLED"}};b(qs,"TODO",new qs({symbol:" ",name:"Todo",nextStatusSymbol:"x",type:"TODO"})),b(qs,"DONE",new qs({symbol:"x",name:"Done",nextStatusSymbol:" ",type:"DONE"})),b(qs,"IN_PROGRESS",new qs({symbol:"/",name:"In Progress",nextStatusSymbol:"x",type:"IN_PROGRESS"})),b(qs,"CANCELLED",new qs({symbol:"-",name:"Cancelled",nextStatusSymbol:" ",type:"CANCELLED"}));let Qs=qs;var Ke;(function(n){n[n.AM=0]="AM",n[n.PM=1]="PM"})(Ke||(Ke={}));var ct;(function(n){n[n.SUNDAY=0]="SUNDAY",n[n.MONDAY=1]="MONDAY",n[n.TUESDAY=2]="TUESDAY",n[n.WEDNESDAY=3]="WEDNESDAY",n[n.THURSDAY=4]="THURSDAY",n[n.FRIDAY=5]="FRIDAY",n[n.SATURDAY=6]="SATURDAY"})(ct||(ct={}));var bs;(function(n){n[n.JANUARY=1]="JANUARY",n[n.FEBRUARY=2]="FEBRUARY",n[n.MARCH=3]="MARCH",n[n.APRIL=4]="APRIL",n[n.MAY=5]="MAY",n[n.JUNE=6]="JUNE",n[n.JULY=7]="JULY",n[n.AUGUST=8]="AUGUST",n[n.SEPTEMBER=9]="SEPTEMBER",n[n.OCTOBER=10]="OCTOBER",n[n.NOVEMBER=11]="NOVEMBER",n[n.DECEMBER=12]="DECEMBER"})(bs||(bs={}));function lr(n,e){n.assign("day",e.getDate()),n.assign("month",e.getMonth()+1),n.assign("year",e.getFullYear())}function sd(n,e){n.assign("hour",e.getHours()),n.assign("minute",e.getMinutes()),n.assign("second",e.getSeconds()),n.assign("millisecond",e.getMilliseconds()),n.assign("meridiem",e.getHours()<12?Ke.AM:Ke.PM)}function gr(n,e){n.imply("day",e.getDate()),n.imply("month",e.getMonth()+1),n.imply("year",e.getFullYear())}function Wo(n,e){n.imply("hour",e.getHours()),n.imply("minute",e.getMinutes()),n.imply("second",e.getSeconds()),n.imply("millisecond",e.getMilliseconds()),n.imply("meridiem",e.getHours()<12?Ke.AM:Ke.PM)}const dg={ACDT:630,ACST:570,ADT:-180,AEDT:660,AEST:600,AFT:270,AKDT:-480,AKST:-540,ALMT:360,AMST:-180,AMT:-240,ANAST:720,ANAT:720,AQTT:300,ART:-180,AST:-240,AWDT:540,AWST:480,AZOST:0,AZOT:-60,AZST:300,AZT:240,BNT:480,BOT:-240,BRST:-120,BRT:-180,BST:60,BTT:360,CAST:480,CAT:120,CCT:390,CDT:-300,CEST:120,CET:{timezoneOffsetDuringDst:2*60,timezoneOffsetNonDst:60,dstStart:n=>Yl(n,bs.MARCH,ct.SUNDAY,2),dstEnd:n=>Yl(n,bs.OCTOBER,ct.SUNDAY,3)},CHADT:825,CHAST:765,CKT:-600,CLST:-180,CLT:-240,COT:-300,CST:-360,CT:{timezoneOffsetDuringDst:-5*60,timezoneOffsetNonDst:-6*60,dstStart:n=>gn(n,bs.MARCH,ct.SUNDAY,2,2),dstEnd:n=>gn(n,bs.NOVEMBER,ct.SUNDAY,1,2)},CVT:-60,CXT:420,ChST:600,DAVT:420,EASST:-300,EAST:-360,EAT:180,ECT:-300,EDT:-240,EEST:180,EET:120,EGST:0,EGT:-60,EST:-300,ET:{timezoneOffsetDuringDst:-4*60,timezoneOffsetNonDst:-5*60,dstStart:n=>gn(n,bs.MARCH,ct.SUNDAY,2,2),dstEnd:n=>gn(n,bs.NOVEMBER,ct.SUNDAY,1,2)},FJST:780,FJT:720,FKST:-180,FKT:-240,FNT:-120,GALT:-360,GAMT:-540,GET:240,GFT:-180,GILT:720,GMT:0,GST:240,GYT:-240,HAA:-180,HAC:-300,HADT:-540,HAE:-240,HAP:-420,HAR:-360,HAST:-600,HAT:-90,HAY:-480,HKT:480,HLV:-210,HNA:-240,HNC:-360,HNE:-300,HNP:-480,HNR:-420,HNT:-150,HNY:-540,HOVT:420,ICT:420,IDT:180,IOT:360,IRDT:270,IRKST:540,IRKT:540,IRST:210,IST:330,JST:540,KGT:360,KRAST:480,KRAT:480,KST:540,KUYT:240,LHDT:660,LHST:630,LINT:840,MAGST:720,MAGT:720,MART:-510,MAWT:300,MDT:-360,MESZ:120,MEZ:60,MHT:720,MMT:390,MSD:240,MSK:180,MST:-420,MT:{timezoneOffsetDuringDst:-6*60,timezoneOffsetNonDst:-7*60,dstStart:n=>gn(n,bs.MARCH,ct.SUNDAY,2,2),dstEnd:n=>gn(n,bs.NOVEMBER,ct.SUNDAY,1,2)},MUT:240,MVT:300,MYT:480,NCT:660,NDT:-90,NFT:690,NOVST:420,NOVT:360,NPT:345,NST:-150,NUT:-660,NZDT:780,NZST:720,OMSST:420,OMST:420,PDT:-420,PET:-300,PETST:720,PETT:720,PGT:600,PHOT:780,PHT:480,PKT:300,PMDT:-120,PMST:-180,PONT:660,PST:-480,PT:{timezoneOffsetDuringDst:-7*60,timezoneOffsetNonDst:-8*60,dstStart:n=>gn(n,bs.MARCH,ct.SUNDAY,2,2),dstEnd:n=>gn(n,bs.NOVEMBER,ct.SUNDAY,1,2)},PWT:540,PYST:-180,PYT:-240,RET:240,SAMT:240,SAST:120,SBT:660,SCT:240,SGT:480,SRT:-180,SST:-660,TAHT:-600,TFT:300,TJT:300,TKT:780,TLT:540,TMT:300,TVT:720,ULAT:480,UTC:0,UYST:-120,UYT:-180,UZT:300,VET:-210,VLAST:660,VLAT:660,VUT:660,WAST:120,WAT:60,WEST:60,WESZ:60,WET:0,WEZ:0,WFT:720,WGST:-120,WGT:-180,WIB:420,WIT:540,WITA:480,WST:780,WT:0,YAKST:600,YAKT:600,YAPT:600,YEKST:360,YEKT:360};function gn(n,e,t,s,r=0){let a=0,i=0;for(;i<s;)a++,new Date(n,e-1,a).getDay()===t&&i++;return new Date(n,e-1,a,r)}function Yl(n,e,t,s=0){const r=t===0?7:t,a=new Date(n,e-1+1,1,12),i=a.getDay()===0?7:a.getDay();let l;return i===r?l=7:i<r?l=7+i-r:l=i-r,a.setDate(a.getDate()-l),new Date(n,e-1,a.getDate(),s)}function nd(n,e,t={}){if(n==null)return null;if(typeof n=="number")return n;const s=t[n]??dg[n];return s==null?null:typeof s=="number"?s:e==null?null:e>s.dstStart(e.getFullYear())&&!(e>s.dstEnd(e.getFullYear()))?s.timezoneOffsetDuringDst:s.timezoneOffsetNonDst}const hg={day:0,second:0,millisecond:0};function is(n,e){let t=new Date(n);if(e.y&&(e.year=e.y,delete e.y),e.mo&&(e.month=e.mo,delete e.mo),e.M&&(e.month=e.M,delete e.M),e.w&&(e.week=e.w,delete e.w),e.d&&(e.day=e.d,delete e.d),e.h&&(e.hour=e.h,delete e.h),e.m&&(e.minute=e.m,delete e.m),e.s&&(e.second=e.s,delete e.s),e.ms&&(e.millisecond=e.ms,delete e.ms),"year"in e){const s=Math.floor(e.year);t.setFullYear(t.getFullYear()+s);const r=e.year-s;r>0&&(e.month=(e==null?void 0:e.month)??0,e.month+=r*12)}if("quarter"in e){const s=Math.floor(e.quarter);t.setMonth(t.getMonth()+s*3)}if("month"in e){const s=Math.floor(e.month);t.setMonth(t.getMonth()+s);const r=e.month-s;r>0&&(e.week=(e==null?void 0:e.week)??0,e.week+=r*4)}if("week"in e){const s=Math.floor(e.week);t.setDate(t.getDate()+s*7);const r=e.week-s;r>0&&(e.day=(e==null?void 0:e.day)??0,e.day+=Math.round(r*7))}if("day"in e){const s=Math.floor(e.day);t.setDate(t.getDate()+s);const r=e.day-s;r>0&&(e.hour=(e==null?void 0:e.hour)??0,e.hour+=Math.round(r*24))}if("hour"in e){const s=Math.floor(e.hour);t.setHours(t.getHours()+s);const r=e.hour-s;r>0&&(e.minute=(e==null?void 0:e.minute)??0,e.minute+=Math.round(r*60))}if("minute"in e){const s=Math.floor(e.minute);t.setMinutes(t.getMinutes()+s);const r=e.minute-s;r>0&&(e.second=(e==null?void 0:e.second)??0,e.second+=Math.round(r*60))}if("second"in e){const s=Math.floor(e.second);t.setSeconds(t.getSeconds()+s);const r=e.second-s;r>0&&(e.millisecond=(e==null?void 0:e.millisecond)??0,e.millisecond+=Math.round(r*1e3))}if("millisecond"in e){const s=Math.floor(e.millisecond);t.setMilliseconds(t.getMilliseconds()+s)}return t}function ci(n){const e={};for(const t in n)e[t]=-n[t];return e}class tr{constructor(e,t){b(this,"instant");b(this,"timezoneOffset");this.instant=e??new Date,this.timezoneOffset=t??null}static fromDate(e){return new tr(e)}static fromInput(e,t){if(e instanceof Date)return tr.fromDate(e);const s=(e==null?void 0:e.instant)??new Date,r=nd(e==null?void 0:e.timezone,s,t);return new tr(s,r)}getDateWithAdjustedTimezone(){const e=new Date(this.instant);return this.timezoneOffset!==null&&e.setMinutes(e.getMinutes()-this.getSystemTimezoneAdjustmentMinute(this.instant)),e}getSystemTimezoneAdjustmentMinute(e,t){(!e||e.getTime()<0)&&(e=new Date);const s=-e.getTimezoneOffset(),r=t??this.timezoneOffset??s;return s-r}getTimezoneOffset(){return this.timezoneOffset??-this.instant.getTimezoneOffset()}}class rt{constructor(e,t){b(this,"knownValues");b(this,"impliedValues");b(this,"reference");b(this,"_tags",new Set);if(this.reference=e,this.knownValues={},this.impliedValues={},t)for(const r in t)this.knownValues[r]=t[r];const s=e.getDateWithAdjustedTimezone();this.imply("day",s.getDate()),this.imply("month",s.getMonth()+1),this.imply("year",s.getFullYear()),this.imply("hour",12),this.imply("minute",0),this.imply("second",0),this.imply("millisecond",0)}static createRelativeFromReference(e,t=hg){let s=is(e.getDateWithAdjustedTimezone(),t);const r=new rt(e);return r.addTag("result/relativeDate"),"hour"in t||"minute"in t||"second"in t||"millisecond"in t?(r.addTag("result/relativeDateAndTime"),sd(r,s),lr(r,s),r.assign("timezoneOffset",e.getTimezoneOffset())):(Wo(r,s),r.imply("timezoneOffset",e.getTimezoneOffset()),"day"in t?(r.assign("day",s.getDate()),r.assign("month",s.getMonth()+1),r.assign("year",s.getFullYear()),r.assign("weekday",s.getDay())):"week"in t?(r.assign("day",s.getDate()),r.assign("month",s.getMonth()+1),r.assign("year",s.getFullYear()),r.imply("weekday",s.getDay())):(r.imply("day",s.getDate()),"month"in t?(r.assign("month",s.getMonth()+1),r.assign("year",s.getFullYear())):(r.imply("month",s.getMonth()+1),"year"in t?r.assign("year",s.getFullYear()):r.imply("year",s.getFullYear())))),r}get(e){return e in this.knownValues?this.knownValues[e]:e in this.impliedValues?this.impliedValues[e]:null}isCertain(e){return e in this.knownValues}getCertainComponents(){return Object.keys(this.knownValues)}imply(e,t){return e in this.knownValues?this:(this.impliedValues[e]=t,this)}assign(e,t){return this.knownValues[e]=t,delete this.impliedValues[e],this}addDurationAsImplied(e){const t=this.dateWithoutTimezoneAdjustment(),s=is(t,e);return("day"in e||"week"in e||"month"in e||"year"in e)&&(this.delete(["day","weekday","month","year"]),this.imply("day",s.getDate()),this.imply("weekday",s.getDay()),this.imply("month",s.getMonth()+1),this.imply("year",s.getFullYear())),("second"in e||"minute"in e||"hour"in e)&&(this.delete(["second","minute","hour"]),this.imply("second",s.getSeconds()),this.imply("minute",s.getMinutes()),this.imply("hour",s.getHours())),this}delete(e){typeof e=="string"&&(e=[e]);for(const t of e)delete this.knownValues[t],delete this.impliedValues[t]}clone(){const e=new rt(this.reference);e.knownValues={},e.impliedValues={};for(const t in this.knownValues)e.knownValues[t]=this.knownValues[t];for(const t in this.impliedValues)e.impliedValues[t]=this.impliedValues[t];return e}isOnlyDate(){return!this.isCertain("hour")&&!this.isCertain("minute")&&!this.isCertain("second")}isOnlyTime(){return!this.isCertain("weekday")&&!this.isCertain("day")&&!this.isCertain("month")&&!this.isCertain("year")}isOnlyWeekdayComponent(){return this.isCertain("weekday")&&!this.isCertain("day")&&!this.isCertain("month")}isDateWithUnknownYear(){return this.isCertain("month")&&!this.isCertain("year")}isValidDate(){const e=this.dateWithoutTimezoneAdjustment();return!(e.getFullYear()!==this.get("year")||e.getMonth()!==this.get("month")-1||e.getDate()!==this.get("day")||this.get("hour")!=null&&e.getHours()!=this.get("hour")||this.get("minute")!=null&&e.getMinutes()!=this.get("minute"))}toString(){return`[ParsingComponents {
            tags: ${JSON.stringify(Array.from(this._tags).sort())}, 
            knownValues: ${JSON.stringify(this.knownValues)}, 
            impliedValues: ${JSON.stringify(this.impliedValues)}}, 
            reference: ${JSON.stringify(this.reference)}]`}date(){const e=this.dateWithoutTimezoneAdjustment(),t=this.reference.getSystemTimezoneAdjustmentMinute(e,this.get("timezoneOffset"));return new Date(e.getTime()+t*6e4)}addTag(e){return this._tags.add(e),this}addTags(e){for(const t of e)this._tags.add(t);return this}tags(){return new Set(this._tags)}dateWithoutTimezoneAdjustment(){const e=new Date(this.get("year"),this.get("month")-1,this.get("day"),this.get("hour"),this.get("minute"),this.get("second"),this.get("millisecond"));return e.setFullYear(this.get("year")),e}}class Ur{constructor(e,t,s,r,a){b(this,"refDate");b(this,"index");b(this,"text");b(this,"reference");b(this,"start");b(this,"end");this.reference=e,this.refDate=e.instant,this.index=t,this.text=s,this.start=r||new rt(e),this.end=a}clone(){const e=new Ur(this.reference,this.index,this.text);return e.start=this.start?this.start.clone():null,e.end=this.end?this.end.clone():null,e}date(){return this.start.date()}addTag(e){return this.start.addTag(e),this.end&&this.end.addTag(e),this}addTags(e){return this.start.addTags(e),this.end&&this.end.addTags(e),this}tags(){const e=new Set(this.start.tags());if(this.end)for(const t of this.end.tags())e.add(t);return e}toString(){const e=Array.from(this.tags()).sort();return`[ParsingResult {index: ${this.index}, text: '${this.text}', tags: ${JSON.stringify(e)} ...}]`}}function rd(n,e,t="\\s{0,5},?\\s{0,5}"){const s=e.replace(/\((?!\?)/g,"(?:");return`${n}${s}(?:${t}${s}){0,10}`}function fg(n){let e;return n instanceof Array?e=[...n]:n instanceof Map?e=Array.from(n.keys()):e=Object.keys(n),e}function Gs(n){return`(?:${fg(n).sort((t,s)=>s.length-t.length).join("|").replace(/\./g,"\\.")})`}function ad(n){return n<100&&(n>50?n=n+1900:n=n+2e3),n}function ui(n,e,t){let s=new Date(n);s.setMonth(t-1),s.setDate(e);const r=is(s,{year:1}),a=is(s,{year:-1});return Math.abs(r.getTime()-n.getTime())<Math.abs(s.getTime()-n.getTime())?s=r:Math.abs(a.getTime()-n.getTime())<Math.abs(s.getTime()-n.getTime())&&(s=a),s.getFullYear()}const so={sunday:0,sun:0,"sun.":0,monday:1,mon:1,"mon.":1,tuesday:2,tue:2,"tue.":2,wednesday:3,wed:3,"wed.":3,thursday:4,thurs:4,"thurs.":4,thur:4,"thur.":4,thu:4,"thu.":4,friday:5,fri:5,"fri.":5,saturday:6,sat:6,"sat.":6},id={january:1,february:2,march:3,april:4,may:5,june:6,july:7,august:8,september:9,october:10,november:11,december:12},Nn={...id,jan:1,"jan.":1,feb:2,"feb.":2,mar:3,"mar.":3,apr:4,"apr.":4,jun:6,"jun.":6,jul:7,"jul.":7,aug:8,"aug.":8,sep:9,"sep.":9,sept:9,"sept.":9,oct:10,"oct.":10,nov:11,"nov.":11,dec:12,"dec.":12},no={one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9,ten:10,eleven:11,twelve:12},ro={first:1,second:2,third:3,fourth:4,fifth:5,sixth:6,seventh:7,eighth:8,ninth:9,tenth:10,eleventh:11,twelfth:12,thirteenth:13,fourteenth:14,fifteenth:15,sixteenth:16,seventeenth:17,eighteenth:18,nineteenth:19,twentieth:20,"twenty first":21,"twenty-first":21,"twenty second":22,"twenty-second":22,"twenty third":23,"twenty-third":23,"twenty fourth":24,"twenty-fourth":24,"twenty fifth":25,"twenty-fifth":25,"twenty sixth":26,"twenty-sixth":26,"twenty seventh":27,"twenty-seventh":27,"twenty eighth":28,"twenty-eighth":28,"twenty ninth":29,"twenty-ninth":29,thirtieth:30,"thirty first":31,"thirty-first":31},od={second:"second",seconds:"second",minute:"minute",minutes:"minute",hour:"hour",hours:"hour",day:"day",days:"day",week:"week",weeks:"week",month:"month",months:"month",quarter:"quarter",quarters:"quarter",year:"year",years:"year"},di={s:"second",sec:"second",second:"second",seconds:"second",m:"minute",min:"minute",mins:"minute",minute:"minute",minutes:"minute",h:"hour",hr:"hour",hrs:"hour",hour:"hour",hours:"hour",d:"day",day:"day",days:"day",w:"week",week:"week",weeks:"week",mo:"month",mon:"month",mos:"month",month:"month",months:"month",qtr:"quarter",quarter:"quarter",quarters:"quarter",y:"year",yr:"year",year:"year",years:"year",...od},ld=`(?:${Gs(no)}|[0-9]+|[0-9]+\\.[0-9]+|half(?:\\s{0,2}an?)?|an?\\b(?:\\s{0,2}few)?|few|several|the|a?\\s{0,2}couple\\s{0,2}(?:of)?)`;function vg(n){const e=n.toLowerCase();return no[e]!==void 0?no[e]:e==="a"||e==="an"||e=="the"?1:e.match(/few/)?3:e.match(/half/)?.5:e.match(/couple/)?2:e.match(/several/)?7:parseFloat(e)}const Wa=`(?:${Gs(ro)}|[0-9]{1,2}(?:st|nd|rd|th)?)`;function Ha(n){let e=n.toLowerCase();return ro[e]!==void 0?ro[e]:(e=e.replace(/(?:st|nd|rd|th)$/i,""),parseInt(e))}const hi="(?:[1-9][0-9]{0,3}\\s{0,2}(?:BE|AD|BC|BCE|CE)|[1-2][0-9]{3}|[5-9][0-9]|2[0-5])";function fi(n){if(/BE/i.test(n))return n=n.replace(/BE/i,""),parseInt(n)-543;if(/BCE?/i.test(n))return n=n.replace(/BCE?/i,""),-parseInt(n);if(/(AD|CE)/i.test(n))return n=n.replace(/(AD|CE)/i,""),parseInt(n);const e=parseInt(n);return ad(e)}const cd=`(${ld})\\s{0,3}(${Gs(di)})`,jl=new RegExp(cd,"i"),pg=`(${ld})\\s{0,3}(${Gs(od)})`,ud="\\s{0,5},?(?:\\s*and)?\\s{0,5}",ga=rd("(?:(?:about|around)\\s{0,3})?",cd,ud),vi=rd("(?:(?:about|around)\\s{0,3})?",pg,ud);function Br(n){const e={};let t=n,s=jl.exec(t);for(;s;)gg(e,s),t=t.substring(s[0].length).trim(),s=jl.exec(t);return Object.keys(e).length==0?null:e}function gg(n,e){if(e[0].match(/^[a-zA-Z]+$/))return;const t=vg(e[1]),s=di[e[2].toLowerCase()];n[s]=t}class us{constructor(){b(this,"cachedInnerPattern",null);b(this,"cachedPattern",null)}innerPatternHasChange(e,t){return this.innerPattern(e)!==t}patternLeftBoundary(){return"(\\W|^)"}pattern(e){return this.cachedInnerPattern&&!this.innerPatternHasChange(e,this.cachedInnerPattern)?this.cachedPattern:(this.cachedInnerPattern=this.innerPattern(e),this.cachedPattern=new RegExp(`${this.patternLeftBoundary()}${this.cachedInnerPattern.source}`,this.cachedInnerPattern.flags),this.cachedPattern)}extract(e,t){const s=t[1]??"";t.index=t.index+s.length,t[0]=t[0].substring(s.length);for(let r=2;r<t.length;r++)t[r-1]=t[r];return this.innerExtract(e,t)}}const mg=new RegExp(`(?:(?:within|in|for)\\s*)?(?:(?:about|around|roughly|approximately|just)\\s*(?:~\\s*)?)?(${ga})(?=\\W|$)`,"i"),yg=new RegExp(`(?:within|in|for)\\s*(?:(?:about|around|roughly|approximately|just)\\s*(?:~\\s*)?)?(${ga})(?=\\W|$)`,"i"),bg=new RegExp(`(?:within|in|for)\\s*(?:(?:about|around|roughly|approximately|just)\\s*(?:~\\s*)?)?(${vi})(?=\\W|$)`,"i");class _g extends us{constructor(t){super();b(this,"strictMode");this.strictMode=t}innerPattern(t){return this.strictMode?bg:t.option.forwardDate?mg:yg}innerExtract(t,s){if(s[0].match(/^for\s*the\s*\w+/))return null;const r=Br(s[1]);return r?rt.createRelativeFromReference(t.reference,r):null}}const wg=new RegExp(`(?:on\\s{0,3})?(${Wa})(?:\\s{0,3}(?:to|\\-|\\|until|through|till)?\\s{0,3}(${Wa}))?(?:-|/|\\s{0,3}(?:of)?\\s{0,3})(${Gs(Nn)})(?:(?:-|/|,?\\s{0,3})(${hi}(?!\\w)))?(?=\\W|$)`,"i"),Wl=1,Hl=2,kg=3,Gl=4;class Tg extends us{innerPattern(){return wg}innerExtract(e,t){const s=e.createParsingResult(t.index,t[0]),r=Nn[t[kg].toLowerCase()],a=Ha(t[Wl]);if(a>31)return t.index=t.index+t[Wl].length,null;if(s.start.assign("month",r),s.start.assign("day",a),t[Gl]){const i=fi(t[Gl]);s.start.assign("year",i)}else{const i=ui(e.refDate,a,r);s.start.imply("year",i)}if(t[Hl]){const i=Ha(t[Hl]);s.end=s.start.clone(),s.end.assign("day",i)}return s}}const Sg=new RegExp(`(${Gs(Nn)})(?:-|/|\\s*,?\\s*)(${Wa})(?!\\s*(?:am|pm))\\s*(?:(?:to|\\-)\\s*(${Wa})\\s*)?(?:(?:-|/|\\s*,\\s*|\\s+)(${hi}))?(?=\\W|$)(?!\\:\\d)`,"i"),xg=1,Kl=2,Ci=3,Ii=4;class Dg extends us{constructor(t){super();b(this,"shouldSkipYearLikeDate");this.shouldSkipYearLikeDate=t}innerPattern(){return Sg}innerExtract(t,s){const r=Nn[s[xg].toLowerCase()],a=Ha(s[Kl]);if(a>31||this.shouldSkipYearLikeDate&&!s[Ci]&&!s[Ii]&&s[Kl].match(/^2[0-5]$/))return null;const i=t.createParsingComponents({day:a,month:r}).addTag("parser/ENMonthNameMiddleEndianParser");if(s[Ii]){const u=fi(s[Ii]);i.assign("year",u)}else{const u=ui(t.refDate,a,r);i.imply("year",u)}if(!s[Ci])return i;const l=Ha(s[Ci]),c=t.createParsingResult(s.index,s[0]);return c.start=i,c.end=i.clone(),c.end.assign("day",l),c}}const Eg=new RegExp(`((?:in)\\s*)?(${Gs(Nn)})\\s*(?:(?:,|-|of)?\\s*(${hi})?)?(?=[^\\s\\w]|\\s+[^0-9]|\\s+$|$)`,"i"),Ag=1,Cg=2,Vl=3;class Ig extends us{innerPattern(){return Eg}innerExtract(e,t){const s=t[Cg].toLowerCase();if(t[0].length<=3&&!id[s])return null;const r=e.createParsingResult(t.index+(t[Ag]||"").length,t.index+t[0].length);r.start.imply("day",1),r.start.addTag("parser/ENMonthNameParser");const a=Nn[s];if(r.start.assign("month",a),t[Vl]){const i=fi(t[Vl]);r.start.assign("year",i)}else{const i=ui(e.refDate,1,a);r.start.imply("year",i)}return r}}const Mg=new RegExp(`([0-9]{4})[-\\.\\/\\s](?:(${Gs(Nn)})|([0-9]{1,2}))[-\\.\\/\\s]([0-9]{1,2})(?=\\W|$)`,"i"),Og=1,Rg=2,Ql=3,Ng=4;class Pg extends us{constructor(t){super();b(this,"strictMonthDateOrder");this.strictMonthDateOrder=t}innerPattern(){return Mg}innerExtract(t,s){const r=parseInt(s[Og]);let a=parseInt(s[Ng]),i=s[Ql]?parseInt(s[Ql]):Nn[s[Rg].toLowerCase()];if(i<1||i>12){if(this.strictMonthDateOrder)return null;a>=1&&a<=12&&([i,a]=[a,i])}return a<1||a>31?null:{day:a,month:i,year:r}}}const Lg=new RegExp("([0-9]|0[1-9]|1[012])/([0-9]{4})","i"),Fg=1,qg=2;class Ug extends us{innerPattern(){return Lg}innerExtract(e,t){const s=parseInt(t[qg]),r=parseInt(t[Fg]);return e.createParsingComponents().imply("day",1).assign("month",r).assign("year",s)}}function Bg(n,e,t,s){return new RegExp(`${n}${e}(\\d{1,4})(?:(?:\\.|:|)(\\d{1,2})(?:(?::|)(\\d{2})(?:\\.(\\d{1,6}))?)?)?(?:\\s*(a\\.m\\.|p\\.m\\.|am?|pm?))?${t}`,s)}function zg(n,e){return new RegExp(`^(${n})(\\d{1,4})(?:(?:\\.|\\:|\\)(\\d{1,2})(?:(?:\\.|\\:|\\)(\\d{1,2})(?:\\.(\\d{1,6}))?)?)?(?:\\s*(a\\.m\\.|p\\.m\\.|am?|pm?))?${e}`,"i")}const Mi=2,Ln=3,Ca=4,Ia=5,vr=6;class $g{constructor(e=!1){b(this,"strictMode");b(this,"cachedPrimaryPrefix",null);b(this,"cachedPrimarySuffix",null);b(this,"cachedPrimaryTimePattern",null);b(this,"cachedFollowingPhase",null);b(this,"cachedFollowingSuffix",null);b(this,"cachedFollowingTimePatten",null);this.strictMode=e}patternFlags(){return"i"}primaryPatternLeftBoundary(){return"(^|\\s|T|\\b)"}primarySuffix(){return"(?!/)(?=\\W|$)"}followingSuffix(){return"(?!/)(?=\\W|$)"}pattern(e){return this.getPrimaryTimePatternThroughCache()}extract(e,t){const s=this.extractPrimaryTimeComponents(e,t);if(!s)return t[0].match(/^\d{4}/)?(t.index+=4,null):(t.index+=t[0].length,null);const r=t.index+t[1].length,a=t[0].substring(t[1].length),i=e.createParsingResult(r,a,s);t.index+=t[0].length;const l=e.text.substring(t.index),u=this.getFollowingTimePatternThroughCache().exec(l);return a.match(/^\d{3,4}/)&&u&&(u[0].match(/^\s*([+-])\s*\d{2,4}$/)||u[0].match(/^\s*([+-])\s*\d{2}\W\d{2}/))?null:!u||u[0].match(/^\s*([+-])\s*\d{3,4}$/)?this.checkAndReturnWithoutFollowingPattern(i):(i.end=this.extractFollowingTimeComponents(e,u,i),i.end&&(i.text+=u[0]),this.checkAndReturnWithFollowingPattern(i))}extractPrimaryTimeComponents(e,t,s=!1){const r=e.createParsingComponents();let a=0,i=null,l=parseInt(t[Mi]);if(l>100){if(t[Mi].length==4&&t[Ln]==null&&!t[vr]||this.strictMode||t[Ln]!=null)return null;a=l%100,l=Math.floor(l/100)}if(l>24)return null;if(t[Ln]!=null){if(t[Ln].length==1&&!t[vr])return null;a=parseInt(t[Ln])}if(a>=60)return null;if(l>12&&(i=Ke.PM),t[vr]!=null){if(l>12)return null;const c=t[vr][0].toLowerCase();c=="a"&&(i=Ke.AM,l==12&&(l=0)),c=="p"&&(i=Ke.PM,l!=12&&(l+=12))}if(r.assign("hour",l),r.assign("minute",a),i!==null?r.assign("meridiem",i):l<12?r.imply("meridiem",Ke.AM):r.imply("meridiem",Ke.PM),t[Ia]!=null){const c=parseInt(t[Ia].substring(0,3));if(c>=1e3)return null;r.assign("millisecond",c)}if(t[Ca]!=null){const c=parseInt(t[Ca]);if(c>=60)return null;r.assign("second",c)}return r}extractFollowingTimeComponents(e,t,s){const r=e.createParsingComponents();if(t[Ia]!=null){const c=parseInt(t[Ia].substring(0,3));if(c>=1e3)return null;r.assign("millisecond",c)}if(t[Ca]!=null){const c=parseInt(t[Ca]);if(c>=60)return null;r.assign("second",c)}let a=parseInt(t[Mi]),i=0,l=-1;if(t[Ln]!=null?i=parseInt(t[Ln]):a>100&&(i=a%100,a=Math.floor(a/100)),i>=60||a>24)return null;if(a>=12&&(l=Ke.PM),t[vr]!=null){if(a>12)return null;const c=t[vr][0].toLowerCase();c=="a"&&(l=Ke.AM,a==12&&(a=0,r.isCertain("day")||r.imply("day",r.get("day")+1))),c=="p"&&(l=Ke.PM,a!=12&&(a+=12)),s.start.isCertain("meridiem")||(l==Ke.AM?(s.start.imply("meridiem",Ke.AM),s.start.get("hour")==12&&s.start.assign("hour",0)):(s.start.imply("meridiem",Ke.PM),s.start.get("hour")!=12&&s.start.assign("hour",s.start.get("hour")+12)))}return r.assign("hour",a),r.assign("minute",i),l>=0?r.assign("meridiem",l):s.start.isCertain("meridiem")&&s.start.get("hour")>12?s.start.get("hour")-12>a?r.imply("meridiem",Ke.AM):a<=12&&(r.assign("hour",a+12),r.assign("meridiem",Ke.PM)):a>12?r.imply("meridiem",Ke.PM):a<=12&&r.imply("meridiem",Ke.AM),r.date().getTime()<s.start.date().getTime()&&r.imply("day",r.get("day")+1),r}checkAndReturnWithoutFollowingPattern(e){if(e.text.match(/^\d$/)||e.text.match(/^\d\d\d+$/)||e.text.match(/\d[apAP]$/))return null;const t=e.text.match(/[^\d:.](\d[\d.]+)$/);if(t){const s=t[1];if(this.strictMode||s.includes(".")&&!s.match(/\d(\.\d{2})+$/)||parseInt(s)>24)return null}return e}checkAndReturnWithFollowingPattern(e){if(e.text.match(/^\d+-\d+$/))return null;const t=e.text.match(/[^\d:.](\d[\d.]+)\s*-\s*(\d[\d.]+)$/);if(t){if(this.strictMode)return null;const s=t[1],r=t[2];if(r.includes(".")&&!r.match(/\d(\.\d{2})+$/))return null;const a=parseInt(r),i=parseInt(s);if(a>24||i>24)return null}return e}getPrimaryTimePatternThroughCache(){const e=this.primaryPrefix(),t=this.primarySuffix();return this.cachedPrimaryPrefix===e&&this.cachedPrimarySuffix===t?this.cachedPrimaryTimePattern:(this.cachedPrimaryTimePattern=Bg(this.primaryPatternLeftBoundary(),e,t,this.patternFlags()),this.cachedPrimaryPrefix=e,this.cachedPrimarySuffix=t,this.cachedPrimaryTimePattern)}getFollowingTimePatternThroughCache(){const e=this.followingPhase(),t=this.followingSuffix();return this.cachedFollowingPhase===e&&this.cachedFollowingSuffix===t?this.cachedFollowingTimePatten:(this.cachedFollowingTimePatten=zg(e,t),this.cachedFollowingPhase=e,this.cachedFollowingSuffix=t,this.cachedFollowingTimePatten)}}class Yg extends $g{constructor(e){super(e)}followingPhase(){return"\\s*(?:\\-|\\|\\~|\\|to|until|through|till|\\?)\\s*"}primaryPrefix(){return"(?:(?:at|from)\\s*)??"}primarySuffix(){return"(?:\\s*(?:o\\W*clock|at\\s*night|in\\s*the\\s*(?:morning|afternoon)))?(?!/)(?=\\W|$)"}extractPrimaryTimeComponents(e,t){const s=super.extractPrimaryTimeComponents(e,t);if(!s)return s;if(t[0].endsWith("night")){const r=s.get("hour");r>=6&&r<12?(s.assign("hour",s.get("hour")+12),s.assign("meridiem",Ke.PM)):r<6&&s.assign("meridiem",Ke.AM)}if(t[0].endsWith("afternoon")){s.assign("meridiem",Ke.PM);const r=s.get("hour");r>=0&&r<=6&&s.assign("hour",s.get("hour")+12)}return t[0].endsWith("morning")&&(s.assign("meridiem",Ke.AM),s.get("hour")<12&&s.assign("hour",s.get("hour"))),s.addTag("parser/ENTimeExpressionParser")}extractFollowingTimeComponents(e,t,s){const r=super.extractFollowingTimeComponents(e,t,s);return r&&r.addTag("parser/ENTimeExpressionParser"),r}}const jg=new RegExp(`(${ga})\\s{0,5}(?:ago|before|earlier)(?=\\W|$)`,"i"),Wg=new RegExp(`(${vi})\\s{0,5}(?:ago|before|earlier)(?=\\W|$)`,"i");class Hg extends us{constructor(t){super();b(this,"strictMode");this.strictMode=t}innerPattern(){return this.strictMode?Wg:jg}innerExtract(t,s){const r=Br(s[1]);return r?rt.createRelativeFromReference(t.reference,ci(r)):null}}const Gg=new RegExp(`(${ga})\\s{0,5}(?:later|after|from now|henceforth|forward|out)(?=(?:\\W|$))`,"i"),Kg=new RegExp(`(${vi})\\s{0,5}(later|after|from now)(?=\\W|$)`,"i"),Vg=1;class Qg extends us{constructor(t){super();b(this,"strictMode");this.strictMode=t}innerPattern(){return this.strictMode?Kg:Gg}innerExtract(t,s){const r=Br(s[Vg]);return r?rt.createRelativeFromReference(t.reference,r):null}}let dd=class{refine(e,t){return t.filter(s=>this.isValid(e,s))}};class ma{refine(e,t){if(t.length<2)return t;const s=[];let r=t[0],a=null;for(let i=1;i<t.length;i++){a=t[i];const l=e.text.substring(r.index+r.text.length,a.index);if(!this.shouldMergeResults(l,r,a,e))s.push(r),r=a;else{const c=r,u=a,d=this.mergeResults(l,c,u,e);e.debug(()=>{console.log(`${this.constructor.name} merged ${c} and ${u} into ${d}`)}),r=d}}return r!=null&&s.push(r),s}}class Xg extends ma{shouldMergeResults(e,t,s){return!t.end&&!s.end&&e.match(this.patternBetween())!=null}mergeResults(e,t,s){if(!t.start.isOnlyWeekdayComponent()&&!s.start.isOnlyWeekdayComponent()&&(s.start.getCertainComponents().forEach(a=>{t.start.isCertain(a)||t.start.imply(a,s.start.get(a))}),t.start.getCertainComponents().forEach(a=>{s.start.isCertain(a)||s.start.imply(a,t.start.get(a))})),t.start.date()>s.start.date()){let a=t.start.date(),i=s.start.date();s.start.isOnlyWeekdayComponent()&&is(i,{day:7})>a?(i=is(i,{day:7}),s.start.imply("day",i.getDate()),s.start.imply("month",i.getMonth()+1),s.start.imply("year",i.getFullYear())):t.start.isOnlyWeekdayComponent()&&is(a,{day:-7})<i?(a=is(a,{day:-7}),t.start.imply("day",a.getDate()),t.start.imply("month",a.getMonth()+1),t.start.imply("year",a.getFullYear())):s.start.isDateWithUnknownYear()&&is(i,{year:1})>a?(i=is(i,{year:1}),s.start.imply("year",i.getFullYear())):t.start.isDateWithUnknownYear()&&is(a,{year:-1})<i?(a=is(a,{year:-1}),t.start.imply("year",a.getFullYear())):[s,t]=[t,s]}const r=t.clone();return r.start=t.start,r.end=s.start,r.index=Math.min(t.index,s.index),t.index<s.index?r.text=t.text+e+s.text:r.text=s.text+e+t.text,r}}class Zg extends Xg{patternBetween(){return/^\s*(to|-||until|through|till)\s*$/i}}function Xl(n,e){const t=n.clone(),s=n.start,r=e.start;if(t.start=Zl(s,r),n.end!=null||e.end!=null){const a=n.end==null?n.start:n.end,i=e.end==null?e.start:e.end,l=Zl(a,i);if(n.end==null&&l.date().getTime()<t.start.date().getTime()){const c=new Date(l.date().getTime());c.setDate(c.getDate()+1),l.isCertain("day")?lr(l,c):gr(l,c)}t.end=l}return t}function Zl(n,e){const t=n.clone();return e.isCertain("hour")?(t.assign("hour",e.get("hour")),t.assign("minute",e.get("minute")),e.isCertain("second")?(t.assign("second",e.get("second")),e.isCertain("millisecond")?t.assign("millisecond",e.get("millisecond")):t.imply("millisecond",e.get("millisecond"))):(t.imply("second",e.get("second")),t.imply("millisecond",e.get("millisecond")))):(t.imply("hour",e.get("hour")),t.imply("minute",e.get("minute")),t.imply("second",e.get("second")),t.imply("millisecond",e.get("millisecond"))),e.isCertain("timezoneOffset")&&t.assign("timezoneOffset",e.get("timezoneOffset")),e.isCertain("meridiem")?t.assign("meridiem",e.get("meridiem")):e.get("meridiem")!=null&&t.get("meridiem")==null&&t.imply("meridiem",e.get("meridiem")),t.get("meridiem")==Ke.PM&&t.get("hour")<12&&(e.isCertain("hour")?t.assign("hour",t.get("hour")+12):t.imply("hour",t.get("hour")+12)),t.addTags(n.tags()),t.addTags(e.tags()),t}class Jg extends ma{shouldMergeResults(e,t,s){return(t.start.isOnlyDate()&&s.start.isOnlyTime()||s.start.isOnlyDate()&&t.start.isOnlyTime())&&e.match(this.patternBetween())!=null}mergeResults(e,t,s){const r=t.start.isOnlyDate()?Xl(t,s):Xl(s,t);return r.index=t.index,r.text=t.text+e+s.text,r}}class Jl extends Jg{patternBetween(){return new RegExp("^\\s*(T|at|after|before|on|of|,|-|\\.||:)?\\s*$")}}const em=new RegExp("^\\s*,?\\s*\\(?([A-Z]{2,4})\\)?(?=\\W|$)","i");class tm{constructor(e){b(this,"timezoneOverrides");this.timezoneOverrides=e}refine(e,t){const s=e.option.timezones??{};return t.forEach(r=>{const a=e.text.substring(r.index+r.text.length),i=em.exec(a);if(!i)return;const l=i[1].toUpperCase(),c=r.start.date()??r.refDate??new Date,u={...this.timezoneOverrides,...s},d=nd(l,c,u);if(d==null)return;e.debug(()=>{console.log(`Extracting timezone: '${l}' into: ${d} for: ${r.start}`)});const f=r.start.get("timezoneOffset");f!==null&&d!=f&&(r.start.isCertain("timezoneOffset")||l!=i[1])||r.start.isOnlyDate()&&l!=i[1]||(r.text+=i[0],r.start.isCertain("timezoneOffset")||r.start.assign("timezoneOffset",d),r.end!=null&&!r.end.isCertain("timezoneOffset")&&r.end.assign("timezoneOffset",d))}),t}}const sm=new RegExp("^\\s*(?:\\(?(?:GMT|UTC)\\s?)?([+-])(\\d{1,2})(?::?(\\d{2}))?\\)?","i"),nm=1,rm=2,am=3;class im{refine(e,t){return t.forEach(function(s){if(s.start.isCertain("timezoneOffset"))return;const r=e.text.substring(s.index+s.text.length),a=sm.exec(r);if(!a)return;e.debug(()=>{console.log(`Extracting timezone: '${a[0]}' into : ${s}`)});const i=parseInt(a[rm]),l=parseInt(a[am]||"0");let c=i*60+l;c>14*60||(a[nm]==="-"&&(c=-c),s.end!=null&&s.end.assign("timezoneOffset",c),s.start.assign("timezoneOffset",c),s.text+=a[0])}),t}}class ao{refine(e,t){if(t.length<2)return t;const s=[];let r=t[0];for(let a=1;a<t.length;a++){const i=t[a];if(i.index>=r.index+r.text.length){s.push(r),r=i;continue}let l=null,c=null;i.text.length>r.text.length?(l=i,c=r):(l=r,c=i),e.debug(()=>{console.log(`${this.constructor.name} remove ${c} by ${l}`)}),r=l}return r!=null&&s.push(r),s}}class om{refine(e,t){return e.option.forwardDate&&t.forEach(s=>{let r=e.reference.getDateWithAdjustedTimezone();if(s.start.isOnlyTime()&&e.reference.instant>s.start.date()){const a=e.reference.getDateWithAdjustedTimezone(),i=new Date(a);i.setDate(i.getDate()+1),gr(s.start,i),e.debug(()=>{console.log(`${this.constructor.name} adjusted ${s} time from the ref date (${a}) to the following day (${i})`)}),s.end&&s.end.isOnlyTime()&&(gr(s.end,i),s.start.date()>s.end.date()&&(i.setDate(i.getDate()+1),gr(s.end,i)))}if(s.start.isOnlyWeekdayComponent()&&r>s.start.date()){let a=s.start.get("weekday")-r.getDay();if(a<=0&&(a+=7),r=is(r,{day:a}),gr(s.start,r),e.debug(()=>{console.log(`${this.constructor.name} adjusted ${s} weekday (${s.start})`)}),s.end&&s.end.isOnlyWeekdayComponent()){let i=s.end.get("weekday")-r.getDay();i<=0&&(i+=7),r=is(r,{day:i}),gr(s.end,r),e.debug(()=>{console.log(`${this.constructor.name} adjusted ${s} weekday (${s.end})`)})}}if(s.start.isDateWithUnknownYear()&&r>s.start.date())for(let a=0;a<3&&r>s.start.date();a++)s.start.imply("year",s.start.get("year")+1),e.debug(()=>{console.log(`${this.constructor.name} adjusted ${s} year (${s.start})`)}),s.end&&!s.end.isCertain("year")&&(s.end.imply("year",s.end.get("year")+1),e.debug(()=>{console.log(`${this.constructor.name} adjusted ${s} month (${s.start})`)}))}),t}}class lm extends dd{constructor(t){super();b(this,"strictMode");this.strictMode=t}isValid(t,s){return s.text.replace(" ","").match(/^\d*(\.\d*)?$/)?(t.debug(()=>{console.log(`Removing unlikely result '${s.text}'`)}),!1):s.start.isValidDate()?s.end&&!s.end.isValidDate()?(t.debug(()=>{console.log(`Removing invalid result: ${s} (${s.end})`)}),!1):this.strictMode?this.isStrictModeValid(t,s):!0:(t.debug(()=>{console.log(`Removing invalid result: ${s} (${s.start})`)}),!1)}isStrictModeValid(t,s){return s.start.isOnlyWeekdayComponent()?(t.debug(()=>{console.log(`(Strict) Removing weekday only component: ${s} (${s.end})`)}),!1):!0}}const cm=new RegExp("([0-9]{4})\\-([0-9]{1,2})\\-([0-9]{1,2})(?:T([0-9]{1,2}):([0-9]{1,2})(?::([0-9]{1,2})(?:\\.(\\d{1,4}))?)?(Z|([+-]\\d{2}):?(\\d{2})?)?)?(?=\\W|$)","i"),um=1,dm=2,hm=3,ec=4,fm=5,tc=6,sc=7,vm=8,nc=9,rc=10;class pm extends us{innerPattern(){return cm}innerExtract(e,t){const s=e.createParsingComponents({year:parseInt(t[um]),month:parseInt(t[dm]),day:parseInt(t[hm])});if(t[ec]!=null&&(s.assign("hour",parseInt(t[ec])),s.assign("minute",parseInt(t[fm])),t[tc]!=null&&s.assign("second",parseInt(t[tc])),t[sc]!=null&&s.assign("millisecond",parseInt(t[sc])),t[vm]!=null)){let r=0;if(t[nc]){const a=parseInt(t[nc]);let i=0;t[rc]!=null&&(i=parseInt(t[rc])),r=a*60,r<0?r-=i:r+=i}s.assign("timezoneOffset",r)}return s.addTag("parser/ISOFormatParser")}}class gm extends ma{mergeResults(e,t,s){const r=s.clone();return r.index=t.index,r.text=t.text+e+r.text,r.start.assign("weekday",t.start.get("weekday")),r.end&&r.end.assign("weekday",t.start.get("weekday")),r}shouldMergeResults(e,t,s){return t.start.isOnlyWeekdayComponent()&&!t.start.isCertain("hour")&&s.start.isCertain("day")&&e.match(/^,?\s*$/)!=null}}function mm(n,e=!1){return n.parsers.unshift(new pm),n.refiners.unshift(new gm),n.refiners.unshift(new im),n.refiners.unshift(new ao),n.refiners.push(new tm),n.refiners.push(new ao),n.refiners.push(new om),n.refiners.push(new lm(e)),n}function ym(n){const e=n.getDateWithAdjustedTimezone(),t=new rt(n,{});return lr(t,e),sd(t,e),t.assign("timezoneOffset",n.getTimezoneOffset()),t.addTag("casualReference/now"),t}function bm(n){const e=n.getDateWithAdjustedTimezone(),t=new rt(n,{});return lr(t,e),Wo(t,e),t.delete("meridiem"),t.addTag("casualReference/today"),t}function _m(n){return km(n).addTag("casualReference/yesterday")}function wm(n){return Ho(n,1).addTag("casualReference/tomorrow")}function km(n,e){return Ho(n,-1)}function Ho(n,e){const t=n.getDateWithAdjustedTimezone(),s=new rt(n,{}),r=new Date(t.getTime());return r.setDate(r.getDate()+e),lr(s,r),Wo(s,r),s.delete("meridiem"),s}function Tm(n,e=22){const t=n.getDateWithAdjustedTimezone(),s=new rt(n,{});return lr(s,t),s.imply("hour",e),s.imply("meridiem",Ke.PM),s.addTag("casualReference/tonight"),s}function Sm(n,e=20){const t=new rt(n,{});return t.imply("meridiem",Ke.PM),t.imply("hour",e),t.addTag("casualReference/evening"),t}function xm(n){const e=new rt(n,{});return n.getDateWithAdjustedTimezone().getHours()>2&&e.addDurationAsImplied({day:1}),e.assign("hour",0),e.imply("minute",0),e.imply("second",0),e.imply("millisecond",0),e.addTag("casualReference/midnight"),e}function Dm(n,e=6){const t=new rt(n,{});return t.imply("meridiem",Ke.AM),t.imply("hour",e),t.imply("minute",0),t.imply("second",0),t.imply("millisecond",0),t.addTag("casualReference/morning"),t}function Em(n,e=15){const t=new rt(n,{});return t.imply("meridiem",Ke.PM),t.imply("hour",e),t.imply("minute",0),t.imply("second",0),t.imply("millisecond",0),t.addTag("casualReference/afternoon"),t}function Am(n){const e=new rt(n,{});return e.imply("meridiem",Ke.AM),e.assign("hour",12),e.imply("minute",0),e.imply("second",0),e.imply("millisecond",0),e.addTag("casualReference/noon"),e}const Cm=/(now|today|tonight|tomorrow|overmorrow|tmr|tmrw|yesterday|last\s*night)(?=\W|$)/i;class Im extends us{innerPattern(e){return Cm}innerExtract(e,t){let s=e.refDate;const r=t[0].toLowerCase();let a=e.createParsingComponents();switch(r){case"now":a=ym(e.reference);break;case"today":a=bm(e.reference);break;case"yesterday":a=_m(e.reference);break;case"tomorrow":case"tmr":case"tmrw":a=wm(e.reference);break;case"tonight":a=Tm(e.reference);break;case"overmorrow":a=Ho(e.reference,2);break;default:if(r.match(/last\s*night/)){if(s.getHours()>6){const i=new Date(s.getTime());i.setDate(i.getDate()-1),s=i}lr(a,s),a.imply("hour",0)}break}return a.addTag("parser/ENCasualDateParser"),a}}const Mm=/(?:this)?\s{0,3}(morning|afternoon|evening|night|midnight|midday|noon)(?=\W|$)/i;class Om extends us{innerPattern(){return Mm}innerExtract(e,t){let s=null;switch(t[1].toLowerCase()){case"afternoon":s=Em(e.reference);break;case"evening":case"night":s=Sm(e.reference);break;case"midnight":s=xm(e.reference);break;case"morning":s=Dm(e.reference);break;case"noon":case"midday":s=Am(e.reference);break}return s&&s.addTag("parser/ENCasualTimeParser"),s}}function Rm(n,e,t){const s=n.getDateWithAdjustedTimezone(),r=Nm(s,e,t);let a=new rt(n);return a=a.addDurationAsImplied({day:r}),a.assign("weekday",e),a}function Nm(n,e,t){const s=n.getDay();switch(t){case"this":return Fa(n,e);case"last":return hd(n,e);case"next":return s==ct.SUNDAY?e==ct.SUNDAY?7:e:s==ct.SATURDAY?e==ct.SATURDAY?7:e==ct.SUNDAY?8:1+e:e<s&&e!=ct.SUNDAY?Fa(n,e):Fa(n,e)+7}return Pm(n,e)}function Pm(n,e){const t=hd(n,e),s=Fa(n,e);return s<-t?s:t}function Fa(n,e){const t=n.getDay();let s=e-t;return s<0&&(s+=7),s}function hd(n,e){const t=n.getDay();let s=e-t;return s>=0&&(s-=7),s}const Lm=new RegExp(`(?:(?:\\,|\\(|\\)\\s*)?(?:on\\s*?)?(?:(this|last|past|next)\\s*)?(${Gs(so)}|weekend|weekday)(?:\\s*(?:\\,|\\)|\\))?(?:\\s*(this|last|past|next)\\s*week)?(?=\\W|$)`,"i"),Fm=1,qm=2,Um=3;class Bm extends us{innerPattern(){return Lm}innerExtract(e,t){const s=t[Fm],r=t[Um];let a=s||r;a=a||"",a=a.toLowerCase();let i=null;a=="last"||a=="past"?i="last":a=="next"?i="next":a=="this"&&(i="this");const l=t[qm].toLowerCase();let c;if(so[l]!==void 0)c=so[l];else if(l=="weekend")c=i=="last"?ct.SUNDAY:ct.SATURDAY;else if(l=="weekday"){const u=e.reference.getDateWithAdjustedTimezone().getDay();u==ct.SUNDAY||u==ct.SATURDAY?c=i=="last"?ct.FRIDAY:ct.MONDAY:(c=u-1,c=i=="last"?c-1:c+1,c=c%5+1)}else return null;return Rm(e.reference,c,i)}}const zm=new RegExp(`(this|last|past|next|after\\s*this)\\s*(${Gs(di)})(?=\\s*)(?=\\W|$)`,"i"),$m=1,Ym=2;class jm extends us{innerPattern(){return zm}innerExtract(e,t){const s=t[$m].toLowerCase(),r=t[Ym].toLowerCase(),a=di[r];if(s=="next"||s.startsWith("after")){const c={};return c[a]=1,rt.createRelativeFromReference(e.reference,c)}if(s=="last"||s=="past"){const c={};return c[a]=-1,rt.createRelativeFromReference(e.reference,c)}const i=e.createParsingComponents();let l=new Date(e.reference.instant.getTime());return r.match(/week/i)?(l.setDate(l.getDate()-l.getDay()),i.imply("day",l.getDate()),i.imply("month",l.getMonth()+1),i.imply("year",l.getFullYear())):r.match(/month/i)?(l.setDate(1),i.imply("day",l.getDate()),i.assign("year",l.getFullYear()),i.assign("month",l.getMonth()+1)):r.match(/year/i)&&(l.setDate(1),l.setMonth(0),i.imply("day",l.getDate()),i.imply("month",l.getMonth()+1),i.assign("year",l.getFullYear())),i}}const Wm=new RegExp("([^\\d]|^)([0-3]{0,1}[0-9]{1})[\\/\\.\\-]([0-3]{0,1}[0-9]{1})(?:[\\/\\.\\-]([0-9]{4}|[0-9]{2}))?(\\W|$)","i"),Hm=1,Gm=5,ac=2,ic=3,Oi=4;class Km{constructor(e){b(this,"groupNumberMonth");b(this,"groupNumberDay");this.groupNumberMonth=e?ic:ac,this.groupNumberDay=e?ac:ic}pattern(){return Wm}extract(e,t){const s=t.index+t[Hm].length,r=t.index+t[0].length-t[Gm].length;if(s>0&&e.text.substring(0,s).match("\\d/?$")||r<e.text.length&&e.text.substring(r).match("^/?\\d"))return;const a=e.text.substring(s,r);if(a.match(/^\d\.\d$/)||a.match(/^\d\.\d{1,2}\.\d{1,2}\s*$/)||!t[Oi]&&a.indexOf("/")<0)return;const i=e.createParsingResult(s,a);let l=parseInt(t[this.groupNumberMonth]),c=parseInt(t[this.groupNumberDay]);if((l<1||l>12)&&l>12)if(c>=1&&c<=12&&l<=31)[c,l]=[l,c];else return null;if(c<1||c>31)return null;if(i.start.assign("day",c),i.start.assign("month",l),t[Oi]){const u=parseInt(t[Oi]),d=ad(u);i.start.assign("year",d)}else{const u=ui(e.refDate,c,l);i.start.imply("year",u)}return i.addTag("parser/SlashDateFormatParser")}}const Vm=new RegExp(`(this|last|past|next|after|\\+|-)\\s*(${ga})(?=\\W|$)`,"i"),Qm=new RegExp(`(this|last|past|next|after|\\+|-)\\s*(${vi})(?=\\W|$)`,"i");class Xm extends us{constructor(t=!0){super();b(this,"allowAbbreviations");this.allowAbbreviations=t}innerPattern(){return this.allowAbbreviations?Vm:Qm}innerExtract(t,s){const r=s[1].toLowerCase();let a=Br(s[2]);if(!a)return null;switch(r){case"last":case"past":case"-":a=ci(a);break}return rt.createRelativeFromReference(t.reference,a)}}function Zm(n){return n.text.match(/^[+-]/i)!=null}function oc(n){return n.text.match(/^-/i)!=null}class Jm extends ma{shouldMergeResults(e,t,s){return e.match(/^\s*$/i)?Zm(s)||oc(s):!1}mergeResults(e,t,s,r){let a=Br(s.text);oc(s)&&(a=ci(a));const i=rt.createRelativeFromReference(tr.fromDate(t.start.date()),a);return new Ur(t.reference,t.index,`${t.text}${e}${s.text}`,i)}}function lc(n){return n.text.match(/\s+(before|from)$/i)!=null}function ey(n){return n.text.match(/\s+(after|since)$/i)!=null}class ty extends ma{patternBetween(){return/^\s*$/i}shouldMergeResults(e,t,s){return!e.match(this.patternBetween())||!lc(t)&&!ey(t)?!1:!!s.start.get("day")&&!!s.start.get("month")&&!!s.start.get("year")}mergeResults(e,t,s){let r=Br(t.text);lc(t)&&(r=ci(r));const a=rt.createRelativeFromReference(tr.fromDate(s.start.date()),r);return new Ur(s.reference,t.index,`${t.text}${e}${s.text}`,a)}}const sy=new RegExp(`^\\s*(${hi})`,"i"),ny=1;class ry{refine(e,t){return t.forEach(function(s){if(!s.start.isDateWithUnknownYear())return;const r=e.text.substring(s.index+s.text.length),a=sy.exec(r);if(!a||a[0].trim().length<=3)return;e.debug(()=>{console.log(`Extracting year: '${a[0]}' into : ${s}`)});const i=fi(a[ny]);s.end!=null&&s.end.assign("year",i),s.start.assign("year",i),s.text+=a[0]}),t}}class ay extends dd{constructor(){super()}isValid(e,t){const s=t.text.trim();return s===e.text.trim()?!0:s.toLowerCase()==="may"&&!e.text.substring(0,t.index).trim().match(/\b(in)$/i)?(e.debug(()=>{console.log(`Removing unlikely result: ${t}`)}),!1):s.toLowerCase().endsWith("the second")?(e.text.substring(t.index+t.text.length).trim().length>0&&e.debug(()=>{console.log(`Removing unlikely result: ${t}`)}),!1):!0}}class fd{createCasualConfiguration(e=!1){const t=this.createConfiguration(!1,e);return t.parsers.push(new Im),t.parsers.push(new Om),t.parsers.push(new Ig),t.parsers.push(new jm),t.parsers.push(new Xm),t.refiners.push(new ay),t}createConfiguration(e=!0,t=!1){const s=mm({parsers:[new Km(t),new _g(e),new Tg,new Dg(t),new Bm,new Ug,new Yg(e),new Hg(e),new Qg(e)],refiners:[new Jl]},e);return s.parsers.unshift(new Pg(e)),s.refiners.unshift(new ty),s.refiners.unshift(new Jm),s.refiners.unshift(new ao),s.refiners.push(new Jl),s.refiners.push(new ry),s.refiners.push(new Zg),s}}class Nr{constructor(e){b(this,"parsers");b(this,"refiners");b(this,"defaultConfig",new fd);e=e||this.defaultConfig.createCasualConfiguration(),this.parsers=[...e.parsers],this.refiners=[...e.refiners]}clone(){return new Nr({parsers:[...this.parsers],refiners:[...this.refiners]})}parseDate(e,t,s){const r=this.parse(e,t,s);return r.length>0?r[0].start.date():null}parse(e,t,s){const r=new iy(e,t,s);let a=[];return this.parsers.forEach(i=>{const l=Nr.executeParser(r,i);a=a.concat(l)}),a.sort((i,l)=>i.index-l.index),this.refiners.forEach(function(i){a=i.refine(r,a)}),a}static executeParser(e,t){const s=[],r=t.pattern(e),a=e.text;let i=e.text,l=r.exec(i);for(;l;){const c=l.index+a.length-i.length;l.index=c;const u=t.extract(e,l);if(!u){i=a.substring(l.index+1),l=r.exec(i);continue}let d=null;u instanceof Ur?d=u:u instanceof rt?(d=e.createParsingResult(l.index,l[0]),d.start=u):d=e.createParsingResult(l.index,l[0],u);const f=d.index,p=d.text;e.debug(()=>console.log(`${t.constructor.name} extracted (at index=${f}) '${p}'`)),s.push(d),i=a.substring(f+p.length),l=r.exec(i)}return s}}class iy{constructor(e,t,s){b(this,"text");b(this,"option");b(this,"reference");b(this,"refDate");this.text=e,this.option=s??{},this.reference=tr.fromInput(t,this.option.timezones),this.refDate=this.reference.instant}createParsingComponents(e){return e instanceof rt?e:new rt(this.reference,e)}createParsingResult(e,t,s,r){const a=typeof t=="string"?t:this.text.substring(e,t),i=s?this.createParsingComponents(s):null,l=r?this.createParsingComponents(r):null;return new Ur(this.reference,e,a,i,l)}debug(e){this.option.debug&&(this.option.debug instanceof Function?this.option.debug(e):this.option.debug.debug(e))}}const Go=new fd,oy=new Nr(Go.createCasualConfiguration(!1));new Nr(Go.createConfiguration(!0,!1));new Nr(Go.createCasualConfiguration(!0));const ly=oy;function Ma(n,e,t){return ly.parseDate(n,e,t)}class os{static parse(e,t=new Date){const s=e.trim(),r=e;if(!s)return{date:null,isValid:!1,error:"Empty date string",original:r};if(s.match(/^(\d{4})-(\d{2})-(\d{2})$/)){const w=new Date(s);if(!isNaN(w.getTime()))return{date:w,isValid:!0,original:r}}try{const w=Ma(s,t);if(w){const m=new Date(w);return m.setHours(0,0,0,0),{date:m,isValid:!0,original:r}}}catch{}const i=new Date(t);i.setHours(0,0,0,0);const l=s.toLowerCase();if(l==="today")return{date:i,isValid:!0,original:r};if(l==="tomorrow"){const w=new Date(i);return w.setDate(w.getDate()+1),{date:w,isValid:!0,original:r}}if(l==="yesterday"){const w=new Date(i);return w.setDate(w.getDate()-1),{date:w,isValid:!0,original:r}}const c=l.match(/^in\s+(\d+)\s+(day|days|week|weeks|month|months)$/);if(c){const w=parseInt(c[1]),m=c[2],g=new Date(i);return m.startsWith("day")?g.setDate(g.getDate()+w):m.startsWith("week")?g.setDate(g.getDate()+w*7):m.startsWith("month")&&g.setMonth(g.getMonth()+w),{date:g,isValid:!0,original:r}}const u=l.match(/^(\d+)\s+(day|days|week|weeks|month|months)\s+ago$/);if(u){const w=parseInt(u[1]),m=u[2],g=new Date(i);return m.startsWith("day")?g.setDate(g.getDate()-w):m.startsWith("week")?g.setDate(g.getDate()-w*7):m.startsWith("month")&&g.setMonth(g.getMonth()-w),{date:g,isValid:!0,original:r}}const d=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],f=l.match(/^(next|last)\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday)$/);if(f){const w=f[1],m=d.indexOf(f[2]),g=i.getDay();let _=m-g;w==="next"?_<=0&&(_+=7):_>=0&&(_-=7);const x=new Date(i);return x.setDate(x.getDate()+_),{date:x,isValid:!0,original:r}}const p=l.match(/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)$/);if(p){const w=d.indexOf(p[1]),m=i.getDay();let g=w-m;g<0&&(g+=7);const _=new Date(i);return _.setDate(_.getDate()+g),{date:_,isValid:!0,original:r}}const y=l.match(/^(this|next|last)\s+(week|month)$/);if(y){const w=y[1],m=y[2],g=new Date(i);if(m==="week"){const _=g.getDay(),x=_===0?-6:1-_;g.setDate(g.getDate()+x),w==="next"?g.setDate(g.getDate()+7):w==="last"&&g.setDate(g.getDate()-7)}else m==="month"&&(g.setDate(1),w==="next"?g.setMonth(g.getMonth()+1):w==="last"&&g.setMonth(g.getMonth()-1));return{date:g,isValid:!0,original:r}}return{date:null,isValid:!1,error:`Could not parse date: ${e}`,original:r}}static toISODateString(e){return e.toISOString().split("T")[0]}static parseNaturalLanguageDate(e,t=new Date){const s=e.trim();if(!s)return null;const r=os.handleShortcuts(s,t);if(r)return r;try{const i=Ma(s,t,{forwardDate:!0});if(i)return i}catch{}return os.parse(s,t).date}static parseToISO(e,t=new Date){const s=os.parseNaturalLanguageDate(e,t);return s?s.toISOString():null}static isDateExpression(e){const t=e.trim().toLowerCase();if(!t)return!1;if(["today","tomorrow","yesterday","monday","tuesday","wednesday","thursday","friday","saturday","sunday","next","last","this","week","month","year","day","days","ago","eod","eow","eom","in ","at "].some(r=>t.includes(r)))return!0;try{return Ma(t,new Date)!==null}catch{return!1}}static getDateSuggestions(e,t=new Date){const s=[],r=e.trim().toLowerCase(),a=new Date(t);a.setHours(0,0,0,0);const i=[{text:"Today",offset:0,icon:""},{text:"Tomorrow",offset:1,icon:""},{text:"In 2 days",offset:2,icon:""},{text:"In 3 days",offset:3,icon:""},{text:"In 1 week",offset:7,icon:""},{text:"In 2 weeks",offset:14,icon:""}];for(const u of i)if(!r||u.text.toLowerCase().includes(r)){const d=In(a,u.offset);s.push({text:u.text,value:d.toISOString(),description:os.formatDateForDisplay(d,!1),category:"relative",icon:u.icon})}const l=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];for(let u=0;u<l.length;u++){const d=l[u];if(!r||d.toLowerCase().includes(r)||`next ${d}`.toLowerCase().includes(r)){const f=a.getDay();let y=(u===6?0:u+1)-f;y<=0&&(y+=7);const w=In(a,y);s.push({text:d,value:w.toISOString(),description:os.formatDateForDisplay(w,!1),category:"named",icon:""})}}const c=[{text:"EOD (end of day)",keyword:"eod",icon:""},{text:"EOW (end of week)",keyword:"eow",icon:""},{text:"EOM (end of month)",keyword:"eom",icon:""}];for(const u of c)if(!r||u.text.toLowerCase().includes(r)||u.keyword.includes(r)){const d=os.handleShortcuts(u.keyword,t);d&&s.push({text:u.text,value:d.toISOString(),description:os.formatDateForDisplay(d,!0),category:"shortcut",icon:u.icon})}if(!r||"next month".includes(r)){const u=new Date(a);u.setMonth(u.getMonth()+1),s.push({text:"Next month",value:u.toISOString(),description:os.formatDateForDisplay(u,!1),category:"relative",icon:""})}return s.slice(0,8)}static formatDateForDisplay(e,t=!1){const s={weekday:"short",year:"numeric",month:"short",day:"numeric"};return t&&(s.hour="2-digit",s.minute="2-digit"),e.toLocaleString(void 0,s)}static parseTime(e){const t=e.trim().toLowerCase(),s=t.match(/^(\d{1,2}):(\d{2})$/);if(s){const a=parseInt(s[1]),i=parseInt(s[2]);if(a>=0&&a<24&&i>=0&&i<60)return{hours:a,minutes:i}}const r=t.match(/^(\d{1,2})(?::(\d{2}))?\s*(am|pm)$/);if(r){let a=parseInt(r[1]);const i=r[2]?parseInt(r[2]):0,l=r[3];if(l==="pm"&&a!==12?a+=12:l==="am"&&a===12&&(a=0),a>=0&&a<24&&i>=0&&i<60)return{hours:a,minutes:i}}try{const a=Ma(t,new Date);if(a)return{hours:a.getHours(),minutes:a.getMinutes()}}catch{}return null}static handleShortcuts(e,t){const s=e.trim().toLowerCase(),r=new Date(t);switch(r.setHours(0,0,0,0),s){case"eod":return Ai(r,17,0);case"eow":{const a=r.getDay();let i;a===0?i=5:a<=5?i=5-a:i=6;const l=In(r,i);return Ai(l,17,0)}case"eom":{const a=new Date(r.getFullYear(),r.getMonth()+1,0);return Ai(a,17,0)}default:return null}}}class sr{constructor(){b(this,"input","");b(this,"position",0);b(this,"line",1);b(this,"column",1);b(this,"referenceDate",new Date)}parse(e,t=new Date){let s=e.trim();const r={},a=s.split(`
`),i=[];for(const u of a){const d=u.trim();if(d==="@ignoreGlobalFilter"){r.overrideGlobalFilter=!0;continue}const f=d.match(/^@profile\s+(.+)$/);if(f){r.useProfile=f[1].trim();continue}i.push(u)}this.input=i.join(`
`).trim(),this.position=0,this.line=1,this.column=1,this.referenceDate=t;const l={filters:[]},c=this.input.split(`
`).map(u=>u.trim()).filter(u=>u.length>0);for(let u=0;u<c.length;u++){this.line=u+1,this.column=1;const d=c[u];if(d.startsWith("sort by "))l.sort=this.parseSortInstruction(d);else if(d.startsWith("group by "))l.group=this.parseGroupInstruction(d);else if(d.startsWith("limit ")||d.startsWith("limit to "))l.limit=this.parseLimitInstruction(d);else if(/^explain$/i.test(d))l.explain=!0;else{const f=this.parseFilterInstruction(d);f&&l.filters.push(f)}}return{...l,...r}}validate(e){try{return this.parse(e),{valid:!0}}catch(t){return t instanceof Cs?{valid:!1,error:t.message}:{valid:!1,error:String(t)}}}normalizeOperatorAliases(e){return e=e.replace(/^-(\w+)/,"not $1"),e=e.replace(/(\s+(?:and|AND|or|OR))\s+-(\w+)/gi,"$1 not $2"),e=e.replace(/^!(\w+)/,"not $1"),e=e.replace(/(\s+(?:and|AND|or|OR))\s+!(\w+)/gi,"$1 not $2"),e=e.replace(/\s+except\s+/gi," AND NOT "),e=e.replace(/\s*&&\s*/g," AND "),e=e.replace(/\s*\|\|\s*/g," OR "),e}parseFilterInstruction(e){if(e=this.normalizeOperatorAliases(e),e==="done")return{type:"done",operator:"is",value:!0};if(e==="not done")return{type:"done",operator:"is",value:!1};if(this.hasBooleanOperators(e)||e.includes("("))return this.parseBooleanExpression(e);if(e.match(/^(due|scheduled|start|created|done|cancelled)\s+between\s+/i)){const r=this.parseDateFilter(e);if(r)return r}if(e.startsWith("status.type is ")){const r=e.substring(15).trim();return{type:"status",operator:"type-is",value:this.parseStatusType(r)}}if(e.startsWith("status.name includes ")){const r=e.substring(21).trim();return{type:"status",operator:"name-includes",value:this.unquote(r)}}if(e.startsWith("status.symbol is ")){const r=e.substring(17).trim();return{type:"status",operator:"symbol-is",value:this.unquote(r)}}const s=this.parseDateFilter(e);if(s)return s;if(e.startsWith("priority is "))return{type:"priority",operator:"is",value:e.substring(12).trim()};if(e.startsWith("priority above "))return{type:"priority",operator:"above",value:e.substring(15).trim()};if(e.startsWith("priority below "))return{type:"priority",operator:"below",value:e.substring(15).trim()};if(e.startsWith("urgency is ")){const r=e.substring(11).trim();return{type:"urgency",operator:"is",value:this.parseNumericValue(r,"urgency")}}if(e.startsWith("urgency above ")){const r=e.substring(14).trim();return{type:"urgency",operator:"above",value:this.parseNumericValue(r,"urgency")}}if(e.startsWith("urgency below ")){const r=e.substring(14).trim();return{type:"urgency",operator:"below",value:this.parseNumericValue(r,"urgency")}}if(e.startsWith("tag includes ")){const r=e.substring(13).trim();return{type:"tag",operator:"includes",value:this.unquote(r)}}if(e.startsWith("tag does not include ")){const r=e.substring(21).trim();return{type:"tag",operator:"includes",value:this.unquote(r),negate:!0}}if(e.startsWith("tags include ")){const r=e.substring(13).trim();return{type:"tag",operator:"includes",value:this.unquote(r)}}if(e==="has tags")return{type:"tag",operator:"has",value:!0};if(e==="no tags")return{type:"tag",operator:"has",value:!1};if(e.startsWith("path includes ")){const r=e.substring(14).trim();return{type:"path",operator:"includes",value:this.unquote(r)}}if(e.startsWith("path does not include ")){const r=e.substring(22).trim();return{type:"path",operator:"includes",value:this.unquote(r),negate:!0}}if(e==="is blocked")return{type:"dependency",operator:"is-blocked",value:!0};if(e==="is not blocked")return{type:"dependency",operator:"is-blocked",value:!1};if(e==="is blocking")return{type:"dependency",operator:"is-blocking",value:!0};if(e==="is recurring")return{type:"recurrence",operator:"is",value:!0};if(e==="is not recurring")return{type:"recurrence",operator:"is",value:!1};if(e.startsWith("description includes ")){const r=e.substring(21).trim();return{type:"description",operator:"includes",value:this.unquote(r)}}if(e.startsWith("description does not include ")){const r=e.substring(29).trim();return{type:"description",operator:"does not include",value:this.unquote(r)}}if(e.startsWith("description regex ")){const r=e.substring(18).trim();return{type:"description",operator:"regex",value:this.unquote(r)}}if(e.startsWith("heading includes ")){const r=e.substring(17).trim();return{type:"heading",operator:"includes",value:this.unquote(r)}}if(e.startsWith("heading does not include ")){const r=e.substring(25).trim();return{type:"heading",operator:"does not include",value:this.unquote(r)}}throw new Cs(`Unknown filter instruction: "${e}"`,this.line,this.column,"Check the query syntax documentation for valid filter instructions")}parseDateFilter(e){const t=["due","scheduled","start","created","done","cancelled"];for(const s of t){if(e===`has ${s} date`)return{type:"date",operator:"has",value:{field:s}};if(e===`no ${s} date`)return{type:"date",operator:"has",value:{field:s},negate:!0};const r=e.match(new RegExp(`^${s}\\s+between\\s+(.+?)\\s+and\\s+(.+)$`,"i"));if(r){const i=r[1].trim(),l=r[2].trim(),c=os.parse(i,this.referenceDate),u=os.parse(l,this.referenceDate);if(!c.isValid||!c.date)throw new Cs(`Invalid start date: "${i}"`,this.line,this.column,'Use formats like: today, tomorrow, YYYY-MM-DD, "in 3 days", "next Monday"');if(!u.isValid||!u.date)throw new Cs(`Invalid end date: "${l}"`,this.line,this.column,'Use formats like: today, tomorrow, YYYY-MM-DD, "in 3 days", "next Monday"');return{type:"date",operator:"between",value:{field:s,date:c.date,endDate:u.date}}}const a=["before","after","on","on or before","on or after"];for(const i of a){const l=`${s} ${i} `;if(e.startsWith(l)){const c=e.substring(l.length).trim(),u=os.parse(c,this.referenceDate);if(!u.isValid||!u.date)throw new Cs(`Invalid date value: "${c}"`,this.line,this.column,'Use formats like: today, tomorrow, YYYY-MM-DD, "in 3 days", "next Monday"');return{type:"date",operator:i,value:{field:s,date:u.date}}}}}return null}parseSortInstruction(e){const t=e.match(/^sort by ([a-z.]+)(\s+reverse)?$/i);if(!t)throw new Cs(`Invalid sort instruction: "${e}"`,this.line,this.column,'Use format: "sort by FIELD" or "sort by FIELD reverse"');return{field:t[1],reverse:!!t[2]}}parseGroupInstruction(e){const t=e.match(/^group by ([a-z.]+)$/i);if(!t)throw new Cs(`Invalid group instruction: "${e}"`,this.line,this.column,'Use format: "group by FIELD"');return{field:t[1]}}parseLimitInstruction(e){let t=e.match(/^limit (\d+)$/);if(t||(t=e.match(/^limit to (\d+) tasks?$/),t))return parseInt(t[1],10);throw new Cs(`Invalid limit instruction: "${e}"`,this.line,this.column,'Use format: "limit 10" or "limit to 10 tasks"')}parseStatusType(e){switch(e.toUpperCase().replace(/\s+/g,"_")){case"TODO":return wt.TODO;case"IN_PROGRESS":return wt.IN_PROGRESS;case"DONE":return wt.DONE;case"CANCELLED":return wt.CANCELLED;case"NON_TASK":return wt.NON_TASK;default:throw new Cs(`Invalid status type: "${e}"`,this.line,this.column,"Valid types: TODO, IN_PROGRESS, DONE, CANCELLED, NON_TASK")}}parseNumericValue(e,t){const s=Number(e);if(Number.isNaN(s))throw new Cs(`Invalid ${t} value: "${e}"`,this.line,this.column,`Use a numeric ${t} value (e.g., "${t} above 75")`);return s}unquote(e){return e.startsWith('"')&&e.endsWith('"')||e.startsWith("'")&&e.endsWith("'")?e.slice(1,-1):e}hasBooleanOperators(e){if(/^(not|NOT)\s+/i.test(e))return!0;const t=/\s+between\s+.+?\s+and\s+/i;if(t.test(e)){const s=e.replace(t," ");return/\s+(and|AND|or|OR)\s+/i.test(s)}return/\s+(and|AND|or|OR)\s+/i.test(e)}parseBooleanExpression(e){return this.parseOrExpression(e)}parseOrExpression(e){const t=this.splitByOperator(e,/\s+(or|OR)\s+/i);if(t.length===1)return this.parseAndExpression(t[0]);let s=this.parseAndExpression(t[0]);for(let r=1;r<t.length;r++)s={type:"boolean",operator:"OR",value:null,left:s,right:this.parseAndExpression(t[r])};return s}parseAndExpression(e){const t=this.splitByOperator(e,/\s+(and|AND)\s+/i,!0);if(t.length===1)return this.parseNotExpression(t[0]);let s=this.parseNotExpression(t[0]);for(let r=1;r<t.length;r++)s={type:"boolean",operator:"AND",value:null,left:s,right:this.parseNotExpression(t[r])};return s}parseNotExpression(e){const t=e.trim();if(t.toLowerCase()==="not done")return{type:"done",operator:"is",value:!1};if(/^(not|NOT)\s+/i.test(t)){const s=t.replace(/^(not|NOT)\s+/i,"").trim();return{type:"boolean",operator:"NOT",value:null,inner:this.parsePrimaryExpression(s)}}return this.parsePrimaryExpression(t)}parsePrimaryExpression(e){const t=e.trim();if(t.startsWith("(")&&t.endsWith(")")){let s=0;for(let r=0;r<t.length&&(t[r]==="("&&s++,t[r]===")"&&s--,!(s===0&&r<t.length-1));r++);if(s===0){const r=t.slice(1,-1).trim();return this.parseBooleanExpression(r)}}return this.parseAtomicFilter(t)}splitByOperator(e,t,s=!1){const r=[];let a="",i=0,l=0;for(;l<e.length;){const c=e[l];if(c==="(")i++,a+=c,l++;else if(c===")")i--,a+=c,l++;else if(i===0){const d=e.slice(l).match(t);if(d&&d.index===0){if(s&&/\s+(and|AND)\s+/i.test(d[0])&&a.toLowerCase().match(/\s+between\s+[^)]*$/)){a+=d[0],l+=d[0].length;continue}a.trim()&&r.push(a.trim()),a="",l+=d[0].length}else a+=c,l++}else a+=c,l++}return a.trim()&&r.push(a.trim()),r.length>0?r:[e]}parseAtomicFilter(e){const t=this.normalizeOperatorAliases(e.trim());if(t==="done")return{type:"done",operator:"is",value:!0};if(t==="not done")return{type:"done",operator:"is",value:!1};if(t.match(/^(due|scheduled|start|created|done|cancelled)\s+between\s+/i)){const a=this.parseDateFilter(t);if(a)return a}if(t.startsWith("status.type is ")){const a=t.substring(15).trim();return{type:"status",operator:"type-is",value:this.parseStatusType(a)}}if(t.startsWith("status.name includes ")){const a=t.substring(21).trim();return{type:"status",operator:"name-includes",value:this.unquote(a)}}if(t.startsWith("status.symbol is ")){const a=t.substring(17).trim();return{type:"status",operator:"symbol-is",value:this.unquote(a)}}const r=this.parseDateFilter(t);if(r)return r;if(t.startsWith("priority is "))return{type:"priority",operator:"is",value:t.substring(12).trim()};if(t.startsWith("priority above "))return{type:"priority",operator:"above",value:t.substring(15).trim()};if(t.startsWith("priority below "))return{type:"priority",operator:"below",value:t.substring(15).trim()};if(t.startsWith("urgency is ")){const a=t.substring(11).trim();return{type:"urgency",operator:"is",value:this.parseNumericValue(a,"urgency")}}if(t.startsWith("urgency above ")){const a=t.substring(14).trim();return{type:"urgency",operator:"above",value:this.parseNumericValue(a,"urgency")}}if(t.startsWith("urgency below ")){const a=t.substring(14).trim();return{type:"urgency",operator:"below",value:this.parseNumericValue(a,"urgency")}}if(t.startsWith("tag includes ")){const a=t.substring(13).trim();return{type:"tag",operator:"includes",value:this.unquote(a)}}if(t.startsWith("tag does not include ")){const a=t.substring(21).trim();return{type:"tag",operator:"includes",value:this.unquote(a),negate:!0}}if(t.startsWith("tags include ")){const a=t.substring(13).trim();return{type:"tag",operator:"includes",value:this.unquote(a)}}if(t==="has tags")return{type:"tag",operator:"has",value:!0};if(t==="no tags")return{type:"tag",operator:"has",value:!1};if(t.startsWith("path includes ")){const a=t.substring(14).trim();return{type:"path",operator:"includes",value:this.unquote(a)}}if(t.startsWith("path does not include ")){const a=t.substring(22).trim();return{type:"path",operator:"includes",value:this.unquote(a),negate:!0}}if(t==="is blocked")return{type:"dependency",operator:"is-blocked",value:!0};if(t==="is not blocked")return{type:"dependency",operator:"is-blocked",value:!1};if(t==="is blocking")return{type:"dependency",operator:"is-blocking",value:!0};if(t==="is recurring")return{type:"recurrence",operator:"is",value:!0};if(t==="is not recurring")return{type:"recurrence",operator:"is",value:!1};if(t.startsWith("description includes ")){const a=t.substring(21).trim();return{type:"description",operator:"includes",value:this.unquote(a)}}if(t.startsWith("description does not include ")){const a=t.substring(29).trim();return{type:"description",operator:"does not include",value:this.unquote(a)}}if(t.startsWith("description regex ")){const a=t.substring(18).trim();return{type:"description",operator:"regex",value:this.unquote(a)}}if(t.startsWith("heading includes ")){const a=t.substring(17).trim();return{type:"heading",operator:"includes",value:this.unquote(a)}}if(t.startsWith("heading does not include ")){const a=t.substring(25).trim();return{type:"heading",operator:"does not include",value:this.unquote(a)}}throw new Cs(`Unknown filter instruction: "${t}"`,this.line,this.column,"Check the query syntax documentation for valid filter instructions")}}class St{}const Un=class Un{constructor(){b(this,"statuses",new Map);this.addDefaultStatuses()}static getInstance(){return Un.instance||(Un.instance=new Un),Un.instance}addDefaultStatuses(){this.add(Qs.TODO),this.add(Qs.IN_PROGRESS),this.add(Qs.DONE),this.add(Qs.CANCELLED)}add(e){this.statuses.set(e.symbol,e)}register(e){this.add(e)}unregister(e){this.statuses.delete(e)}get(e){const t=this.statuses.get(e);return t||new Qs({symbol:e,name:"Unknown",nextStatusSymbol:"x",type:Qs.getTypeForUnknownSymbol(e)})}getNextStatus(e){return this.get(e.nextStatusSymbol)}getAllStatuses(){return Array.from(this.statuses.values())}getAll(){return this.getAllStatuses()}reset(){this.statuses.clear(),this.addDefaultStatuses()}};b(Un,"instance",null);let Hs=Un;class cy extends St{constructor(e,t=!1){super(),this.statusType=e,this.negate=t}matches(e){const t=Hs.getInstance(),s=e.statusSymbol||" ",a=t.get(s).type===this.statusType;return this.negate?!a:a}}class uy extends St{constructor(e,t=!1){super(),this.name=e,this.negate=t}matches(e){const t=Hs.getInstance(),s=e.statusSymbol||" ",a=t.get(s).name.toLowerCase().includes(this.name.toLowerCase());return this.negate?!a:a}}class dy extends St{constructor(e,t=!1){super(),this.symbol=e,this.negate=t}matches(e){const s=(e.statusSymbol||" ")===this.symbol;return this.negate?!s:s}}class hy extends St{matches(e){const t=Hs.getInstance(),s=e.statusSymbol||" ";return t.get(s).type===wt.DONE}}class fy extends St{matches(e){const t=Hs.getInstance(),s=e.statusSymbol||" ";return t.get(s).type!==wt.DONE}}class cc extends St{constructor(e,t,s,r){super(),this.field=e,this.comparator=t,this.targetDate=s,this.endDate=r}matches(e){const t=this.getTaskDate(e);if(!t)return!1;const s=new Date(this.targetDate);s.setHours(0,0,0,0);const r=new Date(t);switch(r.setHours(0,0,0,0),this.comparator){case"before":return r<s;case"after":return r>s;case"on":return r.getTime()===s.getTime();case"on or before":return r<=s;case"on or after":return r>=s;case"between":if(!this.endDate)return!1;const a=new Date(this.endDate);return a.setHours(0,0,0,0),r>=s&&r<=a;default:return!1}}getTaskDate(e){let t;switch(this.field){case"due":t=e.dueAt;break;case"scheduled":t=e.scheduledAt;break;case"start":t=e.startAt;break;case"created":t=e.createdAt;break;case"done":t=e.doneAt;break;case"cancelled":t=e.cancelledAt;break}return t?new Date(t):null}}class vy extends St{constructor(e,t=!1){super(),this.field=e,this.negate=t}matches(e){let t=!1;switch(this.field){case"due":t=!!e.dueAt;break;case"scheduled":t=!!e.scheduledAt;break;case"start":t=!!e.startAt;break;case"created":t=!!e.createdAt;break;case"done":t=!!e.doneAt;break;case"cancelled":t=!!e.cancelledAt;break}return this.negate?!t:t}}const uc={lowest:0,low:1,normal:2,medium:3,high:4,highest:5};function py(n){return Rr(n)??"normal"}function gy(n){return n==="urgent"?"highest":n==="none"?"normal":n}class my extends St{constructor(e,t){super(),this.operator=e,this.level=t}matches(e){const t=py(e.priority),s=uc[t],r=uc[gy(this.level)];switch(this.operator){case"is":return s===r;case"above":return s>r;case"below":return s<r;default:return!1}}}class yy extends St{constructor(e,t=!1){super(),this.tag=e,this.negate=t}matches(e){const t=e.tags||[],s=this.tag.toLowerCase(),r=t.some(a=>a.toLowerCase().includes(s));return this.negate?!r:r}}class by extends St{constructor(e=!1){super(),this.negate=e}matches(e){const t=e.tags&&e.tags.length>0;return this.negate?!t:!!t}}class _y extends St{constructor(e,t=!1){super(),this.pattern=e,this.negate=t}matches(e){const s=(e.path||"").toLowerCase().includes(this.pattern.toLowerCase());return this.negate?!s:s}}class wy extends St{constructor(e,t=!1){super(),this.dependencyGraph=e,this.negate=t}matches(e){if(!this.dependencyGraph){const s=e.blockedBy&&e.blockedBy.length>0;return this.negate?!s:!!s}const t=this.dependencyGraph.isBlocked(e.id);return this.negate?!t:t}}class ky extends St{constructor(e,t=!1){super(),this.dependencyGraph=e,this.negate=t}matches(e){if(!this.dependencyGraph)return!!this.negate;const t=this.dependencyGraph.isBlocking(e.id);return this.negate?!t:t}}class Ty extends St{constructor(e=!1){super(),this.negate=e}matches(e){const t=e.frequency&&e.frequency.type!=="once";return this.negate?!t:!!t}}class Sy extends St{constructor(e,t){super(),this.left=e,this.right=t}matches(e){return this.left.matches(e)&&this.right.matches(e)}}class xy extends St{constructor(e,t){super(),this.left=e,this.right=t}matches(e){return this.left.matches(e)||this.right.matches(e)}}class Dy extends St{constructor(e){super(),this.inner=e}matches(e){return!this.inner.matches(e)}}class Ey extends St{constructor(e,t,s=!1){super(),this.operator=e,this.pattern=t,this.caseSensitive=s}matches(e){const t=e.name||"",s=e.description||"",r=`${t} ${s}`.trim();switch(this.operator){case"includes":{const a=this.caseSensitive?this.pattern:this.pattern.toLowerCase();return(this.caseSensitive?r:r.toLowerCase()).includes(a)}case"does not include":{const a=this.caseSensitive?this.pattern:this.pattern.toLowerCase();return!(this.caseSensitive?r:r.toLowerCase()).includes(a)}case"regex":try{const a=this.caseSensitive?"":"i";return new RegExp(this.pattern,a).test(r)}catch{return!1}}}}class Ay extends St{constructor(e,t){super(),this.operator=e,this.pattern=t}matches(e){const s=(e.heading||"").toLowerCase().includes(this.pattern.toLowerCase());return this.operator==="includes"?s:!s}}class Cy extends St{constructor(e,t,s,r){super(),this.comparator=e,this.threshold=t,this.referenceDate=s,this.settings=r}matches(e){const t=zo(e,{now:this.referenceDate,settings:this.settings});switch(this.comparator){case"above":return t>this.threshold;case"below":return t<this.threshold;case"is":return t===this.threshold;default:return!1}}}class Pn{group(e){const t=new Map;for(const s of e){const r=this.getGroupKey(s);this.addToGroup(t,r,s)}return t}addToGroup(e,t,s){e.has(t)||e.set(t,[]),e.get(t).push(s)}}class Iy extends Pn{getGroupKey(e){if(!e.dueAt)return"No due date";const t=new Date;t.setHours(0,0,0,0);const s=new Date(e.dueAt);s.setHours(0,0,0,0);const r=s.getTime()-t.getTime(),a=Math.ceil(r/(1e3*60*60*24));return a<0?"Overdue":a===0?"Today":a===1?"Tomorrow":a<=7?"This Week":"Later"}}class My extends Pn{getGroupKey(e){if(!e.scheduledAt)return"No scheduled date";const t=new Date;t.setHours(0,0,0,0);const s=new Date(e.scheduledAt);s.setHours(0,0,0,0);const r=s.getTime()-t.getTime(),a=Math.ceil(r/(1e3*60*60*24));return a<0?"Past":a===0?"Today":a===1?"Tomorrow":a<=7?"This Week":"Later"}}class Oy extends Pn{getGroupKey(e){const t=Hs.getInstance(),s=e.statusSymbol||" ";return t.get(s).type}}class Ry extends Pn{getGroupKey(e){const t=Hs.getInstance(),s=e.statusSymbol||" ";return t.get(s).name}}class Ny extends Pn{getGroupKey(e){const t=e.priority||"normal";return t.charAt(0).toUpperCase()+t.slice(1)}}class Py extends Pn{getGroupKey(e){return e.path||""||"No path"}}class Ly extends Pn{getGroupKey(e){const t=e.path||"";if(!t)return"No folder";const s=t.lastIndexOf("/");return s===-1?"Root":t.substring(0,s)||"Root"}}class Fy extends Pn{group(e){const t=new Map;for(const s of e){const r=s.tags||[];if(r.length===0)this.addToGroup(t,"No tags",s);else for(const a of r)this.addToGroup(t,a,s)}return t}getGroupKey(e){const t=e.tags||[];return t.length>0?t[0]:"No tags"}}function qy(n){const e=[];if(n.filters.length>0){e.push("**Filters:**");for(const t of n.filters)e.push(`- ${mr(t)}`)}else e.push("**Filters:** None (showing all tasks)");if(n.sort){const t=n.sort.reverse?"descending":"ascending";e.push(`
**Sort:** By ${n.sort.field} (${t})`)}return n.group&&e.push(`
**Group:** By ${n.group.field}`),n.limit!==void 0&&n.limit>0&&e.push(`
**Limit:** First ${n.limit} tasks`),e.join(`
`)}function mr(n){const e=n.negate?"NOT ":"";switch(n.type){case"status":return`${e}Status ${n.operator} "${n.value}"`;case"date":return`${e}${n.value.field} ${n.value.comparator} ${n.value.date}`;case"priority":return`${e}Priority ${n.operator} ${n.value}`;case"urgency":return`${e}Urgency ${n.operator} ${n.value}`;case"tag":return n.operator==="includes"?`${e}Tag includes "${n.value}"`:n.operator==="has"?`${e}Has tags`:`${e}Tag ${n.operator} "${n.value}"`;case"path":return`${e}Path ${n.operator} "${n.value}"`;case"dependency":return n.value==="blocked"?`${e}Is blocked by another task`:n.value==="blocking"?`${e}Is blocking another task`:`${e}Dependency ${n.operator} ${n.value}`;case"recurrence":return`${e}Recurrence ${n.operator} ${n.value}`;case"boolean":return n.operator==="AND"||n.operator==="and"?`(${mr(n.left)} AND ${mr(n.right)})`:n.operator==="OR"||n.operator==="or"?`(${mr(n.left)} OR ${mr(n.right)})`:n.operator==="NOT"||n.operator==="not"?`(NOT ${mr(n.inner)})`:"Unknown boolean filter";case"done":return n.value?`${e}done`:`${e}not done`;case"description":return`${e}Description ${n.operator} "${n.value}"`;default:return`${e}Unknown filter`}}class vd{constructor(e,t={}){b(this,"dependencyGraph",null);b(this,"globalFilterAST",null);b(this,"urgencySettings");this.taskIndex=e,this.urgencySettings=t.urgencySettings??Bo}setDependencyGraph(e){this.dependencyGraph=e}setGlobalFilter(e){if(!e){this.globalFilterAST=null;return}try{const t=new sr;this.globalFilterAST=t.parse(e)}catch(t){console.error("Failed to parse global filter:",t),this.globalFilterAST=null}}execute(e){const t=performance.now(),s=new Date;try{const r=e.explain?this.generateExplanation(e):void 0;let a=this.taskIndex.getAllTasks();const i=a.length;this.globalFilterAST&&this.globalFilterAST.filters.length>0&&(a=this.applyFilters(a,this.globalFilterAST.filters,s)),e.filters.length>0&&(a=this.applyFilters(a,e.filters,s)),e.sort&&(a=this.applySort(a,e.sort,s)),e.limit!==void 0&&e.limit>0&&(a=a.slice(0,e.limit));let l;e.group&&(l=this.applyGrouping(a,e.group));const u=performance.now()-t;return{tasks:a,groups:l,totalCount:i,executionTimeMs:u,explanation:r}}catch(r){throw new fr(`Failed to execute query: ${r instanceof Error?r.message:String(r)}`,r instanceof Error?r:void 0)}}executeString(e){const s=new sr().parse(e);return this.execute(s)}validateQuery(e){try{return{valid:!0,parsedFilters:new sr().parse(e).filters.map(r=>`${r.type}:${r.operator}`)}}catch(t){return{valid:!1,error:t instanceof Error?t.message:String(t)}}}applyFilters(e,t,s){let r=e;for(const a of t){const i=this.createFilter(a,s);r=r.filter(l=>i.matches(l))}return r}createFilter(e,t){switch(e.type){case"done":return e.value?new hy:new fy;case"status":if(e.operator==="type-is")return new cy(e.value,e.negate);if(e.operator==="name-includes")return new uy(e.value,e.negate);if(e.operator==="symbol-is")return new dy(e.value,e.negate);throw new fr(`Unknown status operator: ${e.operator}`);case"date":return e.operator==="has"?new vy(e.value.field,e.negate):e.operator==="between"?new cc(e.value.field,e.operator,e.value.date,e.value.endDate):new cc(e.value.field,e.operator,e.value.date);case"priority":return new my(e.operator,e.value);case"urgency":return new Cy(e.operator,e.value,t,this.urgencySettings);case"tag":return e.operator==="has"?new by(!e.value):new yy(e.value,e.negate);case"path":return new _y(e.value,e.negate);case"dependency":if(e.operator==="is-blocked")return new wy(this.dependencyGraph,!e.value);if(e.operator==="is-blocking")return new ky(this.dependencyGraph,!e.value);throw new fr(`Unknown dependency operator: ${e.operator}`);case"recurrence":return new Ty(!e.value);case"description":return new Ey(e.operator,e.value,e.negate);case"heading":return new Ay(e.operator,e.value);case"boolean":if(e.operator==="AND"&&e.left&&e.right)return new Sy(this.createFilter(e.left,t),this.createFilter(e.right,t));if(e.operator==="OR"&&e.left&&e.right)return new xy(this.createFilter(e.left,t),this.createFilter(e.right,t));if(e.operator==="NOT"&&e.inner)return new Dy(this.createFilter(e.inner,t));throw new fr(`Invalid boolean operator: ${e.operator}`);default:throw new fr(`Unknown filter type: ${e.type}`)}}applySort(e,t,s){const r=[...e];return r.sort((a,i)=>{let l=0;switch(t.field){case"due":l=this.compareDates(a.dueAt,i.dueAt);break;case"scheduled":l=this.compareDates(a.scheduledAt,i.scheduledAt);break;case"start":l=this.compareDates(a.startAt,i.startAt);break;case"created":l=this.compareDates(a.createdAt,i.createdAt);break;case"done":l=this.compareDates(a.doneAt,i.doneAt);break;case"priority":l=this.comparePriorities(a.priority,i.priority);break;case"urgency":l=this.getUrgencyScore(i,s)-this.getUrgencyScore(a,s);break;case"status.type":l=this.compareStatusTypes(a,i);break;case"description":l=(a.description||"").localeCompare(i.description||"");break;case"heading":l=(a.heading||"").localeCompare(i.heading||"");break;case"path":l=(a.path||"").localeCompare(i.path||"");break;default:l=a.name.localeCompare(i.name)}return t.reverse?-l:l}),r}compareDates(e,t){return!e&&!t?0:e?t?new Date(e).getTime()-new Date(t).getTime():-1:1}comparePriorities(e,t){const s={lowest:0,low:1,normal:2,medium:3,high:4,highest:5},r=s[Rr(e)||"normal"]||2,a=s[Rr(t)||"normal"]||2;return r-a}compareStatusTypes(e,t){const s=r=>{const a=r.statusSymbol||" ";return a===" "?0:a==="/"?1:a==="x"?2:a==="-"?3:0};return s(e)-s(t)}getUrgencyScore(e,t){return zo(e,{now:t,settings:this.urgencySettings})}applyGrouping(e,t){return this.createGrouper(t.field).group(e)}createGrouper(e){switch(e){case"due":return new Iy;case"scheduled":return new My;case"status.type":return new Oy;case"status.name":return new Ry;case"priority":return new Ny;case"path":return new Py;case"folder":return new Ly;case"tags":return new Fy;default:throw new fr(`Unknown grouping field: ${e}`)}}generateExplanation(e){return qy(e)}}class pd{constructor(e){b(this,"parser");this.parser=e??new sr}compose(e,t){const{query:s,ignoreGlobal:r}=this.stripIgnoreDirective(e),a=this.parser.parse(s);return!r&&t&&t.filters.length>0?{ast:{...a,filters:[...t.filters,...a.filters]},ignoredGlobal:!1}:{ast:a,ignoredGlobal:r}}stripIgnoreDirective(e){const t=e.split(`
`),s=[];let r=!1;for(const a of t){if(/^ignore global query$/i.test(a.trim())){r=!0;continue}s.push(a)}return{query:s.join(`
`),ignoreGlobal:r}}}const gd={enabled:!1,query:""},Bn=class Bn{constructor(e=gd){b(this,"config");b(this,"ast",null);b(this,"error",null);this.config=e,this.parse()}static getInstance(){return Bn.instance||(Bn.instance=new Bn),Bn.instance}initialize(e){this.config=e,this.parse()}updateConfig(e){this.config=e,this.parse()}getConfig(){return this.config}isEnabled(){return this.config.enabled&&this.config.query.trim().length>0}getAST(){return this.ast}getError(){return this.error}parse(){if(!this.isEnabled()){this.ast=null,this.error=null;return}try{const e=new sr;this.ast=e.parse(this.config.query),this.error=null}catch(e){this.ast=null,this.error=e instanceof Error?e.message:String(e)}}};b(Bn,"instance",null);let aa=Bn;var Uy=C('<button class="search-tab__btn svelte-1yjlv38"> </button>'),By=C('<div class="search-tab__error svelte-1yjlv38"> </div>'),zy=C('<div class="search-tab__stats svelte-1yjlv38"> </div>'),$y=C('<li><button class="search-tab__history-item svelte-1yjlv38"> </button></li>'),Yy=C('<div class="search-tab__history svelte-1yjlv38"><div class="search-tab__history-header svelte-1yjlv38"><h3 class="svelte-1yjlv38">Recent Queries</h3> <button class="search-tab__btn--small svelte-1yjlv38">Clear</button></div> <ul class="search-tab__history-list svelte-1yjlv38"></ul></div>'),jy=C('<button class="search-tab__example-btn svelte-1yjlv38"><code class="svelte-1yjlv38"> </code></button>'),Wy=C('<div class="search-tab__empty svelte-1yjlv38"><p class="svelte-1yjlv38"> No tasks match your query</p> <p class="search-tab__empty-subtitle svelte-1yjlv38">Try adjusting your search criteria</p></div>'),Hy=C('<div class="search-tab__card-wrapper svelte-1yjlv38" role="listitem"><!></div>'),Gy=C(`<div class="search-tab svelte-1yjlv38"><div class="search-tab__header svelte-1yjlv38"><h2 class="search-tab__title svelte-1yjlv38">Search</h2> <p class="search-tab__subtitle svelte-1yjlv38">Use query language to filter and search tasks</p></div> <div class="search-tab__query-section svelte-1yjlv38"><div class="search-tab__input-wrapper svelte-1yjlv38"><textarea class="search-tab__input svelte-1yjlv38" placeholder="Enter query (e.g., 'not done AND priority high')..." rows="2"></textarea> <div class="search-tab__input-actions svelte-1yjlv38"><button class="search-tab__btn search-tab__btn--primary svelte-1yjlv38"> </button> <!></div></div> <!> <!></div> <!> <div class="search-tab__examples svelte-1yjlv38"><h3 class="search-tab__examples-title svelte-1yjlv38">Example Queries</h3> <div class="search-tab__examples-grid svelte-1yjlv38"></div></div> <div class="search-tab__results svelte-1yjlv38" role="list" aria-label="Search results"><!></div></div>`);function Ky(n,e){ht(e,!0);let t=V(""),s=V(De([])),r=V(""),a=V(0),i=V(De([])),l=V(!1),c=V(!1);const u=["not done","priority is high","due before tomorrow","not done AND priority above medium","is blocked","description includes meeting","tag includes #work","is recurring","priority is high OR priority is medium","NOT is blocked","not done AND priority is high AND description includes priority","sort by priority","sort by urgency","urgency above 80","group by priority"],d={getAllTasks:()=>e.tasks},f=ou(Yo),p=new vd(d,{urgencySettings:f}),y=new pd(new sr);function w(){if(!o(t).trim()){T(s,[],!0),T(r,"");return}T(c,!0),T(r,"");try{const B=aa.getInstance();if(B.isEnabled()&&B.getError())throw new Error(`Global query error: ${B.getError()}`);const A=y.compose(o(t),B.getAST()).ast,F=p.execute(A);if(T(s,F.tasks,!0),T(a,F.executionTimeMs,!0),!o(i).includes(o(t))){T(i,[o(t),...o(i)].slice(0,10),!0);try{localStorage.setItem("query-history",JSON.stringify(o(i)))}catch{}}}catch(B){T(r,B instanceof Error?B.message:String(B),!0),T(s,[],!0),W.error(`Query error: ${o(r)}`)}finally{T(c,!1)}}function m(){try{const B=localStorage.getItem("query-history");B&&T(i,JSON.parse(B),!0)}catch{}}function g(B){T(t,B,!0),w()}function _(B){T(t,B,!0),T(l,!1),w()}function x(){T(i,[],!0);try{localStorage.removeItem("query-history")}catch{}T(l,!1)}function D(B){B.key==="Enter"&&!B.shiftKey&&(B.preventDefault(),w())}kt(()=>{m()});let E=V(0),R=De([]);kt(()=>{o(E)>=o(s).length&&T(E,Math.max(0,o(s).length-1),!0)});function P(B,A){B.key==="ArrowDown"?(B.preventDefault(),T(E,Math.min(o(E)+1,o(s).length-1),!0)):B.key==="ArrowUp"?(B.preventDefault(),T(E,Math.max(o(E)-1,0),!0)):B.key==="Enter"&&e.onEdit?(B.preventDefault(),e.onEdit(o(s)[A])):B.key===" "&&e.onDone&&(B.preventDefault(),e.onDone(o(s)[A]))}var L=Gy(),H=v(h(L),2),Y=h(H),X=h(Y);X.__keydown=D;var oe=v(X,2),ae=h(oe);ae.__click=w;var ve=h(ae),Q=v(ae,2);{var Z=B=>{var A=Uy();A.__click=()=>T(l,!o(l));var F=h(A);$(()=>N(F,`History (${o(i).length??""})`)),S(B,A)};j(Q,B=>{o(i).length>0&&B(Z)})}var U=v(Y,2);{var M=B=>{var A=By(),F=h(A);$(()=>N(F,` ${o(r)??""}`)),S(B,A)};j(U,B=>{o(r)&&B(M)})}var I=v(U,2);{var G=B=>{var A=zy(),F=h(A);$(K=>N(F,`Found ${o(s).length??""} task${o(s).length!==1?"s":""} in ${K??""}ms`),[()=>o(a).toFixed(2)]),S(B,A)};j(I,B=>{o(a)>0&&!o(r)&&B(G)})}var se=v(H,2);{var be=B=>{var A=Yy(),F=h(A),K=v(h(F),2);K.__click=x;var ie=v(F,2);We(ie,21,()=>o(i),yt,(O,q)=>{var ee=$y(),me=h(ee);me.__click=()=>_(o(q));var _e=h(me);$(()=>N(_e,o(q))),S(O,ee)}),S(B,A)};j(se,B=>{o(l)&&o(i).length>0&&B(be)})}var pe=v(se,2),ce=v(h(pe),2);We(ce,21,()=>u,yt,(B,A)=>{var F=jy();F.__click=()=>g(o(A));var K=h(F),ie=h(K);$(()=>N(ie,o(A))),S(B,F)});var Ie=v(pe,2),Me=h(Ie);{var Be=B=>{var A=Wy();S(B,A)},de=B=>{var A=lt(),F=Ve(A);{var K=ie=>{var O=lt(),q=Ve(O);We(q,19,()=>o(s),ee=>ee.id,(ee,me,_e)=>{var ue=Hy();ue.__keydown=Ae=>P(Ae,o(_e));var Ee=h(ue);qr(Ee,{get task(){return o(me)},get onEdit(){return e.onEdit},get onDone(){return e.onDone},get onDelete(){return e.onDelete}}),Ps(ue,(Ae,ze)=>R[ze]=Ae,Ae=>R==null?void 0:R[Ae],()=>[o(_e)]),$(()=>Le(ue,"tabindex",o(_e)===o(E)?0:-1)),Bt("focus",ue,()=>T(E,o(_e),!0)),S(ee,ue)}),S(ie,O)};j(F,ie=>{o(s).length>0&&ie(K)},!0)}S(B,A)};j(Me,B=>{o(s).length===0&&o(t).trim()&&!o(r)?B(Be):B(de,!1)})}$(()=>{ae.disabled=o(c),N(ve,o(c)?"Searching...":"Search")}),ut(X,()=>o(t),B=>T(t,B)),S(n,L),ft()}Tt(["keydown","click"]);class Vy{analyzeCompletionPatterns(e){if(!e.completionHistory||e.completionHistory.length===0)return this.getDefaultInsight();const t=e.completionHistory,s=new dc,r=this.calculateAverageDelay(t),a=s.calculateOptimalTime(t),i=s.findWeekdayPatterns(t),l=Array.from(i.keys()).filter(y=>{const w=i.get(y);return w&&w.confidence>.5}),c=this.calculateConsistencyScore(t),u=(e.completionCount||0)+(e.missCount||0),d=u>0?(e.missCount||0)/u*100:0,f=this.generateSuggestion(r,a,l,c),p=this.calculateConfidence(t.length,c,a.confidence);return{averageCompletionDelay:r,preferredTimeOfDay:a.hour,preferredDayOfWeek:l,completionConsistency:c,missedTaskFrequency:d,suggestedAdjustment:f,confidence:p}}suggestScheduleOptimization(e){const t=this.analyzeCompletionPatterns(e);if(t.confidence<.5||!e.completionHistory||e.completionHistory.length<10)return null;const s=e.frequency,r={...s};let a="",i="";if(Math.abs(t.averageCompletionDelay)>60&&(a=`You typically complete this task around ${t.preferredTimeOfDay}:00, `,a+=t.averageCompletionDelay>0?`${Math.round(t.averageCompletionDelay/60)} hours later than scheduled.`:`${Math.round(Math.abs(t.averageCompletionDelay)/60)} hours earlier than scheduled.`,i="Better alignment with your natural completion patterns"),s.type==="weekly"&&t.preferredDayOfWeek.length>0){const l=s.weekdays||[],c=t.preferredDayOfWeek;JSON.stringify(l.sort())!==JSON.stringify(c.sort())&&(r.weekdays=c,a+=` Consider scheduling for ${this.formatWeekdays(c)} based on completion patterns.`,i="Higher completion rate on preferred days")}return a?{currentSchedule:{frequency:s,time:this.extractTimeFromDueAt(e.dueAt)},suggestedSchedule:{frequency:r,time:t.preferredTimeOfDay!==void 0?`${t.preferredTimeOfDay.toString().padStart(2,"0")}:00`:void 0},reason:a,confidence:t.confidence,expectedImprovement:i}:null}autoAdjustSchedule(e,t=.7){var a;if(!((a=e.smartRecurrence)!=null&&a.autoAdjust))return!1;const s=this.suggestScheduleOptimization(e);if(!s||s.confidence<t)return!1;if(e.frequency=s.suggestedSchedule.frequency,s.suggestedSchedule.time){const i=new Date(e.dueAt),[l,c]=s.suggestedSchedule.time.split(":").map(Number);i.setHours(l,c||0,0,0),e.dueAt=i.toISOString()}e.learningMetrics||(e.learningMetrics={averageDelayMinutes:0,optimalHour:0,consistencyScore:0,lastLearningUpdate:new Date().toISOString()});const r=this.analyzeCompletionPatterns(e);return e.learningMetrics.averageDelayMinutes=r.averageCompletionDelay,e.learningMetrics.optimalHour=r.preferredTimeOfDay,e.learningMetrics.consistencyScore=r.completionConsistency,e.learningMetrics.lastLearningUpdate=new Date().toISOString(),!0}detectAnomalies(e){const t=[];if(!e.completionHistory||e.completionHistory.length<5)return t;const r=new dc().detectSkipPatterns(e);r.isAnomalous&&t.push({type:"consistently_skipped",severity:"high",description:r.reason,affectedPeriod:{start:e.createdAt,end:new Date().toISOString()},suggestion:"Consider adjusting the recurrence frequency or disabling this task"});const a=this.detectCompletionDrift(e.completionHistory);return a.isDrifting&&t.push({type:"completion_drift",severity:a.severity,description:`Completion times are drifting ${a.direction} by an average of ${a.averageDriftMinutes} minutes`,affectedPeriod:{start:e.completionHistory[0].completedAt,end:e.completionHistory[e.completionHistory.length-1].completedAt},suggestion:"Consider adjusting the scheduled time to match your natural completion pattern"}),t}getDefaultInsight(){return{averageCompletionDelay:0,preferredTimeOfDay:9,preferredDayOfWeek:[],completionConsistency:0,missedTaskFrequency:0,suggestedAdjustment:"Not enough data to generate insights (need at least 10 completions)",confidence:0}}calculateAverageDelay(e){if(e.length===0)return 0;const t=e.reduce((s,r)=>s+r.delayMinutes,0);return Math.round(t/e.length)}calculateConsistencyScore(e){if(e.length<2)return 0;const t=this.calculateAverageDelay(e),s=e.reduce((i,l)=>{const c=l.delayMinutes-t;return i+c*c},0)/e.length,r=Math.sqrt(s),a=Math.max(0,1-r/240);return Math.round(a*100)/100}generateSuggestion(e,t,s,r){if(r<.3)return"Completion patterns are inconsistent. Try to complete tasks at similar times.";const a=[];if(Math.abs(e)>60){const i=Math.round(Math.abs(e)/60);e>0?a.push(`Consider scheduling ${i} hour(s) later (around ${t.hour}:00)`):a.push(`Consider scheduling ${i} hour(s) earlier (around ${t.hour}:00)`)}return s.length>0&&t.confidence>.6&&a.push(`Best completion rate on ${this.formatWeekdays(s)}`),a.length>0?a.join(". "):"Maintaining good completion consistency!"}calculateConfidence(e,t,s){const a=Math.min(1,e/30)*.4+t*.3+s*.3;return Math.round(a*100)/100}extractTimeFromDueAt(e){const t=new Date(e);return`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`}formatWeekdays(e){const t=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];return e.map(s=>t[s]).join(", ")}detectCompletionDrift(e){if(e.length<10)return{isDrifting:!1,direction:"later",averageDriftMinutes:0,severity:"low"};const s=e.slice(-10).map(f=>f.delayMinutes);let r=0,a=0,i=0,l=0;const c=s.length;for(let f=0;f<c;f++)r+=f,a+=s[f],i+=f*s[f],l+=f*f;const u=(c*i-r*a)/(c*l-r*r),d=Math.abs(u);if(d>5){const f=d>30?"high":d>15?"medium":"low";return{isDrifting:!0,direction:u>0?"later":"earlier",averageDriftMinutes:Math.round(d),severity:f}}return{isDrifting:!1,direction:"later",averageDriftMinutes:0,severity:"low"}}}class dc{calculateOptimalTime(e){if(e.length===0)return{hour:9,confidence:0,sampleSize:0};const t=new Map;for(const i of e){const l=new Date(i.completedAt).getHours();t.set(l,(t.get(l)||0)+1)}let s=9,r=0;for(const[i,l]of t.entries())l>r&&(r=l,s=i);const a=r/e.length;return{hour:s,confidence:Math.round(a*100)/100,sampleSize:e.length}}findWeekdayPatterns(e){const t=new Map,s=new Map;for(const r of e){const a=r.dayOfWeek;s.has(a)||s.set(a,[]),s.get(a).push(r)}for(const[r,a]of s.entries()){const i=this.calculateOptimalTime(a);a.length>=2&&t.set(r,i)}return t}detectSkipPatterns(e){const t=(e.completionCount||0)+(e.missCount||0),s=t>0?(e.missCount||0)/t:0;return s>.5&&t>=10?{isAnomalous:!0,reason:`Task is skipped ${Math.round(s*100)}% of the time (${e.missCount} out of ${t})`}:(e.missCount||0)>=5&&e.currentStreak===0?{isAnomalous:!0,reason:"Task has been skipped multiple times recently"}:{isAnomalous:!1,reason:""}}}var Qy=C('<div class="empty-state svelte-14xzl1l"><svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="svelte-14xzl1l"><path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg> <h3 class="svelte-14xzl1l">No Smart Tasks Yet</h3> <p>Enable smart recurrence on your tasks and complete them at least 5 times to see insights.</p></div>'),Xy=C('<div class="suggestion-box svelte-14xzl1l"><div class="suggestion-icon svelte-14xzl1l"></div> <p class="svelte-14xzl1l"> </p></div>'),Zy=C('<div class="schedule-suggestion svelte-14xzl1l"><h4 class="svelte-14xzl1l">Suggested Schedule Adjustment</h4> <div class="schedule-comparison svelte-14xzl1l"><div class="schedule-column svelte-14xzl1l"><span class="schedule-label svelte-14xzl1l">Current</span> <span class="schedule-value svelte-14xzl1l"> </span></div> <div class="schedule-arrow svelte-14xzl1l"></div> <div class="schedule-column svelte-14xzl1l"><span class="schedule-label svelte-14xzl1l">Suggested</span> <span class="schedule-value svelte-14xzl1l"> </span></div></div> <p class="suggestion-reason svelte-14xzl1l"> </p> <p class="suggestion-improvement svelte-14xzl1l"> </p> <button class="apply-btn svelte-14xzl1l">Apply Suggestion</button></div>'),Jy=C('<div class="anomaly-card svelte-14xzl1l"><div class="anomaly-header svelte-14xzl1l"><span class="anomaly-type svelte-14xzl1l"> </span> <span class="anomaly-severity svelte-14xzl1l"> </span></div> <p class="anomaly-description svelte-14xzl1l"> </p> <p class="anomaly-suggestion svelte-14xzl1l"> </p></div>'),eb=C('<div class="anomalies-section svelte-14xzl1l"><h4 class="svelte-14xzl1l"> Detected Issues</h4> <!></div>'),tb=C('<span class="history-label svelte-14xzl1l"> </span>'),sb=C('<div class="history-summary svelte-14xzl1l"><span class="history-label svelte-14xzl1l"> </span> <!></div>'),nb=C('<div class="insight-card svelte-14xzl1l"><div class="insight-header svelte-14xzl1l"><h3 class="svelte-14xzl1l"> </h3> <div class="confidence-badge svelte-14xzl1l"> </div></div> <div class="insight-stats svelte-14xzl1l"><div class="stat-item svelte-14xzl1l"><span class="stat-label svelte-14xzl1l">Consistency</span> <span class="stat-value svelte-14xzl1l"> </span></div> <div class="stat-item svelte-14xzl1l"><span class="stat-label svelte-14xzl1l">Avg Delay</span> <span class="stat-value svelte-14xzl1l"> </span></div> <div class="stat-item svelte-14xzl1l"><span class="stat-label svelte-14xzl1l">Preferred Time</span> <span class="stat-value svelte-14xzl1l"> </span></div> <div class="stat-item svelte-14xzl1l"><span class="stat-label svelte-14xzl1l">Completion Rate</span> <span class="stat-value svelte-14xzl1l"> </span></div></div> <!> <!> <!> <!></div>'),rb=C('<div class="insights-list svelte-14xzl1l"></div>'),ab=C('<div class="insights-tab svelte-14xzl1l"><div class="insights-header svelte-14xzl1l"><h2 class="svelte-14xzl1l">Smart Insights</h2> <p class="svelte-14xzl1l">Learn from your task completion patterns to optimize your schedule</p></div> <!></div>');function ib(n,e){ht(e,!0);const t=new Vy,s=J(()=>e.tasks.filter(g=>{var _;return((_=g.smartRecurrence)==null?void 0:_.enabled)&&g.completionHistory&&g.completionHistory.length>=5})),r=J(()=>o(s).map(g=>({task:g,insight:t.analyzeCompletionPatterns(g),suggestion:t.suggestScheduleOptimization(g),anomalies:t.detectAnomalies(g)}))),a=J(()=>o(r).sort((g,_)=>_.insight.confidence-g.insight.confidence));function i(g,_){var x;(x=e.onApplySuggestion)==null||x.call(e,g,_)}function l(g){if(Math.abs(g)<60)return`${Math.abs(g)} minutes`;const _=Math.abs(Math.round(g/60));return`${_} hour${_!==1?"s":""}`}function c(g){const _=g>=12?"PM":"AM";return`${g>12?g-12:g===0?12:g}:00 ${_}`}function u(g){return g>=.8?"Excellent":g>=.6?"Good":g>=.4?"Fair":"Inconsistent"}function d(g){return g>=.8?"#4caf50":g>=.6?"#2196f3":g>=.4?"#ff9800":"#f44336"}function f(g){switch(g){case"low":return"#ff9800";case"medium":return"#ff5722";case"high":return"#f44336"}}var p=ab(),y=v(h(p),2);{var w=g=>{var _=Qy();S(g,_)},m=g=>{var _=rb();We(_,21,()=>o(a),yt,(x,D)=>{let E=()=>o(D).task,R=()=>o(D).insight,P=()=>o(D).suggestion,L=()=>o(D).anomalies;var H=nb(),Y=h(H),X=h(Y),oe=h(X),ae=v(X,2),ve=h(ae),Q=v(Y,2),Z=h(Q),U=v(h(Z),2),M=h(U),I=v(Z,2),G=v(h(I),2),se=h(G),be=v(I,2),pe=v(h(be),2),ce=h(pe),Ie=v(be,2),Me=v(h(Ie),2),Be=h(Me),de=v(Q,2);{var B=ee=>{var me=Xy(),_e=v(h(me),2),ue=h(_e);$(()=>N(ue,R().suggestedAdjustment)),S(ee,me)};j(de,ee=>{R().suggestedAdjustment&&ee(B)})}var A=v(de,2);{var F=ee=>{var me=Zy(),_e=v(h(me),2),ue=h(_e),Ee=v(h(ue),2),Ae=h(Ee),ze=v(ue,4),Ze=v(h(ze),2),He=h(Ze),at=v(_e,2),dt=h(at),Ce=v(at,2),Ne=h(Ce),xe=v(Ce,2);xe.__click=()=>i(E(),P()),$(()=>{N(Ae,P().currentSchedule.time||"Not set"),N(He,P().suggestedSchedule.time||"Not set"),N(dt,P().reason),N(Ne,`Expected: ${P().expectedImprovement??""}`)}),S(ee,me)};j(A,ee=>{P()&&ee(F)})}var K=v(A,2);{var ie=ee=>{var me=eb(),_e=v(h(me),2);We(_e,17,L,yt,(ue,Ee)=>{var Ae=Jy(),ze=h(Ae),Ze=h(ze),He=h(Ze),at=v(Ze,2),dt=h(at),Ce=v(ze,2),Ne=h(Ce),xe=v(Ce,2),Pe=h(xe);$((Ge,Ue,st)=>{Ns(Ae,`border-left-color: ${Ge??""}`),N(He,Ue),Ns(at,`background-color: ${st??""}`),N(dt,o(Ee).severity),N(Ne,o(Ee).description),N(Pe,` ${o(Ee).suggestion??""}`)},[()=>f(o(Ee).severity),()=>o(Ee).type.replace(/_/g," "),()=>f(o(Ee).severity)]),S(ue,Ae)}),S(ee,me)};j(K,ee=>{L().length>0&&ee(ie)})}var O=v(K,2);{var q=ee=>{var me=sb(),_e=h(me),ue=h(_e),Ee=v(_e,2);{var Ae=ze=>{var Ze=tb(),He=h(Ze);$(at=>N(He,`Last updated: ${at??""}`),[()=>new Date(E().learningMetrics.lastLearningUpdate).toLocaleDateString()]),S(ze,Ze)};j(Ee,ze=>{E().learningMetrics&&ze(Ae)})}$(()=>N(ue,` ${E().completionHistory.length??""} completions tracked`)),S(ee,me)};j(O,ee=>{E().completionHistory&&E().completionHistory.length>0&&ee(q)})}$((ee,me,_e,ue,Ee,Ae,ze)=>{N(oe,E().name),Ns(ae,`background-color: ${ee??""}`),N(ve,`${me??""}% confidence`),Ns(U,`color: ${_e??""}`),N(M,ue),N(se,`${R().averageCompletionDelay>0?"+":""}${Ee??""}`),N(ce,Ae),N(Be,`${ze??""}%`)},[()=>d(R().confidence),()=>Math.round(R().confidence*100),()=>d(R().completionConsistency),()=>u(R().completionConsistency),()=>l(R().averageCompletionDelay),()=>c(R().preferredTimeOfDay),()=>Math.round(100-R().missedTaskFrequency)]),S(x,H)}),S(g,_)};j(y,g=>{o(s).length===0?g(w):g(m,!1)})}S(n,p),ft()}Tt(["click"]);var io=["MO","TU","WE","TH","FR","SA","SU"],Zt=function(){function n(e,t){if(t===0)throw new Error("Can't create weekday with n == 0");this.weekday=e,this.n=t}return n.fromStr=function(e){return new n(io.indexOf(e))},n.prototype.nth=function(e){return this.n===e?this:new n(this.weekday,e)},n.prototype.equals=function(e){return this.weekday===e.weekday&&this.n===e.n},n.prototype.toString=function(){var e=io[this.weekday];return this.n&&(e=(this.n>0?"+":"")+String(this.n)+e),e},n.prototype.getJsWeekday=function(){return this.weekday===6?0:this.weekday+1},n}(),_t=function(n){return n!=null},Fs=function(n){return typeof n=="number"},hc=function(n){return typeof n=="string"&&io.includes(n)},vs=Array.isArray,Ks=function(n,e){e===void 0&&(e=n),arguments.length===1&&(e=n,n=0);for(var t=[],s=n;s<e;s++)t.push(s);return t},$e=function(n,e){var t=0,s=[];if(vs(n))for(;t<e;t++)s[t]=[].concat(n);else for(;t<e;t++)s[t]=n;return s},ob=function(n){return vs(n)?n:[n]};function pr(n,e,t){t===void 0&&(t=" ");var s=String(n);return e=e>>0,s.length>e?String(s):(e=e-s.length,e>t.length&&(t+=$e(t,e/t.length)),t.slice(0,e)+String(s))}var lb=function(n,e,t){var s=n.split(e);return t?s.slice(0,t).concat([s.slice(t).join(e)]):s},xs=function(n,e){var t=n%e;return t*e<0?t+e:t},Ri=function(n,e){return{div:Math.floor(n/e),mod:xs(n,e)}},js=function(n){return!_t(n)||n.length===0},Ot=function(n){return!js(n)},tt=function(n,e){return Ot(n)&&n.indexOf(e)!==-1},ar=function(n,e,t,s,r,a){return s===void 0&&(s=0),r===void 0&&(r=0),a===void 0&&(a=0),new Date(Date.UTC(n,e-1,t,s,r,a))},cb=[31,28,31,30,31,30,31,31,30,31,30,31],md=1e3*60*60*24,yd=9999,bd=ar(1970,1,1),ub=[6,0,1,2,3,4,5],Jr=function(n){return n%4===0&&n%100!==0||n%400===0},_d=function(n){return n instanceof Date},Kr=function(n){return _d(n)&&!isNaN(n.getTime())},db=function(n,e){var t=n.getTime(),s=e.getTime(),r=t-s;return Math.round(r/md)},oo=function(n){return db(n,bd)},wd=function(n){return new Date(bd.getTime()+n*md)},hb=function(n){var e=n.getUTCMonth();return e===1&&Jr(n.getUTCFullYear())?29:cb[e]},Pr=function(n){return ub[n.getUTCDay()]},fc=function(n,e){var t=ar(n,e+1,1);return[Pr(t),hb(t)]},kd=function(n,e){return e=e||n,new Date(Date.UTC(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()))},lo=function(n){var e=new Date(n.getTime());return e},vc=function(n){for(var e=[],t=0;t<n.length;t++)e.push(lo(n[t]));return e},ia=function(n){n.sort(function(e,t){return e.getTime()-t.getTime()})},Ko=function(n,e){e===void 0&&(e=!0);var t=new Date(n);return[pr(t.getUTCFullYear().toString(),4,"0"),pr(t.getUTCMonth()+1,2,"0"),pr(t.getUTCDate(),2,"0"),"T",pr(t.getUTCHours(),2,"0"),pr(t.getUTCMinutes(),2,"0"),pr(t.getUTCSeconds(),2,"0"),e?"Z":""].join("")},Vo=function(n){var e=/^(\d{4})(\d{2})(\d{2})(T(\d{2})(\d{2})(\d{2})Z?)?$/,t=e.exec(n);if(!t)throw new Error("Invalid UNTIL value: ".concat(n));return new Date(Date.UTC(parseInt(t[1],10),parseInt(t[2],10)-1,parseInt(t[3],10),parseInt(t[5],10)||0,parseInt(t[6],10)||0,parseInt(t[7],10)||0))},pc=function(n,e){var t=n.toLocaleString("sv-SE",{timeZone:e});return t.replace(" ","T")+"Z"},fb=function(n,e){var t=Intl.DateTimeFormat().resolvedOptions().timeZone,s=new Date(pc(n,t)),r=new Date(pc(n,e??"UTC")),a=r.getTime()-s.getTime();return new Date(n.getTime()-a)},_r=function(){function n(e,t){this.minDate=null,this.maxDate=null,this._result=[],this.total=0,this.method=e,this.args=t,e==="between"?(this.maxDate=t.inc?t.before:new Date(t.before.getTime()-1),this.minDate=t.inc?t.after:new Date(t.after.getTime()+1)):e==="before"?this.maxDate=t.inc?t.dt:new Date(t.dt.getTime()-1):e==="after"&&(this.minDate=t.inc?t.dt:new Date(t.dt.getTime()+1))}return n.prototype.accept=function(e){++this.total;var t=this.minDate&&e<this.minDate,s=this.maxDate&&e>this.maxDate;if(this.method==="between"){if(t)return!0;if(s)return!1}else if(this.method==="before"){if(s)return!1}else if(this.method==="after")return t?!0:(this.add(e),!1);return this.add(e)},n.prototype.add=function(e){return this._result.push(e),!0},n.prototype.getValue=function(){var e=this._result;switch(this.method){case"all":case"between":return e;case"before":case"after":default:return e.length?e[e.length-1]:null}},n.prototype.clone=function(){return new n(this.method,this.args)},n}(),co=function(n,e){return co=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,s){t.__proto__=s}||function(t,s){for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(t[r]=s[r])},co(n,e)};function Qo(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");co(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var gs=function(){return gs=Object.assign||function(e){for(var t,s=1,r=arguments.length;s<r;s++){t=arguments[s];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},gs.apply(this,arguments)};function te(n,e,t){if(t||arguments.length===2)for(var s=0,r=e.length,a;s<r;s++)(a||!(s in e))&&(a||(a=Array.prototype.slice.call(e,0,s)),a[s]=e[s]);return n.concat(a||Array.prototype.slice.call(e))}var gc=function(n){Qo(e,n);function e(t,s,r){var a=n.call(this,t,s)||this;return a.iterator=r,a}return e.prototype.add=function(t){return this.iterator(t,this._result.length)?(this._result.push(t),!0):!1},e}(_r),Ga={dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],tokens:{SKIP:/^[ \r\n\t]+|^\.$/,number:/^[1-9][0-9]*/,numberAsText:/^(one|two|three)/i,every:/^every/i,"day(s)":/^days?/i,"weekday(s)":/^weekdays?/i,"week(s)":/^weeks?/i,"hour(s)":/^hours?/i,"minute(s)":/^minutes?/i,"month(s)":/^months?/i,"year(s)":/^years?/i,on:/^(on|in)/i,at:/^(at)/i,the:/^the/i,first:/^first/i,second:/^second/i,third:/^third/i,nth:/^([1-9][0-9]*)(\.|th|nd|rd|st)/i,last:/^last/i,for:/^for/i,"time(s)":/^times?/i,until:/^(un)?til/i,monday:/^mo(n(day)?)?/i,tuesday:/^tu(e(s(day)?)?)?/i,wednesday:/^we(d(n(esday)?)?)?/i,thursday:/^th(u(r(sday)?)?)?/i,friday:/^fr(i(day)?)?/i,saturday:/^sa(t(urday)?)?/i,sunday:/^su(n(day)?)?/i,january:/^jan(uary)?/i,february:/^feb(ruary)?/i,march:/^mar(ch)?/i,april:/^apr(il)?/i,may:/^may/i,june:/^june?/i,july:/^july?/i,august:/^aug(ust)?/i,september:/^sep(t(ember)?)?/i,october:/^oct(ober)?/i,november:/^nov(ember)?/i,december:/^dec(ember)?/i,comma:/^(,\s*|(and|or)\s*)+/i}},mc=function(n,e){return n.indexOf(e)!==-1},vb=function(n){return n.toString()},pb=function(n,e,t){return"".concat(e," ").concat(t,", ").concat(n)},dn=function(){function n(e,t,s,r){if(t===void 0&&(t=vb),s===void 0&&(s=Ga),r===void 0&&(r=pb),this.text=[],this.language=s||Ga,this.gettext=t,this.dateFormatter=r,this.rrule=e,this.options=e.options,this.origOptions=e.origOptions,this.origOptions.bymonthday){var a=[].concat(this.options.bymonthday),i=[].concat(this.options.bynmonthday);a.sort(function(d,f){return d-f}),i.sort(function(d,f){return f-d}),this.bymonthday=a.concat(i),this.bymonthday.length||(this.bymonthday=null)}if(_t(this.origOptions.byweekday)){var l=vs(this.origOptions.byweekday)?this.origOptions.byweekday:[this.origOptions.byweekday],c=String(l);this.byweekday={allWeeks:l.filter(function(d){return!d.n}),someWeeks:l.filter(function(d){return!!d.n}),isWeekdays:c.indexOf("MO")!==-1&&c.indexOf("TU")!==-1&&c.indexOf("WE")!==-1&&c.indexOf("TH")!==-1&&c.indexOf("FR")!==-1&&c.indexOf("SA")===-1&&c.indexOf("SU")===-1,isEveryDay:c.indexOf("MO")!==-1&&c.indexOf("TU")!==-1&&c.indexOf("WE")!==-1&&c.indexOf("TH")!==-1&&c.indexOf("FR")!==-1&&c.indexOf("SA")!==-1&&c.indexOf("SU")!==-1};var u=function(d,f){return d.weekday-f.weekday};this.byweekday.allWeeks.sort(u),this.byweekday.someWeeks.sort(u),this.byweekday.allWeeks.length||(this.byweekday.allWeeks=null),this.byweekday.someWeeks.length||(this.byweekday.someWeeks=null)}else this.byweekday=null}return n.isFullyConvertible=function(e){var t=!0;if(!(e.options.freq in n.IMPLEMENTED)||e.origOptions.until&&e.origOptions.count)return!1;for(var s in e.origOptions){if(mc(["dtstart","tzid","wkst","freq"],s))return!0;if(!mc(n.IMPLEMENTED[e.options.freq],s))return!1}return t},n.prototype.isFullyConvertible=function(){return n.isFullyConvertible(this.rrule)},n.prototype.toString=function(){var e=this.gettext;if(!(this.options.freq in n.IMPLEMENTED))return e("RRule error: Unable to fully convert this rrule to text");if(this.text=[e("every")],this[le.FREQUENCIES[this.options.freq]](),this.options.until){this.add(e("until"));var t=this.options.until;this.add(this.dateFormatter(t.getUTCFullYear(),this.language.monthNames[t.getUTCMonth()],t.getUTCDate()))}else this.options.count&&this.add(e("for")).add(this.options.count.toString()).add(this.plural(this.options.count)?e("times"):e("time"));return this.isFullyConvertible()||this.add(e("(~ approximate)")),this.text.join("")},n.prototype.HOURLY=function(){var e=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?e("hours"):e("hour"))},n.prototype.MINUTELY=function(){var e=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?e("minutes"):e("minute"))},n.prototype.DAILY=function(){var e=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()),this.byweekday&&this.byweekday.isWeekdays?this.add(this.plural(this.options.interval)?e("weekdays"):e("weekday")):this.add(this.plural(this.options.interval)?e("days"):e("day")),this.origOptions.bymonth&&(this.add(e("in")),this._bymonth()),this.bymonthday?this._bymonthday():this.byweekday?this._byweekday():this.origOptions.byhour&&this._byhour()},n.prototype.WEEKLY=function(){var e=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()).add(this.plural(this.options.interval)?e("weeks"):e("week")),this.byweekday&&this.byweekday.isWeekdays?this.options.interval===1?this.add(this.plural(this.options.interval)?e("weekdays"):e("weekday")):this.add(e("on")).add(e("weekdays")):this.byweekday&&this.byweekday.isEveryDay?this.add(this.plural(this.options.interval)?e("days"):e("day")):(this.options.interval===1&&this.add(e("week")),this.origOptions.bymonth&&(this.add(e("in")),this._bymonth()),this.bymonthday?this._bymonthday():this.byweekday&&this._byweekday(),this.origOptions.byhour&&this._byhour())},n.prototype.MONTHLY=function(){var e=this.gettext;this.origOptions.bymonth?(this.options.interval!==1&&(this.add(this.options.interval.toString()).add(e("months")),this.plural(this.options.interval)&&this.add(e("in"))),this._bymonth()):(this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?e("months"):e("month"))),this.bymonthday?this._bymonthday():this.byweekday&&this.byweekday.isWeekdays?this.add(e("on")).add(e("weekdays")):this.byweekday&&this._byweekday()},n.prototype.YEARLY=function(){var e=this.gettext;this.origOptions.bymonth?(this.options.interval!==1&&(this.add(this.options.interval.toString()),this.add(e("years"))),this._bymonth()):(this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?e("years"):e("year"))),this.bymonthday?this._bymonthday():this.byweekday&&this._byweekday(),this.options.byyearday&&this.add(e("on the")).add(this.list(this.options.byyearday,this.nth,e("and"))).add(e("day")),this.options.byweekno&&this.add(e("in")).add(this.plural(this.options.byweekno.length)?e("weeks"):e("week")).add(this.list(this.options.byweekno,void 0,e("and")))},n.prototype._bymonthday=function(){var e=this.gettext;this.byweekday&&this.byweekday.allWeeks?this.add(e("on")).add(this.list(this.byweekday.allWeeks,this.weekdaytext,e("or"))).add(e("the")).add(this.list(this.bymonthday,this.nth,e("or"))):this.add(e("on the")).add(this.list(this.bymonthday,this.nth,e("and")))},n.prototype._byweekday=function(){var e=this.gettext;this.byweekday.allWeeks&&!this.byweekday.isWeekdays&&this.add(e("on")).add(this.list(this.byweekday.allWeeks,this.weekdaytext)),this.byweekday.someWeeks&&(this.byweekday.allWeeks&&this.add(e("and")),this.add(e("on the")).add(this.list(this.byweekday.someWeeks,this.weekdaytext,e("and"))))},n.prototype._byhour=function(){var e=this.gettext;this.add(e("at")).add(this.list(this.origOptions.byhour,void 0,e("and")))},n.prototype._bymonth=function(){this.add(this.list(this.options.bymonth,this.monthtext,this.gettext("and")))},n.prototype.nth=function(e){e=parseInt(e.toString(),10);var t,s=this.gettext;if(e===-1)return s("last");var r=Math.abs(e);switch(r){case 1:case 21:case 31:t=r+s("st");break;case 2:case 22:t=r+s("nd");break;case 3:case 23:t=r+s("rd");break;default:t=r+s("th")}return e<0?t+" "+s("last"):t},n.prototype.monthtext=function(e){return this.language.monthNames[e-1]},n.prototype.weekdaytext=function(e){var t=Fs(e)?(e+1)%7:e.getJsWeekday();return(e.n?this.nth(e.n)+" ":"")+this.language.dayNames[t]},n.prototype.plural=function(e){return e%100!==1},n.prototype.add=function(e){return this.text.push(" "),this.text.push(e),this},n.prototype.list=function(e,t,s,r){var a=this;r===void 0&&(r=","),vs(e)||(e=[e]);var i=function(c,u,d){for(var f="",p=0;p<c.length;p++)p!==0&&(p===c.length-1?f+=" "+d+" ":f+=u+" "),f+=c[p];return f};t=t||function(c){return c.toString()};var l=function(c){return t&&t.call(a,c)};return s?i(e.map(l),r,s):e.map(l).join(r+" ")},n}(),gb=function(){function n(e){this.done=!0,this.rules=e}return n.prototype.start=function(e){return this.text=e,this.done=!1,this.nextSymbol()},n.prototype.isDone=function(){return this.done&&this.symbol===null},n.prototype.nextSymbol=function(){var e,t;this.symbol=null,this.value=null;do{if(this.done)return!1;var s=void 0;e=null;for(var r in this.rules){s=this.rules[r];var a=s.exec(this.text);a&&(e===null||a[0].length>e[0].length)&&(e=a,t=r)}if(e!=null&&(this.text=this.text.substr(e[0].length),this.text===""&&(this.done=!0)),e==null){this.done=!0,this.symbol=null,this.value=null;return}}while(t==="SKIP");return this.symbol=t,this.value=e,!0},n.prototype.accept=function(e){if(this.symbol===e){if(this.value){var t=this.value;return this.nextSymbol(),t}return this.nextSymbol(),!0}return!1},n.prototype.acceptNumber=function(){return this.accept("number")},n.prototype.expect=function(e){if(this.accept(e))return!0;throw new Error("expected "+e+" but found "+this.symbol)},n}();function Td(n,e){e===void 0&&(e=Ga);var t={},s=new gb(e.tokens);if(!s.start(n))return null;return r(),t;function r(){s.expect("every");var p=s.acceptNumber();if(p&&(t.interval=parseInt(p[0],10)),s.isDone())throw new Error("Unexpected end");switch(s.symbol){case"day(s)":t.freq=le.DAILY,s.nextSymbol()&&(i(),f());break;case"weekday(s)":t.freq=le.WEEKLY,t.byweekday=[le.MO,le.TU,le.WE,le.TH,le.FR],s.nextSymbol(),i(),f();break;case"week(s)":t.freq=le.WEEKLY,s.nextSymbol()&&(a(),i(),f());break;case"hour(s)":t.freq=le.HOURLY,s.nextSymbol()&&(a(),f());break;case"minute(s)":t.freq=le.MINUTELY,s.nextSymbol()&&(a(),f());break;case"month(s)":t.freq=le.MONTHLY,s.nextSymbol()&&(a(),f());break;case"year(s)":t.freq=le.YEARLY,s.nextSymbol()&&(a(),f());break;case"monday":case"tuesday":case"wednesday":case"thursday":case"friday":case"saturday":case"sunday":t.freq=le.WEEKLY;var y=s.symbol.substr(0,2).toUpperCase();if(t.byweekday=[le[y]],!s.nextSymbol())return;for(;s.accept("comma");){if(s.isDone())throw new Error("Unexpected end");var w=c();if(!w)throw new Error("Unexpected symbol "+s.symbol+", expected weekday");t.byweekday.push(le[w]),s.nextSymbol()}i(),d(),f();break;case"january":case"february":case"march":case"april":case"may":case"june":case"july":case"august":case"september":case"october":case"november":case"december":if(t.freq=le.YEARLY,t.bymonth=[l()],!s.nextSymbol())return;for(;s.accept("comma");){if(s.isDone())throw new Error("Unexpected end");var m=l();if(!m)throw new Error("Unexpected symbol "+s.symbol+", expected month");t.bymonth.push(m),s.nextSymbol()}a(),f();break;default:throw new Error("Unknown symbol")}}function a(){var p=s.accept("on"),y=s.accept("the");if(p||y)do{var w=u(),m=c(),g=l();if(w)m?(s.nextSymbol(),t.byweekday||(t.byweekday=[]),t.byweekday.push(le[m].nth(w))):(t.bymonthday||(t.bymonthday=[]),t.bymonthday.push(w),s.accept("day(s)"));else if(m)s.nextSymbol(),t.byweekday||(t.byweekday=[]),t.byweekday.push(le[m]);else if(s.symbol==="weekday(s)")s.nextSymbol(),t.byweekday||(t.byweekday=[le.MO,le.TU,le.WE,le.TH,le.FR]);else if(s.symbol==="week(s)"){s.nextSymbol();var _=s.acceptNumber();if(!_)throw new Error("Unexpected symbol "+s.symbol+", expected week number");for(t.byweekno=[parseInt(_[0],10)];s.accept("comma");){if(_=s.acceptNumber(),!_)throw new Error("Unexpected symbol "+s.symbol+"; expected monthday");t.byweekno.push(parseInt(_[0],10))}}else if(g)s.nextSymbol(),t.bymonth||(t.bymonth=[]),t.bymonth.push(g);else return}while(s.accept("comma")||s.accept("the")||s.accept("on"))}function i(){var p=s.accept("at");if(p)do{var y=s.acceptNumber();if(!y)throw new Error("Unexpected symbol "+s.symbol+", expected hour");for(t.byhour=[parseInt(y[0],10)];s.accept("comma");){if(y=s.acceptNumber(),!y)throw new Error("Unexpected symbol "+s.symbol+"; expected hour");t.byhour.push(parseInt(y[0],10))}}while(s.accept("comma")||s.accept("at"))}function l(){switch(s.symbol){case"january":return 1;case"february":return 2;case"march":return 3;case"april":return 4;case"may":return 5;case"june":return 6;case"july":return 7;case"august":return 8;case"september":return 9;case"october":return 10;case"november":return 11;case"december":return 12;default:return!1}}function c(){switch(s.symbol){case"monday":case"tuesday":case"wednesday":case"thursday":case"friday":case"saturday":case"sunday":return s.symbol.substr(0,2).toUpperCase();default:return!1}}function u(){switch(s.symbol){case"last":return s.nextSymbol(),-1;case"first":return s.nextSymbol(),1;case"second":return s.nextSymbol(),s.accept("last")?-2:2;case"third":return s.nextSymbol(),s.accept("last")?-3:3;case"nth":var p=parseInt(s.value[1],10);if(p<-366||p>366)throw new Error("Nth out of range: "+p);return s.nextSymbol(),s.accept("last")?-p:p;default:return!1}}function d(){s.accept("on"),s.accept("the");var p=u();if(p)for(t.bymonthday=[p],s.nextSymbol();s.accept("comma");){if(p=u(),!p)throw new Error("Unexpected symbol "+s.symbol+"; expected monthday");t.bymonthday.push(p),s.nextSymbol()}}function f(){if(s.symbol==="until"){var p=Date.parse(s.text);if(!p)throw new Error("Cannot parse until date:"+s.text);t.until=new Date(p)}else s.accept("for")&&(t.count=parseInt(s.value[0],10),s.expect("number"))}}var je;(function(n){n[n.YEARLY=0]="YEARLY",n[n.MONTHLY=1]="MONTHLY",n[n.WEEKLY=2]="WEEKLY",n[n.DAILY=3]="DAILY",n[n.HOURLY=4]="HOURLY",n[n.MINUTELY=5]="MINUTELY",n[n.SECONDLY=6]="SECONDLY"})(je||(je={}));function Xo(n){return n<je.HOURLY}var mb=function(n,e){return e===void 0&&(e=Ga),new le(Td(n,e)||void 0)},zr=["count","until","interval","byweekday","bymonthday","bymonth"];dn.IMPLEMENTED=[];dn.IMPLEMENTED[je.HOURLY]=zr;dn.IMPLEMENTED[je.MINUTELY]=zr;dn.IMPLEMENTED[je.DAILY]=["byhour"].concat(zr);dn.IMPLEMENTED[je.WEEKLY]=zr;dn.IMPLEMENTED[je.MONTHLY]=zr;dn.IMPLEMENTED[je.YEARLY]=["byweekno","byyearday"].concat(zr);var yb=function(n,e,t,s){return new dn(n,e,t,s).toString()},bb=dn.isFullyConvertible,Ka=function(){function n(e,t,s,r){this.hour=e,this.minute=t,this.second=s,this.millisecond=r||0}return n.prototype.getHours=function(){return this.hour},n.prototype.getMinutes=function(){return this.minute},n.prototype.getSeconds=function(){return this.second},n.prototype.getMilliseconds=function(){return this.millisecond},n.prototype.getTime=function(){return(this.hour*60*60+this.minute*60+this.second)*1e3+this.millisecond},n}(),_b=function(n){Qo(e,n);function e(t,s,r,a,i,l,c){var u=n.call(this,a,i,l,c)||this;return u.year=t,u.month=s,u.day=r,u}return e.fromDate=function(t){return new this(t.getUTCFullYear(),t.getUTCMonth()+1,t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.valueOf()%1e3)},e.prototype.getWeekday=function(){return Pr(new Date(this.getTime()))},e.prototype.getTime=function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond)).getTime()},e.prototype.getDay=function(){return this.day},e.prototype.getMonth=function(){return this.month},e.prototype.getYear=function(){return this.year},e.prototype.addYears=function(t){this.year+=t},e.prototype.addMonths=function(t){if(this.month+=t,this.month>12){var s=Math.floor(this.month/12),r=xs(this.month,12);this.month=r,this.year+=s,this.month===0&&(this.month=12,--this.year)}},e.prototype.addWeekly=function(t,s){s>this.getWeekday()?this.day+=-(this.getWeekday()+1+(6-s))+t*7:this.day+=-(this.getWeekday()-s)+t*7,this.fixDay()},e.prototype.addDaily=function(t){this.day+=t,this.fixDay()},e.prototype.addHours=function(t,s,r){for(s&&(this.hour+=Math.floor((23-this.hour)/t)*t);;){this.hour+=t;var a=Ri(this.hour,24),i=a.div,l=a.mod;if(i&&(this.hour=l,this.addDaily(i)),js(r)||tt(r,this.hour))break}},e.prototype.addMinutes=function(t,s,r,a){for(s&&(this.minute+=Math.floor((1439-(this.hour*60+this.minute))/t)*t);;){this.minute+=t;var i=Ri(this.minute,60),l=i.div,c=i.mod;if(l&&(this.minute=c,this.addHours(l,!1,r)),(js(r)||tt(r,this.hour))&&(js(a)||tt(a,this.minute)))break}},e.prototype.addSeconds=function(t,s,r,a,i){for(s&&(this.second+=Math.floor((86399-(this.hour*3600+this.minute*60+this.second))/t)*t);;){this.second+=t;var l=Ri(this.second,60),c=l.div,u=l.mod;if(c&&(this.second=u,this.addMinutes(c,!1,r,a)),(js(r)||tt(r,this.hour))&&(js(a)||tt(a,this.minute))&&(js(i)||tt(i,this.second)))break}},e.prototype.fixDay=function(){if(!(this.day<=28)){var t=fc(this.year,this.month-1)[1];if(!(this.day<=t))for(;this.day>t;){if(this.day-=t,++this.month,this.month===13&&(this.month=1,++this.year,this.year>yd))return;t=fc(this.year,this.month-1)[1]}}},e.prototype.add=function(t,s){var r=t.freq,a=t.interval,i=t.wkst,l=t.byhour,c=t.byminute,u=t.bysecond;switch(r){case je.YEARLY:return this.addYears(a);case je.MONTHLY:return this.addMonths(a);case je.WEEKLY:return this.addWeekly(a,i);case je.DAILY:return this.addDaily(a);case je.HOURLY:return this.addHours(a,s,l);case je.MINUTELY:return this.addMinutes(a,s,l,c);case je.SECONDLY:return this.addSeconds(a,s,l,c,u)}},e}(Ka);function Sd(n){for(var e=[],t=Object.keys(n),s=0,r=t;s<r.length;s++){var a=r[s];tt(Qb,a)||e.push(a),_d(n[a])&&!Kr(n[a])&&e.push(a)}if(e.length)throw new Error("Invalid options: "+e.join(", "));return gs({},n)}function wb(n){var e=gs(gs({},Zo),Sd(n));if(_t(e.byeaster)&&(e.freq=le.YEARLY),!(_t(e.freq)&&le.FREQUENCIES[e.freq]))throw new Error("Invalid frequency: ".concat(e.freq," ").concat(n.freq));if(e.dtstart||(e.dtstart=new Date(new Date().setMilliseconds(0))),_t(e.wkst)?Fs(e.wkst)||(e.wkst=e.wkst.weekday):e.wkst=le.MO.weekday,_t(e.bysetpos)){Fs(e.bysetpos)&&(e.bysetpos=[e.bysetpos]);for(var t=0;t<e.bysetpos.length;t++){var s=e.bysetpos[t];if(s===0||!(s>=-366&&s<=366))throw new Error("bysetpos must be between 1 and 366, or between -366 and -1")}}if(!(e.byweekno||Ot(e.byweekno)||Ot(e.byyearday)||e.bymonthday||Ot(e.bymonthday)||_t(e.byweekday)||_t(e.byeaster)))switch(e.freq){case le.YEARLY:e.bymonth||(e.bymonth=e.dtstart.getUTCMonth()+1),e.bymonthday=e.dtstart.getUTCDate();break;case le.MONTHLY:e.bymonthday=e.dtstart.getUTCDate();break;case le.WEEKLY:e.byweekday=[Pr(e.dtstart)];break}if(_t(e.bymonth)&&!vs(e.bymonth)&&(e.bymonth=[e.bymonth]),_t(e.byyearday)&&!vs(e.byyearday)&&Fs(e.byyearday)&&(e.byyearday=[e.byyearday]),!_t(e.bymonthday))e.bymonthday=[],e.bynmonthday=[];else if(vs(e.bymonthday)){for(var r=[],a=[],t=0;t<e.bymonthday.length;t++){var s=e.bymonthday[t];s>0?r.push(s):s<0&&a.push(s)}e.bymonthday=r,e.bynmonthday=a}else e.bymonthday<0?(e.bynmonthday=[e.bymonthday],e.bymonthday=[]):(e.bynmonthday=[],e.bymonthday=[e.bymonthday]);if(_t(e.byweekno)&&!vs(e.byweekno)&&(e.byweekno=[e.byweekno]),!_t(e.byweekday))e.bynweekday=null;else if(Fs(e.byweekday))e.byweekday=[e.byweekday],e.bynweekday=null;else if(hc(e.byweekday))e.byweekday=[Zt.fromStr(e.byweekday).weekday],e.bynweekday=null;else if(e.byweekday instanceof Zt)!e.byweekday.n||e.freq>le.MONTHLY?(e.byweekday=[e.byweekday.weekday],e.bynweekday=null):(e.bynweekday=[[e.byweekday.weekday,e.byweekday.n]],e.byweekday=null);else{for(var i=[],l=[],t=0;t<e.byweekday.length;t++){var c=e.byweekday[t];if(Fs(c)){i.push(c);continue}else if(hc(c)){i.push(Zt.fromStr(c).weekday);continue}!c.n||e.freq>le.MONTHLY?i.push(c.weekday):l.push([c.weekday,c.n])}e.byweekday=Ot(i)?i:null,e.bynweekday=Ot(l)?l:null}return _t(e.byhour)?Fs(e.byhour)&&(e.byhour=[e.byhour]):e.byhour=e.freq<le.HOURLY?[e.dtstart.getUTCHours()]:null,_t(e.byminute)?Fs(e.byminute)&&(e.byminute=[e.byminute]):e.byminute=e.freq<le.MINUTELY?[e.dtstart.getUTCMinutes()]:null,_t(e.bysecond)?Fs(e.bysecond)&&(e.bysecond=[e.bysecond]):e.bysecond=e.freq<le.SECONDLY?[e.dtstart.getUTCSeconds()]:null,{parsedOptions:e}}function kb(n){var e=n.dtstart.getTime()%1e3;if(!Xo(n.freq))return[];var t=[];return n.byhour.forEach(function(s){n.byminute.forEach(function(r){n.bysecond.forEach(function(a){t.push(new Ka(s,r,a,e))})})}),t}function uo(n){var e=n.split(`
`).map(Tb).filter(function(t){return t!==null});return gs(gs({},e[0]),e[1])}function Va(n){var e={},t=/DTSTART(?:;TZID=([^:=]+?))?(?::|=)([^;\s]+)/i.exec(n);if(!t)return e;var s=t[1],r=t[2];return s&&(e.tzid=s),e.dtstart=Vo(r),e}function Tb(n){if(n=n.replace(/^\s+|\s+$/,""),!n.length)return null;var e=/^([A-Z]+?)[:;]/.exec(n.toUpperCase());if(!e)return yc(n);var t=e[1];switch(t.toUpperCase()){case"RRULE":case"EXRULE":return yc(n);case"DTSTART":return Va(n);default:throw new Error("Unsupported RFC prop ".concat(t," in ").concat(n))}}function yc(n){var e=n.replace(/^RRULE:/i,""),t=Va(e),s=n.replace(/^(?:RRULE|EXRULE):/i,"").split(";");return s.forEach(function(r){var a=r.split("="),i=a[0],l=a[1];switch(i.toUpperCase()){case"FREQ":t.freq=je[l.toUpperCase()];break;case"WKST":t.wkst=Os[l.toUpperCase()];break;case"COUNT":case"INTERVAL":case"BYSETPOS":case"BYMONTH":case"BYMONTHDAY":case"BYYEARDAY":case"BYWEEKNO":case"BYHOUR":case"BYMINUTE":case"BYSECOND":var c=Sb(l),u=i.toLowerCase();t[u]=c;break;case"BYWEEKDAY":case"BYDAY":t.byweekday=xb(l);break;case"DTSTART":case"TZID":var d=Va(n);t.tzid=d.tzid,t.dtstart=d.dtstart;break;case"UNTIL":t.until=Vo(l);break;case"BYEASTER":t.byeaster=Number(l);break;default:throw new Error("Unknown RRULE property '"+i+"'")}}),t}function Sb(n){if(n.indexOf(",")!==-1){var e=n.split(",");return e.map(bc)}return bc(n)}function bc(n){return/^[+-]?\d+$/.test(n)?Number(n):n}function xb(n){var e=n.split(",");return e.map(function(t){if(t.length===2)return Os[t];var s=t.match(/^([+-]?\d{1,2})([A-Z]{2})$/);if(!s||s.length<3)throw new SyntaxError("Invalid weekday string: ".concat(t));var r=Number(s[1]),a=s[2],i=Os[a].weekday;return new Zt(i,r)})}var Qa=function(){function n(e,t){if(isNaN(e.getTime()))throw new RangeError("Invalid date passed to DateWithZone");this.date=e,this.tzid=t}return Object.defineProperty(n.prototype,"isUTC",{get:function(){return!this.tzid||this.tzid.toUpperCase()==="UTC"},enumerable:!1,configurable:!0}),n.prototype.toString=function(){var e=Ko(this.date.getTime(),this.isUTC);return this.isUTC?":".concat(e):";TZID=".concat(this.tzid,":").concat(e)},n.prototype.getTime=function(){return this.date.getTime()},n.prototype.rezonedDate=function(){return this.isUTC?this.date:fb(this.date,this.tzid)},n}();function ho(n){for(var e=[],t="",s=Object.keys(n),r=Object.keys(Zo),a=0;a<s.length;a++)if(s[a]!=="tzid"&&tt(r,s[a])){var i=s[a].toUpperCase(),l=n[s[a]],c="";if(!(!_t(l)||vs(l)&&!l.length)){switch(i){case"FREQ":c=le.FREQUENCIES[n.freq];break;case"WKST":Fs(l)?c=new Zt(l).toString():c=l.toString();break;case"BYWEEKDAY":i="BYDAY",c=ob(l).map(function(y){return y instanceof Zt?y:vs(y)?new Zt(y[0],y[1]):new Zt(y)}).toString();break;case"DTSTART":t=Db(l,n.tzid);break;case"UNTIL":c=Ko(l,!n.tzid);break;default:if(vs(l)){for(var u=[],d=0;d<l.length;d++)u[d]=String(l[d]);c=u.toString()}else c=String(l)}c&&e.push([i,c])}}var f=e.map(function(y){var w=y[0],m=y[1];return"".concat(w,"=").concat(m.toString())}).join(";"),p="";return f!==""&&(p="RRULE:".concat(f)),[t,p].filter(function(y){return!!y}).join(`
`)}function Db(n,e){return n?"DTSTART"+new Qa(new Date(n),e).toString():""}function Eb(n,e){return Array.isArray(n)?!Array.isArray(e)||n.length!==e.length?!1:n.every(function(t,s){return t.getTime()===e[s].getTime()}):n instanceof Date?e instanceof Date&&n.getTime()===e.getTime():n===e}var Ab=function(){function n(){this.all=!1,this.before=[],this.after=[],this.between=[]}return n.prototype._cacheAdd=function(e,t,s){t&&(t=t instanceof Date?lo(t):vc(t)),e==="all"?this.all=t:(s._value=t,this[e].push(s))},n.prototype._cacheGet=function(e,t){var s=!1,r=t?Object.keys(t):[],a=function(d){for(var f=0;f<r.length;f++){var p=r[f];if(!Eb(t[p],d[p]))return!0}return!1},i=this[e];if(e==="all")s=this.all;else if(vs(i))for(var l=0;l<i.length;l++){var c=i[l];if(!(r.length&&a(c))){s=c._value;break}}if(!s&&this.all){for(var u=new _r(e,t),l=0;l<this.all.length&&u.accept(this.all[l]);l++);s=u.getValue(),this._cacheAdd(e,s,t)}return vs(s)?vc(s):s instanceof Date?lo(s):s},n}(),Cb=te(te(te(te(te(te(te(te(te(te(te(te(te([],$e(1,31),!0),$e(2,28),!0),$e(3,31),!0),$e(4,30),!0),$e(5,31),!0),$e(6,30),!0),$e(7,31),!0),$e(8,31),!0),$e(9,30),!0),$e(10,31),!0),$e(11,30),!0),$e(12,31),!0),$e(1,7),!0),Ib=te(te(te(te(te(te(te(te(te(te(te(te(te([],$e(1,31),!0),$e(2,29),!0),$e(3,31),!0),$e(4,30),!0),$e(5,31),!0),$e(6,30),!0),$e(7,31),!0),$e(8,31),!0),$e(9,30),!0),$e(10,31),!0),$e(11,30),!0),$e(12,31),!0),$e(1,7),!0),Mb=Ks(1,29),Ob=Ks(1,30),xn=Ks(1,31),jt=Ks(1,32),Rb=te(te(te(te(te(te(te(te(te(te(te(te(te([],jt,!0),Ob,!0),jt,!0),xn,!0),jt,!0),xn,!0),jt,!0),jt,!0),xn,!0),jt,!0),xn,!0),jt,!0),jt.slice(0,7),!0),Nb=te(te(te(te(te(te(te(te(te(te(te(te(te([],jt,!0),Mb,!0),jt,!0),xn,!0),jt,!0),xn,!0),jt,!0),jt,!0),xn,!0),jt,!0),xn,!0),jt,!0),jt.slice(0,7),!0),Pb=Ks(-28,0),Lb=Ks(-29,0),Dn=Ks(-30,0),Wt=Ks(-31,0),Fb=te(te(te(te(te(te(te(te(te(te(te(te(te([],Wt,!0),Lb,!0),Wt,!0),Dn,!0),Wt,!0),Dn,!0),Wt,!0),Wt,!0),Dn,!0),Wt,!0),Dn,!0),Wt,!0),Wt.slice(0,7),!0),qb=te(te(te(te(te(te(te(te(te(te(te(te(te([],Wt,!0),Pb,!0),Wt,!0),Dn,!0),Wt,!0),Dn,!0),Wt,!0),Wt,!0),Dn,!0),Wt,!0),Dn,!0),Wt,!0),Wt.slice(0,7),!0),Ub=[0,31,60,91,121,152,182,213,244,274,305,335,366],Bb=[0,31,59,90,120,151,181,212,243,273,304,334,365],_c=function(){for(var n=[],e=0;e<55;e++)n=n.concat(Ks(7));return n}();function zb(n,e){var t=ar(n,1,1),s=Jr(n)?366:365,r=Jr(n+1)?366:365,a=oo(t),i=Pr(t),l=gs(gs({yearlen:s,nextyearlen:r,yearordinal:a,yearweekday:i},$b(n)),{wnomask:null});if(js(e.byweekno))return l;l.wnomask=$e(0,s+7);var c,u,d=c=xs(7-i+e.wkst,7);d>=4?(d=0,u=l.yearlen+xs(i-e.wkst,7)):u=s-d;for(var f=Math.floor(u/7),p=xs(u,7),y=Math.floor(f+p/4),w=0;w<e.byweekno.length;w++){var m=e.byweekno[w];if(m<0&&(m+=y+1),m>0&&m<=y){var g=void 0;m>1?(g=d+(m-1)*7,d!==c&&(g-=7-c)):g=d;for(var _=0;_<7&&(l.wnomask[g]=1,g++,l.wdaymask[g]!==e.wkst);_++);}}if(tt(e.byweekno,1)){var g=d+y*7;if(d!==c&&(g-=7-c),g<s)for(var w=0;w<7&&(l.wnomask[g]=1,g+=1,l.wdaymask[g]!==e.wkst);w++);}if(d){var x=void 0;if(tt(e.byweekno,-1))x=-1;else{var D=Pr(ar(n-1,1,1)),E=xs(7-D.valueOf()+e.wkst,7),R=Jr(n-1)?366:365,P=void 0;E>=4?(E=0,P=R+xs(D-e.wkst,7)):P=s-d,x=Math.floor(52+xs(P,7)/4)}if(tt(e.byweekno,x))for(var g=0;g<d;g++)l.wnomask[g]=1}return l}function $b(n){var e=Jr(n)?366:365,t=ar(n,1,1),s=Pr(t);return e===365?{mmask:Cb,mdaymask:Nb,nmdaymask:qb,wdaymask:_c.slice(s),mrange:Bb}:{mmask:Ib,mdaymask:Rb,nmdaymask:Fb,wdaymask:_c.slice(s),mrange:Ub}}function Yb(n,e,t,s,r,a){var i={lastyear:n,lastmonth:e,nwdaymask:[]},l=[];if(a.freq===le.YEARLY)if(js(a.bymonth))l=[[0,t]];else for(var c=0;c<a.bymonth.length;c++)e=a.bymonth[c],l.push(s.slice(e-1,e+1));else a.freq===le.MONTHLY&&(l=[s.slice(e-1,e+1)]);if(js(l))return i;i.nwdaymask=$e(0,t);for(var c=0;c<l.length;c++)for(var u=l[c],d=u[0],f=u[1]-1,p=0;p<a.bynweekday.length;p++){var y=void 0,w=a.bynweekday[p],m=w[0],g=w[1];g<0?(y=f+(g+1)*7,y-=xs(r[y]-m,7)):(y=d+(g-1)*7,y+=xs(7-r[y]+m,7)),d<=y&&y<=f&&(i.nwdaymask[y]=1)}return i}function jb(n,e){e===void 0&&(e=0);var t=n%19,s=Math.floor(n/100),r=n%100,a=Math.floor(s/4),i=s%4,l=Math.floor((s+8)/25),c=Math.floor((s-l+1)/3),u=Math.floor(19*t+s-a-c+15)%30,d=Math.floor(r/4),f=r%4,p=Math.floor(32+2*i+2*d-u-f)%7,y=Math.floor((t+11*u+22*p)/451),w=Math.floor((u+p-7*y+114)/31),m=(u+p-7*y+114)%31+1,g=Date.UTC(n,w-1,m+e),_=Date.UTC(n,0,1);return[Math.ceil((g-_)/(1e3*60*60*24))]}var Wb=function(){function n(e){this.options=e}return n.prototype.rebuild=function(e,t){var s=this.options;if(e!==this.lastyear&&(this.yearinfo=zb(e,s)),Ot(s.bynweekday)&&(t!==this.lastmonth||e!==this.lastyear)){var r=this.yearinfo,a=r.yearlen,i=r.mrange,l=r.wdaymask;this.monthinfo=Yb(e,t,a,i,l,s)}_t(s.byeaster)&&(this.eastermask=jb(e,s.byeaster))},Object.defineProperty(n.prototype,"lastyear",{get:function(){return this.monthinfo?this.monthinfo.lastyear:null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"lastmonth",{get:function(){return this.monthinfo?this.monthinfo.lastmonth:null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"yearlen",{get:function(){return this.yearinfo.yearlen},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"yearordinal",{get:function(){return this.yearinfo.yearordinal},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"mrange",{get:function(){return this.yearinfo.mrange},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"wdaymask",{get:function(){return this.yearinfo.wdaymask},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"mmask",{get:function(){return this.yearinfo.mmask},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"wnomask",{get:function(){return this.yearinfo.wnomask},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"nwdaymask",{get:function(){return this.monthinfo?this.monthinfo.nwdaymask:[]},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"nextyearlen",{get:function(){return this.yearinfo.nextyearlen},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"mdaymask",{get:function(){return this.yearinfo.mdaymask},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"nmdaymask",{get:function(){return this.yearinfo.nmdaymask},enumerable:!1,configurable:!0}),n.prototype.ydayset=function(){return[Ks(this.yearlen),0,this.yearlen]},n.prototype.mdayset=function(e,t){for(var s=this.mrange[t-1],r=this.mrange[t],a=$e(null,this.yearlen),i=s;i<r;i++)a[i]=i;return[a,s,r]},n.prototype.wdayset=function(e,t,s){for(var r=$e(null,this.yearlen+7),a=oo(ar(e,t,s))-this.yearordinal,i=a,l=0;l<7&&(r[a]=a,++a,this.wdaymask[a]!==this.options.wkst);l++);return[r,i,a]},n.prototype.ddayset=function(e,t,s){var r=$e(null,this.yearlen),a=oo(ar(e,t,s))-this.yearordinal;return r[a]=a,[r,a,a+1]},n.prototype.htimeset=function(e,t,s,r){var a=this,i=[];return this.options.byminute.forEach(function(l){i=i.concat(a.mtimeset(e,l,s,r))}),ia(i),i},n.prototype.mtimeset=function(e,t,s,r){var a=this.options.bysecond.map(function(i){return new Ka(e,t,i,r)});return ia(a),a},n.prototype.stimeset=function(e,t,s,r){return[new Ka(e,t,s,r)]},n.prototype.getdayset=function(e){switch(e){case je.YEARLY:return this.ydayset.bind(this);case je.MONTHLY:return this.mdayset.bind(this);case je.WEEKLY:return this.wdayset.bind(this);case je.DAILY:return this.ddayset.bind(this);default:return this.ddayset.bind(this)}},n.prototype.gettimeset=function(e){switch(e){case je.HOURLY:return this.htimeset.bind(this);case je.MINUTELY:return this.mtimeset.bind(this);case je.SECONDLY:return this.stimeset.bind(this)}},n}();function Hb(n,e,t,s,r,a){for(var i=[],l=0;l<n.length;l++){var c=void 0,u=void 0,d=n[l];d<0?(c=Math.floor(d/e.length),u=xs(d,e.length)):(c=Math.floor((d-1)/e.length),u=xs(d-1,e.length));for(var f=[],p=t;p<s;p++){var y=a[p];_t(y)&&f.push(y)}var w=void 0;c<0?w=f.slice(c)[0]:w=f[c];var m=e[u],g=wd(r.yearordinal+w),_=kd(g,m);tt(i,_)||i.push(_)}return ia(i),i}function xd(n,e){var t=e.dtstart,s=e.freq,r=e.interval,a=e.until,i=e.bysetpos,l=e.count;if(l===0||r===0)return Vs(n);var c=_b.fromDate(t),u=new Wb(e);u.rebuild(c.year,c.month);for(var d=Vb(u,c,e);;){var f=u.getdayset(s)(c.year,c.month,c.day),p=f[0],y=f[1],w=f[2],m=Kb(p,y,w,u,e);if(Ot(i))for(var g=Hb(i,d,y,w,u,p),_=0;_<g.length;_++){var x=g[_];if(a&&x>a)return Vs(n);if(x>=t){var D=wc(x,e);if(!n.accept(D)||l&&(--l,!l))return Vs(n)}}else for(var _=y;_<w;_++){var E=p[_];if(_t(E))for(var R=wd(u.yearordinal+E),P=0;P<d.length;P++){var L=d[P],x=kd(R,L);if(a&&x>a)return Vs(n);if(x>=t){var D=wc(x,e);if(!n.accept(D)||l&&(--l,!l))return Vs(n)}}}if(e.interval===0||(c.add(e,m),c.year>yd))return Vs(n);Xo(s)||(d=u.gettimeset(s)(c.hour,c.minute,c.second,0)),u.rebuild(c.year,c.month)}}function Gb(n,e,t){var s=t.bymonth,r=t.byweekno,a=t.byweekday,i=t.byeaster,l=t.bymonthday,c=t.bynmonthday,u=t.byyearday;return Ot(s)&&!tt(s,n.mmask[e])||Ot(r)&&!n.wnomask[e]||Ot(a)&&!tt(a,n.wdaymask[e])||Ot(n.nwdaymask)&&!n.nwdaymask[e]||i!==null&&!tt(n.eastermask,e)||(Ot(l)||Ot(c))&&!tt(l,n.mdaymask[e])&&!tt(c,n.nmdaymask[e])||Ot(u)&&(e<n.yearlen&&!tt(u,e+1)&&!tt(u,-n.yearlen+e)||e>=n.yearlen&&!tt(u,e+1-n.yearlen)&&!tt(u,-n.nextyearlen+e-n.yearlen))}function wc(n,e){return new Qa(n,e.tzid).rezonedDate()}function Vs(n){return n.getValue()}function Kb(n,e,t,s,r){for(var a=!1,i=e;i<t;i++){var l=n[i];a=Gb(s,l,r),a&&(n[l]=null)}return a}function Vb(n,e,t){var s=t.freq,r=t.byhour,a=t.byminute,i=t.bysecond;return Xo(s)?kb(t):s>=le.HOURLY&&Ot(r)&&!tt(r,e.hour)||s>=le.MINUTELY&&Ot(a)&&!tt(a,e.minute)||s>=le.SECONDLY&&Ot(i)&&!tt(i,e.second)?[]:n.gettimeset(s)(e.hour,e.minute,e.second,e.millisecond)}var Os={MO:new Zt(0),TU:new Zt(1),WE:new Zt(2),TH:new Zt(3),FR:new Zt(4),SA:new Zt(5),SU:new Zt(6)},Zo={freq:je.YEARLY,dtstart:null,interval:1,wkst:Os.MO,count:null,until:null,tzid:null,bysetpos:null,bymonth:null,bymonthday:null,bynmonthday:null,byyearday:null,byweekno:null,byweekday:null,bynweekday:null,byhour:null,byminute:null,bysecond:null,byeaster:null},Qb=Object.keys(Zo),le=function(){function n(e,t){e===void 0&&(e={}),t===void 0&&(t=!1),this._cache=t?null:new Ab,this.origOptions=Sd(e);var s=wb(e).parsedOptions;this.options=s}return n.parseText=function(e,t){return Td(e,t)},n.fromText=function(e,t){return mb(e,t)},n.fromString=function(e){return new n(n.parseString(e)||void 0)},n.prototype._iter=function(e){return xd(e,this.options)},n.prototype._cacheGet=function(e,t){return this._cache?this._cache._cacheGet(e,t):!1},n.prototype._cacheAdd=function(e,t,s){if(this._cache)return this._cache._cacheAdd(e,t,s)},n.prototype.all=function(e){if(e)return this._iter(new gc("all",{},e));var t=this._cacheGet("all");return t===!1&&(t=this._iter(new _r("all",{})),this._cacheAdd("all",t)),t},n.prototype.between=function(e,t,s,r){if(s===void 0&&(s=!1),!Kr(e)||!Kr(t))throw new Error("Invalid date passed in to RRule.between");var a={before:t,after:e,inc:s};if(r)return this._iter(new gc("between",a,r));var i=this._cacheGet("between",a);return i===!1&&(i=this._iter(new _r("between",a)),this._cacheAdd("between",i,a)),i},n.prototype.before=function(e,t){if(t===void 0&&(t=!1),!Kr(e))throw new Error("Invalid date passed in to RRule.before");var s={dt:e,inc:t},r=this._cacheGet("before",s);return r===!1&&(r=this._iter(new _r("before",s)),this._cacheAdd("before",r,s)),r},n.prototype.after=function(e,t){if(t===void 0&&(t=!1),!Kr(e))throw new Error("Invalid date passed in to RRule.after");var s={dt:e,inc:t},r=this._cacheGet("after",s);return r===!1&&(r=this._iter(new _r("after",s)),this._cacheAdd("after",r,s)),r},n.prototype.count=function(){return this.all().length},n.prototype.toString=function(){return ho(this.origOptions)},n.prototype.toText=function(e,t,s){return yb(this,e,t,s)},n.prototype.isFullyConvertibleToText=function(){return bb(this)},n.prototype.clone=function(){return new n(this.origOptions)},n.FREQUENCIES=["YEARLY","MONTHLY","WEEKLY","DAILY","HOURLY","MINUTELY","SECONDLY"],n.YEARLY=je.YEARLY,n.MONTHLY=je.MONTHLY,n.WEEKLY=je.WEEKLY,n.DAILY=je.DAILY,n.HOURLY=je.HOURLY,n.MINUTELY=je.MINUTELY,n.SECONDLY=je.SECONDLY,n.MO=Os.MO,n.TU=Os.TU,n.WE=Os.WE,n.TH=Os.TH,n.FR=Os.FR,n.SA=Os.SA,n.SU=Os.SU,n.parseString=uo,n.optionsToString=ho,n}();function Xb(n,e,t,s,r,a){var i={},l=n.accept;function c(p,y){t.forEach(function(w){w.between(p,y,!0).forEach(function(m){i[Number(m)]=!0})})}r.forEach(function(p){var y=new Qa(p,a).rezonedDate();i[Number(y)]=!0}),n.accept=function(p){var y=Number(p);return isNaN(y)?l.call(this,p):!i[y]&&(c(new Date(y-1),new Date(y+1)),!i[y])?(i[y]=!0,l.call(this,p)):!0},n.method==="between"&&(c(n.args.after,n.args.before),n.accept=function(p){var y=Number(p);return i[y]?!0:(i[y]=!0,l.call(this,p))});for(var u=0;u<s.length;u++){var d=new Qa(s[u],a).rezonedDate();if(!n.accept(new Date(d.getTime())))break}e.forEach(function(p){xd(n,p.options)});var f=n._result;switch(ia(f),n.method){case"all":case"between":return f;case"before":return f.length&&f[f.length-1]||null;case"after":default:return f.length&&f[0]||null}}var kc={dtstart:null,cache:!1,unfold:!1,forceset:!1,compatible:!1,tzid:null};function Zb(n,e){var t=[],s=[],r=[],a=[],i=Va(n),l=i.dtstart,c=i.tzid,u=n_(n,e.unfold);return u.forEach(function(d){var f;if(d){var p=s_(d),y=p.name,w=p.parms,m=p.value;switch(y.toUpperCase()){case"RRULE":if(w.length)throw new Error("unsupported RRULE parm: ".concat(w.join(",")));t.push(uo(d));break;case"RDATE":var g=(f=/RDATE(?:;TZID=([^:=]+))?/i.exec(d))!==null&&f!==void 0?f:[],_=g[1];_&&!c&&(c=_),s=s.concat(Tc(m,w));break;case"EXRULE":if(w.length)throw new Error("unsupported EXRULE parm: ".concat(w.join(",")));r.push(uo(m));break;case"EXDATE":a=a.concat(Tc(m,w));break;case"DTSTART":break;default:throw new Error("unsupported property: "+y)}}}),{dtstart:l,tzid:c,rrulevals:t,rdatevals:s,exrulevals:r,exdatevals:a}}function Jb(n,e){var t=Zb(n,e),s=t.rrulevals,r=t.rdatevals,a=t.exrulevals,i=t.exdatevals,l=t.dtstart,c=t.tzid,u=e.cache===!1;if(e.compatible&&(e.forceset=!0,e.unfold=!0),e.forceset||s.length>1||r.length||a.length||i.length){var d=new a_(u);return d.dtstart(l),d.tzid(c||void 0),s.forEach(function(p){d.rrule(new le(Ni(p,l,c),u))}),r.forEach(function(p){d.rdate(p)}),a.forEach(function(p){d.exrule(new le(Ni(p,l,c),u))}),i.forEach(function(p){d.exdate(p)}),e.compatible&&e.dtstart&&d.rdate(l),d}var f=s[0]||{};return new le(Ni(f,f.dtstart||e.dtstart||l,f.tzid||e.tzid||c),u)}function fo(n,e){return e===void 0&&(e={}),Jb(n,e_(e))}function Ni(n,e,t){return gs(gs({},n),{dtstart:e,tzid:t})}function e_(n){var e=[],t=Object.keys(n),s=Object.keys(kc);if(t.forEach(function(r){tt(s,r)||e.push(r)}),e.length)throw new Error("Invalid options: "+e.join(", "));return gs(gs({},kc),n)}function t_(n){if(n.indexOf(":")===-1)return{name:"RRULE",value:n};var e=lb(n,":",1),t=e[0],s=e[1];return{name:t,value:s}}function s_(n){var e=t_(n),t=e.name,s=e.value,r=t.split(";");if(!r)throw new Error("empty property name");return{name:r[0].toUpperCase(),parms:r.slice(1),value:s}}function n_(n,e){if(e===void 0&&(e=!1),n=n&&n.trim(),!n)throw new Error("Invalid empty string");if(!e)return n.split(/\s/);for(var t=n.split(`
`),s=0;s<t.length;){var r=t[s]=t[s].replace(/\s+$/g,"");r?s>0&&r[0]===" "?(t[s-1]+=r.slice(1),t.splice(s,1)):s+=1:t.splice(s,1)}return t}function r_(n){n.forEach(function(e){if(!/(VALUE=DATE(-TIME)?)|(TZID=)/.test(e))throw new Error("unsupported RDATE/EXDATE parm: "+e)})}function Tc(n,e){return r_(e),n.split(",").map(function(t){return Vo(t)})}function Sc(n){var e=this;return function(t){if(t!==void 0&&(e["_".concat(n)]=t),e["_".concat(n)]!==void 0)return e["_".concat(n)];for(var s=0;s<e._rrule.length;s++){var r=e._rrule[s].origOptions[n];if(r)return r}}}var a_=function(n){Qo(e,n);function e(t){t===void 0&&(t=!1);var s=n.call(this,{},t)||this;return s.dtstart=Sc.apply(s,["dtstart"]),s.tzid=Sc.apply(s,["tzid"]),s._rrule=[],s._rdate=[],s._exrule=[],s._exdate=[],s}return e.prototype._iter=function(t){return Xb(t,this._rrule,this._exrule,this._rdate,this._exdate,this.tzid())},e.prototype.rrule=function(t){xc(t,this._rrule)},e.prototype.exrule=function(t){xc(t,this._exrule)},e.prototype.rdate=function(t){Dc(t,this._rdate)},e.prototype.exdate=function(t){Dc(t,this._exdate)},e.prototype.rrules=function(){return this._rrule.map(function(t){return fo(t.toString())})},e.prototype.exrules=function(){return this._exrule.map(function(t){return fo(t.toString())})},e.prototype.rdates=function(){return this._rdate.map(function(t){return new Date(t.getTime())})},e.prototype.exdates=function(){return this._exdate.map(function(t){return new Date(t.getTime())})},e.prototype.valueOf=function(){var t=[];return!this._rrule.length&&this._dtstart&&(t=t.concat(ho({dtstart:this._dtstart}))),this._rrule.forEach(function(s){t=t.concat(s.toString().split(`
`))}),this._exrule.forEach(function(s){t=t.concat(s.toString().split(`
`).map(function(r){return r.replace(/^RRULE:/,"EXRULE:")}).filter(function(r){return!/^DTSTART/.test(r)}))}),this._rdate.length&&t.push(Ec("RDATE",this._rdate,this.tzid())),this._exdate.length&&t.push(Ec("EXDATE",this._exdate,this.tzid())),t},e.prototype.toString=function(){return this.valueOf().join(`
`)},e.prototype.clone=function(){var t=new e(!!this._cache);return this._rrule.forEach(function(s){return t.rrule(s.clone())}),this._exrule.forEach(function(s){return t.exrule(s.clone())}),this._rdate.forEach(function(s){return t.rdate(new Date(s.getTime()))}),this._exdate.forEach(function(s){return t.exdate(new Date(s.getTime()))}),t},e}(le);function xc(n,e){if(!(n instanceof le))throw new TypeError(String(n)+" is not RRule instance");tt(e.map(String),String(n))||e.push(n)}function Dc(n,e){if(!(n instanceof Date))throw new TypeError(String(n)+" is not Date instance");tt(e.map(Number),Number(n))||(e.push(n),ia(e))}function Ec(n,e,t){var s=!t||t.toUpperCase()==="UTC",r=s?"".concat(n,":"):"".concat(n,";TZID=").concat(t,":"),a=e.map(function(i){return Ko(i.valueOf(),s)}).join(",");return"".concat(r).concat(a)}class Xa{static parse(e){const t=e,s=e.trim().toLowerCase().replace(/\s+/g," ");if(!s)return{frequency:{type:"daily",interval:1},raw:t,isValid:!1,error:"Recurrence string cannot be empty"};const r=s.match(/^every\s+(.+)$/);if(!r)return{frequency:{type:"daily",interval:1},raw:t,isValid:!1,error:"Recurrence must start with 'every'"};let a=r[1],i;const l=a.match(/^(.+?)\s+when\s+done$/),c=a.match(/^(.+?)\s+when\s+due$/);if(l?(a=l[1],i=!0):c&&(a=c[1],i=!1),a==="weekday"||a==="weekdays"){const w=[0,1,2,3,4];return{frequency:{type:"weekly",interval:1,weekdays:w,whenDone:i,rruleString:this.buildWeeklyRRuleString(1,w),naturalLanguage:t},raw:t,isValid:!0}}if(a==="weekend"||a==="weekends"){const w=[5,6];return{frequency:{type:"weekly",interval:1,weekdays:w,whenDone:i,rruleString:this.buildWeeklyRRuleString(1,w),naturalLanguage:t},raw:t,isValid:!0}}const u=this.parseOrdinalWeekdayPattern(a);if(u.matched)return u.error||u.ordinal===void 0||u.weekday===void 0?{frequency:{type:"daily",interval:1,whenDone:i},raw:t,isValid:!1,error:u.error||"Invalid ordinal weekday pattern"}:{frequency:{type:"monthly",interval:1,dayOfMonth:1,whenDone:i,rruleString:this.buildOrdinalRRuleString(u.weekday,u.ordinal),naturalLanguage:t},raw:t,isValid:!0};const d=a.match(/^(\d+\s+)?days?$/);if(d){const w=d[1]?parseInt(d[1]):1;return{frequency:{type:"daily",interval:w,whenDone:i,rruleString:this.buildDailyRRuleString(w),naturalLanguage:t},raw:t,isValid:!0}}const f=a.match(/^(\d+\s+)?weeks?(?:\s+on\s+(.+))?$/);if(f){const w=f[1]?parseInt(f[1]):1,m=f[2];if(!m){const _=[1];return{frequency:{type:"weekly",interval:w,weekdays:_,whenDone:i,rruleString:this.buildWeeklyRRuleString(w,_),naturalLanguage:t},raw:t,isValid:!0}}const g=this.parseDayNames(m);return g.length===0?{frequency:{type:"weekly",interval:w,weekdays:[1],whenDone:i},raw:t,isValid:!1,error:"Invalid day names"}:{frequency:{type:"weekly",interval:w,weekdays:g,whenDone:i,rruleString:this.buildWeeklyRRuleString(w,g),naturalLanguage:t},raw:t,isValid:!0}}const p=a.match(/^(\d+\s+)?months?(?:\s+on\s+the\s+(\d+)(?:st|nd|rd|th)?)?$/);if(p){const w=p[1]?parseInt(p[1]):1,m=p[2]?parseInt(p[2]):1;return m<1||m>31?{frequency:{type:"monthly",interval:w,dayOfMonth:1,whenDone:i},raw:t,isValid:!1,error:"Day of month must be between 1 and 31"}:{frequency:{type:"monthly",interval:w,dayOfMonth:m,whenDone:i,rruleString:this.buildMonthlyRRuleString(w,m),naturalLanguage:t},raw:t,isValid:!0}}const y=a.match(/^(\d+\s+)?years?$/);if(y){const w=y[1]?parseInt(y[1]):1;return{frequency:{type:"yearly",interval:w,month:0,dayOfMonth:1,whenDone:i,rruleString:this.buildYearlyRRuleString(w),naturalLanguage:t},raw:t,isValid:!0}}return{frequency:{type:"daily",interval:1,whenDone:i},raw:t,isValid:!1,error:"Unrecognized recurrence pattern"}}static stringify(e){const t=this.stringifyOrdinalWeekday(e.rruleString);if(t)return e.whenDone?`${t} when done`:t;const s=e.interval;let r;switch(e.type){case"daily":r=s===1?"every day":`every ${s} days`;break;case"weekly":{const a=s===1?"week":`${s} weeks`;if(e.weekdays.length===0)r=`every ${a}`;else{const i=e.weekdays.map(l=>this.getDayName(l)).join(", ");r=`every ${a} on ${i}`}break}case"monthly":{const a=s===1?"month":`${s} months`,i=this.getDaySuffix(e.dayOfMonth);r=`every ${a} on the ${e.dayOfMonth}${i}`;break}case"yearly":{r=`every ${s===1?"year":`${s} years`}`;break}default:r="every day"}return e.whenDone?`${r} when done`:r}static parseDayNames(e){const t={monday:0,mon:0,tuesday:1,tue:1,wednesday:2,wed:2,thursday:3,thu:3,friday:4,fri:4,saturday:5,sat:5,sunday:6,sun:6},s=e.split(",").map(a=>a.trim().toLowerCase()),r=[];for(const a of s)a in t&&r.push(t[a]);return r}static parseOrdinalWeekdayPattern(e){const t=e.split(" ");if(t.length<2)return{matched:!1};const s=this.parseOrdinalToken(t[0]);if(!s.matched)return{matched:!1};if(s.error)return{matched:!0,error:s.error};const r=this.parseSingleDay(t[1]);return r===null?{matched:!0,error:"Invalid weekday name"}:t.length===2?{matched:!0,ordinal:s.value,weekday:r}:t.length===5&&t[2]==="of"&&t[3]==="the"&&t[4]==="month"?{matched:!0,ordinal:s.value,weekday:r}:{matched:!0,error:"Ordinal weekday pattern must be 'every <ordinal> <weekday>' optionally followed by 'of the month'"}}static parseOrdinalToken(e){const t={first:1,second:2,third:3,fourth:4,last:-1};if(e in t)return{matched:!0,value:t[e]};const s=e.match(/^(\d+)(st|nd|rd|th)$/);if(!s)return{matched:!1};const r=parseInt(s[1],10);return r>=1&&r<=4?{matched:!0,value:r}:{matched:!0,error:"Ordinal weekday must be first, second, third, fourth, or last"}}static parseSingleDay(e){const t={monday:0,mon:0,tuesday:1,tue:1,wednesday:2,wed:2,thursday:3,thu:3,friday:4,fri:4,saturday:5,sat:5,sunday:6,sun:6};return e in t?t[e]:null}static stringifyOrdinalWeekday(e){if(!e)return null;const t=this.parseRRuleString(e);if(!t||t.FREQ!=="MONTHLY"||!t.BYDAY||!t.BYSETPOS)return null;const s=this.fromRRuleWeekday(t.BYDAY);if(s===null)return null;const r=Number.parseInt(t.BYSETPOS,10);if(!Number.isFinite(r))return null;const a=this.ordinalWord(r);return a?`every ${a} ${this.getDayName(s)}`:null}static ordinalWord(e){switch(e){case 1:return"first";case 2:return"second";case 3:return"third";case 4:return"fourth";case-1:return"last";default:return null}}static buildOrdinalRRuleString(e,t){return`RRULE:FREQ=MONTHLY;BYDAY=${this.toRRuleWeekday(e)};BYSETPOS=${t}`}static toRRuleWeekday(e){return["MO","TU","WE","TH","FR","SA","SU"][e]||"MO"}static fromRRuleWeekday(e){const s=["MO","TU","WE","TH","FR","SA","SU"].indexOf(e);return s>=0?s:null}static parseRRuleString(e){const t=e.trim().toUpperCase(),s=t.startsWith("RRULE:")?t.slice(6):t;if(!s)return null;const r=s.split(";"),a={};for(const i of r){if(!i)continue;const[l,c]=i.split("=");if(!l||!c)return null;a[l]=c}return a}static getDayName(e){return["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"][e]||"Monday"}static getDaySuffix(e){if(e>=11&&e<=13)return"th";switch(e%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}}static buildDailyRRuleString(e){return`FREQ=DAILY;INTERVAL=${e}`}static buildWeeklyRRuleString(e,t){const s=t.map(r=>this.toRRuleWeekday(r)).join(",");return`FREQ=WEEKLY;INTERVAL=${e};BYDAY=${s}`}static buildMonthlyRRuleString(e,t){return`FREQ=MONTHLY;INTERVAL=${e};BYMONTHDAY=${t===31?-1:t}`}static buildYearlyRRuleString(e){return`FREQ=YEARLY;INTERVAL=${e}`}}var i_=C('<label><input type="radio" name="priority" class="svelte-1w15n9q"/> <span class="priority-selector__emoji svelte-1w15n9q"> </span> <span class="priority-selector__label svelte-1w15n9q"> </span></label>'),o_=C('<div class="priority-selector svelte-1w15n9q"></div>');function l_(n,e){ht(e,!0);let t=an(e,"value",15,"normal");const s=[{value:"highest",label:"Highest",emoji:"",color:"var(--b3-theme-error, #ef4444)"},{value:"high",label:"High",emoji:"",color:"#f97316"},{value:"medium",label:"Medium",emoji:"",color:"#f59e0b"},{value:"normal",label:"Normal",emoji:"",color:"#eab308"},{value:"low",label:"Low",emoji:"",color:"#22c55e"},{value:"lowest",label:"Lowest",emoji:"",color:"#64748b"}];function r(i){t(i),e.onchange(i)}var a=o_();We(a,21,()=>s,yt,(i,l)=>{var c=i_();let u;var d=h(c);d.__change=()=>r(o(l).value);var f=v(d,2),p=h(f),y=v(f,2),w=h(y);$(()=>{u=Je(c,1,"priority-selector__option svelte-1w15n9q",null,u,{active:t()===o(l).value}),Ns(c,`--priority-color: ${o(l).color??""}`),Fo(d,o(l).value),Cn(d,t()===o(l).value),N(p,o(l).emoji),N(w,o(l).label)}),S(i,c)}),S(n,a),ft()}Tt(["change"]);var c_=C('<label><input type="radio" name="status" class="svelte-v9ezc0"/> <span class="status-selector__icon svelte-v9ezc0"> </span> <span class="status-selector__label svelte-v9ezc0"> </span></label>'),u_=C('<div class="status-selector svelte-v9ezc0"></div>');function d_(n,e){ht(e,!0);let t=an(e,"value",15,"todo");const s=[{value:"todo",label:"Todo",icon:"",color:"var(--b3-theme-on-surface)"},{value:"done",label:"Done",icon:"",color:"#44cc44"},{value:"cancelled",label:"Cancelled",icon:"",color:"#999"}];function r(i){t(i),e.onchange(i)}var a=u_();We(a,21,()=>s,yt,(i,l)=>{var c=c_();let u;var d=h(c);d.__change=()=>r(o(l).value);var f=v(d,2),p=h(f),y=v(f,2),w=h(y);$(()=>{u=Je(c,1,"status-selector__option svelte-v9ezc0",null,u,{active:t()===o(l).value}),Ns(c,`--status-color: ${o(l).color??""}`),Fo(d,o(l).value),Cn(d,t()===o(l).value),N(p,o(l).icon),N(w,o(l).label)}),S(i,c)}),S(n,a),ft()}Tt(["change"]);var h_=C('<div class="recurrence-input__valid svelte-787fjp"> Valid recurrence pattern</div>'),f_=C('<div class="recurrence-input__error svelte-787fjp"> </div>'),v_=C('<div class="recurrence-input__feedback svelte-787fjp"><!></div>'),p_=C('<li class="svelte-787fjp"> </li>'),g_=C('<div class="recurrence-input__preview svelte-787fjp"><div class="recurrence-input__preview-title svelte-787fjp">Next occurrences:</div> <ul class="recurrence-input__preview-list svelte-787fjp"></ul></div>'),m_=C('<div class="recurrence-input svelte-787fjp"><input type="text" placeholder="e.g., every week on Monday"/> <!> <!></div>');function y_(n,e){ht(e,!0);let t=an(e,"value",15,""),s=an(e,"showPreview",3,!0);const r=J(()=>Xa.parse(t())),a=J(()=>o(r).isValid),i=J(()=>o(r).error);function l(_,x=3){const D=[],E=new Date;for(let R=0;R<x;R++){const P=new Date(E);switch(_.type){case"daily":P.setDate(E.getDate()+R*_.interval);break;case"weekly":P.setDate(E.getDate()+R*_.interval*7);break;case"monthly":P.setMonth(E.getMonth()+R*_.interval);break;case"yearly":P.setFullYear(E.getFullYear()+R*_.interval);break}D.push(P.toLocaleDateString())}return D}const c=J(()=>o(a)&&s()?l(o(r).frequency):[]);function u(_){const D=_.target.value;t(D);const E=Xa.parse(D);e.onchange(D,E.isValid?E.frequency:null,E.isValid)}var d=m_(),f=h(d);let p;f.__input=u;var y=v(f,2);{var w=_=>{var x=v_(),D=h(x);{var E=P=>{var L=h_();S(P,L)},R=P=>{var L=f_(),H=h(L);$(()=>N(H,` ${(o(i)||"Invalid recurrence pattern")??""}`)),S(P,L)};j(D,P=>{o(a)?P(E):P(R,!1)})}S(_,x)};j(y,_=>{t().length>0&&_(w)})}var m=v(y,2);{var g=_=>{var x=g_(),D=v(h(x),2);We(D,21,()=>o(c),yt,(E,R)=>{var P=p_(),L=h(P);$(()=>N(L,o(R))),S(E,P)}),S(_,x)};j(m,_=>{o(a)&&s()&&o(c).length>0&&_(g)})}$(()=>{p=Je(f,1,"recurrence-input__field svelte-787fjp",null,p,{valid:o(a),invalid:!o(a)&&t().length>0}),Le(f,"aria-invalid",!o(a)&&t().length>0)}),ut(f,t),S(n,d),ft()}Tt(["input"]);var b_=C('<div class="dependency-picker__chip svelte-10ls0lk"><span class="dependency-picker__chip-text svelte-10ls0lk"> </span> <button type="button" class="dependency-picker__chip-remove svelte-10ls0lk"></button></div>'),__=C('<div class="dependency-picker__chips svelte-10ls0lk"></div>'),w_=C('<span class="dependency-picker__option-check svelte-10ls0lk"></span>'),k_=C('<button type="button"><span class="dependency-picker__option-name svelte-10ls0lk"> </span> <!></button>'),T_=C('<div class="dependency-picker__dropdown svelte-10ls0lk"></div>'),S_=C('<div class="dependency-picker svelte-10ls0lk"><label class="dependency-picker__label svelte-10ls0lk"> </label> <!> <div class="dependency-picker__search-wrapper svelte-10ls0lk"><input type="text" class="dependency-picker__search svelte-10ls0lk" placeholder="Search tasks..."/> <!></div></div>');function Ac(n,e){ht(e,!0);let t=an(e,"selected",31,()=>De([])),s=an(e,"label",3,"Select tasks"),r=V(""),a=V(!1);const i=J(()=>e.repository.getAllTasks().filter(P=>P.id!==e.excludeId)),l=J(()=>o(r).trim()?o(i).filter(P=>P.name.toLowerCase().includes(o(r).toLowerCase())):o(i)),c=J(()=>o(i).filter(P=>t().includes(P.id)));function u(P){if(!t().includes(P)){const L=[...t(),P];t(L),e.onchange(L)}T(r,""),T(a,!1)}function d(P){const L=t().filter(H=>H!==P);t(L),e.onchange(L)}function f(){T(a,!0)}function p(){setTimeout(()=>{T(a,!1)},200)}var y=S_(),w=h(y),m=h(w),g=v(w,2);{var _=P=>{var L=__();We(L,21,()=>o(c),H=>H.id,(H,Y)=>{var X=b_(),oe=h(X),ae=h(oe),ve=v(oe,2);ve.__click=()=>d(o(Y).id),$(()=>{N(ae,o(Y).name),Le(ve,"aria-label",`Remove ${o(Y).name??""}`)}),S(H,X)}),S(P,L)};j(g,P=>{o(c).length>0&&P(_)})}var x=v(g,2),D=h(x),E=v(D,2);{var R=P=>{var L=T_();We(L,21,()=>o(l).slice(0,10),H=>H.id,(H,Y)=>{var X=k_();let oe;X.__click=()=>u(o(Y).id);var ae=h(X),ve=h(ae),Q=v(ae,2);{var Z=U=>{var M=w_();S(U,M)};j(Q,U=>{t().includes(o(Y).id)&&U(Z)})}$((U,M)=>{oe=Je(X,1,"dependency-picker__option svelte-10ls0lk",null,oe,U),X.disabled=M,N(ve,o(Y).name)},[()=>({selected:t().includes(o(Y).id)}),()=>t().includes(o(Y).id)]),S(H,X)}),S(P,L)};j(E,P=>{o(a)&&o(l).length>0&&P(R)})}$(()=>N(m,s())),Bt("focus",D,f),Bt("blur",D,p),ut(D,()=>o(r),P=>T(r,P)),S(n,y),ft()}Tt(["click"]);var x_=C('<div class="task-editor__error svelte-xc3qs9"> </div>'),D_=C('<div class="task-editor__error svelte-xc3qs9"> </div>'),E_=C('<div class="task-editor__error svelte-xc3qs9"> </div>'),A_=C('<div class="task-editor__timestamp svelte-xc3qs9"><span class="task-editor__timestamp-label svelte-xc3qs9">Completed:</span> <span class="task-editor__timestamp-value svelte-xc3qs9"> </span></div>'),C_=C('<div class="task-editor__timestamp svelte-xc3qs9"><span class="task-editor__timestamp-label svelte-xc3qs9">Cancelled:</span> <span class="task-editor__timestamp-value svelte-xc3qs9"> </span></div>'),I_=C('<div class="task-editor__timestamp svelte-xc3qs9"><span class="task-editor__timestamp-label svelte-xc3qs9">Linked block:</span> <span class="task-editor__timestamp-value svelte-xc3qs9"> </span></div>'),M_=C('<div class="task-editor-overlay svelte-xc3qs9" role="dialog" aria-modal="true" aria-labelledby="task-editor-title" tabindex="-1"><div class="task-editor-modal svelte-xc3qs9" role="document"><div class="task-editor__header svelte-xc3qs9"><h2 id="task-editor-title" class="svelte-xc3qs9"> </h2> <button class="task-editor__close svelte-xc3qs9" type="button" aria-label="Close"></button></div> <div class="task-editor__body svelte-xc3qs9"><div class="task-editor__field svelte-xc3qs9"><label for="task-name" class="svelte-xc3qs9">Description *</label> <input id="task-name" type="text" placeholder="Task name" class="svelte-xc3qs9"/> <!></div> <div class="task-editor__field svelte-xc3qs9"><label for="task-description" class="svelte-xc3qs9">Notes</label> <textarea id="task-description" placeholder="Additional details about this task..." rows="3" class="svelte-xc3qs9"></textarea></div> <div class="task-editor__field svelte-xc3qs9"><label class="svelte-xc3qs9">Priority</label> <!></div> <div class="task-editor__field svelte-xc3qs9"><label class="svelte-xc3qs9">Status</label> <!></div> <div class="task-editor__field svelte-xc3qs9"><label for="task-due" class="svelte-xc3qs9">Due Date *</label> <input id="task-due" type="datetime-local" class="svelte-xc3qs9"/> <!></div> <div class="task-editor__field svelte-xc3qs9"><label for="task-scheduled" class="svelte-xc3qs9">Scheduled Date</label> <input id="task-scheduled" type="datetime-local" class="svelte-xc3qs9"/> <div class="task-editor__hint svelte-xc3qs9">When you plan to start working on this task</div></div> <div class="task-editor__field svelte-xc3qs9"><label for="task-start" class="svelte-xc3qs9">Start Date</label> <input id="task-start" type="datetime-local" class="svelte-xc3qs9"/> <div class="task-editor__hint svelte-xc3qs9">Earliest date this task can begin</div></div> <div class="task-editor__field svelte-xc3qs9"><label for="task-recurrence" class="svelte-xc3qs9">Recurrence</label> <!> <!></div> <div class="task-editor__field svelte-xc3qs9"><!></div> <div class="task-editor__field svelte-xc3qs9"><!></div> <div class="task-editor__timestamps svelte-xc3qs9"><div class="task-editor__timestamp svelte-xc3qs9"><span class="task-editor__timestamp-label svelte-xc3qs9">Created:</span> <span class="task-editor__timestamp-value svelte-xc3qs9"> </span></div> <!> <!> <!></div></div> <div class="task-editor__footer svelte-xc3qs9"><button class="task-editor__cancel svelte-xc3qs9" type="button">Cancel</button> <button class="task-editor__save svelte-xc3qs9" type="button"> </button></div> <div class="task-editor__hint-footer svelte-xc3qs9"> Press <kbd class="svelte-xc3qs9">Esc</kbd> to close, <kbd class="svelte-xc3qs9">/Ctrl+Enter</kbd> to save</div></div></div>');function Dd(n,e){var ke,Re,pt,$t,xt,Gt,Dt,Lt,As,Yt,ns,Kt;ht(e,!0);const t="every day",s="Blocked by (tasks that must complete first)",r="Blocks (tasks that depend on this)",a=!e.task;let i=V(De(((ke=e.task)==null?void 0:ke.name)||"")),l=V(De(((Re=e.task)==null?void 0:Re.description)||"")),c=V(De(((pt=e.task)==null?void 0:pt.priority)||"normal")),u=V(De((($t=e.task)==null?void 0:$t.status)||"todo")),d=V(De((xt=e.task)!=null&&xt.dueAt?new Date(e.task.dueAt).toISOString().slice(0,16):new Date().toISOString().slice(0,16))),f=V(De((Gt=e.task)!=null&&Gt.scheduledAt?new Date(e.task.scheduledAt).toISOString().slice(0,16):"")),p=V(De((Dt=e.task)!=null&&Dt.startAt?new Date(e.task.startAt).toISOString().slice(0,16):"")),y=V(De(((Lt=e.task)==null?void 0:Lt.recurrenceText)||((As=e.task)!=null&&As.frequency?Xa.stringify(e.task.frequency):t))),w=V(De(((Yt=e.task)==null?void 0:Yt.frequency)||null)),m=V(!0),g=V(De(((ns=e.task)==null?void 0:ns.blockedBy)||[])),_=V(De(((Kt=e.task)==null?void 0:Kt.dependsOn)||[])),x=V(De({name:!1,dueAt:!1,recurrence:!1})),D=V(!1),E=V(null);const R=J(()=>o(x).name&&!o(i).trim()?"Task name is required":""),P=J(()=>o(x).dueAt?o(d)?Number.isNaN(new Date(o(d)).getTime())?"Invalid due date":"":"Due date is required":""),L=J(()=>o(x).recurrence&&!o(m)?"Invalid recurrence pattern":""),H=J(()=>!!(o(R)||o(P)||o(L)));va(()=>{requestAnimationFrame(()=>{var z;(z=o(E))==null||z.focus()})});function Y(z,ye,nt){T(y,z,!0),T(w,ye,!0),T(m,nt,!0),o(x).recurrence=!0}function X(z){T(c,z,!0)}function oe(z){T(u,z,!0)}function ae(z){T(g,z,!0)}function ve(z){T(_,z,!0)}async function Q(){if(T(x,{name:!0,dueAt:!0,recurrence:!0},!0),o(H)){W.warning("Please fix validation errors");return}if(!o(w)){W.error("Invalid recurrence pattern");return}T(D,!0);try{let z;a?z=pa(o(i).trim(),o(w),new Date(o(d))):(z={...e.task},z.name=o(i).trim(),z.frequency=o(w),z.dueAt=new Date(o(d)).toISOString()),z.description=o(l).trim()||void 0,z.priority=o(c),z.status=o(u),z.recurrenceText=o(y),z.scheduledAt=o(f)?new Date(o(f)).toISOString():void 0,z.startAt=o(p)?new Date(o(p)).toISOString():void 0,z.blockedBy=o(g).length>0?o(g):void 0,z.dependsOn=o(_).length>0?o(_):void 0,z.updatedAt=new Date().toISOString(),o(u)==="done"&&!z.lastCompletedAt&&(z.lastCompletedAt=new Date().toISOString()),o(u)==="cancelled"&&!z.cancelledAt&&(z.cancelledAt=new Date().toISOString()),await e.repository.saveTask(z),e.onSave&&e.onSave(z),W.success(`Task "${z.name}" ${a?"created":"updated"}`),Ye.emit("task:refresh",void 0),window.dispatchEvent(new CustomEvent("recurring-task-refresh")),e.onClose()}catch(z){W.error(`Failed to save task: ${z}`)}finally{T(D,!1)}}function Z(z){z.key==="Escape"&&e.onClose(),(z.metaKey||z.ctrlKey)&&z.key==="Enter"&&(z.preventDefault(),Q())}function U(z){return z?new Date(z).toLocaleString():""}var M=M_();M.__keydown=Z;var I=h(M),G=h(I),se=h(G),be=h(se),pe=v(se,2);pe.__click=function(...z){var ye;(ye=e.onClose)==null||ye.apply(this,z)};var ce=v(G,2),Ie=h(ce),Me=v(h(Ie),2);Me.__input=()=>o(x).name=!0,Ps(Me,z=>T(E,z),()=>o(E));var Be=v(Me,2);{var de=z=>{var ye=x_(),nt=h(ye);$(()=>N(nt,o(R))),S(z,ye)};j(Be,z=>{o(R)&&z(de)})}var B=v(Ie,2),A=v(h(B),2),F=v(B,2),K=v(h(F),2);l_(K,{get value(){return o(c)},onchange:X});var ie=v(F,2),O=v(h(ie),2);d_(O,{get value(){return o(u)},onchange:oe});var q=v(ie,2),ee=v(h(q),2);ee.__input=()=>o(x).dueAt=!0;var me=v(ee,2);{var _e=z=>{var ye=D_(),nt=h(ye);$(()=>N(nt,o(P))),S(z,ye)};j(me,z=>{o(P)&&z(_e)})}var ue=v(q,2),Ee=v(h(ue),2),Ae=v(ue,2),ze=v(h(Ae),2),Ze=v(Ae,2),He=v(h(Ze),2);y_(He,{get value(){return o(y)},onchange:Y,showPreview:!0});var at=v(He,2);{var dt=z=>{var ye=E_(),nt=h(ye);$(()=>N(nt,o(L))),S(z,ye)};j(at,z=>{o(L)&&z(dt)})}var Ce=v(Ze,2),Ne=h(Ce);{let z=J(()=>{var ye;return(ye=e.task)==null?void 0:ye.id});Ac(Ne,{get repository(){return e.repository},get selected(){return o(g)},get excludeId(){return o(z)},onchange:ae,label:s})}var xe=v(Ce,2),Pe=h(xe);{let z=J(()=>{var ye;return(ye=e.task)==null?void 0:ye.id});Ac(Pe,{get repository(){return e.repository},get selected(){return o(_)},get excludeId(){return o(z)},onchange:ve,label:r})}var Ge=v(xe,2),Ue=h(Ge),st=v(h(Ue),2),gt=h(st),vt=v(Ue,2);{var It=z=>{var ye=A_(),nt=v(h(ye),2),rs=h(nt);$(Vt=>N(rs,Vt),[()=>U(e.task.lastCompletedAt)]),S(z,ye)};j(vt,z=>{var ye;(ye=e.task)!=null&&ye.lastCompletedAt&&z(It)})}var mt=v(vt,2);{var Pt=z=>{var ye=C_(),nt=v(h(ye),2),rs=h(nt);$(Vt=>N(rs,Vt),[()=>U(e.task.cancelledAt)]),S(z,ye)};j(mt,z=>{var ye;(ye=e.task)!=null&&ye.cancelledAt&&z(Pt)})}var ss=v(mt,2);{var ne=z=>{var ye=I_(),nt=v(h(ye),2),rs=h(nt);$(()=>N(rs,e.task.linkedBlockId)),S(z,ye)};j(ss,z=>{var ye;(ye=e.task)!=null&&ye.linkedBlockId&&z(ne)})}var we=v(ce,2),ge=h(we);ge.__click=function(...z){var ye;(ye=e.onClose)==null||ye.apply(this,z)};var Oe=v(ge,2);Oe.__click=Q;var he=h(Oe);$(z=>{N(be,a?"Create Task":"Edit Task"),Le(Me,"aria-invalid",!!o(R)),Le(ee,"aria-invalid",!!o(P)),N(gt,z),Oe.disabled=o(D),N(he,o(D)?"Saving...":a?"Create Task":"Save Changes")},[()=>{var z;return U((z=e.task)==null?void 0:z.createdAt)}]),Bt("blur",Me,()=>o(x).name=!0),ut(Me,()=>o(i),z=>T(i,z)),ut(A,()=>o(l),z=>T(l,z)),Bt("blur",ee,()=>o(x).dueAt=!0),ut(ee,()=>o(d),z=>T(d,z)),ut(Ee,()=>o(f),z=>T(f,z)),ut(ze,()=>o(p),z=>T(p,z)),S(n,M),ft()}Tt(["keydown","click","input"]);var O_=C("<option> </option>"),R_=C('<li class="svelte-b8rwae"> </li>'),N_=C('<div class="validation-errors svelte-b8rwae"><h4 class="svelte-b8rwae"> Validation Errors:</h4> <ul class="svelte-b8rwae"></ul></div>'),P_=C('<div class="profile-editor svelte-b8rwae"><div class="profile-header svelte-b8rwae"><input type="text" placeholder="Profile name" class="profile-name-input svelte-b8rwae"/> <input type="text" placeholder="Description (optional)" class="profile-description-input svelte-b8rwae"/></div> <section class="filter-section svelte-b8rwae"><h3 class="svelte-b8rwae"> Path Scoping</h3> <p class="help-text svelte-b8rwae">Use glob patterns like <code class="svelte-b8rwae">daily/**</code>, <code class="svelte-b8rwae">projects/**</code> <br/> <strong>Tip:</strong> <code class="svelte-b8rwae">**</code> matches any depth, <code class="svelte-b8rwae">*</code> matches within a folder</p> <div class="dual-input svelte-b8rwae"><label class="svelte-b8rwae"><span class="label-with-badge svelte-b8rwae">Include Paths <span class="badge optional svelte-b8rwae">Optional</span></span> <textarea placeholder="daily/** projects/**  Leave empty to include all paths" rows="4" class="svelte-b8rwae"></textarea> <span class="hint svelte-b8rwae">If set, only tasks in these paths are included</span></label> <label class="svelte-b8rwae"><span class="label-with-badge svelte-b8rwae">Exclude Paths <span class="badge wins svelte-b8rwae">Wins</span></span> <textarea placeholder="archive/** templates/** trash/**" rows="4" class="svelte-b8rwae"></textarea> <span class="hint svelte-b8rwae">Always excluded, even if in include list</span></label></div></section> <section class="filter-section svelte-b8rwae"><h3 class="svelte-b8rwae"> Tag Scoping</h3> <p class="help-text svelte-b8rwae">Tags are boundary-safe: <code class="svelte-b8rwae">#work</code>  <code class="svelte-b8rwae">#workshop</code> <br/> <strong>Case-insensitive:</strong> <code class="svelte-b8rwae">#Work</code> = <code class="svelte-b8rwae">#work</code></p> <div class="dual-input svelte-b8rwae"><label class="svelte-b8rwae"><span class="label-with-badge svelte-b8rwae">Include Tags <span class="badge optional svelte-b8rwae">Optional</span></span> <input type="text" placeholder="#task, #work, #active" class="svelte-b8rwae"/> <span class="hint svelte-b8rwae">Task must have at least one of these tags</span></label> <label class="svelte-b8rwae"><span class="label-with-badge svelte-b8rwae">Exclude Tags <span class="badge wins svelte-b8rwae">Wins</span></span> <input type="text" placeholder="#archive, #template, #ignore" class="svelte-b8rwae"/> <span class="hint svelte-b8rwae">Tasks with these tags are always excluded</span></label></div></section> <section class="filter-section svelte-b8rwae"><h3 class="svelte-b8rwae"> Regex Scoping (Advanced)</h3> <p class="help-text svelte-b8rwae">Pattern matching for complex filtering. Invalid regex will be disabled automatically. <br/> <strong>Examples:</strong> <code class="svelte-b8rwae">TODO|FIXME</code>, <code class="svelte-b8rwae">wip|draft</code>, <code class="svelte-b8rwae">^\\[.*\\]</code></p> <div class="dual-input svelte-b8rwae"><label class="svelte-b8rwae"><span class="label-with-badge svelte-b8rwae">Include Regex <span class="badge optional svelte-b8rwae">Optional</span></span> <input type="text" placeholder="TODO|FIXME|IMPORTANT" class="svelte-b8rwae"/> <span class="hint svelte-b8rwae">Task must match this pattern</span></label> <label class="svelte-b8rwae"><span class="label-with-badge svelte-b8rwae">Exclude Regex <span class="badge wins svelte-b8rwae">Wins</span></span> <input type="text" placeholder="wip|draft|skip" class="svelte-b8rwae"/> <span class="hint svelte-b8rwae">Tasks matching this are excluded</span></label></div> <div class="regex-targets svelte-b8rwae"><span class="targets-label svelte-b8rwae">Match against:</span> <label class="checkbox-label svelte-b8rwae"><input type="checkbox" class="svelte-b8rwae"/> <span>Task Text</span></label> <label class="checkbox-label svelte-b8rwae"><input type="checkbox" class="svelte-b8rwae"/> <span>Path</span></label> <label class="checkbox-label svelte-b8rwae"><input type="checkbox" class="svelte-b8rwae"/> <span>File Name</span></label></div></section> <!> <div class="profile-save-actions svelte-b8rwae"><button type="button" class="primary svelte-b8rwae"> Save Profile</button> <button type="button" class="secondary svelte-b8rwae"> Reset All to Defaults</button></div></div>'),L_=C('<span class="task-path svelte-b8rwae"> </span>'),F_=C('<span class="task-tags svelte-b8rwae"> </span>'),q_=C('<span class="explanation svelte-b8rwae"> </span>'),U_=C('<li class="svelte-b8rwae"><div class="task-info svelte-b8rwae"><span class="task-name svelte-b8rwae"> </span> <!> <!></div> <!></li>'),B_=C('<details open class="svelte-b8rwae"><summary class="svelte-b8rwae">Sample Excluded Tasks (first 20):</summary> <ul class="excluded-samples svelte-b8rwae"></ul></details>'),z_=C('<div class="no-excluded svelte-b8rwae"> All tasks pass the current filter</div>'),$_=C('<div class="profile-toolbar svelte-b8rwae"><div class="profile-selector svelte-b8rwae"><label for="profile-select" class="svelte-b8rwae">Active Profile:</label> <select id="profile-select" class="svelte-b8rwae"></select></div> <div class="profile-actions svelte-b8rwae"><button type="button" title="Create new profile" class="svelte-b8rwae">+ New</button> <button type="button" title="Duplicate current profile" class="svelte-b8rwae"> Duplicate</button> <button type="button" title="Delete current profile" class="svelte-b8rwae"> Delete</button> <button type="button" title="Export profile to JSON" class="svelte-b8rwae"> Export</button> <button type="button" title="Import profile from JSON" class="svelte-b8rwae"> Import</button></div></div> <!> <div class="preview svelte-b8rwae"><div class="preview-header svelte-b8rwae"><h3 class="svelte-b8rwae"> Live Preview</h3> <label class="checkbox-label svelte-b8rwae"><input type="checkbox" class="svelte-b8rwae"/> <span>Show Explain Mode</span></label></div> <div class="preview-stats svelte-b8rwae"><div class="stat stat-included svelte-b8rwae"><span class="stat-icon svelte-b8rwae"></span> <div class="stat-content svelte-b8rwae"><span class="stat-value svelte-b8rwae"> </span> <span class="stat-label svelte-b8rwae">Included</span></div></div> <div class="stat stat-excluded svelte-b8rwae"><span class="stat-icon svelte-b8rwae"></span> <div class="stat-content svelte-b8rwae"><span class="stat-value svelte-b8rwae"> </span> <span class="stat-label svelte-b8rwae">Excluded</span></div></div> <div class="stat stat-total svelte-b8rwae"><span class="stat-icon svelte-b8rwae"></span> <div class="stat-content svelte-b8rwae"><span class="stat-value svelte-b8rwae"> </span> <span class="stat-label svelte-b8rwae">Total</span></div></div></div> <!></div> <div class="quick-tips svelte-b8rwae"><h3 class="svelte-b8rwae"> Quick Tips</h3> <ul class="svelte-b8rwae"><li class="svelte-b8rwae"><strong>Precedence:</strong> Exclude always wins over include</li> <li class="svelte-b8rwae"><strong>Performance:</strong> Filters are compiled and optimized for 10k+ tasks</li> <li class="svelte-b8rwae"><strong>Profiles:</strong> Create multiple profiles for different contexts (Work, Personal, etc.)</li> <li class="svelte-b8rwae"><strong>Query Overrides:</strong> Use <code class="svelte-b8rwae">@ignoreGlobalFilter</code> or <code class="svelte-b8rwae">@profile Work</code> in queries</li> <li class="svelte-b8rwae"><strong>Debugging:</strong> Enable "Show Explain Mode" to see why tasks are excluded</li></ul></div>',1),Y_=C('<div class="disabled-state svelte-b8rwae"><p class="svelte-b8rwae">Global Filter is disabled. All tasks will be included.</p> <p class="hint svelte-b8rwae">Enable to start filtering tasks by path, tags, or regex patterns.</p></div>'),j_=C(`<div class="global-filter-settings svelte-b8rwae"><div class="header svelte-b8rwae"><div class="header-content svelte-b8rwae"><h2 class="svelte-b8rwae">Global Filter Profiles</h2> <p class="subtitle svelte-b8rwae">Control which tasks are included in your plugin universe. 
        Tasks that fail the filter won't appear in queries, dashboards, or notifications.</p></div> <label class="enable-toggle svelte-b8rwae"><input type="checkbox"/> <span class="svelte-b8rwae">Enable Global Filter</span></label></div> <!></div>`);function W_(n,e){ht(e,!0);const t=fs.getInstance();let s=V(De(e.settingsService.get().globalFilter??ta)),r=J(()=>o(s).profiles.find(Q=>Q.id===o(s).activeProfileId)),a=V(De({included:0,excluded:0,samples:[]})),i=V(De([])),l=V(!1),c=V(""),u=V(""),d=V(""),f=V("");kt(()=>{o(r)&&(T(c,o(r).includePaths.join(`
`),!0),T(u,o(r).excludePaths.join(`
`),!0),T(d,o(r).includeTags.join(", "),!0),T(f,o(r).excludeTags.join(", "),!0))});function p(Q){o(s).activeProfileId=Q,t.setActiveProfile(Q),_()}function y(){const Q={id:`profile_${Date.now()}`,name:"New Profile",description:"",includePaths:[],excludePaths:[],includeTags:[],excludeTags:[],includeRegex:void 0,excludeRegex:void 0,regexTargets:["taskText"],excludeStatusTypes:[]};o(s).profiles=[...o(s).profiles,Q],o(s).activeProfileId=Q.id,_(),W.success("Profile created")}function w(){if(!o(r))return;const Q={...o(r),id:`profile_${Date.now()}`,name:`${o(r).name} (Copy)`};o(s).profiles=[...o(s).profiles,Q],o(s).activeProfileId=Q.id,_(),W.success("Profile duplicated")}function m(Q){if(o(s).profiles.length<=1){W.error("Cannot delete the last profile");return}o(s).profiles=o(s).profiles.filter(Z=>Z.id!==Q),o(s).activeProfileId===Q&&(o(s).activeProfileId=o(s).profiles[0].id),_(),W.success("Profile deleted")}function g(){if(!o(r))return;o(r).includePaths=o(c).split(`
`).map(Z=>Z.trim()).filter(Boolean),o(r).excludePaths=o(u).split(`
`).map(Z=>Z.trim()).filter(Boolean),o(r).includeTags=o(d).split(",").map(Z=>Z.trim()).filter(Boolean),o(r).excludeTags=o(f).split(",").map(Z=>Z.trim()).filter(Boolean);const Q=jh(o(r));T(i,Q.errors,!0),Q.valid?(_(),W.success("Profile saved")):W.error("Validation failed - check errors below")}async function _(){t.updateConfig(o(s)),await e.settingsService.update({globalFilter:o(s)}),Ye.emit("task: settings",{source:"global-filter"}),x()}function x(){if(!e.repository){T(a,{included:0,excluded:0,samples:[]},!0);return}const Q=e.repository.getAllTasks(),Z=fs.getInstance(),U=Q.filter(M=>!Z.shouldIncludeTask(M));T(a,{included:Q.length-U.length,excluded:U.length,samples:U.slice(0,20)},!0)}function D(Q){const Z=t.explainTask(Q);let U=Z.reason;return Z.matchedRule&&(U+=` (${Z.matchedRule.type}:  ${Z.matchedRule.pattern}`,Z.matchedRule.target&&(U+=` on ${Z.matchedRule.target}`),U+=")"),U}async function E(){confirm("Reset all profiles to defaults?  This cannot be undone.")&&(T(s,{...ta},!0),await _(),W.success("Reset to defaults"))}function R(){if(!o(r))return;const Q=JSON.stringify(o(r),null,2),Z=new Blob([Q],{type:"application/json"}),U=URL.createObjectURL(Z),M=document.createElement("a");M.href=U,M.download=`${o(r).name.replace(/\s+/g,"-").toLowerCase()}-profile.json`,M.click(),URL.revokeObjectURL(U),W.success("Profile exported")}async function P(){const Q=document.createElement("input");Q.type="file",Q.accept=". json",Q.onchange=async Z=>{var M;const U=(M=Z.target.files)==null?void 0:M[0];if(U)try{const I=await U.text(),G=JSON.parse(I);if(!G.id||!G.name||!Array.isArray(G.includePaths))throw new Error("Invalid profile format");G.id=`profile_${Date.now()}`,o(s).profiles=[...o(s).profiles,G],o(s).activeProfileId=G.id,await _(),W.success(`Profile "${G.name}" imported`)}catch(I){W.error(`Import failed: ${I instanceof Error?I.message:"Unknown error"}`)}},Q.click()}kt(()=>{x()});var L=j_(),H=h(L),Y=v(h(H),2),X=h(Y);X.__change=()=>_();var oe=v(H,2);{var ae=Q=>{var Z=$_(),U=Ve(Z),M=h(U),I=v(h(M),2);I.__change=()=>p(o(s).activeProfileId),We(I,21,()=>o(s).profiles,yt,(Ne,xe)=>{var Pe=O_(),Ge=h(Pe),Ue={};$(()=>{N(Ge,o(xe).name),Ue!==(Ue=o(xe).id)&&(Pe.value=(Pe.__value=o(xe).id)??"")}),S(Ne,Pe)});var G=v(M,2),se=h(G);se.__click=y;var be=v(se,2);be.__click=w;var pe=v(be,2);pe.__click=()=>m(o(s).activeProfileId);var ce=v(pe,2);ce.__click=R;var Ie=v(ce,2);Ie.__click=P;var Me=v(U,2);{var Be=Ne=>{var xe=P_(),Pe=h(xe),Ge=h(Pe);Ge.__change=()=>g();var Ue=v(Ge,2);Ue.__change=()=>g();var st=v(Pe,2),gt=v(h(st),4),vt=h(gt),It=v(h(vt),2),mt=v(vt,2),Pt=v(h(mt),2),ss=v(st,2),ne=v(h(ss),4),we=h(ne),ge=v(h(we),2),Oe=v(we,2),he=v(h(Oe),2),ke=v(ss,2),Re=v(h(ke),4),pt=h(Re),$t=v(h(pt),2),xt=v(pt,2),Gt=v(h(xt),2),Dt=v(Re,2),Lt=v(h(Dt),2),As=h(Lt);As.__change=Xe=>{Xe.currentTarget.checked?o(r).regexTargets.includes("taskText")||(o(r).regexTargets=[...o(r).regexTargets,"taskText"]):o(r).regexTargets=o(r).regexTargets.filter(Ft=>Ft!=="taskText")};var Yt=v(Lt,2),ns=h(Yt);ns.__change=Xe=>{Xe.currentTarget.checked?o(r).regexTargets.includes("path")||(o(r).regexTargets=[...o(r).regexTargets,"path"]):o(r).regexTargets=o(r).regexTargets.filter(Ft=>Ft!=="path")};var Kt=v(Yt,2),z=h(Kt);z.__change=Xe=>{Xe.currentTarget.checked?o(r).regexTargets.includes("fileName")||(o(r).regexTargets=[...o(r).regexTargets,"fileName"]):o(r).regexTargets=o(r).regexTargets.filter(Ft=>Ft!=="fileName")};var ye=v(ke,2);{var nt=Xe=>{var Ft=N_(),fn=v(h(Ft),2);We(fn,21,()=>o(i),yt,(pi,gi)=>{var ya=R_(),vn=h(ya);$(()=>N(vn,o(gi))),S(pi,ya)}),S(Xe,Ft)};j(ye,Xe=>{o(i).length>0&&Xe(nt)})}var rs=v(ye,2),Vt=h(rs);Vt.__click=g;var hn=v(Vt,2);hn.__click=E,$((Xe,Ft,fn)=>{Cn(As,Xe),Cn(ns,Ft),Cn(z,fn)},[()=>o(r).regexTargets.includes("taskText"),()=>o(r).regexTargets.includes("path"),()=>o(r).regexTargets.includes("fileName")]),ut(Ge,()=>o(r).name,Xe=>o(r).name=Xe),ut(Ue,()=>o(r).description,Xe=>o(r).description=Xe),ut(It,()=>o(c),Xe=>T(c,Xe)),ut(Pt,()=>o(u),Xe=>T(u,Xe)),ut(ge,()=>o(d),Xe=>T(d,Xe)),ut(he,()=>o(f),Xe=>T(f,Xe)),ut($t,()=>o(r).includeRegex,Xe=>o(r).includeRegex=Xe),ut(Gt,()=>o(r).excludeRegex,Xe=>o(r).excludeRegex=Xe),S(Ne,xe)};j(Me,Ne=>{o(r)&&Ne(Be)})}var de=v(Me,2),B=h(de),A=v(h(B),2),F=h(A),K=v(B,2),ie=h(K),O=v(h(ie),2),q=h(O),ee=h(q),me=v(ie,2),_e=v(h(me),2),ue=h(_e),Ee=h(ue),Ae=v(me,2),ze=v(h(Ae),2),Ze=h(ze),He=h(Ze),at=v(K,2);{var dt=Ne=>{var xe=B_(),Pe=v(h(xe),2);We(Pe,21,()=>o(a).samples,yt,(Ge,Ue)=>{var st=U_(),gt=h(st),vt=h(gt),It=h(vt),mt=v(vt,2);{var Pt=Oe=>{var he=L_(),ke=h(he);$(()=>N(ke,o(Ue).path)),S(Oe,he)};j(mt,Oe=>{o(Ue).path&&Oe(Pt)})}var ss=v(mt,2);{var ne=Oe=>{var he=F_(),ke=h(he);$(Re=>N(ke,Re),[()=>o(Ue).tags.join(" ")]),S(Oe,he)};j(ss,Oe=>{o(Ue).tags&&o(Ue).tags.length>0&&Oe(ne)})}var we=v(gt,2);{var ge=Oe=>{var he=q_(),ke=h(he);$(Re=>N(ke,Re),[()=>D(o(Ue))]),S(Oe,he)};j(we,Oe=>{o(l)&&Oe(ge)})}$(()=>N(It,o(Ue).name)),S(Ge,st)}),S(Ne,xe)},Ce=Ne=>{var xe=lt(),Pe=Ve(xe);{var Ge=Ue=>{var st=z_();S(Ue,st)};j(Pe,Ue=>{o(s).enabled&&Ue(Ge)},!0)}S(Ne,xe)};j(at,Ne=>{o(a).samples.length>0?Ne(dt):Ne(Ce,!1)})}$(()=>{pe.disabled=o(s).profiles.length<=1,N(ee,o(a).included),N(Ee,o(a).excluded),N(He,o(a).included+o(a).excluded)}),Ku(I,()=>o(s).activeProfileId,Ne=>o(s).activeProfileId=Ne),Ls(F,()=>o(l),Ne=>T(l,Ne)),S(Q,Z)},ve=Q=>{var Z=Y_();S(Q,Z)};j(oe,Q=>{o(s).enabled?Q(ae):Q(ve,!1)})}Ls(X,()=>o(s).enabled,Q=>o(s).enabled=Q),S(n,L),ft()}Tt(["change","click"]);var H_=C('<button class="delete-btn svelte-1qw3eru">Delete</button>'),G_=C('<span class="default-badge svelte-1qw3eru">Default</span>'),K_=C('<tr class="svelte-1qw3eru"><td class="svelte-1qw3eru"><code class="status-symbol svelte-1qw3eru"> </code></td><td class="svelte-1qw3eru"> </td><td class="svelte-1qw3eru"><span class="status-type svelte-1qw3eru"> </span></td><td class="svelte-1qw3eru"><code class="status-symbol svelte-1qw3eru"> </code></td><td class="example-col svelte-1qw3eru"><code class="example svelte-1qw3eru"> </code></td><td class="svelte-1qw3eru"><!></td></tr>'),V_=C('<div class="status-registry-editor svelte-1qw3eru"><h3 class="settings__section-title svelte-1qw3eru">Custom Task Statuses</h3> <p class="description svelte-1qw3eru">Define custom checkbox symbols for different task states</p> <div class="status-list svelte-1qw3eru"><div class="table-container svelte-1qw3eru"><table class="svelte-1qw3eru"><thead class="svelte-1qw3eru"><tr><th class="svelte-1qw3eru">Symbol</th><th class="svelte-1qw3eru">Name</th><th class="svelte-1qw3eru">Type</th><th class="svelte-1qw3eru">Next Symbol</th><th class="svelte-1qw3eru">Example</th><th class="svelte-1qw3eru">Actions</th></tr></thead><tbody class="svelte-1qw3eru"></tbody></table></div></div> <div class="add-status-section svelte-1qw3eru"><h4 class="subsection-title svelte-1qw3eru">Add Custom Status</h4> <div class="add-status-form"><div class="form-row svelte-1qw3eru"><div class="form-field svelte-1qw3eru"><label class="settings__label svelte-1qw3eru">Symbol (1 char)</label> <input type="text" placeholder="!" maxlength="1" class="settings__input svelte-1qw3eru"/></div> <div class="form-field svelte-1qw3eru"><label class="settings__label svelte-1qw3eru">Name</label> <input type="text" placeholder="Important" class="settings__input svelte-1qw3eru"/></div> <div class="form-field svelte-1qw3eru"><label class="settings__label svelte-1qw3eru">Type</label> <select class="settings__input svelte-1qw3eru"><option>TODO</option><option>IN_PROGRESS</option><option>DONE</option><option>CANCELLED</option><option>NON_TASK</option></select></div> <div class="form-field svelte-1qw3eru"><label class="settings__label svelte-1qw3eru">Next Symbol</label> <input type="text" placeholder="x" maxlength="1" class="settings__input svelte-1qw3eru"/></div> <div class="form-field svelte-1qw3eru"><label class="settings__label svelte-1qw3eru">&nbsp;</label> <button class="add-btn svelte-1qw3eru">Add Status</button></div></div></div></div> <div class="actions svelte-1qw3eru"><button class="reset-btn svelte-1qw3eru">Reset to Defaults</button></div> <div class="info-section svelte-1qw3eru"><h4 class="subsection-title svelte-1qw3eru">About Custom Statuses</h4> <ul class="svelte-1qw3eru"><li class="svelte-1qw3eru"><strong>Symbol:</strong> The character shown in the checkbox (e.g., <code class="svelte-1qw3eru">[!]</code>)</li> <li class="svelte-1qw3eru"><strong>Type:</strong> Determines how the task is treated (active, completed, etc.)</li> <li class="svelte-1qw3eru"><strong>Next Symbol:</strong> What symbol to use when toggling the task</li> <li class="svelte-1qw3eru"><strong>Examples:</strong> <code class="svelte-1qw3eru">[!]</code> for urgent, <code class="svelte-1qw3eru">[?]</code> for question, <code class="svelte-1qw3eru">[&gt;]</code> for forwarded</li></ul></div></div>');function Q_(n,e){ht(e,!0);let t=Hs.getInstance(),s=V(De([])),r=V(""),a=V(""),i=V(De(wt.TODO)),l=V("x");function c(){T(s,t.getAll(),!0)}function u(){if(!o(r).trim()||!o(a).trim()){W.error("Symbol and name are required");return}if(o(r).length!==1){W.error("Symbol must be a single character");return}const de={symbol:o(r),name:o(a),type:o(i),nextStatusSymbol:o(l)},B=new Qs(de);t.register(B),c(),p(),W.success(`Status "${o(a)}" added`)}function d(de){if([" ","x","/","-"].includes(de)){W.error("Cannot delete default status");return}t.unregister(de),c(),W.success("Status deleted")}function f(){confirm("Reset all statuses to defaults? This will remove all custom statuses.")&&(t.reset(),c(),W.success("Statuses reset to defaults"))}function p(){T(r,""),T(a,""),T(i,wt.TODO,!0),T(l,"x")}kt(()=>{c()});var y=V_(),w=v(h(y),4),m=h(w),g=h(m),_=v(h(g));We(_,21,()=>o(s),yt,(de,B)=>{var A=K_(),F=h(A),K=h(F),ie=h(K),O=v(F),q=h(O),ee=v(O),me=h(ee),_e=h(me),ue=v(ee),Ee=h(ue),Ae=h(Ee),ze=v(ue),Ze=h(ze),He=h(Ze),at=v(ze),dt=h(at);{var Ce=xe=>{var Pe=H_();Pe.__click=()=>d(o(B).symbol),S(xe,Pe)},Ne=xe=>{var Pe=G_();S(xe,Pe)};j(dt,xe=>{[" ","x","/","-"].includes(o(B).symbol)?xe(Ne,!1):xe(Ce)})}$(()=>{N(ie,`[${o(B).symbol??""}]`),N(q,o(B).name),N(_e,o(B).type),N(Ae,`[${o(B).nextStatusSymbol??""}]`),N(He,`- [${o(B).symbol??""}] Task example`)}),S(de,A)});var x=v(w,2),D=v(h(x),2),E=h(D),R=h(E),P=v(h(R),2),L=v(R,2),H=v(h(L),2),Y=v(L,2),X=v(h(Y),2),oe=h(X),ae={},ve=v(oe),Q={},Z=v(ve),U={},M=v(Z),I={},G=v(M),se={},be=v(Y,2),pe=v(h(be),2),ce=v(be,2),Ie=v(h(ce),2);Ie.__click=u;var Me=v(x,2),Be=h(Me);Be.__click=f,$(()=>{ae!==(ae=wt.TODO)&&(oe.value=(oe.__value=wt.TODO)??""),Q!==(Q=wt.IN_PROGRESS)&&(ve.value=(ve.__value=wt.IN_PROGRESS)??""),U!==(U=wt.DONE)&&(Z.value=(Z.__value=wt.DONE)??""),I!==(I=wt.CANCELLED)&&(M.value=(M.__value=wt.CANCELLED)??""),se!==(se=wt.NON_TASK)&&(G.value=(G.__value=wt.NON_TASK)??"")}),ut(P,()=>o(r),de=>T(r,de)),ut(H,()=>o(a),de=>T(a,de)),Ku(X,()=>o(i),de=>T(i,de)),ut(pe,()=>o(l),de=>T(l,de)),S(n,y),ft()}Tt(["click"]);var X_=C('<button class="settings__close-btn svelte-1ke3hir"></button>'),Z_=C("<div> </div>"),J_=C('<section class="settings__section svelte-1ke3hir"><div class="settings__section-header svelte-1ke3hir"><h3 class="settings__section-title svelte-1ke3hir">n8n Webhook</h3> <label class="settings__toggle svelte-1ke3hir"><input type="checkbox" class="svelte-1ke3hir"/> <span>Enabled</span></label></div> <div class="settings__field svelte-1ke3hir"><label class="settings__label svelte-1ke3hir" for="n8n-webhook">Webhook URL</label> <input id="n8n-webhook" class="settings__input svelte-1ke3hir" type="url" placeholder="https://your-n8n-instance.com/webhook/..."/></div> <div class="settings__field svelte-1ke3hir"><label class="settings__label svelte-1ke3hir" for="n8n-secret">Shared Secret</label> <input id="n8n-secret" class="settings__input svelte-1ke3hir" type="password" placeholder="Optional shared secret"/></div> <button class="settings__test-btn svelte-1ke3hir"> </button> <!></section>'),ew=C('<div class="settings__shortcut-context svelte-1ke3hir"> </div>'),tw=C('<div class="settings__shortcut svelte-1ke3hir"><div class="settings__shortcut-main svelte-1ke3hir"><div class="settings__shortcut-label svelte-1ke3hir"> </div> <div class="settings__shortcut-description svelte-1ke3hir"> </div> <!></div> <div class="settings__shortcut-keys svelte-1ke3hir"><input class="settings__shortcut-input svelte-1ke3hir" type="text" placeholder="Unassigned"/> <div class="settings__shortcut-actions svelte-1ke3hir"><button class="settings__shortcut-btn svelte-1ke3hir" type="button">Save</button> <button class="settings__shortcut-btn settings__shortcut-btn--ghost svelte-1ke3hir" type="button">Reset</button></div> <div class="settings__shortcut-default svelte-1ke3hir"> </div></div></div>'),sw=C(`<section class="settings__section svelte-1ke3hir"><div class="settings__section-header svelte-1ke3hir"><h3 class="settings__section-title svelte-1ke3hir">Keyboard Shortcuts</h3></div> <div class="settings__shortcuts svelte-1ke3hir"></div> <button class="settings__shortcut-reset-all svelte-1ke3hir" type="button">Reset all shortcuts</button> <p class="settings__shortcut-note svelte-1ke3hir">Tip: You can also customize these in SiYuan's native shortcut settings.</p></section>`),nw=C('<div class="settings__warning svelte-1ke3hir"> Strict mode enabled - tasks with any parsing errors will be rejected</div>'),rw=C('<section class="settings__section svelte-1ke3hir"><div class="settings__section-header svelte-1ke3hir"><h3 class="settings__section-title svelte-1ke3hir">Auto-Creation Settings</h3> <label class="settings__toggle svelte-1ke3hir"><input type="checkbox" class="svelte-1ke3hir"/> <span>Enable Inline Creation</span></label></div> <p class="settings__description svelte-1ke3hir">Automatically create tasks from markdown checklists as you type.</p> <div class="settings__subsection svelte-1ke3hir"><h4 class="settings__subsection-title svelte-1ke3hir">Auto-Creation Triggers</h4> <label class="settings__checkbox svelte-1ke3hir"><input type="checkbox" class="svelte-1ke3hir"/> <div><div class="settings__checkbox-label svelte-1ke3hir">Create on Enter</div> <div class="settings__checkbox-description svelte-1ke3hir">Automatically create task when you press Enter after typing a checklist</div></div></label> <label class="settings__checkbox svelte-1ke3hir"><input type="checkbox" class="svelte-1ke3hir"/> <div><div class="settings__checkbox-label svelte-1ke3hir">Create on Blur</div> <div class="settings__checkbox-description svelte-1ke3hir">Automatically create task when you click away from a checklist (debounced)</div></div></label></div> <div class="settings__subsection svelte-1ke3hir"><h4 class="settings__subsection-title svelte-1ke3hir">Normalization</h4> <label class="settings__checkbox svelte-1ke3hir"><input type="checkbox" class="svelte-1ke3hir"/> <div><div class="settings__checkbox-label svelte-1ke3hir">Normalize on Save</div> <div class="settings__checkbox-description svelte-1ke3hir">Reformat checklist text to standard format after task creation</div></div></label></div> <div class="settings__subsection svelte-1ke3hir"><h4 class="settings__subsection-title svelte-1ke3hir">Parsing Mode</h4> <label class="settings__checkbox svelte-1ke3hir"><input type="checkbox" class="svelte-1ke3hir"/> <div><div class="settings__checkbox-label svelte-1ke3hir">Strict Parsing</div> <div class="settings__checkbox-description svelte-1ke3hir">Reject tasks with invalid syntax (warning: may be frustrating)</div></div></label> <!></div> <div class="settings__subsection svelte-1ke3hir"><h4 class="settings__subsection-title svelte-1ke3hir">Visual Indicators</h4> <label class="settings__checkbox svelte-1ke3hir"><input type="checkbox" class="svelte-1ke3hir"/> <div><div class="settings__checkbox-label svelte-1ke3hir">Show Error Hints</div> <div class="settings__checkbox-description svelte-1ke3hir">Display inline error messages when task parsing fails</div></div></label> <label class="settings__checkbox svelte-1ke3hir"><input type="checkbox" class="svelte-1ke3hir"/> <div><div class="settings__checkbox-label svelte-1ke3hir">Highlight Managed Tasks</div> <div class="settings__checkbox-description svelte-1ke3hir">Add visual indicator to checklists that have linked tasks</div></div></label></div> <button class="settings__save-btn svelte-1ke3hir">Save Auto-Creation Settings</button></section>'),aw=C('<div class="settings__footer svelte-1ke3hir"><button class="settings__save-btn svelte-1ke3hir">Save Settings</button></div>'),iw=C('<div class="settings svelte-1ke3hir"><div class="settings__header svelte-1ke3hir"><h2 class="settings__title svelte-1ke3hir">Settings</h2> <!></div> <div class="settings__layout svelte-1ke3hir"><nav class="settings__nav svelte-1ke3hir"><button>General</button> <button>Global Filtering & Query</button> <button>Custom Statuses</button> <button>Shortcuts</button> <button>Auto-Creation</button></nav> <div class="settings__content svelte-1ke3hir"><!></div></div> <!></div>');function ow(n,e){ht(e,!0);let t=V(De(Zi)),s=V(null),r=De({}),a=V("general"),i=V(De([])),l=V(De({})),c=V(De({enableInlineCreation:!0,autoCreateOnEnter:!1,autoCreateOnBlur:!1,normalizeOnSave:!0,strictParsing:!1,showInlineHints:!0,highlightManagedTasks:!0}));function u(){if(!e.shortcutManager){T(i,[],!0),T(l,{},!0);return}T(i,e.shortcutManager.getShortcutDisplay(),!0),T(l,o(i).reduce((I,G)=>(I[G.id]=G.currentHotkey||"",I),{}),!0)}function d(I,G){T(l,{...o(l),[I]:G},!0)}async function f(I){if(!e.shortcutManager)return;const G=await e.shortcutManager.updateShortcut(I,o(l)[I]??"");if(!G.success){W.error(G.message||"Failed to update shortcut.");return}W.success("Shortcut updated."),u()}async function p(I){e.shortcutManager&&(await e.shortcutManager.resetShortcut(I),W.success("Shortcut reset."),u())}async function y(){e.shortcutManager&&(await e.shortcutManager.resetAllShortcuts(),W.success("Shortcuts reset to defaults."),u())}kt(()=>{T(t,e.eventService.getConfig(),!0)}),kt(()=>{u()}),kt(()=>{const I=e.settingsService.get();I.inlineTasks&&T(c,{...I.inlineTasks},!0)});async function w(){try{await e.eventService.saveConfig(o(t)),W.success("Settings saved successfully!"),e.onClose&&e.onClose()}catch(I){W.error("Failed to save settings: "+I)}}async function m(){try{await e.settingsService.update({inlineTasks:o(c)}),W.success("Auto-creation settings saved!")}catch(I){W.error("Failed to save settings: "+I)}}async function g(){T(s,"n8n"),r.n8n={success:!1,message:"Testing..."};try{const I=await e.eventService.testConnection();r.n8n={success:I.success,message:I.success?"Test successful!":I.message||"Test failed. Check configuration."}}catch(I){r.n8n={success:!1,message:"Error: "+(I instanceof Error?I.message:String(I))}}finally{T(s,null)}}var _=iw(),x=h(_),D=v(h(x),2);{var E=I=>{var G=X_();G.__click=function(...se){var be;(be=e.onClose)==null||be.apply(this,se)},S(I,G)};j(D,I=>{e.onClose&&I(E)})}var R=v(x,2),P=h(R),L=h(P);L.__click=()=>T(a,"general");var H=v(L,2);H.__click=()=>T(a,"filter");var Y=v(H,2);Y.__click=()=>T(a,"statuses");var X=v(Y,2);X.__click=()=>T(a,"shortcuts");var oe=v(X,2);oe.__click=()=>T(a,"inlineTasks");var ae=v(P,2),ve=h(ae);{var Q=I=>{var G=J_(),se=h(G),be=v(h(se),2),pe=h(be),ce=v(se,2),Ie=v(h(ce),2),Me=v(ce,2),Be=v(h(Me),2),de=v(Me,2);de.__click=g;var B=h(de),A=v(de,2);{var F=K=>{var ie=Z_(),O=h(ie);$(()=>{Je(ie,1,`settings__test-result ${r.n8n.success?"success":"error"}`,"svelte-1ke3hir"),N(O,r.n8n.message)}),S(K,ie)};j(A,K=>{r.n8n&&K(F)})}$(()=>{Ie.disabled=!o(t).n8n.enabled,Be.disabled=!o(t).n8n.enabled,de.disabled=!o(t).n8n.enabled||o(s)==="n8n",N(B,o(s)==="n8n"?"Testing...":"Test Connection")}),Ls(pe,()=>o(t).n8n.enabled,K=>o(t).n8n.enabled=K),ut(Ie,()=>o(t).n8n.webhookUrl,K=>o(t).n8n.webhookUrl=K),ut(Be,()=>o(t).n8n.sharedSecret,K=>o(t).n8n.sharedSecret=K),S(I,G)},Z=I=>{var G=lt(),se=Ve(G);{var be=ce=>{W_(ce,{get settingsService(){return e.settingsService},get repository(){return e.repository}})},pe=ce=>{var Ie=lt(),Me=Ve(Ie);{var Be=B=>{Q_(B,{})},de=B=>{var A=lt(),F=Ve(A);{var K=O=>{var q=sw(),ee=v(h(q),2);We(ee,21,()=>o(i),yt,(_e,ue)=>{var Ee=tw(),Ae=h(Ee),ze=h(Ae),Ze=h(ze),He=v(ze,2),at=h(He),dt=v(He,2);{var Ce=vt=>{var It=ew(),mt=h(It);$(()=>N(mt,o(ue).context)),S(vt,It)};j(dt,vt=>{o(ue).context&&vt(Ce)})}var Ne=v(Ae,2),xe=h(Ne);xe.__input=vt=>d(o(ue).id,vt.currentTarget.value);var Pe=v(xe,2),Ge=h(Pe);Ge.__click=()=>f(o(ue).id);var Ue=v(Ge,2);Ue.__click=()=>p(o(ue).id);var st=v(Pe,2),gt=h(st);$(()=>{N(Ze,o(ue).label),N(at,o(ue).description),Fo(xe,o(l)[o(ue).id]??""),N(gt,`Default: ${(o(ue).defaultHotkey||"Unassigned")??""}`)}),S(_e,Ee)});var me=v(ee,2);me.__click=y,S(O,q)},ie=O=>{var q=lt(),ee=Ve(q);{var me=_e=>{var ue=rw(),Ee=h(ue),Ae=v(h(Ee),2),ze=h(Ae),Ze=v(Ee,4),He=v(h(Ze),2),at=h(He),dt=v(He,2),Ce=h(dt),Ne=v(Ze,2),xe=v(h(Ne),2),Pe=h(xe),Ge=v(Ne,2),Ue=v(h(Ge),2),st=h(Ue),gt=v(Ue,2);{var vt=ge=>{var Oe=nw();S(ge,Oe)};j(gt,ge=>{o(c).strictParsing&&ge(vt)})}var It=v(Ge,2),mt=v(h(It),2),Pt=h(mt),ss=v(mt,2),ne=h(ss),we=v(It,2);we.__click=m,$(()=>{at.disabled=!o(c).enableInlineCreation,Ce.disabled=!o(c).enableInlineCreation,Pe.disabled=!o(c).enableInlineCreation,st.disabled=!o(c).enableInlineCreation,Pt.disabled=!o(c).enableInlineCreation,ne.disabled=!o(c).enableInlineCreation}),Ls(ze,()=>o(c).enableInlineCreation,ge=>o(c).enableInlineCreation=ge),Ls(at,()=>o(c).autoCreateOnEnter,ge=>o(c).autoCreateOnEnter=ge),Ls(Ce,()=>o(c).autoCreateOnBlur,ge=>o(c).autoCreateOnBlur=ge),Ls(Pe,()=>o(c).normalizeOnSave,ge=>o(c).normalizeOnSave=ge),Ls(st,()=>o(c).strictParsing,ge=>o(c).strictParsing=ge),Ls(Pt,()=>o(c).showInlineHints,ge=>o(c).showInlineHints=ge),Ls(ne,()=>o(c).highlightManagedTasks,ge=>o(c).highlightManagedTasks=ge),S(_e,ue)};j(ee,_e=>{o(a)==="inlineTasks"&&_e(me)},!0)}S(O,q)};j(F,O=>{o(a)==="shortcuts"?O(K):O(ie,!1)},!0)}S(B,A)};j(Me,B=>{o(a)==="statuses"?B(Be):B(de,!1)},!0)}S(ce,Ie)};j(se,ce=>{o(a)==="filter"?ce(be):ce(pe,!1)},!0)}S(I,G)};j(ve,I=>{o(a)==="general"?I(Q):I(Z,!1)})}var U=v(R,2);{var M=I=>{var G=aw(),se=h(G);se.__click=w,S(I,G)};j(U,I=>{o(a)==="general"&&I(M)})}$(()=>{Je(L,1,`settings__nav-btn ${o(a)==="general"?"active":""}`,"svelte-1ke3hir"),Je(H,1,`settings__nav-btn ${o(a)==="filter"?"active":""}`,"svelte-1ke3hir"),Je(Y,1,`settings__nav-btn ${o(a)==="statuses"?"active":""}`,"svelte-1ke3hir"),Je(X,1,`settings__nav-btn ${o(a)==="shortcuts"?"active":""}`,"svelte-1ke3hir"),Je(oe,1,`settings__nav-btn ${o(a)==="inlineTasks"?"active":""}`,"svelte-1ke3hir")}),S(n,_),ft()}Tt(["click","input"]);var lw=C('<div class="dashboard__overlay svelte-1y1a8hs"><!></div>'),cw=C('<div class="dashboard__overlay svelte-1y1a8hs"><!></div>'),uw=C('<span class="dashboard__tab-badge svelte-1y1a8hs"> </span>'),dw=C('<span class="dashboard__tab-badge svelte-1y1a8hs"> </span>'),hw=C('<span class="dashboard__tab-badge svelte-1y1a8hs"> </span>'),fw=C('<span class="dashboard__tab-badge svelte-1y1a8hs"> </span>'),vw=C('<span class="dashboard__tab-badge svelte-1y1a8hs"> </span>'),pw=C('<div class="dashboard__filters svelte-1y1a8hs"><span class="dashboard__filters-label svelte-1y1a8hs">Quick Filters:</span> <button>Not Done</button> <button>Due Today</button> <button>Overdue</button> <button>In Progress</button> <button>Blocked</button> <button>Blocking</button> <button>High Priority</button></div>'),gw=C('<div class="dashboard__tabs svelte-1y1a8hs" role="tablist" aria-label="Dashboard tabs"><button id="dashboard-tab-inbox" role="tab" aria-controls="dashboard-panel"> Inbox <!></button> <button id="dashboard-tab-today" role="tab" aria-controls="dashboard-panel"> Today <!></button> <button id="dashboard-tab-upcoming" role="tab" aria-controls="dashboard-panel"> Upcoming <!></button> <button id="dashboard-tab-done" role="tab" aria-controls="dashboard-panel"> Done <!></button> <button id="dashboard-tab-projects" role="tab" aria-controls="dashboard-panel"> Projects <!></button> <button id="dashboard-tab-search" role="tab" aria-controls="dashboard-panel"> Search</button> <button id="dashboard-tab-all" role="tab" aria-controls="dashboard-panel"> All <span class="dashboard__tab-badge svelte-1y1a8hs"> </span></button> <button id="dashboard-tab-insights" role="tab" aria-controls="dashboard-panel"> Insights</button></div> <!> <div id="dashboard-panel" class="dashboard__content svelte-1y1a8hs" role="tabpanel"><!></div>',1),mw=C('<div class="dashboard svelte-1y1a8hs"><div class="dashboard__header svelte-1y1a8hs"><h1 class="dashboard__title svelte-1y1a8hs">Recurring Tasks</h1> <div class="dashboard__header-actions svelte-1y1a8hs"><button class="dashboard__refresh-btn svelte-1y1a8hs" title="Refresh tasks"> </button> <button class="dashboard__settings-btn svelte-1y1a8hs"> Settings</button></div></div> <!></div>');function yw(n,e){ht(e,!0),Df(Yo,e.settingsService.get().urgency);const t=e.scheduler.getTimezoneHandler(),s=e.scheduler.getRecurrenceEngine();let r=V("today"),a=V(!1),i=V(!1),l=V(void 0),c=V(De(new Set)),u=V(De([])),d=J(()=>$v(o(u))),f=V(!1);const p=J(()=>["inbox","today","upcoming","done","projects","search","all","insights"].includes(o(r))?`dashboard-tab-${o(r)}`:void 0),y=J(()=>()=>{let A=o(u);if(o(c).has("notDone")&&(A=A.filter(F=>F.status!=="done"&&F.status!=="cancelled")),o(c).has("dueToday")){const F=new Date;F.setHours(0,0,0,0);const K=new Date(F);K.setDate(K.getDate()+1),A=A.filter(ie=>{if(!ie.dueAt)return!1;const O=new Date(ie.dueAt);return O>=F&&O<K})}if(o(c).has("overdue")){const F=new Date;F.setHours(0,0,0,0),A=A.filter(K=>!K.dueAt||K.status==="done"||K.status==="cancelled"?!1:new Date(K.dueAt)<F)}return o(c).has("inProgress")&&(A=A.filter(F=>F.status==="todo"&&F.statusSymbol&&F.statusSymbol!==" ")),o(c).has("blocked")&&(A=A.filter(F=>qv(F,o(u)))),o(c).has("blocking")&&(A=A.filter(F=>Uv(F,o(u)))),o(c).has("highPriority")&&(A=A.filter(F=>{const K=Rr(F.priority)||"normal";return K==="high"||K==="highest"})),A}),w=J(()=>o(u).filter(A=>A.status!=="done"&&A.status!=="cancelled"&&!A.dueAt&&!A.scheduledAt&&!A.startAt).length),m=J(()=>()=>{const A=new Date;A.setHours(0,0,0,0);const F=new Date(A);return F.setDate(F.getDate()+7),o(u).filter(K=>{if(K.status==="done"||K.status==="cancelled"||!K.dueAt)return!1;const ie=new Date(K.dueAt);return ie.setHours(0,0,0,0),ie>A&&ie<=F}).length}),g=J(()=>()=>{const A=new Date;return A.setDate(A.getDate()-30),A.setHours(0,0,0,0),o(u).filter(F=>F.status!=="done"||!F.doneAt?!1:new Date(F.doneAt)>=A).length}),_=J(()=>o(u).filter(A=>A.status!=="done"&&A.status!=="cancelled").length);function x(A="initial"){T(f,!0),T(u,e.repository.getAllTasks().map(F=>({...F})),!0),T(f,!1),A!=="initial"&&W.info("Task list reloaded")}x();const D=()=>x("reload");va(()=>{window.addEventListener("recurring-task-refresh",D)}),wv(()=>{window.removeEventListener("recurring-task-refresh",D)});async function E(A){Ye.emit("task: complete",{taskId:A.id})}async function R(A){const F=o(u),K=Ei(o(u),A.id,ie=>{const O={...ie},q=new Date(O.dueAt),ee=t.tomorrow();return ee.setHours(q.getHours(),q.getMinutes(),0,0),O.dueAt=ee.toISOString(),O.snoozeCount=(O.snoozeCount||0)+1,O.updatedAt=new Date().toISOString(),O});T(u,K,!0),W.info(`Task "${A.name}" delayed to tomorrow`);try{await e.eventService.emitTaskEvent("task. snoozed",A),await e.scheduler.delayToTomorrow(A.id)}catch(ie){T(u,F,!0),W.error("Failed to delay task:  "+ie),x("external")}}async function P(A){var K;if(!((K=A.name)!=null&&K.trim())){W.error("Task name is required");return}if(!Vu(A.frequency)){W.error("Invalid frequency configuration");return}const F={...A};T(u,Aa(o(u),F),!0),T(a,!1),T(l,void 0),W.success(`Task "${A.name}" saved successfully`),e.repository.saveTask(F).catch(ie=>{W.error("Failed to save task: "+ie),x("external")})}async function L(A){const F=o(u);T(u,Bl(o(u),A.id),!0);const K=window.setTimeout(async()=>{try{await e.repository.deleteTask(A.id)}catch(ie){T(u,F,!0),W.error("Failed to delete task: "+ie),x("external")}},5e3);Yn({message:`Task "${A.name}" deleted`,type:"success",duration:5e3,actionLabel:"Undo",onAction:()=>{window.clearTimeout(K),T(u,F,!0),W.info(`Restored "${A.name}"`)},showCountdown:!0})}async function H(A){const F=A.name.endsWith(" (copy)")?`${A.name} ${new Date().toLocaleDateString()}`:`${A.name} (copy)`,K=Zu(A,{name:F});T(u,Aa(o(u),K),!0),W.success(`Duplicated "${A.name}"`),e.repository.saveTask(K).catch(ie=>{T(u,Bl(o(u),K.id),!0),W.error("Failed to duplicate task: "+ie),x("external")})}async function Y(A){const F=!A.enabled,K={...A,enabled:F},ie=Ei(o(u),A.id,()=>K);T(u,ie,!0),W.info(`Task ${F?"enabled":"disabled"}`),e.repository.saveTask(K).catch(O=>{W.error("Failed to update task: "+O),x("external")})}async function X(A,F){if(A.length===0)return;const K=o(u),ie=new Set(A),O=o(u).map(q=>ie.has(q.id)?{...q,enabled:F}:q);T(u,O,!0),W.info(`${F?"Enabled":"Disabled"} ${A.length} task${A.length===1?"":"s"}`);try{const q=O.filter(ee=>ie.has(ee.id));await Promise.all(q.map(ee=>e.repository.saveTask(ee)))}catch(q){T(u,K,!0),W.error(`Failed to ${F?"enable":"disable"} tasks: ${q}`),x("external")}}async function oe(A){if(A.length===0)return;const F=o(u),K=new Set(A),ie=o(u).filter(q=>K.has(q.id));T(u,o(u).filter(q=>!K.has(q.id)),!0);const O=window.setTimeout(async()=>{try{await Promise.all(ie.map(q=>e.repository.deleteTask(q.id)))}catch(q){T(u,F,!0),W.error("Failed to delete tasks: "+q),x("external")}},5e3);Yn({message:`${ie.length} task${ie.length===1?"":"s"} deleted`,type:"success",duration:5e3,actionLabel:"Undo",onAction:()=>{window.clearTimeout(O),T(u,F,!0),W.info("Bulk delete undone")},showCountdown:!0})}function ae(A){T(l,A,!0),T(a,!0)}function ve(){T(l,void 0),T(a,!0)}function Q(){T(a,!1),T(l,void 0)}function Z(){T(i,!0)}function U(){T(i,!1)}async function M(A){const F=o(u),K=Ei(o(u),A.id,ie=>{const O={...ie};Ju(O);const q=s.calculateNext(new Date(O.dueAt),O.frequency);return O.dueAt=q.toISOString(),O});T(u,K,!0),W.info(`Task "${A.name}" skipped to next occurrence`);try{await e.eventService.emitTaskEvent("task.skipped",A),await e.scheduler.skipTaskOccurrence(A.id)}catch(ie){T(u,F,!0),W.error("Failed to skip task: "+ie),x("external")}}function I(A){const F=new Set(o(c));F.has(A)?F.delete(A):F.add(A),T(c,F,!0)}async function G(A){const F={...A,status:"todo",doneAt:void 0};T(u,Aa(o(u),F),!0),W.success(`Task "${A.name}" marked as not done`),e.repository.saveTask(F).catch(K=>{W.error("Failed to update task: "+K),x("external")})}var se=mw(),be=h(se),pe=v(h(be),2),ce=h(pe);ce.__click=()=>x("reload");var Ie=h(ce),Me=v(ce,2);Me.__click=Z;var Be=v(be,2);{var de=A=>{var F=lw(),K=h(F);ow(K,{get eventService(){return e.eventService},get shortcutManager(){return e.shortcutManager},get settingsService(){return e.settingsService},get repository(){return e.repository},onClose:U}),S(A,F)},B=A=>{var F=lt(),K=Ve(F);{var ie=q=>{var ee=cw(),me=h(ee);Dd(me,{get task(){return o(l)},get repository(){return e.repository},onSave:P,onClose:Q}),S(q,ee)},O=q=>{var ee=gw(),me=Ve(ee),_e=h(me);_e.__click=()=>T(r,"inbox");var ue=v(h(_e));{var Ee=he=>{var ke=uw(),Re=h(ke);$(()=>N(Re,o(w))),S(he,ke)};j(ue,he=>{o(w)>0&&he(Ee)})}var Ae=v(_e,2);Ae.__click=()=>T(r,"today");var ze=v(h(Ae));{var Ze=he=>{var ke=dw(),Re=h(ke);$(()=>N(Re,o(d).length)),S(he,ke)};j(ze,he=>{o(d).length>0&&he(Ze)})}var He=v(Ae,2);He.__click=()=>T(r,"upcoming");var at=v(h(He));{var dt=he=>{var ke=hw(),Re=h(ke);$(()=>N(Re,o(m))),S(he,ke)};j(at,he=>{o(m)>0&&he(dt)})}var Ce=v(He,2);Ce.__click=()=>T(r,"done");var Ne=v(h(Ce));{var xe=he=>{var ke=fw(),Re=h(ke);$(()=>N(Re,o(g))),S(he,ke)};j(Ne,he=>{o(g)>0&&he(xe)})}var Pe=v(Ce,2);Pe.__click=()=>T(r,"projects");var Ge=v(h(Pe));{var Ue=he=>{var ke=vw(),Re=h(ke);$(()=>N(Re,o(_))),S(he,ke)};j(Ge,he=>{o(_)>0&&he(Ue)})}var st=v(Pe,2);st.__click=()=>T(r,"search");var gt=v(st,2);gt.__click=()=>T(r,"all");var vt=v(h(gt)),It=h(vt),mt=v(gt,2);mt.__click=()=>T(r,"insights");var Pt=v(me,2);{var ss=he=>{var ke=pw(),Re=v(h(ke),2);Re.__click=()=>I("notDone");var pt=v(Re,2);pt.__click=()=>I("dueToday");var $t=v(pt,2);$t.__click=()=>I("overdue");var xt=v($t,2);xt.__click=()=>I("inProgress");var Gt=v(xt,2);Gt.__click=()=>I("blocked");var Dt=v(Gt,2);Dt.__click=()=>I("blocking");var Lt=v(Dt,2);Lt.__click=()=>I("highPriority"),$((As,Yt,ns,Kt,z,ye,nt)=>{Je(Re,1,`dashboard__filter-btn ${As??""}`,"svelte-1y1a8hs"),Je(pt,1,`dashboard__filter-btn ${Yt??""}`,"svelte-1y1a8hs"),Je($t,1,`dashboard__filter-btn ${ns??""}`,"svelte-1y1a8hs"),Je(xt,1,`dashboard__filter-btn ${Kt??""}`,"svelte-1y1a8hs"),Je(Gt,1,`dashboard__filter-btn ${z??""}`,"svelte-1y1a8hs"),Je(Dt,1,`dashboard__filter-btn ${ye??""}`,"svelte-1y1a8hs"),Je(Lt,1,`dashboard__filter-btn ${nt??""}`,"svelte-1y1a8hs")},[()=>o(c).has("notDone")?"active":"",()=>o(c).has("dueToday")?"active":"",()=>o(c).has("overdue")?"active":"",()=>o(c).has("inProgress")?"active":"",()=>o(c).has("blocked")?"active":"",()=>o(c).has("blocking")?"active":"",()=>o(c).has("highPriority")?"active":""]),S(he,ke)};j(Pt,he=>{o(r)!=="search"&&o(r)!=="timeline"&&o(r)!=="analytics"&&o(r)!=="insights"&&he(ss)})}var ne=v(Pt,2),we=h(ne);{var ge=he=>{{let ke=J(()=>o(c).size>0?o(y):o(u));Hp(he,{get tasks(){return o(ke)},onEdit:ae,onDone:E,onDelete:L})}},Oe=he=>{var ke=lt(),Re=Ve(ke);{var pt=xt=>{{let Gt=J(()=>o(c).size>0?o(y).filter(Dt=>o(d).some(Lt=>Lt.id===Dt.id)):o(d));fp(xt,{get tasks(){return o(Gt)},onDone:E,onDelay:R,onSkip:M,onEdit:ae,get timezoneHandler(){return t}})}},$t=xt=>{var Gt=lt(),Dt=Ve(Gt);{var Lt=Yt=>{{let ns=J(()=>o(c).size>0?o(y):o(u));Xp(Yt,{get tasks(){return o(ns)},onEdit:ae,onDone:E,onDelete:L})}},As=Yt=>{var ns=lt(),Kt=Ve(ns);{var z=nt=>{{let rs=J(()=>o(c).size>0?o(y):o(u));rg(nt,{get tasks(){return o(rs)},onEdit:ae,onDelete:L,onUncomplete:G})}},ye=nt=>{var rs=lt(),Vt=Ve(rs);{var hn=Ft=>{{let fn=J(()=>o(c).size>0?o(y):o(u));ug(Ft,{get tasks(){return o(fn)},onEdit:ae,onDone:E,onDelete:L})}},Xe=Ft=>{var fn=lt(),pi=Ve(fn);{var gi=vn=>{Ky(vn,{get tasks(){return o(u)},onEdit:ae,onDone:E,onDelete:L})},ya=vn=>{var Jo=lt(),Nd=Ve(Jo);{var Pd=cr=>{{let ba=J(()=>o(c).size>0?o(y):o(u));kp(cr,{get tasks(){return o(ba)},onEdit:ae,onDelete:L,onDuplicate:H,onToggleEnabled:Y,onBulkEnable:$r=>X($r,!0),onBulkDisable:$r=>X($r,!1),onBulkDelete:oe,onCreate:ve})}},Ld=cr=>{var ba=lt(),$r=Ve(ba);{var Fd=ur=>{Mp(ur,{get tasks(){return o(u)},get recurrenceEngine(){return s}})},qd=ur=>{var el=lt(),Ud=Ve(el);{var Bd=dr=>{$p(dr,{get tasks(){return o(u)}})},zd=dr=>{var tl=lt(),$d=Ve(tl);{var Yd=mi=>{ib(mi,{get tasks(){return o(u)},onApplySuggestion:async(_a,yi)=>{const sl={..._a,frequency:yi.suggestedSchedule.frequency,dueAt:yi.suggestedSchedule.time?(()=>{const wa=new Date(_a.dueAt),[jd,Wd]=yi.suggestedSchedule.time.split(":").map(Number);return wa.setHours(jd,Wd||0,0,0),wa.toISOString()})():_a.dueAt,updatedAt:new Date().toISOString()};T(u,Aa(o(u),sl),!0),W.success(`Schedule updated for "${_a.name}"`);try{await e.repository.saveTask(sl)}catch(wa){W.error("Failed to save schedule update: "+wa),x("external")}}})};j($d,mi=>{o(r)==="insights"&&mi(Yd)},!0)}S(dr,tl)};j(Ud,dr=>{o(r)==="analytics"?dr(Bd):dr(zd,!1)},!0)}S(ur,el)};j($r,ur=>{o(r)==="timeline"?ur(Fd):ur(qd,!1)},!0)}S(cr,ba)};j(Nd,cr=>{o(r)==="all"?cr(Pd):cr(Ld,!1)},!0)}S(vn,Jo)};j(pi,vn=>{o(r)==="search"?vn(gi):vn(ya,!1)},!0)}S(Ft,fn)};j(Vt,Ft=>{o(r)==="projects"?Ft(hn):Ft(Xe,!1)},!0)}S(nt,rs)};j(Kt,nt=>{o(r)==="done"?nt(z):nt(ye,!1)},!0)}S(Yt,ns)};j(Dt,Yt=>{o(r)==="upcoming"?Yt(Lt):Yt(As,!1)},!0)}S(xt,Gt)};j(Re,xt=>{o(r)==="today"?xt(pt):xt($t,!1)},!0)}S(he,ke)};j(we,he=>{o(r)==="inbox"?he(ge):he(Oe,!1)})}$(()=>{Je(_e,1,`dashboard__tab ${o(r)==="inbox"?"active":""}`,"svelte-1y1a8hs"),Le(_e,"aria-selected",o(r)==="inbox"),Je(Ae,1,`dashboard__tab ${o(r)==="today"?"active":""}`,"svelte-1y1a8hs"),Le(Ae,"aria-selected",o(r)==="today"),Je(He,1,`dashboard__tab ${o(r)==="upcoming"?"active":""}`,"svelte-1y1a8hs"),Le(He,"aria-selected",o(r)==="upcoming"),Je(Ce,1,`dashboard__tab ${o(r)==="done"?"active":""}`,"svelte-1y1a8hs"),Le(Ce,"aria-selected",o(r)==="done"),Je(Pe,1,`dashboard__tab ${o(r)==="projects"?"active":""}`,"svelte-1y1a8hs"),Le(Pe,"aria-selected",o(r)==="projects"),Je(st,1,`dashboard__tab ${o(r)==="search"?"active":""}`,"svelte-1y1a8hs"),Le(st,"aria-selected",o(r)==="search"),Je(gt,1,`dashboard__tab ${o(r)==="all"?"active":""}`,"svelte-1y1a8hs"),Le(gt,"aria-selected",o(r)==="all"),N(It,o(u).length),Je(mt,1,`dashboard__tab ${o(r)==="insights"?"active":""}`,"svelte-1y1a8hs"),Le(mt,"aria-selected",o(r)==="insights"),Le(ne,"aria-labelledby",o(p))}),S(q,ee)};j(K,q=>{o(a)?q(ie):q(O,!1)},!0)}S(A,F)};j(Be,A=>{o(i)?A(de):A(B,!1)})}$(()=>{ce.disabled=o(f),N(Ie,o(f)?"":"")}),S(n,se),ft()}Tt(["click"]);var bw=C('<div class="quick-add-card__error svelte-1q3w22"> </div>'),_w=C('<div class="quick-add-card__error svelte-1q3w22"> </div>'),ww=C('<div class="quick-add-card__linked svelte-1q3w22">Linked block: <span class="svelte-1q3w22"> </span></div>'),kw=C('<button class="quick-add-card__advanced svelte-1q3w22" type="button">Advanced...</button>'),Tw=C('<div class="quick-add-overlay svelte-1q3w22" role="dialog" aria-modal="true" aria-labelledby="quick-add-title"><div class="quick-add-card svelte-1q3w22" role="document"><div class="quick-add-card__header svelte-1q3w22"><h2 id="quick-add-title" class="svelte-1q3w22">Quick Add</h2> <button class="quick-add-card__close svelte-1q3w22" type="button" aria-label="Close"></button></div> <div class="quick-add-card__field svelte-1q3w22"><label for="quick-task-name">Task Name *</label> <input id="quick-task-name" type="text" placeholder="e.g. Review daily notes" class="svelte-1q3w22"/> <!></div> <div class="quick-add-card__field svelte-1q3w22"><label for="quick-task-due">Due *</label> <input id="quick-task-due" type="datetime-local" class="svelte-1q3w22"/> <!></div> <!> <div class="quick-add-card__actions svelte-1q3w22"><button class="quick-add-card__cancel svelte-1q3w22" type="button">Cancel</button> <!> <button class="quick-add-card__save svelte-1q3w22" type="button"> </button></div> <p class="quick-add-card__hint svelte-1q3w22">Tip: Press /Ctrl + Enter to save.</p></div></div>');function Sw(n,e){var U;ht(e,!0);let t=V(De(((U=e.prefill)==null?void 0:U.suggestedName)??"")),s=V(De(new Date().toISOString().slice(0,16))),r=V(De({name:!1,dueAt:!1})),a=V(!1),i=V(null);const l=J(()=>o(r).name&&!o(t).trim()?"Task name is required.":""),c=J(()=>o(r).dueAt?o(s)?Number.isNaN(new Date(o(s)).getTime())?"Enter a valid date and time.":"":"Due date and time are required.":""),u=J(()=>!!(o(l)||o(c)));va(()=>{var M;if((M=e.prefill)!=null&&M.suggestedTime){const I=new Date,[G,se]=e.prefill.suggestedTime.split(":").map(Number);I.setHours(G,se,0,0),T(s,I.toISOString().slice(0,16),!0)}requestAnimationFrame(()=>{var I;(I=o(i))==null||I.focus()})});async function d(){var se,be;if(T(r,{name:!0,dueAt:!0},!0),o(u)){W.warning("Please fill out the required fields.");return}const M=oi(),I=o(s).slice(11,16);if(M.time=I,!Vu(M)){W.error("Invalid frequency configuration.");return}const G=pa(o(t).trim(),M,new Date(o(s)));G.linkedBlockId=((se=e.prefill)==null?void 0:se.linkedBlockId)||void 0,G.linkedBlockContent=((be=e.prefill)==null?void 0:be.linkedBlockContent)||void 0,T(a,!0);try{await e.repository.saveTask(G),W.success(`Task "${G.name}" created`),Ye.emit("task:refresh",void 0),window.dispatchEvent(new CustomEvent("recurring-task-refresh")),e.onClose()}catch(pe){W.error("Failed to create task: "+pe)}finally{T(a,!1)}}function f(M){M.key==="Escape"&&e.onClose(),(M.metaKey||M.ctrlKey)&&M.key==="Enter"&&(M.preventDefault(),d())}var p=Tw();p.__keydown=f;var y=h(p),w=h(y),m=v(h(w),2);m.__click=function(...M){var I;(I=e.onClose)==null||I.apply(this,M)};var g=v(w,2),_=v(h(g),2);_.__input=()=>o(r).name=!0,Ps(_,M=>T(i,M),()=>o(i));var x=v(_,2);{var D=M=>{var I=bw(),G=h(I);$(()=>N(G,o(l))),S(M,I)};j(x,M=>{o(l)&&M(D)})}var E=v(g,2),R=v(h(E),2);R.__input=()=>o(r).dueAt=!0;var P=v(R,2);{var L=M=>{var I=_w(),G=h(I);$(()=>N(G,o(c))),S(M,I)};j(P,M=>{o(c)&&M(L)})}var H=v(E,2);{var Y=M=>{var I=ww(),G=v(h(I)),se=h(G);$(()=>N(se,e.prefill.linkedBlockId)),S(M,I)};j(H,M=>{var I;(I=e.prefill)!=null&&I.linkedBlockId&&M(Y)})}var X=v(H,2),oe=h(X);oe.__click=function(...M){var I;(I=e.onClose)==null||I.apply(this,M)};var ae=v(oe,2);{var ve=M=>{var I=kw();I.__click=function(...G){var se;(se=e.onAdvanced)==null||se.apply(this,G)},S(M,I)};j(ae,M=>{e.onAdvanced&&M(ve)})}var Q=v(ae,2);Q.__click=d;var Z=h(Q);$(()=>{Le(_,"aria-invalid",!!o(l)),Le(R,"aria-invalid",!!o(c)),Q.disabled=o(a),N(Z,o(a)?"Saving":"Create Task")}),Bt("blur",_,()=>o(r).name=!0),ut(_,()=>o(t),M=>T(t,M)),Bt("blur",R,()=>o(r).dueAt=!0),ut(R,()=>o(s),M=>T(s,M)),S(n,p),ft()}Tt(["keydown","click","input"]);var xw=C('<button class="postpone-card__option svelte-tkdeu6" type="button" role="listitem"> </button>'),Dw=C('<div class="postpone-overlay svelte-tkdeu6" role="dialog" aria-modal="true" aria-labelledby="postpone-title"><div class="postpone-card svelte-tkdeu6" role="document"><div class="postpone-card__header svelte-tkdeu6"><h2 id="postpone-title" class="svelte-tkdeu6">Postpone task</h2> <button class="postpone-card__close svelte-tkdeu6" type="button" aria-label="Close"></button></div> <p class="postpone-card__summary svelte-tkdeu6">Choose a new due offset for <strong> </strong>.</p> <div class="postpone-card__options svelte-tkdeu6" role="list"></div> <div class="postpone-card__actions svelte-tkdeu6"><button class="postpone-card__cancel svelte-tkdeu6" type="button">Cancel</button></div></div></div>');function Ew(n,e){ht(e,!0);let t=V(null);function s(m,g){g&&T(t,m,!0)}va(()=>{requestAnimationFrame(()=>{var m;(m=o(t))==null||m.focus()})});function r(m){m.key==="Escape"&&e.onClose()}var a=Dw();a.__keydown=r;var i=h(a),l=h(i),c=v(h(l),2);c.__click=function(...m){var g;(g=e.onClose)==null||g.apply(this,m)};var u=v(l,2),d=v(h(u)),f=h(d),p=v(u,2);We(p,21,()=>Av,yt,(m,g,_)=>{var x=xw();x.__click=()=>e.onSelect(o(g).minutes);var D=h(x);dv(x,(E,R)=>s==null?void 0:s(E,R),()=>_===0),$(()=>N(D,o(g).label)),S(m,x)});var y=v(p,2),w=h(y);w.__click=function(...m){var g;(g=e.onClose)==null||g.apply(this,m)},$(()=>N(f,e.taskName)),S(n,a),ft()}Tt(["keydown","click"]);function Ed(){return Intl.DateTimeFormat().resolvedOptions().timeZone}class Aw{static migrateFrequency(e,t){if(e.rruleString)return e;const s=this.legacyToRRule(e),r=t?t.toISOString():new Date().toISOString();return{...e,rruleString:s.toString(),dtstart:r,naturalLanguage:s.toText(),timezone:e.timezone||Ed()}}static legacyToRRule(e){const t={freq:this.mapFreqType(e.type),interval:e.interval||1};return e.type==="weekly"&&e.weekdays&&e.weekdays.length>0&&(t.byweekday=e.weekdays.map(this.mapWeekday)),e.type==="monthly"&&e.dayOfMonth&&(e.dayOfMonth===31?t.bymonthday=-1:t.bymonthday=e.dayOfMonth),e.type==="yearly"&&(e.month!==void 0&&(t.bymonth=e.month+1),e.dayOfMonth&&(e.dayOfMonth===31?t.bymonthday=-1:t.bymonthday=e.dayOfMonth)),new le(t)}static mapFreqType(e){switch(e){case"daily":return le.DAILY;case"weekly":return le.WEEKLY;case"monthly":return le.MONTHLY;case"yearly":return le.YEARLY;default:return le.DAILY}}static mapWeekday(e){return[le.MO,le.TU,le.WE,le.TH,le.FR,le.SA,le.SU][e]||le.MO}static migrateTask(e){var t;if((t=e.frequency)!=null&&t.rruleString||!e.frequency)return e;try{const s=new Date(e.dueAt),r=this.migrateFrequency(e.frequency,s),a={type:e.frequency.type,interval:e.frequency.interval,weekdays:"weekdays"in e.frequency?e.frequency.weekdays:void 0,dayOfMonth:"dayOfMonth"in e.frequency?e.frequency.dayOfMonth:void 0,month:"month"in e.frequency?e.frequency.month:void 0,migratedAt:new Date().toISOString()};return{...e,frequency:r,legacyRecurrenceSnapshot:a,updatedAt:new Date().toISOString()}}catch(s){throw Se(`Failed to migrate task ${e.id}:`,s),s}}}async function Cw(n){let e=0,t=0,s=0;const r=[];for(const a of n)try{if(!a.frequency){t++,r.push(a);continue}if(a.frequency.rruleString){t++,r.push(a);continue}const i=Aw.migrateTask(a);r.push(i),e++,re(`Migrated task ${a.id} to RRULE format`)}catch(i){Se(`Failed to migrate task ${a.id}:`,i),s++,r.push(a)}return re(`RRULE Migration complete: ${e} migrated, ${t} skipped, ${s} errors`),{migrated:e,skipped:t,errors:s,migratedTasks:r}}class Iw{constructor(e){b(this,"plugin");this.plugin=e}getCurrentVersion(){return mn}async createBackup(e,t){try{const s=await this.plugin.loadData(e);if(s){const r=new Date().toISOString().replace(/[:.]/g,"-"),a=t!==void 0?`v${t}`:"unknown",i=`${e}-backup-${a}-${r}`;return await this.plugin.saveData(i,s),re(`Created backup: ${i}`),i}throw new Error("No data to backup")}catch(s){throw Se("Failed to create backup",s),s}}async migrate(e){try{const t=await this.plugin.loadData(e);if(!t)return re("No data to migrate"),{migrated:!1,tasksAffected:0,toVersion:mn};const s=Array.isArray(t)?t:Array.isArray(t.tasks)?t.tasks:[];if(s.length===0)return re("No data to migrate"),{migrated:!1,tasksAffected:0,toVersion:mn};let r=!1,a,i,l=0;for(let u=0;u<s.length;u++){const d=s[u],f=d.version||0;f<mn&&(r||(i=f,a=await this.createBackup(e,f),r=!0),s[u]=this.migrateTask(d,f),l++,re(`Migrated task ${d.id} from v${f} to v${mn}`))}const c=await Cw(s);if(c.migrated>0){r||(i=4,a=await this.createBackup(e,i),r=!0),l+=c.migrated;for(let u=0;u<c.migratedTasks.length;u++)s[u]=c.migratedTasks[u]}if(r){const u=Array.isArray(t)?s:{...t,tasks:s};return await this.plugin.saveData(e,u),re(`Migration complete: ${l} tasks migrated`),{migrated:!0,tasksAffected:l,fromVersion:i,toVersion:mn,backupKey:a}}else return re("No migration needed - all tasks up to date"),{migrated:!1,tasksAffected:0,toVersion:mn}}catch(t){throw Se("Migration failed",t),t}}migrateTask(e,t){let s={...e};return t<1&&(s.version=1),t<2&&(s={...s,version:2,timezone:s.timezone||Intl.DateTimeFormat().resolvedOptions().timeZone,completionCount:s.completionCount||0,missCount:s.missCount||0,currentStreak:s.currentStreak||0,bestStreak:s.bestStreak||0,recentCompletions:s.recentCompletions||[],priority:s.priority||"normal",tags:s.tags||[],notificationChannels:s.notificationChannels||[],snoozeCount:s.snoozeCount||0,maxSnoozes:s.maxSnoozes||3}),t<3&&(s={...s,version:3,escalationPolicy:s.escalationPolicy||{enabled:!1,levels:[]},linkedBlockContent:s.linkedBlockContent||void 0,category:s.category||void 0,description:s.description||void 0}),t<4&&(s={...s,version:4,onCompletion:s.onCompletion||"keep",dependsOn:s.dependsOn||[],blockedBy:s.blockedBy||[]}),t<5&&(s={...s,version:5}),s}}class Mw{constructor(e,t=50){b(this,"pendingState",null);b(this,"writeInProgress",!1);b(this,"scheduledTimer",null);b(this,"flushResolvers",[]);this.writer=e,this.debounceMs=t}requestSave(e){this.pendingState=e,!(this.writeInProgress||this.scheduledTimer)&&(this.scheduledTimer=setTimeout(()=>{this.scheduledTimer=null,this.drainQueue()},this.debounceMs))}async flush(){if(!(!this.pendingState&&!this.writeInProgress&&!this.scheduledTimer))return new Promise(e=>{this.flushResolvers.push(e),!this.writeInProgress&&!this.scheduledTimer&&this.pendingState&&this.drainQueue()})}async drainQueue(){if(!this.writeInProgress){this.writeInProgress=!0;try{for(;this.pendingState;){const e=this.pendingState;if(this.pendingState=null,!await this.writeWithRetry(e)){this.pendingState=e;break}}}finally{this.writeInProgress=!1,this.pendingState||this.resolveFlushes(),this.pendingState&&!this.scheduledTimer&&(this.scheduledTimer=setTimeout(()=>{this.scheduledTimer=null,this.drainQueue()},this.debounceMs))}}}async writeWithRetry(e){try{return await this.writer.write(e),!0}catch(t){Se("Task persistence write failed, retrying once",t)}try{return await this.writer.write(e),!0}catch(t){return Se("Task persistence write failed after retry",t),!1}}resolveFlushes(){if(this.flushResolvers.length===0)return;const e=[...this.flushResolvers];this.flushResolvers=[];for(const t of e)t()}}const vo={},Ow=Object.freeze(Object.defineProperty({__proto__:null,default:vo},Symbol.toStringTag,{value:"Module"})),Cc=new Set;function qa(n){const e=`${n.feature}:${n.capability}:${n.message}`;Cc.has(e)||(Cc.add(e),et(n.message,{feature:n.feature,capability:n.capability,cause:n.cause}))}class Ad extends Error{constructor(t,s,r){super(r);b(this,"capability");b(this,"feature");this.name="SiYuanCapabilityError",this.feature=t,this.capability=s}}class Cd extends Error{constructor(t,s,r,a){super(r);b(this,"capability");b(this,"feature");b(this,"cause");this.name="SiYuanApiExecutionError",this.feature=t,this.capability=s,this.cause=a}}class Id{constructor(e=globalThis){b(this,"supportedCapabilities");b(this,"globalScope");this.globalScope=e,this.supportedCapabilities={setBlockAttrs:this.isSetBlockAttrsAvailable(),dataDir:this.isDataDirAvailable()}}isSetBlockAttrsAvailable(){var e;return typeof((e=this.globalScope)==null?void 0:e.setBlockAttrs)=="function"}isDataDirAvailable(){var e,t,s,r;return typeof((r=(s=(t=(e=this.globalScope)==null?void 0:e.siyuan)==null?void 0:t.config)==null?void 0:s.system)==null?void 0:r.dataDir)=="string"}getDataDir(){var e,t,s;return this.isDataDirAvailable()?((s=(t=(e=this.globalScope.siyuan)==null?void 0:e.config)==null?void 0:t.system)==null?void 0:s.dataDir)??null:null}async setBlockAttrs(e,t){const s=this.getSetBlockAttrs();try{await s(e,t)}catch(r){throw new Cd("Block attribute sync","setBlockAttrs","Failed to sync block attributes via SiYuan API.",r)}}getSetBlockAttrs(){if(!this.isSetBlockAttrsAvailable())throw new Ad("Block attribute sync","setBlockAttrs","Block attribute sync unavailable in this SiYuan version. Tasks will continue without block sync.");return this.globalScope.setBlockAttrs}}const Rw=".tmp";class Nw{constructor(e,t){b(this,"plugin");b(this,"apiAdapter");b(this,"fsPromises");this.plugin=e,this.apiAdapter=t}async loadActive(){try{const e=await this.plugin.loadData($n);if(e&&Array.isArray(e.tasks))return new Map(e.tasks.map(t=>[t.id,t]))}catch(e){Se("Failed to load active tasks",e)}return new Map}async saveActive(e){await this.write({tasks:Array.from(e.values())})}async write(e){try{await this.saveActiveAtomic(e),re(`Saved ${e.tasks.length} active tasks`)}catch(t){throw Se("Failed to save active tasks",t),t}}async saveActiveAtomic(e){const t=await this.getFsPromises();if(!t){await this.plugin.saveData($n,e);return}const s=this.resolveStoragePath($n);if(!s){await this.plugin.saveData($n,e);return}const r=vo.dirname(s);await t.mkdir(r,{recursive:!0});const a=`${s}${Rw}`,i=JSON.stringify(e),l=await t.open(a,"w");try{await l.writeFile(i,"utf8"),await l.sync()}finally{await l.close()}try{await t.rename(a,s)}catch{await t.rm(s,{force:!0}),await t.rename(a,s)}}async getFsPromises(){if(this.fsPromises!==void 0)return this.fsPromises;try{const e=await Promise.resolve().then(()=>Ow);return this.fsPromises=e.promises,this.fsPromises}catch(e){return et("Node.js fs unavailable; falling back to plugin storage without atomic writes.",e),this.fsPromises=null,null}}resolveStoragePath(e){const t=this.apiAdapter.getDataDir(),s=this.plugin.name;return!t||!s?(t||qa({feature:"Atomic task storage",capability:"dataDir",message:"SiYuan dataDir unavailable; falling back to plugin storage without atomic writes."}),null):vo.join(t,"storage",`p${s}`,`${e}.json`)}}const Ic=1,Mc=1e3;class Pw{constructor(e){b(this,"plugin");this.plugin=e}async archiveTask(e){await this.archiveTasks([e])}async archiveTasks(e){if(e.length===0)return;const t=await this.loadIndex(),s=this.groupByYear(e);for(const[r,a]of s.entries())await this.appendTasksToYear(t,r,a);await this.saveIndex(t)}async loadArchive(e){const t=await this.loadIndex();if(t.chunks.length===0)return[];const s=this.filterChunks(t.chunks,e),r=[];for(const l of s){const c=await this.loadChunk(l.key);if(c)for(const u of c.tasks)this.matchesQuery(u,e)&&r.push(u)}const a=(e==null?void 0:e.offset)??0,i=(e==null?void 0:e.limit)??r.length;return r.slice(a,a+i)}async loadIndex(){try{const e=await this.plugin.loadData(Pa);if(e&&typeof e=="object"&&Array.isArray(e.chunks))return{version:e.version??Ic,totalCount:e.totalCount??0,chunks:e.chunks}}catch(e){Se("Failed to load archive index",e)}return{version:Ic,totalCount:0,chunks:[]}}async saveIndex(e){try{await this.plugin.saveData(Pa,e)}catch(t){throw Se("Failed to save archive index",t),t}}buildChunkKey(e,t){return`${Pa}-${e}-${t}`}async loadChunk(e){try{const t=await this.plugin.loadData(e);if(t&&Array.isArray(t.tasks))return t}catch(t){Se("Failed to load archive chunk",{key:e,err:t})}return null}async saveChunk(e,t){try{await this.plugin.saveData(e,t)}catch(s){throw Se("Failed to save archive chunk",{key:e,err:s}),s}}groupByYear(e){const t=new Map;for(const s of e){const r=this.getCompletionTimestamp(s),a=new Date(r).getFullYear(),i=t.get(a);i?i.push(s):t.set(a,[s])}return t}async appendTasksToYear(e,t,s){let r=[...s];for(;r.length>0;){const a=this.findOrCreateChunk(e,t),i=await this.loadChunk(a.key)||{tasks:[]},l=Mc-i.tasks.length,c=r.slice(0,l);i.tasks.push(...c),r=r.slice(c.length);const u=this.updateChunkMeta(a,c);a.count=u.count,a.start=u.start,a.end=u.end,await this.saveChunk(a.key,i),e.totalCount+=c.length}}findOrCreateChunk(e,t){const r=e.chunks.filter(l=>l.year===t).sort((l,c)=>l.sequence-c.sequence).at(-1);if(r&&r.count<Mc)return r;const a=r?r.sequence+1:1,i={key:this.buildChunkKey(t,a),year:t,sequence:a,count:0};return e.chunks.push(i),i}updateChunkMeta(e,t){let s=e.start,r=e.end;for(const a of t){const i=this.getCompletionTimestamp(a);(!s||i<s)&&(s=i),(!r||i>r)&&(r=i)}return{...e,count:e.count+t.length,start:s,end:r}}filterChunks(e,t){if(!(t!=null&&t.from)&&!(t!=null&&t.to))return e;const s=t!=null&&t.from?new Date(t.from).getTime():null,r=t!=null&&t.to?new Date(t.to).getTime():null;return e.filter(a=>{const i=a.start?new Date(a.start).getTime():null,l=a.end?new Date(a.end).getTime():null;return!(s&&l&&l<s||r&&i&&i>r)})}matchesQuery(e,t){if(!t)return!0;if(t.taskId&&e.id!==t.taskId)return!1;const s=this.getCompletionTimestamp(e),r=new Date(s).getTime();return!(t.from&&r<new Date(t.from).getTime()||t.to&&r>new Date(t.to).getTime())}getCompletionTimestamp(e){return e.lastCompletedAt||e.updatedAt||e.dueAt}}class Lw{constructor(e,t=new Id){b(this,"plugin");b(this,"activeTasks");b(this,"blockIndex",new Map);b(this,"taskBlockIndex",new Map);b(this,"dueIndex",new Map);b(this,"activeStore");b(this,"archiveStore");b(this,"persistence");b(this,"blockAttrSyncEnabled",!0);b(this,"blockApi");b(this,"apiAdapter");b(this,"syncRetryQueue",new Map);b(this,"retryProcessorInterval");this.plugin=e,this.activeTasks=new Map,this.apiAdapter=t,this.blockApi=t,this.activeStore=new Nw(e,t),this.archiveStore=new Pw(e),this.persistence=new Mw(this.activeStore)}async init(){await this.migrateLegacyStorage();const e=await this.activeStore.loadActive(),t=fs.getInstance(),s=new Map;for(const[r,a]of e.entries())t.shouldIncludeTask(a)&&s.set(r,a);this.activeTasks=s,re(`Loaded ${this.activeTasks.size} active tasks from storage (after global filter)`),this.rebuildBlockIndex(),this.rebuildDueIndex(),this.startSyncRetryProcessor()}async loadActiveTasks(e=1e3,t){const s=await this.activeStore.loadActive(),r=Array.from(s.values()),a=fs.getInstance(),i=r.filter(u=>a.shouldIncludeTask(u)),l=i.length;if(l===0)return[];const c=[];for(let u=0;u<l;u+=e){const d=i.slice(u,Math.min(u+e,l));c.push(...d),t&&t(c.length,l),await new Promise(f=>setTimeout(f,0))}return c}rebuildBlockIndex(){this.blockIndex.clear(),this.taskBlockIndex.clear();for(const e of this.activeTasks.values())e.linkedBlockId&&(this.blockIndex.set(e.linkedBlockId,e.id),this.taskBlockIndex.set(e.id,e.linkedBlockId));re(`Rebuilt block index with ${this.blockIndex.size} entries`)}rebuildDueIndex(){this.dueIndex.clear();for(const e of this.activeTasks.values())e.enabled&&this.addToDueIndex(e);re(`Rebuilt due index with ${this.dueIndex.size} date entries`)}addToDueIndex(e){const t=e.dueAt.slice(0,10);this.dueIndex.has(t)||this.dueIndex.set(t,new Set),this.dueIndex.get(t).add(e.id)}removeFromDueIndex(e){const t=e.dueAt.slice(0,10),s=this.dueIndex.get(t);s&&(s.delete(e.id),s.size===0&&this.dueIndex.delete(t))}getTasksDueOn(e){const t=e.toISOString().slice(0,10);return this.getTasksForDueKey(t)}getTasksDueOnOrBefore(e){const t=e.toISOString().slice(0,10),s=[];for(const[r]of this.dueIndex)r<=t&&s.push(...this.getTasksForDueKey(r));return s}getTasksForDueKey(e){const t=this.dueIndex.get(e);if(!t)return[];const s=[];for(const r of t){const a=this.activeTasks.get(r);if(!a){this.removeStaleDueIndexEntry(e,r,"missing task");continue}if(!a.enabled){this.removeStaleDueIndexEntry(e,r,"task disabled");continue}if(a.dueAt.slice(0,10)!==e){this.removeStaleDueIndexEntry(e,r,"date mismatch");continue}s.push(a)}return s}removeStaleDueIndexEntry(e,t,s){const r=this.dueIndex.get(e);r&&(r.delete(t),r.size===0&&this.dueIndex.delete(e),et("Removed stale due index entry",{taskId:t,dateKey:e,reason:s}))}async save(){this.persistence.requestSave({tasks:Array.from(this.activeTasks.values())})}async flush(){await this.persistence.flush()}getAllTasks(){return Array.from(this.activeTasks.values())}getTask(e){return this.activeTasks.get(e)}getTaskByBlockId(e){const t=this.blockIndex.get(e);return t?this.activeTasks.get(t):void 0}async saveTask(e){const t=this.activeTasks.get(e.id);if(t&&e.version!==void 0&&t.version!==void 0&&e.version<t.version)throw new Error(`Concurrent modification detected for task "${e.name}". Please refresh and try again.`);e.version=(e.version??0)+1;const s=this.activeTasks.get(e.id),r=this.taskBlockIndex.get(e.id);r&&r!==e.linkedBlockId&&(this.blockIndex.delete(r),this.taskBlockIndex.delete(e.id)),s&&s.enabled&&(s.dueAt!==e.dueAt||!e.enabled)&&this.removeFromDueIndex(s),e.linkedBlockId&&(this.blockIndex.set(e.linkedBlockId,e.id),this.taskBlockIndex.set(e.id,e.linkedBlockId)),e.enabled&&this.addToDueIndex(e),e.updatedAt=new Date().toISOString(),this.activeTasks.set(e.id,e),await this.save(),e.linkedBlockId&&await this.syncTaskToBlockAttrsWithRetry(e),r&&r!==e.linkedBlockId&&await this.clearBlockAttrs(r)}async syncTaskToBlockAttrs(e){e.linkedBlockId&&await this.updateBlockAttrs(e.linkedBlockId,{[Pl]:e.id,[Ll]:e.dueAt,[Fl]:e.enabled?"true":"false"})}async clearBlockAttrs(e){await this.updateBlockAttrs(e,{[Pl]:"",[Ll]:"",[Fl]:""})}async updateBlockAttrs(e,t){if(this.blockAttrSyncEnabled){if(!this.apiAdapter.supportedCapabilities.setBlockAttrs){qa({feature:"Block attribute sync",capability:"setBlockAttrs",message:"Block attribute sync unavailable in current SiYuan version. Tasks will continue to function without block sync."}),this.blockAttrSyncEnabled=!1;return}try{await this.blockApi.setBlockAttrs(e,t)}catch(s){s instanceof Ad||s instanceof Cd?qa({feature:s.feature,capability:s.capability,message:s.message,cause:s.cause}):qa({feature:"Block attribute sync",capability:"setBlockAttrs",message:"Unexpected error while syncing block attributes. Block sync disabled to keep tasks stable.",cause:s}),this.blockAttrSyncEnabled=!1}}}async deleteTask(e){const t=this.activeTasks.get(e);t!=null&&t.linkedBlockId&&(this.blockIndex.delete(t.linkedBlockId),await this.clearBlockAttrs(t.linkedBlockId)),this.taskBlockIndex.delete(e),t&&this.removeFromDueIndex(t),this.activeTasks.delete(e),await this.save()}getEnabledTasks(){return this.getAllTasks().filter(e=>e.enabled)}getTodayAndOverdueTasks(){const e=new Date,t=new Date(e);return t.setHours(23,59,59,999),this.getEnabledTasks().filter(s=>new Date(s.dueAt)<=t)}getTasksInRange(e,t){return this.getEnabledTasks().filter(s=>{const r=new Date(s.dueAt);return r>=e&&r<=t})}async clearAll(){this.activeTasks.clear(),await this.save()}async loadActive(){return this.activeStore.loadActive()}async saveActive(e){this.persistence.requestSave({tasks:Array.from(e.values())})}async archiveTask(e){await this.archiveStore.archiveTask(e)}async loadArchive(e){return this.archiveStore.loadArchive(e)}async migrateLegacyStorage(){const e=await this.plugin.loadData($n);if(e&&Array.isArray(e.tasks))return;const t=await this.plugin.loadData(xl);if(!t)return;const s=Array.isArray(t.tasks)?t.tasks:Array.isArray(t)?t:[];if(s.length===0)return;await this.plugin.saveData(Dl,t),re(`Created legacy backup at ${Dl}`);const r=s.filter(l=>!l.enabled&&l.lastCompletedAt),a=s.filter(l=>!r.includes(l)),i=new Map(a.map(l=>[l.id,l]));this.persistence.requestSave({tasks:Array.from(i.values())}),await this.persistence.flush(),r.length>0&&await this.archiveStore.archiveTasks(r),re("Legacy storage migration complete",{activeCount:a.length,archivedCount:r.length,legacyKey:xl,activeKey:$n,archiveIndexKey:Pa})}async syncTaskToBlockAttrsWithRetry(e){try{await this.syncTaskToBlockAttrs(e),this.syncRetryQueue.delete(e.id)}catch(t){const s=this.syncRetryQueue.get(e.id)||{task:e,attempts:0,nextRetry:Date.now()};s.attempts<Ea?(s.attempts++,s.nextRetry=Date.now()+ql[s.attempts-1],s.task=e,this.syncRetryQueue.set(e.id,s),et(`Block sync failed for task ${e.id}, added to retry queue`,{taskId:e.id,attempts:s.attempts,nextRetry:new Date(s.nextRetry).toISOString(),error:t instanceof Error?t.message:String(t)})):(Se(`Block sync failed for task ${e.id} after ${Ea} attempts`,{taskId:e.id,error:t instanceof Error?t.message:String(t)}),this.syncRetryQueue.delete(e.id))}}startSyncRetryProcessor(){this.retryProcessorInterval&&clearInterval(this.retryProcessorInterval),this.retryProcessorInterval=setInterval(async()=>{const e=Date.now(),t=[];for(const[s,r]of this.syncRetryQueue.entries())r.nextRetry<=e&&t.push({id:s,entry:r});for(const{id:s,entry:r}of t)try{await this.syncTaskToBlockAttrs(r.task),this.syncRetryQueue.delete(s),re(`Block sync retry succeeded for task ${s}`,{taskId:s,attempts:r.attempts})}catch(a){r.attempts<Ea?(r.attempts++,r.nextRetry=Date.now()+ql[r.attempts-1],this.syncRetryQueue.set(s,r),et(`Block sync retry failed for task ${s}`,{taskId:s,attempts:r.attempts,nextRetry:new Date(r.nextRetry).toISOString(),error:a instanceof Error?a.message:String(a)})):(Se(`Block sync retry exhausted for task ${s} after ${Ea} attempts`,{taskId:s,error:a instanceof Error?a.message:String(a)}),this.syncRetryQueue.delete(s))}},Mv)}stopSyncRetryProcessor(){this.retryProcessorInterval&&(clearInterval(this.retryProcessorInterval),this.retryProcessorInterval=void 0)}}class Fw{constructor(e){this.storage=e}getAllTasks(){return this.storage.getAllTasks()}getTask(e){return this.storage.getTask(e)}getTaskByBlockId(e){return this.storage.getTaskByBlockId(e)}getEnabledTasks(){return this.storage.getEnabledTasks()}getTasksDueOnOrBefore(e){return this.storage.getTasksDueOnOrBefore(e)}getTodayAndOverdueTasks(){return this.storage.getTodayAndOverdueTasks()}getTasksInRange(e,t){return this.storage.getTasksInRange(e,t)}async saveTask(e){await this.storage.saveTask(e)}async deleteTask(e){await this.storage.deleteTask(e)}async archiveTask(e){await this.storage.archiveTask(e)}async loadArchive(e){return this.storage.loadArchive(e)}async flush(){await this.storage.flush()}}class qw{normalizeInterval(e){return!Number.isFinite(e)||e<1?1:Math.floor(e)}normalizeWeekdays(e){if(!Array.isArray(e))return[];const t=new Set;for(const s of e)Number.isFinite(s)&&s>=0&&s<=6&&t.add(Math.floor(s));return Array.from(t).sort((s,r)=>s-r)}normalizeDayOfMonth(e,t){const s=Number.isFinite(e)?Math.floor(e):t;return Math.min(Math.max(s,1),31)}normalizeMonth(e,t){const s=Number.isFinite(e)?Math.floor(e):t;return Math.min(Math.max(s,0),11)}calculateNext(e,t,s){if(s!=null&&s.timezone||Ed(),t.rruleString)return this.calculateNextWithRRule(e,t,s);const a=((s==null?void 0:s.whenDone)??t.whenDone??!1)&&(s!=null&&s.completionDate)?s.completionDate:e,{type:i,time:l}=t,c=this.normalizeInterval(t.interval);let u;switch(i){case"daily":u=this.calculateNextDaily(a,c);break;case"weekly":u=this.calculateNextWeekly(a,c,this.normalizeWeekdays(t.weekdays));break;case"monthly":u=this.calculateNextMonthly(a,c,this.normalizeDayOfMonth(t.dayOfMonth,a.getDate()));break;case"yearly":u=this.calculateNextYearly(a,c,this.normalizeMonth(t.month,a.getMonth()),this.normalizeDayOfMonth(t.dayOfMonth,a.getDate()));break;default:throw new Error(`Unknown frequency type: ${i}`)}if(l){const{hours:d,minutes:f}=Ji(l);if(Number.isFinite(d)&&Number.isFinite(f)){const{date:p,shifted:y}=$l(u,d,f);y&&et("DST shift detected while applying recurrence time",{requestedTime:l,original:u.toISOString(),adjusted:p.toISOString()}),u=p}}return u}calculateNextWithRRule(e,t,s){try{const a=((s==null?void 0:s.whenDone)??t.whenDone??!1)&&(s!=null&&s.completionDate)?s.completionDate:e,l=fo(t.rruleString).after(a,!1);if(!l){et("RRule returned no next occurrence, falling back to legacy logic",{rruleString:t.rruleString,baseDate:a.toISOString()});const{rruleString:u,naturalLanguage:d,...f}=t;return this.calculateNext(a,f,s)}let c=l;if(t.time){const{hours:u,minutes:d}=Ji(t.time);if(Number.isFinite(u)&&Number.isFinite(d)){const{date:f,shifted:p}=$l(c,u,d);p&&et("DST shift detected while applying recurrence time",{requestedTime:t.time,original:c.toISOString(),adjusted:f.toISOString()}),c=f}}return c}catch(r){Se("Failed to parse rrule, falling back to legacy logic",{error:r instanceof Error?r.message:String(r),rruleString:t.rruleString});const{rruleString:a,naturalLanguage:i,...l}=t;return this.calculateNext(e,l,s)}}calculateNextDaily(e,t){return In(e,t)}calculateNextWeekly(e,t,s){if(!s||s.length===0)return zl(e,t);const r=this.getMondayIndex(e),a=Math.min(xi,t*14);for(let i=1;i<=a;i++){if(Math.floor((r+i)/7)%t!==0)continue;const c=In(e,i),u=this.getMondayIndex(c);if(s.includes(u))return c}return et("Weekly recurrence guard hit, falling back to interval weeks.",{currentDue:e.toISOString(),interval:t,weekdays:s}),zl(e,t)}getMondayIndex(e){return(e.getDay()+6)%7}calculateNextMonthly(e,t,s){const r=s??e.getDate(),a=e.getFullYear(),l=e.getMonth()+t,c=a+Math.floor(l/12),u=(l%12+12)%12,d=new Date(c,u+1,0).getDate(),f=Math.min(r,d),p=new Date(e);return p.setFullYear(c,u,f),p}calculateNextYearly(e,t,s,r){const a=r??e.getDate(),i=e.getFullYear()+t,l=new Date(i,s+1,0).getDate(),c=Math.min(a,l),u=new Date(e);return u.setFullYear(i,s,c),u}getOccurrencesInRange(e,t,s,r){const a=[];let i=new Date(r),l=0;for(;i<=t&&l<xi;)i>=e&&a.push(new Date(i)),i=this.calculateNext(i,s),l++;return a}getMissedOccurrences(e,t,s,r){const a=[];let i=new Date(r),l=0;for(;i<=e&&l<xi;)i=this.calculateNext(i,s),l++;let c=0;for(;i<t&&c<La;)a.push(new Date(i)),i=this.calculateNext(i,s),c++;return c>=La&&et("Recovery iteration cap hit while computing missed occurrences",{lastCheckedAt:e.toISOString(),now:t.toISOString(),frequency:s,firstOccurrence:r.toISOString(),cap:La}),a}}class Uw{getTimezone(){return Intl.DateTimeFormat().resolvedOptions().timeZone}toLocal(e){return new Date(e)}createLocalDateTime(e,t){const{hours:s,minutes:r}=Ji(t);if(!Number.isFinite(s)||!Number.isFinite(r))return new Date(e);const a=new Date(e);return a.setHours(s,r,0,0),a}isSameLocalDay(e,t){const s=new Date(e),r=new Date(t);return s.getFullYear()===r.getFullYear()&&s.getMonth()===r.getMonth()&&s.getDate()===r.getDate()}startOfLocalDay(e){const t=e?new Date(e):new Date;return t.setHours(0,0,0,0),t}endOfLocalDay(e){const t=e?new Date(e):new Date;return t.setHours(23,59,59,999),t}formatLocal(e){return e.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}formatLocalTime(e){return e.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"})}formatLocalDate(e){return e.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}getRelativeTime(e){const t=new Date,s=e.getTime()-t.getTime(),r=Math.trunc(s/(1e3*60)),a=Math.trunc(s/(1e3*60*60)),i=Math.trunc(s/(1e3*60*60*24));return Math.abs(s)<1e3*60?"now":Math.abs(r)<60?r>0?`in ${r}m`:`${-r}m ago`:Math.abs(a)<24?a>0?`in ${a}h`:`${-a}h ago`:i>0?`in ${i}d`:`${-i}d ago`}isToday(e){return this.isSameLocalDay(e,new Date)}isPast(e){return e<new Date}isOverdue(e){return this.isPast(e)&&!this.isToday(e)}addDays(e,t){const s=new Date(e);return s.setDate(s.getDate()+t),s}tomorrow(){return this.addDays(new Date,1)}nextWeek(){return this.addDays(new Date,7)}}class Bw{constructor(e){b(this,"siyuanApi");this.siyuanApi=e}async execute(e,t){try{if(t==="keep")return re(`Task "${e.name}" completed and kept`,{taskId:e.id}),{success:!0};if(t==="delete"){if(!e.linkedBlockId)return et(`Task "${e.name}" has no linkedBlockId, cannot delete from document`,{taskId:e.id}),{success:!0,warnings:["Task has no linked block, removed from task list only"]};if(await this.hasNestedItems(e.linkedBlockId))return et("Cannot delete task with nested items",{taskId:e.id,blockId:e.linkedBlockId}),{success:!1,error:"Cannot delete task with nested items",warnings:['Task has sub-items. Please remove them first or use "keep" mode.']};if(this.siyuanApi&&this.siyuanApi.deleteBlock)await this.siyuanApi.deleteBlock({id:e.linkedBlockId}),re(`Task "${e.name}" completed and deleted from document`,{taskId:e.id,blockId:e.linkedBlockId});else return et("SiYuan API not available, cannot delete block from document"),{success:!0,warnings:["Block could not be deleted from document (API unavailable)"]};return{success:!0}}return{success:!1,error:`Unknown onCompletion action: ${t}`}}catch(s){return Se("Failed to execute onCompletion action",{taskId:e.id,action:t,error:s}),{success:!1,error:s instanceof Error?s.message:"Unknown error occurred"}}}async hasNestedItems(e){if(!this.siyuanApi||!this.siyuanApi.getChildBlocks)return et("SiYuan API not available for nested item check"),!0;try{const t=await this.siyuanApi.getChildBlocks({id:e});return t&&t.length>0}catch(t){return Se("Failed to check for nested items",{blockId:e,error:t}),!0}}}class zw{constructor(e,t){b(this,"intervalMs");b(this,"timeoutId",null);b(this,"isRunning",!1);this.onTick=t,this.intervalMs=e}start(){this.isRunning||(this.isRunning=!0,this.scheduleNextTick())}stop(){this.timeoutId!==null&&(globalThis.clearTimeout(this.timeoutId),this.timeoutId=null),this.isRunning=!1}setInterval(e){this.intervalMs=e}isActive(){return this.isRunning}scheduleNextTick(){if(!this.isRunning)return;const e=Date.now(),t=this.intervalMs>0?this.intervalMs:Uo,s=t-e%t;this.timeoutId=globalThis.setTimeout(()=>{this.onTick(),this.scheduleNextTick()},s)}}class $w{constructor(e,t=Uo,s){b(this,"storage");b(this,"recurrenceEngine");b(this,"onCompletionHandler");b(this,"emittedDue",new Set);b(this,"emittedMissed",new Set);b(this,"timezoneHandler");b(this,"isChecking",!1);b(this,"lastCheckStartTime",0);b(this,"plugin",null);b(this,"listeners",{"task:due":new Set,"task:overdue":new Set});b(this,"MAX_EMITTED_ENTRIES",1e3);b(this,"EMITTED_RETENTION_DAYS",30);b(this,"EMITTED_SAVE_DEBOUNCE_MS",1500);b(this,"persistTimeoutId",null);b(this,"emittedStateReady",null);b(this,"timer");this.storage=e,this.recurrenceEngine=new qw,this.onCompletionHandler=new Bw(s),this.timezoneHandler=new Uw,this.plugin=s||null,this.timer=new zw(t,()=>{this.checkDueTasks()})}on(e,t){return this.listeners[e].add(t),()=>this.listeners[e].delete(t)}start(){this.ensureEmittedStateLoaded().finally(()=>{this.checkDueTasks(),this.timer.start(),re("Scheduler started")})}stop(){this.timer.stop(),this.persistEmittedState(),re("Scheduler stopped")}runOnce(){this.checkDueTasks()}isActive(e){return e.enabled===!0}checkDueTasks(){if(this.isChecking)if(Date.now()-(this.lastCheckStartTime||0)>3e4)et("Scheduler check timeout detected, forcing reset"),this.isChecking=!1;else return;this.isChecking=!0,this.lastCheckStartTime=Date.now();const e=new Date,t=this.storage.getTasksDueOnOrBefore(e);try{for(const s of t){if(!this.isActive(s))continue;const r=new Date(s.dueAt),a=r<=e;if(a){const l=this.buildOccurrenceKey(s.id,r,"hour");this.emittedDue.has(l)||(this.emitEvent("task:due",{taskId:s.id,dueAt:r,context:"today",task:s}),this.registerEmittedKey("due",l),re(`Task due: ${s.name}`,{taskId:s.id,dueAt:s.dueAt}))}const i=s.lastCompletedAt?new Date(s.lastCompletedAt):null;if(a&&e.getTime()-r.getTime()>=Dv&&(!i||i<r)){const l=this.buildOccurrenceKey(s.id,r,"hour");this.emittedMissed.has(l)||(this.emitEvent("task:overdue",{taskId:s.id,dueAt:r,context:"overdue",task:s}),this.registerEmittedKey("missed",l),et(`Task missed: ${s.name}`,{taskId:s.id,dueAt:s.dueAt}))}}this.cleanupEmittedSets()}finally{this.isChecking=!1}}cleanupEmittedSets(){const e=new Date;e.setDate(e.getDate()-this.EMITTED_RETENTION_DAYS);const t=this.pruneEmittedSet("due",this.emittedDue,e),s=this.pruneEmittedSet("missed",this.emittedMissed,e);this.emittedDue=t.set,this.emittedMissed=s.set,(t.didTrim||s.didTrim)&&this.schedulePersistEmittedState()}pruneEmittedSet(e,t,s){const r=s.getTime(),a=Array.from(t).map(u=>({entry:u,time:this.parseOccurrenceKeyTimestamp(u)}));let i=a.filter(({time:u})=>u===null||u>=r),l=i.length!==a.length;i.length>this.MAX_EMITTED_ENTRIES&&(i=i.sort((u,d)=>(u.time??0)-(d.time??0)).slice(-this.MAX_EMITTED_ENTRIES),l=!0);const c=new Set(i.map(({entry:u})=>u));return l&&re(`Cleaned up emitted${e==="due"?"Due":"Missed"} set: ${t.size} -> ${c.size}`),{set:c,didTrim:l}}parseOccurrenceKeyTimestamp(e){const t=e.indexOf(":");if(t===-1)return null;const s=e.slice(t+1);if(!s)return null;const r=s.length===13?`${s}:00:00.000Z`:s,a=new Date(r);return Number.isNaN(a.getTime())?null:a.getTime()}async markTaskDone(e){const t=this.storage.getTask(e);if(!t)throw new Error(`Task not found: ${e}`);const s=new Date;t.doneAt=s.toISOString(),Fv(t);const r=JSON.parse(JSON.stringify(t));await this.storage.archiveTask(r);const a=t.onCompletion||"keep",i=await this.onCompletionHandler.execute(t,a);if(i.success||Se(`OnCompletion action failed for task "${t.name}"`,{taskId:t.id,action:a,error:i.error}),i.warnings)for(const u of i.warnings)et(u,{taskId:t.id});const l=new Date(t.dueAt),c=this.recurrenceEngine.calculateNext(l,t.frequency,{completionDate:s,whenDone:t.whenDone});t.dueAt=c.toISOString(),t.doneAt=void 0,await this.storage.saveTask(t),re(`Task "${t.name}" completed and rescheduled to ${c.toISOString()}`)}async delayTask(e,t){const s=this.storage.getTask(e);if(!s)throw new Error(`Task not found: ${e}`);this.assertSnoozeAvailable(s);const r=new Date(s.dueAt),a=new Date(r.getTime()+t*60*1e3);s.dueAt=a.toISOString(),s.snoozeCount=(s.snoozeCount||0)+1,await this.storage.saveTask(s),re(`Task "${s.name}" delayed by ${t} minutes to ${a.toISOString()}`)}async delayToTomorrow(e){const t=this.storage.getTask(e);if(!t)throw new Error(`Task not found: ${e}`);this.assertSnoozeAvailable(t);const s=new Date(t.dueAt),r=this.timezoneHandler.tomorrow();r.setHours(s.getHours(),s.getMinutes(),0,0),t.dueAt=r.toISOString(),t.snoozeCount=(t.snoozeCount||0)+1,await this.storage.saveTask(t),re(`Task "${t.name}" delayed to tomorrow: ${r.toISOString()}`)}async skipOccurrence(e){const t=this.storage.getTask(e);if(!t)throw new Error(`Task not found: ${e}`);Ju(t);const s=new Date(t.dueAt),r=this.recurrenceEngine.calculateNext(s,t.frequency);t.dueAt=r.toISOString(),await this.storage.saveTask(t),re(`Task "${t.name}" skipped to ${r.toISOString()}`)}async delayTaskToTomorrow(e){return this.delayToTomorrow(e)}async skipTaskOccurrence(e){return this.skipOccurrence(e)}async recoverMissedTasks(){await this.ensureEmittedStateLoaded();const e=await this.loadLastRunTimestamp(),t=new Date;if(!e){await this.saveLastRunTimestamp(t),re("First run detected, no recovery needed");return}re(`Recovering missed tasks since ${e.toISOString()}`);for(const s of this.storage.getEnabledTasks())try{const r=this.recurrenceEngine.getMissedOccurrences(e,t,s.frequency,new Date(s.createdAt));for(const a of r){const i=this.buildOccurrenceKey(s.id,a,"exact");this.emittedMissed.has(i)||(this.emitEvent("task:overdue",{taskId:s.id,dueAt:a,context:"overdue",task:s}),this.registerEmittedKey("missed",i))}await this.advanceToNextFutureOccurrence(s,t)}catch(r){Se(`Failed to recover task ${s.id}:`,r)}await this.saveLastRunTimestamp(t),this.cleanupEmittedSets(),re("Missed task recovery completed")}async advanceToNextFutureOccurrence(e,t){const s=new Date(e.dueAt);if(s>=t)return;let r=s,a=0;for(;r<t&&a<La;)r=this.recurrenceEngine.calculateNext(r,e.frequency),a++;r>s&&(e.dueAt=r.toISOString(),await this.storage.saveTask(e),re(`Advanced task "${e.name}" to ${r.toISOString()}`))}async loadLastRunTimestamp(){if(!this.plugin)return null;try{const e=await this.plugin.loadData(Nl);if(e&&e.timestamp)return new Date(e.timestamp)}catch(e){Se("Failed to load last run timestamp:",e)}return null}async saveLastRunTimestamp(e){if(this.plugin)try{await this.plugin.saveData(Nl,{timestamp:e.toISOString()})}catch(t){Se("Failed to save last run timestamp:",t)}}getRecurrenceEngine(){return this.recurrenceEngine}getTimezoneHandler(){return this.timezoneHandler}emitEvent(e,t){const s=this.listeners[e];for(const r of s)try{const a=r(t);a instanceof Promise&&a.catch(i=>{Se(`Scheduler listener error for ${e}:`,i)})}catch(a){Se(`Scheduler listener error for ${e}:`,a)}}assertSnoozeAvailable(e){const t=e.maxSnoozes??Ev,s=e.snoozeCount??0;if(t<=0)throw new Error("Snoozing is disabled for this task.");if(s>=t)throw new Error(`Snooze limit reached (${t}).`)}registerEmittedKey(e,t){e==="due"?this.emittedDue.add(t):this.emittedMissed.add(t),this.schedulePersistEmittedState()}ensureEmittedStateLoaded(){return this.emittedStateReady||(this.emittedStateReady=this.restoreEmittedState()),this.emittedStateReady}async restoreEmittedState(){if(this.plugin)try{const e=await this.plugin.loadData(Cl),t=Array.isArray(e==null?void 0:e.due)?e.due.filter(r=>typeof r=="string"):[],s=Array.isArray(e==null?void 0:e.missed)?e.missed.filter(r=>typeof r=="string"):[];this.emittedDue=new Set(t.slice(-this.MAX_EMITTED_ENTRIES)),this.emittedMissed=new Set(s.slice(-this.MAX_EMITTED_ENTRIES)),re("Restored scheduler emitted state",{due:this.emittedDue.size,missed:this.emittedMissed.size})}catch(e){Se("Failed to restore scheduler emitted state:",e)}}schedulePersistEmittedState(){this.plugin&&this.persistTimeoutId===null&&(this.persistTimeoutId=globalThis.setTimeout(()=>{this.persistTimeoutId=null,this.persistEmittedState()},this.EMITTED_SAVE_DEBOUNCE_MS))}async persistEmittedState(){if(this.plugin)try{await this.plugin.saveData(Cl,{due:Array.from(this.emittedDue),missed:Array.from(this.emittedMissed)})}catch(e){Se("Failed to persist scheduler emitted state:",e)}}buildOccurrenceKey(e,t,s){return s==="exact"?`${e}:${t.toISOString()}`:`${e}:${t.toISOString().slice(0,13)}`}}const Yw=7,jw=2e3;class Ww{constructor(e,t){b(this,"plugin");b(this,"storageKey");b(this,"notifications",new Map);b(this,"escalations",new Map);b(this,"lastCleanup",new Date);b(this,"isDirty",!1);this.plugin=e,this.storageKey=t}async load(){try{const e=await this.plugin.loadData(this.storageKey);if(e){const t=e;if(Array.isArray(t.notifications))for(const s of t.notifications)this.notifications.set(s.taskKey,s);if(Array.isArray(t.escalations))for(const s of t.escalations)this.escalations.set(s.taskId,s);t.lastCleanup&&(this.lastCleanup=new Date(t.lastCleanup)),re(`Loaded notification state: ${this.notifications.size} notifications, ${this.escalations.size} escalations`),this.cleanupOldEntries()}}catch(e){Se("Failed to load notification state",e),this.notifications.clear(),this.escalations.clear()}}async save(){if(this.isDirty)try{const e={notifications:Array.from(this.notifications.values()),escalations:Array.from(this.escalations.values()),lastCleanup:this.lastCleanup.toISOString()};await this.plugin.saveData(this.storageKey,e),this.isDirty=!1,td("Saved notification state")}catch(e){Se("Failed to save notification state",e)}}async forceSave(){this.isDirty=!0,await this.save()}hasNotified(e){const t=this.notifications.get(e);return t!==void 0&&t.type==="due"}markNotified(e){this.notifications.set(e,{taskKey:e,notifiedAt:new Date().toISOString(),type:"due"}),this.isDirty=!0,this.notifications.size>jw&&Array.from(this.notifications.keys()).slice(0,100).forEach(s=>this.notifications.delete(s))}hasMissed(e){const t=this.notifications.get(e);return t!==void 0&&t.type==="missed"}markMissed(e){this.notifications.set(e,{taskKey:e,notifiedAt:new Date().toISOString(),type:"missed"}),this.isDirty=!0}getEscalationLevel(e){const t=this.escalations.get(e);return(t==null?void 0:t.level)||0}incrementEscalation(e){const s=this.getEscalationLevel(e)+1;return this.escalations.set(e,{taskId:e,level:s,lastEscalatedAt:new Date().toISOString()}),this.isDirty=!0,s}resetEscalation(e){this.escalations.delete(e),this.isDirty=!0}generateTaskKey(e,t){const s=new Date(t);return`${e}:${s.toISOString().slice(0,13)}`}cleanupOldEntries(){const e=new Date;if((e.getTime()-this.lastCleanup.getTime())/(1e3*60*60*24)<1)return;const s=new Date(e.getTime()-Yw*24*60*60*1e3);let r=0;for(const[a,i]of this.notifications.entries())new Date(i.notifiedAt)<s&&(this.notifications.delete(a),r++);r>0&&(re(`Cleaned up ${r} old notification records`),this.isDirty=!0),this.lastCleanup=e}}function Hw(n){return{id:n.id,name:n.name,dueAt:n.dueAt,frequency:n.frequency,linkedBlockId:n.linkedBlockId,linkedBlockContent:n.linkedBlockContent,priority:n.priority,tags:n.tags,notificationChannels:n.notificationChannels,completionCount:n.completionCount,missCount:n.missCount,currentStreak:n.currentStreak,bestStreak:n.bestStreak}}const Gw=30*1e3,Kw=30*60*1e3,Fn=500;class Vw{constructor(e,t={}){b(this,"plugin");b(this,"config");b(this,"queue",[]);b(this,"dedupeKeys",new Set);b(this,"flushIntervalId",null);b(this,"fetcher");b(this,"notificationState");b(this,"schedulerUnsubscribe",[]);this.plugin=e,this.fetcher=t.fetcher??fetch,this.config={...Zi},this.notificationState=t.notificationState??new Ww(this.plugin,Tv)}async init(){await this.notificationState.load(),await this.loadConfig(),await this.loadQueue(),await this.flushQueueOnStartup(),this.startQueueWorker()}async flushQueueOnStartup(){this.queue.length>0&&(console.log(`Found ${this.queue.length} pending events from previous session`),await this.flushQueue())}async loadConfig(){try{const e=await this.plugin.loadData(El);e&&(this.config={...Zi,...e})}catch(e){console.error("Failed to load event config:",e)}}async saveConfig(e){this.config=e,await this.plugin.saveData(El,e)}async loadQueue(){try{const e=await this.plugin.loadData(Al);if(e){this.queue=Array.isArray(e.queue)?e.queue:[];const t=Array.isArray(e.dedupeKeys)?e.dedupeKeys:[];if(this.dedupeKeys=new Set(t),this.queue.length>Fn){const s=this.queue.length-Fn;this.queue=this.queue.slice(-Fn),console.warn(`Event queue trimmed to ${Fn} entries (dropped ${s}).`)}}}catch(e){console.error("Failed to load event queue:",e),this.queue=[],this.dedupeKeys=new Set}}async persistQueue(){const e=Array.from(this.dedupeKeys).slice(-Si);await this.plugin.saveData(Al,{queue:this.queue,dedupeKeys:e})}startQueueWorker(){this.flushIntervalId===null&&(this.flushQueue(),this.flushIntervalId=globalThis.setInterval(()=>{this.flushQueue()},xv))}stopQueueWorker(){this.flushIntervalId!==null&&(globalThis.clearInterval(this.flushIntervalId),this.flushIntervalId=null)}async shutdown(){this.stopQueueWorker(),await this.notificationState.forceSave()}bindScheduler(e){this.unbindScheduler(),this.schedulerUnsubscribe=[e.on("task:due",t=>{this.handleTaskDue(t)}),e.on("task:overdue",t=>{this.handleTaskOverdue(t)})]}unbindScheduler(){this.schedulerUnsubscribe.forEach(e=>e()),this.schedulerUnsubscribe=[]}async handleTaskCompleted(e){await this.emitTaskEvent("task.completed",e,0),this.notificationState.resetEscalation(e.id),await this.notificationState.save()}async handleTaskSnoozed(e){await this.emitTaskEvent("task.snoozed",e,0)}async handleTaskDue(e){const t=this.notificationState.generateTaskKey(e.taskId,e.dueAt.toISOString());if(this.notificationState.hasNotified(t))return;const s=this.notificationState.getEscalationLevel(e.taskId);await this.emitTaskEvent("task.due",e.task,s),this.notificationState.markNotified(t),this.notificationState.save()}async handleTaskOverdue(e){const t=this.notificationState.generateTaskKey(e.taskId,e.dueAt.toISOString());if(this.notificationState.hasMissed(t))return;const s=this.notificationState.getEscalationLevel(e.taskId);await this.emitTaskEvent("task.missed",e.task,s),this.notificationState.markMissed(t),this.notificationState.incrementEscalation(e.taskId),this.notificationState.save()}async emitTaskEvent(e,t,s=0){if(!this.config.n8n.enabled||!this.config.n8n.webhookUrl)return;const r=this.buildDedupeKey(e,t);if(this.isDuplicate(r))return;const a=this.buildPayload(e,t,r,1,s);await this.sendPayload(a)?(this.markDelivered(r),await this.persistQueue()):this.enqueue(a)}async testConnection(){if(!this.config.n8n.enabled||!this.config.n8n.webhookUrl)return{success:!1,message:"n8n webhook not configured"};try{const e=`test.ping:${new Date().toISOString()}`,t={event:"test.ping",source:Il,version:Ml,occurredAt:new Date().toISOString(),delivery:{dedupeKey:e,attempt:1}},s=await this.fetcher(this.config.n8n.webhookUrl,{method:"POST",headers:await this.buildHeaders(t),body:JSON.stringify(t)});return s.ok?{success:!0,message:"Connection successful"}:{success:!1,message:`HTTP ${s.status}: ${s.statusText}`}}catch(e){return{success:!1,message:`Connection failed: ${e.message}`}}}async flushQueue(){if(!this.config.n8n.enabled||!this.config.n8n.webhookUrl)return;const e=Date.now();let t=!1;const s=[];for(const r of this.queue){if(new Date(r.nextAttemptAt).getTime()>e){s.push(r);continue}const a={...r.payload,delivery:{...r.payload.delivery,attempt:r.attempt}};if(await this.sendPayload(a))this.markDelivered(a.delivery.dedupeKey),t=!0;else{const l=r.attempt+1,c=this.getRetryDelay(l);s.push({...r,attempt:l,nextAttemptAt:new Date(e+c).toISOString()}),t=!0}}t&&(this.queue=s,await this.persistQueue())}getConfig(){return{...this.config}}buildPayload(e,t,s,r,a=0){const i=new Date,l=new Date(t.dueAt),c=i.getTime()-l.getTime();return{event:e,source:Il,version:Ml,occurredAt:i.toISOString(),task:Hw(t),context:{timezone:t.timezone||Intl.DateTimeFormat().resolvedOptions().timeZone,delayMs:c>0?c:void 0,previousDueAt:t.lastCompletedAt,nextDueAt:void 0},routing:{escalationLevel:a,channels:t.notificationChannels||[]},delivery:{dedupeKey:s,attempt:r}}}buildDedupeKey(e,t){const s=new Date(t.dueAt).toISOString().slice(0,16);return`${e}:${t.id}:${s}`}isDuplicate(e){return this.dedupeKeys.has(e)?!0:this.queue.some(t=>t.payload.delivery.dedupeKey===e)}markDelivered(e){if(this.dedupeKeys.add(e),this.dedupeKeys.size>Si){const t=Array.from(this.dedupeKeys).slice(-Si);this.dedupeKeys=new Set(t)}}enqueue(e){const t=Date.now();if(this.queue.length>=Fn){const s=this.queue.length-Fn+1;this.queue.splice(0,s),console.warn(`Event queue capped at ${Fn}. Dropped ${s} oldest entr${s===1?"y":"ies"}.`)}this.queue.push({id:`${e.delivery.dedupeKey}:${e.delivery.attempt}`,payload:e,attempt:e.delivery.attempt,nextAttemptAt:new Date(t+this.getRetryDelay(e.delivery.attempt)).toISOString()}),this.persistQueue()}getRetryDelay(e){const t=Gw*Math.pow(2,e-1);return Math.min(t,Kw)}async generateSignature(e,t){try{if(typeof crypto<"u"&&crypto.subtle){const s=new TextEncoder,r=s.encode(t),a=s.encode(e),i=await crypto.subtle.importKey("raw",r,{name:"HMAC",hash:"SHA-256"},!1,["sign"]),l=await crypto.subtle.sign("HMAC",i,a);return Array.from(new Uint8Array(l)).map(u=>u.toString(16).padStart(2,"0")).join("")}return console.warn("Web Crypto API not available - signature generation disabled"),""}catch(s){return console.error("Failed to generate signature:",s),""}}async buildHeaders(e){const t=JSON.stringify(e),s=new Date().toISOString();let r="";this.config.n8n.sharedSecret&&(r=await this.generateSignature(t+s,this.config.n8n.sharedSecret));const a={"Content-Type":"application/json","X-Shehab-Event":e.event,"X-Shehab-Timestamp":s};return r&&(a["X-Shehab-Signature"]=r),this.config.n8n.sharedSecret&&(a["X-Shehab-Note-Secret"]=this.config.n8n.sharedSecret),a}async sendPayload(e,t=!1){try{const s=JSON.stringify(e),r=await this.buildHeaders(e),a=await this.fetcher(this.config.n8n.webhookUrl,{method:"POST",headers:r,body:s});if(!a.ok)return console.error("n8n webhook failed:",a.statusText),!1;if(t){const i=await a.json().catch(()=>null);return!!(i&&i.ok)}return!0}catch(s){return console.error("Failed to send n8n event:",s),!1}}}const Et={dates:{autoAddCreated:!1,autoAddDone:!0,autoAddCancelled:!0},recurrence:{newTaskPosition:"below",removeScheduledOnRecurrence:!1,preserveOriginalTime:!0},dependencies:{warnOnCycles:!0,autoValidate:!0},filenameDate:{enabled:!1,patterns:["YYYY-MM-DD","YYYYMMDD"],folders:["daily/","journal/"],targetField:"scheduled"},globalFilter:ta,globalQuery:gd,urgency:Bo,smartRecurrence:{enabled:!0,autoAdjust:!1,minCompletionsForLearning:10,confidenceThreshold:.7},naturalLanguage:{enabled:!0,showConfidenceScore:!0,provideExamples:!0},crossNoteDependencies:{enabled:!0,checkInterval:5,notifyWhenMet:!0},smartSuggestions:{enabled:!0,minConfidence:.65,showDismissed:!1,autoApplyHighConfidence:!1},predictiveScheduling:{enabled:!0,showHeatmap:!0,minDataPoints:5,workingHours:{start:6,end:22},preferredDays:[1,2,3,4,5]},keyboardNavigation:{enabled:!1,useVimKeybindings:!0,customKeybindings:{},showModeIndicator:!0,showQuickHints:!0,enableCommandPalette:!0},inlineTasks:{enableInlineCreation:!0,autoCreateOnEnter:!1,autoCreateOnBlur:!1,normalizeOnSave:!0,strictParsing:!1,showInlineHints:!0,highlightManagedTasks:!0}};function Oc(n){var e,t,s,r;if(n.globalFilter&&!n.globalFilter.profiles){const a=n.globalFilter,i={id:"migrated-default",name:"Migrated Settings",description:"Automatically migrated from previous version",includePaths:[],excludePaths:[...a.excludeFolders||[],...a.excludeFilePatterns||[]],includeTags:[],excludeTags:a.excludeTags||[],includeRegex:void 0,excludeRegex:void 0,regexTargets:["taskText"],excludeStatusTypes:a.excludeStatusTypes||[]};n.globalFilter={enabled:a.enabled??!1,mode:a.mode??"all",activeProfileId:"migrated-default",profiles:[i]}}return{dates:{...Et.dates,...n.dates},recurrence:{...Et.recurrence,...n.recurrence},dependencies:{...Et.dependencies,...n.dependencies},filenameDate:{...Et.filenameDate,...n.filenameDate},globalFilter:{...Et.globalFilter,...n.globalFilter,profiles:((e=n.globalFilter)==null?void 0:e.profiles)??Et.globalFilter.profiles},globalQuery:{...Et.globalQuery,...n.globalQuery},urgency:{...Et.urgency,...n.urgency},smartRecurrence:{...Et.smartRecurrence,...n.smartRecurrence},naturalLanguage:{...Et.naturalLanguage,...n.naturalLanguage},crossNoteDependencies:{...Et.crossNoteDependencies,...n.crossNoteDependencies},smartSuggestions:{...Et.smartSuggestions,...n.smartSuggestions},predictiveScheduling:{...Et.predictiveScheduling,...n.predictiveScheduling,preferredDays:((t=n.predictiveScheduling)==null?void 0:t.preferredDays)??Et.predictiveScheduling.preferredDays,workingHours:((s=n.predictiveScheduling)==null?void 0:s.workingHours)??Et.predictiveScheduling.workingHours},keyboardNavigation:{...Et.keyboardNavigation,...n.keyboardNavigation,customKeybindings:((r=n.keyboardNavigation)==null?void 0:r.customKeybindings)??Et.keyboardNavigation.customKeybindings},inlineTasks:{...Et.inlineTasks,...n.inlineTasks}}}const Pi="plugin-settings";class Qw{constructor(e){b(this,"plugin");b(this,"settings");this.plugin=e,this.settings=Et}async load(){try{const e=await this.plugin.loadData(Pi);e&&typeof e=="object"&&(this.settings=Oc(e))}catch(e){console.error("Failed to load plugin settings:",e)}}async save(e){this.settings=e,await this.plugin.saveData(Pi,e),Ye.emit("task:refresh",void 0)}get(){return this.settings}async update(e){this.settings=Oc(e),await this.plugin.saveData(Pi,this.settings),Ye.emit("task:refresh",void 0)}}const yn=class yn{constructor(e){b(this,"plugin");b(this,"isInitialized",!1);b(this,"storage");b(this,"repository");b(this,"scheduler");b(this,"eventService");b(this,"settingsService");this.plugin=e}static getInstance(e){if(!yn.instance){if(!e)return null;yn.instance=new yn(e)}return yn.instance}async initialize(){if(this.isInitialized){et("TaskManager already initialized");return}re("Initializing TaskManager"),this.settingsService=new Qw(this.plugin),await this.settingsService.load();const e=this.settingsService.get();fs.getInstance().initialize(e.globalFilter),aa.getInstance().initialize(e.globalQuery),this.storage=new Lw(this.plugin),await this.storage.init(),this.repository=new Fw(this.storage),this.eventService=new Vw(this.plugin),await this.eventService.init(),this.scheduler=new $w(this.storage,Uo,this.plugin),this.eventService.bindScheduler(this.scheduler),this.isInitialized=!0,re("TaskManager initialized successfully")}async start(e,t){if(!this.isInitialized)throw new Error("TaskManager must be initialized before starting");e&&this.scheduler.on("task:due",({task:s})=>e(s)),t&&this.scheduler.on("task:overdue",({task:s})=>t(s)),this.scheduler.start(),await this.scheduler.recoverMissedTasks(),re("TaskManager started")}async destroy(){re("Destroying TaskManager"),this.scheduler&&this.scheduler.stop(),this.eventService&&await this.eventService.shutdown(),this.storage&&await this.storage.flush(),this.isInitialized=!1,yn.instance=null,re("TaskManager destroyed")}getStorage(){return this.ensureInitialized(),this.storage}getRepository(){return this.ensureInitialized(),this.repository}getScheduler(){return this.ensureInitialized(),this.scheduler}getEventService(){return this.ensureInitialized(),this.eventService}getSettingsService(){return this.ensureInitialized(),this.settingsService}isReady(){return this.isInitialized}ensureInitialized(){if(!this.isInitialized)throw new Error("TaskManager is not initialized. Call initialize() first.")}};b(yn,"instance",null);let Za=yn;function Xw(n){let t=`- [${n.status==="done"?"x":" "}] ${n.name}`;if(n.dueAt){const s=new Date(n.dueAt);t+=`  ${s.toISOString().split("T")[0]}`}return n.frequency&&(t+=`  every ${n.frequency.interval} ${n.frequency.type}${n.frequency.interval>1?"s":""}`),t}class Zw{constructor(e,t,s,r){this.storage=e,this.recurrenceEngine=t,this.settings=s,this.siyuanApi=r}async onComplete(e,t){try{const s=[],r=this.addCompletionDate(e,t);let a;return e.frequency&&(a=await this.generateNextInstance(r,t),a&&(await this.placeNextInstance(r,a)||s.push("Could not place next instance in document (API unavailable)"),await this.storage.saveTask(a))),e.onCompletion==="delete"?await this.hasNestedItems(e.linkedBlockId)?(et("Cannot delete task with nested items",{taskId:e.id,blockId:e.linkedBlockId}),await this.storage.saveTask(r),s.push("Task has nested items - kept instead of deleted")):await this.deleteTask(e):await this.storage.saveTask(r),{success:!0,nextTask:a,warnings:s.length>0?s:void 0}}catch(s){return Se("Failed to handle task completion",{taskId:e.id,error:s}),{success:!1,error:s instanceof Error?s.message:"Unknown error occurred"}}}addCompletionDate(e,t){const s={...e},r=t.toISOString();return e.status==="done"&&this.settings.dates.autoAddDone?(s.doneAt=r,s.cancelledAt=void 0):e.status==="cancelled"&&this.settings.dates.autoAddCancelled&&(s.cancelledAt=r,s.doneAt=void 0),s}async generateNextInstance(e,t){if(e.frequency)try{const s=new Date(e.dueAt),r=this.recurrenceEngine.calculateNext(s,e.frequency,{completionDate:t,whenDone:e.frequency.whenDone||e.whenDone}),a=Zu(e,{dueAt:r.toISOString(),status:"todo",doneAt:void 0,cancelledAt:void 0,linkedBlockId:void 0,linkedBlockContent:void 0});return this.settings.recurrence.removeScheduledOnRecurrence&&(a.scheduledAt=void 0),a}catch(s){Se("Failed to generate next recurrence instance",{taskId:e.id,frequency:e.frequency,error:s});return}}async placeNextInstance(e,t){if(!e.linkedBlockId)return et("Original task has no linkedBlockId, cannot place next instance"),!1;if(!this.siyuanApi)return et("SiYuan API not available, cannot place next instance"),!1;const s=this.settings.recurrence.newTaskPosition,r=Xw(t);try{let a;return s==="above"&&this.siyuanApi.insertBlockAbove?a=await this.siyuanApi.insertBlockAbove(e.linkedBlockId,r):s==="below"&&this.siyuanApi.insertBlockBelow&&(a=await this.siyuanApi.insertBlockBelow(e.linkedBlockId,r)),a!=null&&a.id?(t.linkedBlockId=a.id,t.linkedBlockContent=r,!0):!1}catch(a){return Se("Failed to place next instance in document",{taskId:e.id,placement:s,error:a}),!1}}async hasNestedItems(e){var t;if(!e||!((t=this.siyuanApi)!=null&&t.getChildBlocks))return!1;try{const s=await this.siyuanApi.getChildBlocks({id:e});return s&&s.length>0}catch(s){return Se("Failed to check for nested items",{blockId:e,error:s}),!1}}async deleteTask(e){var t;if(await this.storage.deleteTask(e.id),e.linkedBlockId&&((t=this.siyuanApi)!=null&&t.deleteBlock))try{await this.siyuanApi.deleteBlock({id:e.linkedBlockId}),re("Task deleted from document and storage",{taskId:e.id,blockId:e.linkedBlockId})}catch(s){Se("Failed to delete task from document",{taskId:e.id,blockId:e.linkedBlockId,error:s})}else re("Task deleted from storage only (no linked block)",{taskId:e.id})}}class Jw{constructor(e,t,s,r){b(this,"completionHandler");this.repository=e,this.recurrenceEngine=t,this.getSettings=s,this.siyuanApi=r,t&&s&&(this.completionHandler=new Zw(e,t,s(),r))}get settings(){var e;return(e=this.getSettings)==null?void 0:e.call(this)}async toggleStatus(e){var t,s;try{const r=this.repository.getTask(e);if(!r){W.error("Task not found");return}const a=Hs.getInstance(),i=r.statusSymbol||" ",l=a.getNextSymbol(i),c={...r,statusSymbol:l},u=a.getStatus(l);if(u.type==="DONE"){if(c.status="done",r.frequency&&this.completionHandler){const d=await this.completionHandler.onComplete(c,new Date);d.success?(d.nextTask?(re("Next recurrence created",{taskId:c.id,nextTaskId:d.nextTask.id,nextDue:d.nextTask.dueAt}),W.success("Task completed - next occurrence scheduled")):W.success(`Task status updated to ${u.name}`),d.warnings&&d.warnings.forEach(f=>W.warning(f))):W.error(`Failed to complete task: ${d.error}`)}else(t=this.settings)!=null&&t.dates.autoAddDone&&!c.doneAt&&(c.doneAt=new Date().toISOString()),await this.repository.saveTask(c),W.success(`Task status updated to ${u.name}`);Ye.emit("task:updated",{taskId:e})}else u.type==="CANCELLED"?(c.status="cancelled",(s=this.settings)!=null&&s.dates.autoAddCancelled&&!c.cancelledAt&&(c.cancelledAt=new Date().toISOString()),await this.repository.saveTask(c),Ye.emit("task:updated",{taskId:e}),W.success(`Task status updated to ${u.name}`)):u.type==="TODO"&&(c.status="todo",await this.repository.saveTask(c),Ye.emit("task:updated",{taskId:e}),W.success(`Task status updated to ${u.name}`))}catch(r){Se("Failed to toggle task status",r),W.error("Failed to toggle status")}}async completeTask(e){var t;try{const s=this.repository.getTask(e);if(!s){W.error("Task not found");return}const r={...s,status:"done"};if(s.frequency&&this.completionHandler){const a=await this.completionHandler.onComplete(r,new Date);a.success?(a.nextTask?(re("Next recurrence created",{taskId:r.id,nextTaskId:a.nextTask.id,nextDue:a.nextTask.dueAt}),W.success(`Task "${s.name}" completed - next occurrence scheduled`)):W.success(`Task "${s.name}" completed`),a.warnings&&a.warnings.forEach(i=>W.warning(i))):W.error(`Failed to complete task: ${a.error}`)}else(t=this.settings)!=null&&t.dates.autoAddDone&&!r.doneAt&&(r.doneAt=new Date().toISOString()),await this.repository.saveTask(r),W.success(`Task "${s.name}" completed`);Ye.emit("task:complete",{taskId:e})}catch(s){Se("Failed to complete task",s),W.error("Failed to complete task")}}async deleteTask(e){try{const t=this.repository.getTask(e);if(!t){W.error("Task not found");return}const r=this.repository.getAllTasks().filter(a=>{var i,l;return((i=a.blockedBy)==null?void 0:i.includes(e))||((l=a.dependsOn)==null?void 0:l.includes(e))});if(r.length>0&&!confirm(`This task is blocking ${r.length} other task(s). Are you sure you want to delete it?`))return;await this.repository.deleteTask(e),Ye.emit("task:deleted",{taskId:e}),W.success(`Task "${t.name}" deleted`)}catch(t){Se("Failed to delete task",t),W.error("Failed to delete task")}}async rescheduleToToday(e){try{const t=this.repository.getTask(e);if(!t){W.error("Task not found");return}const s=new Date;s.setHours(12,0,0,0);const r={...t,scheduledAt:s.toISOString(),updatedAt:new Date().toISOString()};await this.repository.saveTask(r),Ye.emit("task:updated",{taskId:e}),W.success("Task rescheduled to today")}catch(t){Se("Failed to reschedule task",t),W.error("Failed to reschedule task")}}async deferTask(e,t){try{const s=this.repository.getTask(e);if(!s){W.error("Task not found");return}const r={...s,updatedAt:new Date().toISOString()};if(s.dueAt){const a=new Date(s.dueAt);a.setDate(a.getDate()+t),r.dueAt=a.toISOString()}if(s.scheduledAt){const a=new Date(s.scheduledAt);a.setDate(a.getDate()+t),r.scheduledAt=a.toISOString()}await this.repository.saveTask(r),Ye.emit("task:updated",{taskId:e}),W.success(`Task deferred by ${t} day${t!==1?"s":""}`)}catch(s){Se("Failed to defer task",s),W.error("Failed to defer task")}}}class ek{constructor(e,t,s){b(this,"plugin");b(this,"storageKey");b(this,"settings");b(this,"defaults");this.plugin=e,this.storageKey=t,this.defaults={...s},this.settings={...s}}async load(){try{const e=await this.plugin.loadData(this.storageKey);e&&(this.settings={...this.defaults,...e})}catch(e){console.error(`Failed to load settings from ${this.storageKey}:`,e),this.settings={...this.defaults}}return this.settings}async save(e){e&&(this.settings=e);try{await this.plugin.saveData(this.storageKey,this.settings)}catch(t){throw console.error(`Failed to save settings to ${this.storageKey}:`,t),t}}get(){return{...this.settings}}async set(e,t){this.settings[e]=t,await this.save()}async reset(){this.settings={...this.defaults},await this.save()}has(e){return e in this.settings}getValue(e){return this.settings[e]}}const yr=[{id:"quickAddTask",langKey:"quickAddTask",label:"Quick add recurring task",description:"Open the quick add dialog with focus on the task title.",defaultHotkey:"Ctrl+Shift+T",context:"Global / Editor"},{id:"markTaskDone",langKey:"markTaskDone",label:"Mark task as done",description:"Complete the focused task and trigger recurrence.",defaultHotkey:"Ctrl+Enter",context:"Task focus / Task block"},{id:"postponeTask",langKey:"postponeTask",label:"Postpone task",description:"Open the snooze selector for the focused task.",defaultHotkey:"Ctrl+Shift+P",context:"Task focus"},{id:"openRecurringTasksDock",langKey:"openRecurringTasksDock",label:"Open recurring tasks dock",description:"Focus the recurring tasks dashboard.",defaultHotkey:"Ctrl+Shift+O",context:"Global"},{id:"createRecurringTask",langKey:"createRecurringTask",label:"Create recurring task from selection",description:"Create a recurring task based on the current editor block.",defaultHotkey:"Ctrl+Shift+R",context:"Editor"},{id:"quickCompleteNextTask",langKey:"quickCompleteNextTask",label:"Quick complete next task",description:"Marks the most overdue task as complete.",defaultHotkey:"Ctrl+Shift+D",context:"Global"},{id:"toggleTaskStatus",langKey:"toggleTaskStatus",label:"Toggle task status",description:"Cycle the status of the focused task.",defaultHotkey:"Ctrl+Shift+X",context:"Task focus"},{id:"openTaskEditor",langKey:"openTaskEditor",label:"Open task editor",description:"Open the full task editor modal.",defaultHotkey:"Ctrl+Shift+E",context:"Global"},{id:"createTaskFromBlock",langKey:"createTaskFromBlock",label:"Create or Edit Task from Block",description:"Parse current block as inline task and open editor with pre-populated data.",defaultHotkey:"Ctrl+Shift+I",context:"Editor / Block"}],Li=yr.reduce((n,e)=>(n[e.id]=e.defaultHotkey,n),{});function po(n,e){Ye.emit("task:snooze",{taskId:n,minutes:e}),window.dispatchEvent(new CustomEvent("task-snooze",{detail:{taskId:n,minutes:e}})),re(`Snoozing task ${n} for ${e} minutes`)}function tk(n){const e=new Date,t=new Date(e);t.setDate(t.getDate()+1);const s=to(t),r=Math.max(0,Math.floor((s.getTime()-e.getTime())/(60*1e3)));Ye.emit("task:snooze",{taskId:n,minutes:r}),window.dispatchEvent(new CustomEvent("task-snooze",{detail:{taskId:n,minutes:r}})),re(`Snoozing task ${n} to tomorrow`)}function sk(n){n.eventBus.on("click-blockicon",({detail:e})=>{var i,l,c;const t=e.blockElements;if(!t||t.length===0)return;const s=t[0],r=s==null?void 0:s.getAttribute("data-node-id");if(!r)return;const a=(s==null?void 0:s.textContent)||"";e.menu.addItem({icon:"iconCalendar",label:((i=n.i18n)==null?void 0:i.createRecurringTask)||"Create Recurring Task",click:()=>{Ye.emit("task:create",{source:"block-menu",linkedBlockId:r,linkedBlockContent:a,suggestedName:go(a),suggestedTime:mo(a)}),window.dispatchEvent(new CustomEvent("recurring-task-create",{detail:{source:"block-menu",linkedBlockId:r,linkedBlockContent:a,suggestedName:go(a),suggestedTime:mo(a)}}))}});try{const u=Za.getInstance();if(u&&u.isReady()){const f=u.getRepository().getTaskByBlockId(r);if(f){e.menu.addSeparator(),e.menu.addItem({icon:"iconCheck",label:((l=n.i18n)==null?void 0:l.completeTask)||"Complete Task",click:()=>{Ye.emit("task:complete",{taskId:f.id}),window.dispatchEvent(new CustomEvent("recurring-task-complete",{detail:{taskId:f.id}}))}});const p=[{label:"15 minutes",click:()=>po(f.id,15)},{label:"1 hour",click:()=>po(f.id,60)},{label:"Tomorrow",click:()=>tk(f.id)}];e.menu.addItem({icon:"iconClock",label:((c=n.i18n)==null?void 0:c.snoozeTask)||"Snooze Task",submenu:p})}}}catch{td("TaskManager not available for quick actions")}}),re("Registered block context menu")}function go(n){const e=n.split(`
`)[0].trim();return e.length>50?e.substring(0,50)+"...":e}function mo(n){var s;const e=/\b(\d{1,2}):(\d{2})\s*(AM|PM|am|pm)?\b/,t=n.match(e);if(t){let r=parseInt(t[1],10);const a=t[2],i=(s=t[3])==null?void 0:s.toUpperCase();return i==="PM"&&r<12?r+=12:i==="AM"&&r===12&&(r=0),`${r.toString().padStart(2,"0")}:${a}`}return null}const nk="recurring-task-shortcuts",rk=350;class ak{constructor(e,t,s,r,a){b(this,"settingsStore");b(this,"settings",{...Li});b(this,"taskCommands");b(this,"cooldownTimers",new Map);this.plugin=e,this.repository=t,this.handlers=a,this.settingsStore=new ek(e,nk,Li),this.taskCommands=new Jw(t,s,r,void 0)}async initialize(){this.settings=await this.settingsStore.load()}registerShortcuts(){yr.forEach(e=>{const t=this.settings[e.id]||e.defaultHotkey;this.plugin.addCommand({langKey:e.langKey,hotkey:t,callback:()=>{this.handleShortcut(e.id)}})}),re("Registered shortcut commands",{shortcuts:yr.map(e=>({id:e.id,hotkey:this.settings[e.id]}))})}getShortcutDisplay(){return yr.map(e=>({id:e.id,label:e.label,description:e.description,context:e.context,currentHotkey:this.settings[e.id]||"",defaultHotkey:e.defaultHotkey}))}async updateShortcut(e,t){const s=t.trim(),r=this.findDuplicateHotkey(e,s);return r?{success:!1,message:`Hotkey already assigned to "${r.label}".`}:(this.settings={...this.settings,[e]:s},await this.settingsStore.save(this.settings),this.registerShortcuts(),{success:!0})}async resetShortcut(e){const t=this.getDefinition(e);t&&(this.settings={...this.settings,[e]:t.defaultHotkey},await this.settingsStore.save(this.settings),this.registerShortcuts())}async resetAllShortcuts(){this.settings={...Li},await this.settingsStore.save(this.settings),this.registerShortcuts()}destroy(){this.cooldownTimers.forEach(e=>globalThis.clearTimeout(e)),this.cooldownTimers.clear()}async handleShortcut(e){if(!this.shouldIgnoreShortcut(e))switch(e){case"quickAddTask":this.guardCooldown(e,rk,()=>{this.handlers.createTask(this.buildCreatePayload("shortcut"))});break;case"createRecurringTask":this.handlers.createTask(this.buildCreatePayload("shortcut"));break;case"openRecurringTasksDock":this.handlers.openDock();break;case"markTaskDone":{const t=this.resolveTaskId();if(!t)return;await this.handlers.completeTask(t);break}case"postponeTask":{const t=this.resolveTaskId();if(!t)return;this.handlers.postponeTask(t);break}case"quickCompleteNextTask":await this.quickCompleteNextTask();break;case"toggleTaskStatus":{const t=this.resolveTaskId();if(!t)return;await this.taskCommands.toggleStatus(t);break}case"openTaskEditor":this.handlers.openTaskEditor();break;case"createTaskFromBlock":await this.handlers.createTaskFromBlock();break}}guardCooldown(e,t,s){if(this.cooldownTimers.has(e))return;s();const r=globalThis.setTimeout(()=>{this.cooldownTimers.delete(e)},t);this.cooldownTimers.set(e,r)}shouldIgnoreShortcut(e){const t=document.activeElement;if(!t)return!1;const s=t.tagName.toLowerCase();return["input","textarea","select"].includes(s)?!0:t.isContentEditable?!this.isEditorAllowedShortcut(e):!1}isEditorAllowedShortcut(e){return e==="quickAddTask"||e==="createRecurringTask"}resolveTaskId(){const e=this.getFocusedTaskId();if(e)return e;const t=this.getSelectedBlockContext();if(!t)return null;const s=this.repository.getTaskByBlockId(t.blockId);return(s==null?void 0:s.id)??null}getFocusedTaskId(){const e=document.activeElement;if(!e)return null;const t=e.closest("[data-task-id]");return(t==null?void 0:t.dataset.taskId)??null}getSelectedBlockContext(){const e=window.getSelection(),t=e==null?void 0:e.anchorNode;if(!t)return null;const s=t instanceof HTMLElement?t:t.parentElement;if(!s)return null;const r=s.closest("[data-node-id]");if(!r)return null;const a=r.getAttribute("data-node-id");return a?{blockId:a,blockContent:r.textContent||""}:null}buildCreatePayload(e){const t=this.getSelectedBlockContext();return t?{source:e,linkedBlockId:t.blockId,linkedBlockContent:t.blockContent,suggestedName:go(t.blockContent),suggestedTime:mo(t.blockContent)}:{source:e}}async quickCompleteNextTask(){try{const e=this.repository.getTodayAndOverdueTasks();if(e.length===0)return;const t=e[0];await this.taskCommands.completeTask(t.id)}catch(e){Se("Failed to quick complete task",e),W.error("Failed to complete task")}}getDefinition(e){return yr.find(t=>t.id===e)}findDuplicateHotkey(e,t){if(!t)return null;const s=t.toLowerCase(),r=yr.find(a=>a.id===e?!1:(this.settings[a.id]||"").toLowerCase()===s);return r?{id:r.id,label:r.label,description:r.description,context:r.context,currentHotkey:this.settings[r.id],defaultHotkey:r.defaultHotkey}:null}}async function ik(n,e,t,s,r){const a=new ak(n,e,s,r,t);return await a.initialize(),a.registerShortcuts(),a}class ok{constructor(e,t){b(this,"plugin");b(this,"repository");b(this,"topbarElement",null);b(this,"updateIntervalId",null);this.plugin=e,this.repository=t}init(){this.createTopbarButton(),this.startAutoUpdate(),re("Topbar menu initialized")}destroy(){this.updateIntervalId!==null&&(window.clearInterval(this.updateIntervalId),this.updateIntervalId=null),this.topbarElement&&(this.topbarElement.remove(),this.topbarElement=null),re("Topbar menu destroyed")}createTopbarButton(){const e=this.plugin.addTopBar({icon:"iconCalendar",title:"Recurring Tasks",position:"right",callback:()=>{this.toggleMenu()}});this.topbarElement=e,this.updateBadge()}updateBadge(){if(!this.topbarElement)return;const e=this.repository.getTodayAndOverdueTasks(),t=e.filter(s=>{const r=new Date(s.dueAt);return r<new Date&&!jo(r)}).length;if(e.length>0){const s=this.topbarElement.querySelector(".b3-badge");if(s)s.textContent=e.length.toString(),s.style.display="block",t>0?s.style.backgroundColor="var(--b3-theme-error)":s.style.backgroundColor="var(--b3-theme-primary)";else{const r=document.createElement("span");r.className="b3-badge",r.textContent=e.length.toString(),r.style.display="block",r.style.backgroundColor=t>0?"var(--b3-theme-error)":"var(--b3-theme-primary)",this.topbarElement.appendChild(r)}}else{const s=this.topbarElement.querySelector(".b3-badge");s&&s.remove()}}toggleMenu(){Ye.emit("task:settings",{action:"toggle"});const e=new CustomEvent("recurring-task-settings",{detail:{action:"toggle"}});window.dispatchEvent(e)}startAutoUpdate(){this.updateIntervalId=window.setInterval(()=>{this.updateBadge()},60*1e3)}update(){this.updateBadge()}}class lk{constructor(e="tasks"){b(this,"codeLanguage");b(this,"cachedCodeBlocks",new WeakMap);b(this,"cachedAttributeBlocks",new WeakMap);this.codeLanguage=e.toLowerCase()}parse(e){const t=[];let s=this.cachedCodeBlocks.get(e);s||(s=e.querySelectorAll('[data-type="NodeCodeBlock"]'),this.cachedCodeBlocks.set(e,s)),s.forEach(a=>{var d;if((a.dataset.subtype||a.getAttribute("data-subtype")||"").toLowerCase()!==this.codeLanguage)return;const l=a.querySelector("code")||a.querySelector("textarea")||a.querySelector(".hljs")||a,c=((d=l==null?void 0:l.textContent)==null?void 0:d.trim())??"";if(!c)return;const u=a.getAttribute("data-node-id")||`inline-query-${t.length}`;t.push({id:u,query:c,element:a,source:"code"})});let r=this.cachedAttributeBlocks.get(e);return r||(r=e.querySelectorAll("[data-node-id]"),this.cachedAttributeBlocks.set(e,r)),r.forEach(a=>{if(a.classList.contains("rt-inline-query")||a.getAttribute("data-type")==="NodeCodeBlock")return;const i=this.parseAttributes(a);if(!i.query)return;const l=a.getAttribute("data-node-id")||`inline-query-${t.length}`;t.push({id:l,query:i.query,view:i.view,element:a,source:"attribute"})}),t}parseAttributes(e){var a;const t=e.getAttribute("custom-task-query")||e.getAttribute("data-attr-custom-task-query")||e.dataset.customTaskQuery||e.dataset.attrCustomTaskQuery,s=e.getAttribute("custom-task-view")||e.getAttribute("data-attr-custom-task-view")||e.dataset.customTaskView||e.dataset.attrCustomTaskView;if(t)return{query:t.trim(),view:s};const r=e.getAttribute("data-attrs");if(!r)return{};try{const i=JSON.parse(r),l=(a=i["custom-task-query"])==null?void 0:a.trim(),c=i["custom-task-view"];return{query:l,view:c}}catch{return{}}}}class ck{constructor(e=6e4,t=100){b(this,"cache",new Map);b(this,"metrics",{hits:0,misses:0,evictions:0});b(this,"maxSize");this.ttlMs=e,this.maxSize=t}buildKey(e,t){return`${e}::${t}`}get(e){const t=this.cache.get(e);return t?this.ttlMs>0&&Date.now()-t.updatedAt>this.ttlMs?(this.cache.delete(e),this.metrics.misses++,null):(t.lastAccessedAt=Date.now(),this.cache.delete(e),this.cache.set(e,t),this.metrics.hits++,t):(this.metrics.misses++,null)}set(e,t){this.cache.size>=this.maxSize&&!this.cache.has(e)&&this.evictLRU();const s=Date.now();this.cache.set(e,{result:t,updatedAt:s,lastAccessedAt:s})}clear(){this.cache.clear()}evictLRU(){const e=this.cache.keys().next().value;e&&(this.cache.delete(e),this.metrics.evictions++)}getMetrics(){return{hits:this.metrics.hits,misses:this.metrics.misses,size:this.cache.size,evictions:this.metrics.evictions}}resetMetrics(){this.metrics.hits=0,this.metrics.misses=0,this.metrics.evictions=0}}class uk{render(e,t){if(e.innerHTML="",e.classList.add("rt-inline-query"),e.dataset.query=t.query,e.dataset.view=t.view,e.setAttribute("role","region"),e.setAttribute("aria-label","Task query results"),t.isIndexing){e.appendChild(this.renderLoadingState());return}if(t.error){e.appendChild(this.renderErrorState(t.error));return}if(!t.result){e.appendChild(this.renderState("No results yet."));return}const s=t.result.tasks,r=s.length;if(r===0||s.length===0){e.appendChild(this.renderEmptyState());return}const a=document.createElement("div");a.className="rt-inline-query__header",a.textContent=`Inline Tasks  ${r}`,e.appendChild(a);const i=t.view||"list",l=t.result.groups;if(l&&l.size>0?l.forEach((c,u)=>{const d=this.renderGroupSection(u,c,i,t);e.appendChild(d)}):e.appendChild(this.renderTaskCollection(s,i,t)),typeof t.maxItems=="number"&&typeof t.renderedCount=="number"&&t.renderedCount<r){const c=document.createElement("div");c.className="rt-inline-query__footer";const u=document.createElement("button");u.type="button",u.className="rt-inline-query__more",u.dataset.rtAction="more",u.textContent=`Show more (${t.renderedCount}/${r})`,c.appendChild(u),e.appendChild(c)}}renderGroupSection(e,t,s,r){const a=document.createElement("section");a.className="rt-inline-query__group";const i=document.createElement("div");return i.className="rt-inline-query__group-title",i.textContent=e||"Untitled",a.appendChild(i),a.appendChild(this.renderTaskCollection(t,s,r)),a}renderTaskCollection(e,t,s){return t==="table"?this.renderTable(e,s):this.renderList(e,s)}renderList(e,t){const s=document.createElement("ul");s.className="rt-inline-query__list",s.setAttribute("role","list"),s.setAttribute("aria-label","Tasks");const r=document.createDocumentFragment();return this.getRenderedTasks(e,t).forEach(i=>{const l=document.createElement("li");l.className="rt-inline-query__item",l.dataset.taskId=i.id;const c=document.createElement("button");c.type="button",c.className="rt-inline-query__checkbox",c.dataset.rtAction="toggle",c.setAttribute("aria-pressed",String(i.status==="done"));const u=i.status==="done"?`Mark incomplete: ${i.name.replace(/"/g,"'")}`:`Mark complete: ${i.name.replace(/"/g,"'")}`;c.setAttribute("aria-label",u),c.textContent=i.status==="done"?"":"";const d=document.createElement("span");d.className="rt-inline-query__title",d.textContent=i.name,i.status==="done"&&d.classList.add("rt-inline-query__title--done");const f=document.createElement("span");f.className="rt-inline-query__meta",f.textContent=this.formatTaskMeta(i);const p=this.renderSource(i),y=document.createElement("button");y.type="button",y.className="rt-inline-query__edit",y.dataset.rtAction="edit",y.setAttribute("aria-label",`Edit task: ${i.name.replace(/"/g,"'")}`),y.textContent="Edit",l.appendChild(c),l.appendChild(d),l.appendChild(f),p&&l.appendChild(p),l.appendChild(y),r.appendChild(l)}),s.appendChild(r),s}renderTable(e,t){const s=document.createElement("table");s.className="rt-inline-query__table",s.setAttribute("role","table"),s.setAttribute("aria-label","Tasks table");const r=document.createElement("thead"),a=document.createElement("tr");["Status","Task","Dates","Priority","Source",""].forEach(u=>{const d=document.createElement("th");d.textContent=u,a.appendChild(d)}),r.appendChild(a),s.appendChild(r);const i=document.createElement("tbody"),l=document.createDocumentFragment();return this.getRenderedTasks(e,t).forEach(u=>{const d=document.createElement("tr");d.dataset.taskId=u.id;const f=document.createElement("td"),p=document.createElement("button");p.type="button",p.className="rt-inline-query__checkbox",p.dataset.rtAction="toggle",p.setAttribute("aria-pressed",String(u.status==="done"));const y=u.status==="done"?`Mark incomplete: ${u.name.replace(/"/g,"'")}`:`Mark complete: ${u.name.replace(/"/g,"'")}`;p.setAttribute("aria-label",y),p.textContent=u.status==="done"?"":"",f.appendChild(p);const w=document.createElement("td");w.textContent=u.name,u.status==="done"&&w.classList.add("rt-inline-query__title--done");const m=document.createElement("td");m.textContent=this.formatTaskDates(u);const g=document.createElement("td");g.textContent=u.priority??"";const _=document.createElement("td"),x=this.renderSource(u);x?_.appendChild(x):_.textContent="";const D=document.createElement("td"),E=document.createElement("button");E.type="button",E.className="rt-inline-query__edit",E.dataset.rtAction="edit",E.setAttribute("aria-label",`Edit task: ${u.name.replace(/"/g,"'")}`),E.textContent="Edit",D.appendChild(E),d.appendChild(f),d.appendChild(w),d.appendChild(m),d.appendChild(g),d.appendChild(_),d.appendChild(D),l.appendChild(d)}),i.appendChild(l),s.appendChild(i),s}getRenderedTasks(e,t){return t.maxItems?e.slice(0,t.maxItems):e}formatTaskDates(e){const t=[];return e.dueAt&&t.push(`Due ${this.formatDate(e.dueAt)}`),e.scheduledAt&&t.push(`Scheduled ${this.formatDate(e.scheduledAt)}`),e.startAt&&t.push(`Start ${this.formatDate(e.startAt)}`),t.length>0?t.join("  "):""}formatTaskMeta(e){const t=[];return e.dueAt&&t.push(`Due ${this.formatDate(e.dueAt)}`),e.scheduledAt&&t.push(`Scheduled ${this.formatDate(e.scheduledAt)}`),e.startAt&&t.push(`Start ${this.formatDate(e.startAt)}`),e.priority&&t.push(`Priority ${e.priority}`),t.length>0?t.join("  "):"No dates"}formatDate(e){if(!e)return"";try{return new Date(e).toLocaleDateString()}catch{return e}}renderSource(e){if(!e.linkedBlockId&&!e.path)return null;const t=document.createElement("a");return t.className="rt-inline-query__source",t.dataset.rtAction="jump",t.dataset.blockId=e.linkedBlockId??"",e.linkedBlockId&&(t.href=`siyuan://blocks/${e.linkedBlockId}`),t.textContent=this.formatSourceLabel(e),t.title=e.path??e.linkedBlockId??"",t}formatSourceLabel(e){if(e.path){const t=e.path.split("/");return t[t.length-1]||e.path}return e.linkedBlockId?"Block":"Source"}renderState(e,t="info"){const s=document.createElement("div");return s.className=`rt-inline-query__state rt-inline-query__state--${t}`,s.textContent=e,s}renderLoadingState(){const e=document.createElement("div");e.className="rt-inline-query__loading",e.setAttribute("role","status"),e.setAttribute("aria-live","polite"),e.setAttribute("aria-label","Loading tasks");const t=document.createElement("div");t.className="rt-inline-query__spinner";const s=document.createElement("div");return s.className="rt-inline-query__loading-text",s.textContent="Building index",e.appendChild(t),e.appendChild(s),e}renderErrorState(e){const t=document.createElement("div");t.className="rt-inline-query__state rt-inline-query__state--error",t.setAttribute("role","alert");const s=document.createElement("div");s.className="rt-inline-query__error-icon",s.textContent="";const r=document.createElement("div");r.className="rt-inline-query__error-message",r.textContent=e;const a=document.createElement("div");return a.className="rt-inline-query__error-hint",a.textContent="Check your query syntax and try again.",t.appendChild(s),t.appendChild(r),t.appendChild(a),t}renderEmptyState(){const e=document.createElement("div");e.className="rt-inline-query__state rt-inline-query__state--empty";const t=document.createElement("div");t.className="rt-inline-query__empty-icon",t.textContent="";const s=document.createElement("div");s.className="rt-inline-query__empty-message",s.textContent="No tasks match this query";const r=document.createElement("div");return r.className="rt-inline-query__empty-hint",r.textContent="Try adjusting your filters or create a new task.",e.appendChild(t),e.appendChild(s),e.appendChild(r),e}}class dk{constructor(e){b(this,"parser",new lk);b(this,"renderer",new uk);b(this,"cache",new ck);b(this,"queryComposer",new pd(new sr));b(this,"blocks",new Map);b(this,"refreshTimer");b(this,"indexReady",!1);b(this,"unsubs",[]);b(this,"debounceMs");b(this,"pageSize");this.options=e,this.debounceMs=e.debounceMs??300,this.pageSize=e.pageSize??50}mount(){var r,a,i,l;this.refreshAll();const{plugin:e}=this.options,t=()=>this.scheduleRefresh(),s=()=>this.scheduleRefresh();try{const c=(a=(r=e.eventBus).on)==null?void 0:a.call(r,"loaded-protyle",t),u=(l=(i=e.eventBus).on)==null?void 0:l.call(i,"switch-protyle",s);typeof c=="function"&&this.unsubs.push(c),typeof u=="function"&&this.unsubs.push(u)}catch(c){et("Inline query controller failed to bind protyle events",c)}this.unsubs.push(Ye.on("task:refresh",()=>{this.cache.clear(),this.scheduleRefresh()})),this.unsubs.push(Ye.on("task:settings",()=>{this.cache.clear(),this.scheduleRefresh()}))}destroy(){this.refreshTimer&&globalThis.clearTimeout(this.refreshTimer),this.blocks.forEach(({container:e})=>e.remove()),this.blocks.clear(),this.unsubs.forEach(e=>e()),this.unsubs=[]}scheduleRefresh(){this.refreshTimer&&globalThis.clearTimeout(this.refreshTimer),this.refreshTimer=globalThis.setTimeout(()=>{this.refreshAll()},this.debounceMs)}refreshAll(){const e=this.getProtyleRoots();if(e.length===0)return;const t=new Set;e.forEach(s=>{this.parser.parse(s).forEach(a=>{t.add(a.id);const i=this.getOrCreateBlockState(a);this.renderBlock(i)})}),Array.from(this.blocks.keys()).forEach(s=>{if(!t.has(s)){const r=this.blocks.get(s);r==null||r.container.remove(),this.blocks.delete(s)}}),this.indexReady=!0}renderBlock(e){const{block:t}=e,s=t.view??"list";if(!this.indexReady){this.renderer.render(e.container,{query:t.query,view:s,isIndexing:!0});return}let r,a;try{a=this.executeQuery(t.query)}catch(l){r=l instanceof Error?l.message:String(l)}const i=a?Math.min(e.renderLimit,a.tasks.length):0;this.renderer.render(e.container,{query:t.query,view:s,result:a,error:r,maxItems:e.renderLimit,renderedCount:i})}executeQuery(e){const t=this.options.settingsService.get(),s=this.buildSettingsHash(t),r=this.cache.buildKey(e,s),a=this.cache.get(r);if(a)return a.result;const i={getAllTasks:()=>this.options.repository.getAllTasks()},l=new vd(i,{urgencySettings:t.urgency}),c=aa.getInstance();if(c.isEnabled()&&c.getError())throw new Error(`Global query error: ${c.getError()}`);const u=this.queryComposer.compose(e,c.getAST()).ast,d=l.execute(u);return this.cache.set(r,d),d}buildSettingsHash(e){try{return JSON.stringify(e)}catch{return String(Date.now())}}getOrCreateBlockState(e){const t=this.blocks.get(e.id);if(t)return t.block=e,t;const s=document.createElement("div");s.dataset.rtInlineQuery=e.id,s.className="rt-inline-query",e.element.insertAdjacentElement("afterend",s),s.addEventListener("click",a=>this.handleContainerClick(a));const r={block:e,container:s,renderLimit:this.pageSize};return this.blocks.set(e.id,r),r}handleContainerClick(e){const t=e.target;if(!t)return;const s=t.closest("[data-rt-action]");if(!s)return;const r=s.dataset.rtAction,a=t.closest(".rt-inline-query");if(!a)return;const i=a.dataset.rtInlineQuery;if(!i)return;const l=this.blocks.get(i);if(!l)return;if(r==="more"){l.renderLimit+=this.pageSize,this.renderBlock(l);return}const c=t.closest("[data-task-id]"),u=c==null?void 0:c.dataset.taskId;if(u){if(r==="toggle"){this.options.onToggleTask(u);return}if(r==="edit"){const d=this.options.repository.getTask(u);d&&this.options.onEditTask(d)}}}getProtyleRoots(){return Array.from(document.querySelectorAll(".protyle-wysiwyg"))}}function Fi(n,e=new Date){if(!n||typeof n!="string")return{error:!0,message:"Empty or invalid date input"};const t=n.trim();if(!t)return{error:!0,message:"Empty date string"};const s=os.parse(t,e);return s.isValid&&s.date?{date:os.toISODateString(s.date)}:{error:!0,message:s.error||`Could not parse date: ${n}`}}function hk(n){if(!n||typeof n!="string")return{error:!0,message:"Empty or invalid recurrence text"};const e=n.trim();if(!e)return{error:!0,message:"Empty recurrence string"};let t="scheduled",s=e.toLowerCase();s.includes("when done")?(t="done",s=s.replace(/\s*when\s+done\s*$/i,"").trim()):s.includes("when scheduled")&&(t="scheduled",s=s.replace(/\s*when\s+scheduled\s*$/i,"").trim());const r=Xa.parse(s);if(!r.isValid)return{error:!0,message:r.error||`Could not parse recurrence: ${n}`};if(!r.frequency.rruleString)return{error:!0,message:"Failed to generate RRULE string"};let a=r.frequency.rruleString;return a.startsWith("RRULE:")&&(a=a.substring(6)),{rule:a,mode:t}}function fk(n){try{const e=n.startsWith("RRULE:")?n:`RRULE:${n}`;return le.fromString(e).toText()}catch{return n}}const vk=/^-\s*\[\s*([ x\-])\s*\]/i,pk=/\s+([^#]+?)(?=\s*(?:||||||||#|$))/,gk=/\s+([^#]+?)(?=\s*(?:||||||||#|$))/,mk=/\s+([^#]+?)(?=\s*(?:||||||||#|$))/,yk=/\s+(.+?)(?=\s*(?:|||||#|$))/,Rc=//,Nc=//,Pc=//,bk=/\s+([a-zA-Z0-9\-_]+)/,_k=/\s+([a-zA-Z0-9\-_,\s]+)/,Lc=/#([a-zA-Z0-9\-_]+)/g;function Md(n){if(!n||typeof n!="string")return{error:!0,message:"Invalid input: text must be a non-empty string"};const e=n.trim(),t=e.match(vk);if(!t)return{error:!0,message:'Not a checklist item: must start with "- [ ]", "- [x]", or "- [-]"',position:0};const s=t[1].toLowerCase(),r=s==="x"?"done":s==="-"?"cancelled":"todo";let a=e.substring(t[0].length).trim();const i={description:"",status:r},l=a.match(pk);if(l){const m=l[1].trim(),g=Fi(m);if(g.error)return{error:!0,message:`Invalid due date: ${g.message}`,token:m};i.dueDate=g.date,a=a.replace(l[0],"")}const c=a.match(gk);if(c){const m=c[1].trim(),g=Fi(m);if(g.error)return{error:!0,message:`Invalid scheduled date: ${g.message}`,token:m};i.scheduledDate=g.date,a=a.replace(c[0],"")}const u=a.match(mk);if(u){const m=u[1].trim(),g=Fi(m);if(g.error)return{error:!0,message:`Invalid start date: ${g.message}`,token:m};i.startDate=g.date,a=a.replace(u[0],"")}const d=a.match(yk);if(d){const m=d[1].trim(),g=hk(m);if(g.error)return{error:!0,message:`Invalid recurrence: ${g.message}`,token:m};i.recurrence={rule:g.rule,mode:g.mode},a=a.replace(d[0],"")}Rc.test(a)&&(i.priority="high",a=a.replace(Rc,"")),Nc.test(a)&&(i.priority="medium",a=a.replace(Nc,"")),Pc.test(a)&&(i.priority="low",a=a.replace(Pc,""));const f=a.match(bk);f&&(i.id=f[1],a=a.replace(f[0],""));const p=a.match(_k);if(p){const m=p[1].split(",").map(g=>g.trim()).filter(g=>g.length>0);m.length>0&&(i.dependsOn=m),a=a.replace(p[0],"")}const y=[],w=a.matchAll(Lc);for(const m of w)y.push(m[1]);return y.length>0&&(i.tags=y,a=a.replace(Lc,"")),i.description=a.trim(),i}function wk(n){const e=[],t=n.status==="done"?"x":n.status==="cancelled"?"-":" ";if(e.push(`- [${t}]`),e.push(n.description),n.dueDate&&e.push(` ${n.dueDate}`),n.scheduledDate&&e.push(` ${n.scheduledDate}`),n.startDate&&e.push(` ${n.startDate}`),n.recurrence){const s=fk(n.recurrence.rule),r=n.recurrence.mode==="done"?" when done":"";e.push(` ${s}${r}`)}return n.priority==="high"?e.push(""):n.priority==="medium"?e.push(""):n.priority==="low"&&e.push(""),n.id&&e.push(` ${n.id}`),n.dependsOn&&n.dependsOn.length>0&&e.push(` ${n.dependsOn.join(",")}`),n.tags&&n.tags.length>0&&e.push(...n.tags.map(s=>`#${s}`)),e.join(" ")}function kk(){const n=window.getSelection(),e=n==null?void 0:n.anchorNode;if(!e)return null;const t=e instanceof HTMLElement?e:e.parentElement;if(!t)return null;const s=t.closest("[data-node-id]");if(!s)return null;const r=s.getAttribute("data-node-id");if(!r)return null;const a=s.textContent||"",i=/^-\s*\[\s*[x\s\-]\s*\]/i.test(a.trim());return{blockId:r,content:a.trim(),isChecklist:i}}const qi=new Map;function Od(n,e){et("Task parse error",{error:n,blockId:e});const t=`Invalid task syntax: ${n.message}`;W.warning(t,5e3),Tk(e),n.token&&re("Problematic token",{token:n.token}),n.position!==void 0&&re("Error position",{position:n.position})}function Tk(n){try{const e=document.querySelector(`[data-node-id="${n}"]`);if(e){e.classList.add("task-parse-error");const t=qi.get(n);t!==void 0&&clearTimeout(t);const s=setTimeout(()=>{const r=document.querySelector(`[data-node-id="${n}"]`);r&&r.classList.remove("task-parse-error"),qi.delete(n)},5e3);qi.set(n,s)}}catch(e){et("Failed to add error class to block",{error:e,blockId:n})}}async function Sk(n){re("Create task from block command triggered");const e=kk();if(!e){W.error("No block selected or cursor not in editor"),et("No block context available");return}re("Block data extracted",{blockId:e.blockId,isChecklist:e.isChecklist,contentLength:e.content.length});let t=e.content;e.isChecklist||(t=`- [ ] ${t}`,re("Auto-promoted plain text to checklist"));const s=Md(t);if("error"in s){re("Parse error occurred, opening editor with raw content",{error:s}),Od(s,e.blockId);const i=pa(e.content,oi(),new Date);i.linkedBlockId=e.blockId,i.linkedBlockContent=e.content,n.openTaskEditor(i,{name:e.content,status:"todo"});return}re("Task parsed successfully",{parsed:s});const r=n.repository.getTaskByBlockId(e.blockId);let a;r?(re("Editing existing task",{taskId:r.id}),a={...r},Rd(a,s)):(re("Creating new task from block"),a=xk(s,e.blockId,e.content)),n.openTaskEditor(a)}function xk(n,e,t){const s=n.dueDate?new Date(n.dueDate):new Date,r=oi(),a=pa(n.description,r,s);return a.linkedBlockId=e,a.linkedBlockContent=t,Rd(a,n),a}function Rd(n,e){n.name=e.description,n.status=e.status,e.dueDate&&(n.dueAt=new Date(e.dueDate).toISOString()),e.scheduledDate&&(n.scheduledAt=new Date(e.scheduledDate).toISOString()),e.startDate&&(n.startAt=new Date(e.startDate).toISOString()),e.priority&&(n.priority=e.priority==="high"?"high":e.priority==="low"?"low":"normal"),e.tags&&(n.tags=e.tags),e.dependsOn&&(n.dependsOn=e.dependsOn),e.recurrence&&(n.recurrenceText=e.recurrence.rule)}class Dk{constructor(e){b(this,"deps");b(this,"debouncedCreateTimeout");b(this,"debouncedCreateInternal",async(e,t)=>{await this.tryAutoCreate(e,t)});b(this,"debouncedCreate",(e,t)=>{this.debouncedCreateTimeout!==void 0&&clearTimeout(this.debouncedCreateTimeout),this.debouncedCreateTimeout=setTimeout(()=>{this.debouncedCreateInternal(e,t),this.debouncedCreateTimeout=void 0},500)});this.deps=e}async handleEnter(e,t){const s=this.deps.settings();if(!s.enableInlineCreation||!s.autoCreateOnEnter){re("Auto-create on Enter disabled");return}await this.tryAutoCreate(e,t)}async handleBlur(e,t){const s=this.deps.settings();if(!s.enableInlineCreation||!s.autoCreateOnBlur){re("Auto-create on Blur disabled");return}this.debouncedCreate(e,t)}async tryAutoCreate(e,t){try{const s=this.deps.settings();if(!t.trim().match(/^-\s*\[\s*[x\s\-]\s*\]/i)){re("Not a checklist, skipping auto-create",{blockId:e});return}const r=this.deps.repository.getTaskByBlockId(e);if(r){re("Task already exists for block, skipping",{blockId:e,taskId:r.id});return}const a=Md(t);if("error"in a){s.showInlineHints&&Od(a,e),et("Parse error during auto-create",{error:a,blockId:e});return}re("Auto-creating task from block",{blockId:e,parsed:a});const i=this.createTaskFromParsed(a,e,t);if(await this.deps.saveTask(i),re("Task auto-created successfully",{taskId:i.id,blockId:e}),s.normalizeOnSave&&this.deps.updateBlockContent){const l=wk(a);l!==t&&(await this.deps.updateBlockContent(e,l),re("Block content normalized",{blockId:e}))}}catch(s){Se("Auto-create failed",{error:s,blockId:e})}}createTaskFromParsed(e,t,s){const r=pa(e.description||"Untitled Task",oi(),new Date);return r.linkedBlockId=t,r.linkedBlockContent=s,e.dueDate&&(r.due=new Date(e.dueDate)),e.scheduledDate&&(r.scheduled=new Date(e.scheduledDate)),e.startDate&&(r.start=new Date(e.startDate)),e.priority&&(r.priority=e.priority==="high"?1:e.priority==="medium"?2:3),e.tags&&(r.tags=e.tags),e.recurrence&&(r.frequency.recurrenceRule=e.recurrence.rule),r.status=e.status==="done"?"done":e.status==="cancelled"?"cancelled":"todo",r}cleanup(){this.debouncedCreateTimeout!==void 0&&(clearTimeout(this.debouncedCreateTimeout),this.debouncedCreateTimeout=void 0)}}const ea=class ea extends _o.Plugin{constructor(){super(...arguments);b(this,"taskManager");b(this,"repository");b(this,"scheduler");b(this,"eventService");b(this,"migrationManager");b(this,"topbarMenu");b(this,"settingsService");b(this,"dashboardComponent",null);b(this,"dockEl");b(this,"quickAddComponent",null);b(this,"quickAddContainer",null);b(this,"taskEditorComponent",null);b(this,"taskEditorContainer",null);b(this,"postponeComponent",null);b(this,"postponeContainer",null);b(this,"pendingCompletionTimeouts",new Map);b(this,"shortcutManager",null);b(this,"inlineQueryController",null);b(this,"autoTaskCreator",null);b(this,"autoCreationKeydownHandler",null);b(this,"autoCreationBlurHandler",null);b(this,"handleCreateTaskEvent",t=>{try{const s=t;re("Create task event received",s.detail),this.openQuickAdd(s.detail)}catch(s){Se("Failed to handle create task event",s),W.error("Failed to open task creator.")}});b(this,"handleSettingsEvent",t=>{try{re("Settings event received",t.detail),this.openDock()}catch(s){Se("Failed to handle settings event",s),W.error("Failed to open settings.")}});b(this,"handleCompleteTaskEvent",async t=>{try{const s=t,{taskId:r}=s.detail??{};if(!r)throw new Error("Missing taskId for completion event.");await this.handleCompleteTask(r)}catch(s){Se("Failed to complete task",s),W.error("Failed to complete task.")}});b(this,"handleSnoozeTaskEvent",async t=>{try{const s=t,{taskId:r,minutes:a}=s.detail??{};if(!r||typeof a!="number")throw new Error("Missing task snooze details.");await this.handleSnoozeTask(r,a)}catch(s){Se("Failed to snooze task",s),W.error("Failed to snooze task.")}})}async onload(){re("Loading Recurring Tasks Plugin"),this.migrationManager=new Iw(this);try{await this.migrationManager.migrate($n)}catch(r){Se("Migration failed, continuing with existing data",r)}const t=Za.getInstance(this);if(!t)throw new Error("TaskManager failed to initialize");this.taskManager=t,await this.taskManager.initialize(),this.repository=this.taskManager.getRepository(),this.scheduler=this.taskManager.getScheduler(),this.eventService=this.taskManager.getEventService();const s=this.taskManager.getSettingsService();this.settingsService=s;try{await this.taskManager.start()}catch(r){Se("Failed to start TaskManager",r)}this.shortcutManager=await ik(this,this.repository,{createTask:r=>this.dispatchCreateTask(r),completeTask:r=>Ye.emit("task:complete",{taskId:r}),postponeTask:r=>this.openPostponePicker(r),openDock:()=>this.openDock(),openTaskEditor:()=>this.openTaskEditor(),createTaskFromBlock:()=>this.handleCreateTaskFromBlock()},this.scheduler.getRecurrenceEngine(),()=>s.get()),this.addCommand({langString:"switchGlobalFilterProfile",hotkey:"F",callback:async()=>{var d;const a=fs.getInstance().getConfig();if(!a.enabled){showMessage(this.i18n.globalFilterDisabled||"Global Filter is disabled. Enable it in settings first.",3e3,"info");return}if(a.profiles.length===0){showMessage(this.i18n.noProfiles||"No profiles found. Create one in settings.",3e3,"info");return}const i=new Menu;a.profiles.forEach(f=>{i.addItem({label:f.name,icon:f.id===a.activeProfileId?"iconCheck":"",click:async()=>{await this.switchToProfile(f.id)}})}),i.addSeparator(),i.addItem({label:this.i18n.manageProfiles||"Manage Profiles...",icon:"iconSettings",click:()=>{this.openSettings("global-filter")}});const l=(d=document.activeElement)==null?void 0:d.getBoundingClientRect(),c=l?l.left:window.innerWidth/2,u=l?l.bottom+5:100;i.showAtPosition({x:c,y:u})}}),this.addCommand({langString:"toggleGlobalFilter",hotkey:"",callback:async()=>{const r=fs.getInstance(),a=r.getConfig(),i=!a.enabled;await this.settingsService.update({globalFilter:{...a,enabled:i}}),r.updateConfig({...a,enabled:i}),showMessage(i?this.i18n.globalFilterEnabled||"Global Filter enabled":this.i18n.globalFilterDisabled||"Global Filter disabled",2e3,"info"),Ye.emit("task:refresh",void 0)}}),this.addCommand({langString:"showGlobalFilterStatus",hotkey:"",callback:async()=>{const r=fs.getInstance(),a=r.getConfig(),i=r.getActiveProfile();if(!a.enabled){showMessage(this.i18n.globalFilterDisabled||"Global Filter: Disabled",3e3,"info");return}if(!i){showMessage(this.i18n.noActiveProfile||"No active profile",3e3,"error");return}const l=await this.repository.getAllTasks(),c=l.filter(p=>r.shouldIncludeTask(p)).length,u=l.length-c,d=`
          <div style="padding: 10px;">
            <h3 style="margin: 0 0 10px 0;">Global Filter Status</h3>
            <p><strong>Active Profile:</strong> ${i.name}</p>
            ${i.description?`<p style="color: var(--text-muted); font-size: 0.9em;">${i.description}</p>`:""}
            <p><strong>Included Tasks:</strong> ${c}</p>
            <p><strong>Excluded Tasks:</strong> ${u}</p>
            <p><strong>Total Tasks:</strong> ${l.length}</p>
          </div>
        `;new Dialog({title:"Global Filter Status",content:d,width:"400px"}).open()}}),this.addCommand({langString:"createGlobalFilterProfile",hotkey:"",callback:async()=>{const r=await this.promptForInput(this.i18n.enterProfileName||"Enter profile name:","");if(!r||r.trim()==="")return;const a=fs.getInstance(),i=a.getConfig(),l={id:`profile_${Date.now()}`,name:r.trim(),description:"",includePaths:[],excludePaths:[],includeTags:[],excludeTags:[],includeRegex:void 0,excludeRegex:void 0,regexTargets:["taskText"],excludeStatusTypes:[]},c={...i,profiles:[...i.profiles,l],activeProfileId:l.id};a.updateConfig(c),await this.settingsService.update({globalFilter:c}),showMessage(`Profile "${r}" created and activated`,2e3,"info"),await this.confirmDialog(this.i18n.configureNewProfile||"Configure new profile now?")&&this.openSettings("global-filter")}}),this.addCommand({langString:"explainTaskExclusion",hotkey:"",callback:async()=>{const r=fs.getInstance();if(!r.getConfig().enabled){showMessage(this.i18n.globalFilterDisabled||"Global Filter is disabled",2e3,"info");return}const i=await this.getFocusedTask();if(!i){showMessage(this.i18n.noTaskSelected||"No task selected. Click on a task first.",3e3,"info");return}const l=r.explainTask(i);let c=`
          <div style="padding: 10px;">
            <h3 style="margin: 0 0 10px 0;">Filter Explanation</h3>
            <p><strong>Task:</strong> ${i.name}</p>
        `;l.included?c+=`
            <p style="color: var(--text-success); font-weight: 600;"> Task is INCLUDED</p>
            <p>${l.reason}</p>
          `:(c+=`
            <p style="color: var(--text-error); font-weight: 600;"> Task is EXCLUDED</p>
            <p><strong>Reason:</strong> ${l.reason}</p>
          `,l.matchedRule&&(c+=`
              <p><strong>Matched Rule:</strong></p>
              <ul style="margin-left: 20px;">
                <li><strong>Type:</strong> ${l.matchedRule.type}</li>
                <li><strong>Pattern:</strong> <code>${l.matchedRule.pattern}</code></li>
                ${l.matchedRule.target?`<li><strong>Target:</strong> ${l.matchedRule.target}</li>`:""}
              </ul>
            `)),c+="</div>",new Dialog({title:"Task Filter Explanation",content:c,width:"500px"}).open()}}),sk(this),this.topbarMenu=new ok(this,this.repository),this.topbarMenu.init(),this.addDock({config:{position:"RightBottom",size:{width:400,height:600},icon:"iconCalendar",title:"Recurring Tasks"},data:null,type:Sv,init:r=>{this.dockEl=r.element,this.renderDashboard()},destroy:()=>{this.destroyDashboard()}}),this.addEventListeners(),this.inlineQueryController=new dk({plugin:this,repository:this.repository,settingsService:this.settingsService,onEditTask:r=>this.openTaskEditor(r),onToggleTask:r=>Ye.emit("task:complete",{taskId:r})}),this.inlineQueryController.mount(),this.autoTaskCreator=new Dk({repository:this.repository,settings:()=>this.settingsService.get().inlineTasks,saveTask:async r=>{await this.repository.createTask(r)}}),this.setupAutoCreationEventHandlers(),re("Recurring Tasks Plugin loaded successfully")}async onunload(){re("Unloading Recurring Tasks Plugin"),this.pendingCompletionTimeouts.forEach(t=>{globalThis.clearTimeout(t)}),this.pendingCompletionTimeouts.clear(),this.taskManager&&await this.taskManager.destroy(),this.topbarMenu&&this.topbarMenu.destroy(),this.autoTaskCreator&&this.autoTaskCreator.cleanup(),this.destroyDashboard(),this.closeQuickAdd(),this.closeTaskEditor(),this.closePostponePicker(),this.removeEventListeners(),this.shortcutManager&&(this.shortcutManager.destroy(),this.shortcutManager=null),this.inlineQueryController&&(this.inlineQueryController.destroy(),this.inlineQueryController=null)}renderDashboard(){this.dockEl&&!this.dashboardComponent&&(this.dashboardComponent=Sa(yw,{target:this.dockEl,props:{repository:this.repository,scheduler:this.scheduler,eventService:this.eventService,shortcutManager:this.shortcutManager,settingsService:this.settingsService}}))}destroyDashboard(){this.dashboardComponent&&(xa(this.dashboardComponent),this.dashboardComponent=null)}addEventListeners(){try{Ye.on("task:create",t=>{re("Create task event received",t),this.openQuickAdd(t)}),Ye.on("task:complete",async t=>{await this.handleCompleteTask(t.taskId)}),Ye.on("task:snooze",async t=>{await this.handleSnoozeTask(t.taskId,t.minutes)}),Ye.on("task:settings",()=>{this.openDock()}),Ye.on("task:refresh",()=>{}),window.addEventListener("recurring-task-create",this.handleCreateTaskEvent),window.addEventListener("recurring-task-settings",this.handleSettingsEvent),window.addEventListener("recurring-task-complete",this.handleCompleteTaskEvent),window.addEventListener("task-snooze",this.handleSnoozeTaskEvent)}catch(t){Se("Failed to add event listeners",t),this.removeEventListeners()}}removeEventListeners(){Ye.clear(),window.removeEventListener("recurring-task-create",this.handleCreateTaskEvent),window.removeEventListener("recurring-task-settings",this.handleSettingsEvent),window.removeEventListener("recurring-task-complete",this.handleCompleteTaskEvent),window.removeEventListener("task-snooze",this.handleSnoozeTaskEvent),this.autoCreationKeydownHandler&&document.removeEventListener("keydown",this.autoCreationKeydownHandler),this.autoCreationBlurHandler&&document.removeEventListener("focusout",this.autoCreationBlurHandler,!0)}setupAutoCreationEventHandlers(){this.autoTaskCreator&&(this.autoCreationKeydownHandler=t=>{if(t.key!=="Enter")return;const r=t.target.closest("[data-node-id]");if(!r)return;const a=r.getAttribute("data-node-id"),i=r.textContent||"";!a||!ea.CHECKLIST_PATTERN.test(i.trim())||this.autoTaskCreator.handleEnter(a,i.trim())},this.autoCreationBlurHandler=t=>{const r=t.target.closest("[data-node-id]");if(!r)return;const a=r.getAttribute("data-node-id"),i=r.textContent||"";!a||!ea.CHECKLIST_PATTERN.test(i.trim())||this.autoTaskCreator.handleBlur(a,i.trim())},document.addEventListener("keydown",this.autoCreationKeydownHandler),document.addEventListener("focusout",this.autoCreationBlurHandler,!0),re("Auto-creation event handlers registered"))}async handleCompleteTask(t){const s=this.repository.getTask(t);if(s){if(this.pendingCompletionTimeouts.has(t)){W.info(`Completion already pending for "${s.name}".`);return}const r=globalThis.setTimeout(async()=>{this.pendingCompletionTimeouts.delete(t);try{await this.eventService.handleTaskCompleted(s),await this.scheduler.markTaskDone(t),this.topbarMenu&&this.topbarMenu.update(),Ye.emit("task:refresh",void 0),re(`Task completed: ${s.name}`)}catch(i){Se("Failed to finalize task completion",i),W.error("Failed to complete task.")}},5e3);this.pendingCompletionTimeouts.set(t,r);const a=()=>{const i=this.pendingCompletionTimeouts.get(t);i&&(globalThis.clearTimeout(i),this.pendingCompletionTimeouts.delete(t),W.info(`Undo: "${s.name}" restored`))};Yn({message:`Task "${s.name}" completed.`,type:"success",duration:5e3,actionLabel:"Undo",onAction:a,showCountdown:!0})}}async handleSnoozeTask(t,s){const r=this.repository.getTask(t);r&&(await this.eventService.handleTaskSnoozed(r),await this.scheduler.delayTask(t,s),this.topbarMenu&&this.topbarMenu.update(),re(`Task snoozed: ${r.name} for ${s} minutes`))}openQuickAdd(t){this.quickAddComponent&&this.closeQuickAdd(),this.quickAddContainer=document.createElement("div"),document.body.appendChild(this.quickAddContainer),this.quickAddComponent=Sa(Sw,{target:this.quickAddContainer,props:{repository:this.repository,prefill:t,onClose:()=>this.closeQuickAdd(),onAdvanced:()=>{this.closeQuickAdd(),this.openTaskEditor()}}})}openPostponePicker(t){const s=this.repository.getTask(t);if(!s){W.error("Task not found");return}this.postponeComponent&&this.closePostponePicker(),this.postponeContainer=document.createElement("div"),document.body.appendChild(this.postponeContainer),this.postponeComponent=Sa(Ew,{target:this.postponeContainer,props:{taskName:s.name,onClose:()=>this.closePostponePicker(),onSelect:r=>{po(t,r),this.closePostponePicker()}}})}closePostponePicker(){this.postponeComponent&&(xa(this.postponeComponent),this.postponeComponent=null),this.postponeContainer&&(this.postponeContainer.remove(),this.postponeContainer=null)}dispatchCreateTask(t){Ye.emit("task:create",t),window.dispatchEvent(new CustomEvent("recurring-task-create",{detail:t}))}closeQuickAdd(){this.quickAddComponent&&(xa(this.quickAddComponent),this.quickAddComponent=null),this.quickAddContainer&&(this.quickAddContainer.remove(),this.quickAddContainer=null)}openTaskEditor(t){this.taskEditorComponent&&this.closeTaskEditor(),this.taskEditorContainer=document.createElement("div"),document.body.appendChild(this.taskEditorContainer),this.taskEditorComponent=Sa(Dd,{target:this.taskEditorContainer,props:{repository:this.repository,task:t,onClose:()=>this.closeTaskEditor(),onSave:()=>{window.dispatchEvent(new CustomEvent("recurring-task-refresh"))}}})}closeTaskEditor(){this.taskEditorComponent&&(xa(this.taskEditorComponent),this.taskEditorComponent=null),this.taskEditorContainer&&(this.taskEditorContainer.remove(),this.taskEditorContainer=null)}async handleCreateTaskFromBlock(){const t=new Id;await Sk({repository:this.repository,blockApi:t,openTaskEditor:(s,r)=>{this.openTaskEditor(s)}})}async switchToProfile(t){const s=fs.getInstance(),r=s.getConfig(),a=r.profiles.find(i=>i.id===t);if(!a){showMessage(this.i18n.profileNotFound||"Profile not found",2e3,"error");return}s.setActiveProfile(t),await this.settingsService.update({globalFilter:{...r,activeProfileId:t}}),showMessage(`Switched to profile: ${a.name}`,2e3,"info"),Ye.emit("task:refresh",void 0)}openSettings(t){const s=new SettingsDialog(this,this.settingsService);t&&s.openToSection(t),s.open()}async promptForInput(t,s){return new Promise(r=>{var l;const a=new Dialog({title:t,content:`
          <div style="padding: 10px;">
            <input 
              type="text" 
              id="input-value" 
              value="${s}" 
              style="width: 100%; padding: 8px; border: 1px solid var(--background-modifier-border); border-radius: 4px;"
            />
          </div>
        `,width:"400px"});(l=a.element.querySelector("#input-value"))==null||l.addEventListener("keypress",c=>{var u;if(c.key==="Enter"){const d=(u=a.element.querySelector("#input-value"))==null?void 0:u.value;a.destroy(),r(d||null)}});const i=a.element.querySelector(".b3-dialog__footer");if(i){const c=document.createElement("button");c.textContent="OK",c.className="b3-button b3-button--primary",c.onclick=()=>{var f;const d=(f=a.element.querySelector("#input-value"))==null?void 0:f.value;a.destroy(),r(d||null)};const u=document.createElement("button");u.textContent="Cancel",u.className="b3-button",u.onclick=()=>{a.destroy(),r(null)},i.appendChild(u),i.appendChild(c)}a.open()})}async confirmDialog(t){return new Promise(s=>{const r=new Dialog({title:"Confirm",content:`<div style="padding: 10px;">${t}</div>`,width:"350px"}),a=r.element.querySelector(".b3-dialog__footer");if(a){const i=document.createElement("button");i.textContent="Yes",i.className="b3-button b3-button--primary",i.onclick=()=>{r.destroy(),s(!0)};const l=document.createElement("button");l.textContent="No",l.className="b3-button",l.onclick=()=>{r.destroy(),s(!1)},a.appendChild(l),a.appendChild(i)}r.open()})}async getFocusedTask(){const t=document.activeElement,s=t==null?void 0:t.getAttribute("data-task-id");return s?this.repository.getTask(s)||null:(this.taskEditorComponent,null)}};b(ea,"CHECKLIST_PATTERN",/^-\s*\[\s*[x\s\-]\s*\]/i);let yo=ea;module.exports=yo;
